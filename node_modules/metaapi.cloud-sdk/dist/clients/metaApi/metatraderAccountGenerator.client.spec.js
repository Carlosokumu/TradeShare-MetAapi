'use strict';

var _httpClient = require('../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _metatraderAccountGenerator = require('./metatraderAccountGenerator.client');

var _metatraderAccountGenerator2 = _interopRequireDefault(_metatraderAccountGenerator);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const provisioningApiUrl = 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai';

/**
 * @test {MetatraderAccountGeneratorClient}
 */
describe('MetatraderAccountGeneratorClient', () => {

  let client;
  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let domainClient;
  let sandbox;
  let requestStub;

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    domainClient = {
      token,
      domain: 'agiliumtrade.agiliumtrade.ai',
      getUrl: () => {}
    };
    client = new _metatraderAccountGenerator2.default(httpClient, domainClient);
    requestStub = sandbox.stub(httpClient, 'request');
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT4DemoAccount}
   */
  it('should create new MetaTrader 4 demo account', async () => {
    let expected = { login: '12345', password: 'qwerty', serverName: 'HugosWay-Demo3', investorPassword: 'qwerty' };
    requestStub.resolves(expected);
    let account = await client.createMT4DemoAccount({
      accountType: 'type',
      balance: 10,
      email: 'test@test.com',
      leverage: 15,
      serverName: 'HugosWay-Demo3'
    }, 'profileId1');
    account.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${provisioningApiUrl}/users/current/provisioning-profiles/profileId1/mt4-demo-accounts`,
      method: 'POST',
      headers: {
        'auth-token': token
      },
      body: {
        accountType: 'type',
        balance: 10,
        email: 'test@test.com',
        leverage: 15,
        serverName: 'HugosWay-Demo3'
      },
      json: true
    }, 'createMT4DemoAccount');
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT4DemoAccount}
   */
  it('should not create MetaTrader 4 demo account via API with account token', async () => {
    domainClient.token = 'token';
    client = new _metatraderAccountGenerator2.default(httpClient, domainClient);
    try {
      await client.createMT4DemoAccount({}, 'profileId1');
      _sinon2.default.assert.fail();
    } catch (error) {
      error.message.should.equal('You can not invoke createMT4DemoAccount method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT4LiveAccount}
   */
  it('should create new MetaTrader 4 live acccount', async () => {
    let expected = { login: '12345', password: 'qwerty', serverName: 'HugosWay-Live3', investorPassword: 'qwerty' };
    requestStub.resolves(expected);
    let account = await client.createMT4LiveAccount({
      accountType: 'type',
      balance: 10,
      email: 'test@test.com',
      leverage: 15,
      serverName: 'HugosWay-Live3'
    }, 'profileId1');
    account.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${provisioningApiUrl}/users/current/provisioning-profiles/profileId1/mt4-live-accounts`,
      method: 'POST',
      headers: {
        'auth-token': token
      },
      body: {
        accountType: 'type',
        balance: 10,
        email: 'test@test.com',
        leverage: 15,
        serverName: 'HugosWay-Live3'
      },
      json: true
    }, 'createMT4LiveAccount');
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT4LiveAccount}
   */
  it('should not create MetaTrader 4 live account via API with account token', async () => {
    domainClient.token = 'token';
    client = new _metatraderAccountGenerator2.default(httpClient, domainClient);
    try {
      await client.createMT4LiveAccount({}, 'profileId1');
      _sinon2.default.assert.fail();
    } catch (error) {
      error.message.should.equal('You can not invoke createMT4LiveAccount method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT5DemoAccount}
   */
  it('should create new MetaTrader 5 demo account', async () => {
    let expected = { login: '12345', password: 'qwerty', serverName: 'HugosWay-Demo3', investorPassword: 'qwerty' };
    requestStub.resolves(expected);
    let account = await client.createMT5DemoAccount({
      accountType: 'type',
      balance: 10,
      email: 'test@test.com',
      leverage: 15,
      serverName: 'HugosWay-Demo3'
    }, 'profileId2');
    account.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${provisioningApiUrl}/users/current/provisioning-profiles/profileId2/mt5-demo-accounts`,
      method: 'POST',
      headers: {
        'auth-token': token
      },
      body: {
        accountType: 'type',
        balance: 10,
        email: 'test@test.com',
        leverage: 15,
        serverName: 'HugosWay-Demo3'
      },
      json: true
    }, 'createMT5DemoAccount');
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT5DemoAccount}
   */
  it('should not create MetaTrader 5 demo account via API with account token', async () => {
    domainClient.token = 'token';
    client = new _metatraderAccountGenerator2.default(httpClient, domainClient);
    try {
      await client.createMT5DemoAccount({}, 'profileId2');
      _sinon2.default.assert.fail();
    } catch (error) {
      error.message.should.equal('You can not invoke createMT5DemoAccount method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT5LiveAccount}
   */
  it('should create new MetaTrader 5 live account', async () => {
    let expected = { login: '12345', password: 'qwerty', serverName: 'HugosWay-Live3', investorPassword: 'qwerty' };
    requestStub.resolves(expected);
    let account = await client.createMT5LiveAccount({
      accountType: 'type',
      balance: 10,
      email: 'test@test.com',
      leverage: 15,
      serverName: 'HugosWay-Live3'
    }, 'profileId2');
    account.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${provisioningApiUrl}/users/current/provisioning-profiles/profileId2/mt5-live-accounts`,
      method: 'POST',
      headers: {
        'auth-token': token
      },
      body: {
        accountType: 'type',
        balance: 10,
        email: 'test@test.com',
        leverage: 15,
        serverName: 'HugosWay-Live3'
      },
      json: true
    }, 'createMT5LiveAccount');
  });

  /**
   * @test {MetatraderAccountGeneratorClient#createMT5LiveAccount}
   */
  it('should not create MetaTrader 5 live account via API with account token', async () => {
    domainClient.token = 'token';
    client = new _metatraderAccountGenerator2.default(httpClient, domainClient);
    try {
      await client.createMT5LiveAccount({}, 'profileId2');
      _sinon2.default.assert.fail();
    } catch (error) {
      error.message.should.equal('You can not invoke createMT5LiveAccount method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL21ldGFBcGkvbWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3IuY2xpZW50LnNwZWMuZXM2Il0sIm5hbWVzIjpbInByb3Zpc2lvbmluZ0FwaVVybCIsImRlc2NyaWJlIiwiY2xpZW50IiwidG9rZW4iLCJodHRwQ2xpZW50IiwiSHR0cENsaWVudCIsImRvbWFpbkNsaWVudCIsInNhbmRib3giLCJyZXF1ZXN0U3R1YiIsImJlZm9yZSIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImJlZm9yZUVhY2giLCJkb21haW4iLCJnZXRVcmwiLCJNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudCIsInN0dWIiLCJhZnRlckVhY2giLCJyZXN0b3JlIiwiaXQiLCJleHBlY3RlZCIsImxvZ2luIiwicGFzc3dvcmQiLCJzZXJ2ZXJOYW1lIiwiaW52ZXN0b3JQYXNzd29yZCIsInJlc29sdmVzIiwiYWNjb3VudCIsImNyZWF0ZU1UNERlbW9BY2NvdW50IiwiYWNjb3VudFR5cGUiLCJiYWxhbmNlIiwiZW1haWwiLCJsZXZlcmFnZSIsInNob3VsZCIsImVxdWFsIiwiYXNzZXJ0IiwiY2FsbGVkT25jZVdpdGhFeGFjdGx5IiwicmVxdWVzdCIsInVybCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwianNvbiIsImZhaWwiLCJlcnJvciIsIm1lc3NhZ2UiLCJjcmVhdGVNVDRMaXZlQWNjb3VudCIsImNyZWF0ZU1UNURlbW9BY2NvdW50IiwiY3JlYXRlTVQ1TGl2ZUFjY291bnQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsTUFBTUEscUJBQXFCLDZEQUEzQjs7QUFFQTs7O0FBR0FDLFNBQVMsa0NBQVQsRUFBNkMsTUFBTTs7QUFFakQsTUFBSUMsTUFBSjtBQUNBLFFBQU1DLFFBQVEscUJBQWQ7QUFDQSxNQUFJQyxhQUFhLElBQUlDLG9CQUFKLEVBQWpCO0FBQ0EsTUFBSUMsWUFBSjtBQUNBLE1B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QkFBTXdCLE1BQU4sQ0FBYUMscUJBQWIsQ0FBbUMvQixXQUFXZ0MsT0FBOUMsRUFBdUQ7QUFDckRDLFdBQU0sR0FBRXJDLGtCQUFtQixtRUFEMEI7QUFFckRzQyxjQUFRLE1BRjZDO0FBR3JEQyxlQUFTO0FBQ1Asc0JBQWNwQztBQURQLE9BSDRDO0FBTXJEcUMsWUFBTTtBQUNKWixxQkFBYSxNQURUO0FBRUpDLGlCQUFTLEVBRkw7QUFHSkMsZUFBTyxlQUhIO0FBSUpDLGtCQUFVLEVBSk47QUFLSlIsb0JBQVk7QUFMUixPQU4rQztBQWFyRGtCLFlBQU07QUFiK0MsS0FBdkQsRUFjRyxzQkFkSDtBQWVELEdBNUJEOztBQThCQTs7O0FBR0F0QixLQUFHLHdFQUFILEVBQTZFLFlBQVk7QUFDdkZiLGlCQUFhSCxLQUFiLEdBQXFCLE9BQXJCO0FBQ0FELGFBQVMsSUFBSWEsb0NBQUosQ0FBcUNYLFVBQXJDLEVBQWlERSxZQUFqRCxDQUFUO0FBQ0EsUUFBSTtBQUNGLFlBQU1KLE9BQU82QyxvQkFBUCxDQUE0QixFQUE1QixFQUFnQyxZQUFoQyxDQUFOO0FBQ0FyQyxzQkFBTXdCLE1BQU4sQ0FBYVEsSUFBYjtBQUNELEtBSEQsQ0FHRSxPQUFPQyxLQUFQLEVBQWM7QUFDZEEsWUFBTUMsT0FBTixDQUFjWixNQUFkLENBQXFCQyxLQUFyQixDQUNFLDJHQUNBLDhGQUZGO0FBSUQ7QUFDRixHQVpEO0FBY0QsQ0FoT0QiLCJmaWxlIjoibWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3IuY2xpZW50LnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBIdHRwQ2xpZW50IGZyb20gJy4uL2h0dHBDbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudCBmcm9tICcuL21ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yLmNsaWVudCc7XG5cbmNvbnN0IHByb3Zpc2lvbmluZ0FwaVVybCA9ICdodHRwczovL210LXByb3Zpc2lvbmluZy1hcGktdjEuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haSc7XG5cbi8qKlxuICogQHRlc3Qge01ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50fVxuICovXG5kZXNjcmliZSgnTWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3JDbGllbnQnLCAoKSA9PiB7XG5cbiAgbGV0IGNsaWVudDtcbiAgY29uc3QgdG9rZW4gPSAnaGVhZGVyLnBheWxvYWQuc2lnbic7XG4gIGxldCBodHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTtcbiAgbGV0IGRvbWFpbkNsaWVudDtcbiAgbGV0IHNhbmRib3g7XG4gIGxldCByZXF1ZXN0U3R1YjtcblxuICBiZWZvcmUoKCkgPT4ge1xuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudCA9IHtcbiAgICAgIHRva2VuLFxuICAgICAgZG9tYWluOiAnYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haScsXG4gICAgICBnZXRVcmw6ICgpID0+IHt9XG4gICAgfTtcbiAgICBjbGllbnQgPSBuZXcgTWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3JDbGllbnQoaHR0cENsaWVudCwgZG9tYWluQ2xpZW50KTtcbiAgICByZXF1ZXN0U3R1YiA9IHNhbmRib3guc3R1YihodHRwQ2xpZW50LCAncmVxdWVzdCcpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50I2NyZWF0ZU1UNERlbW9BY2NvdW50fVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBjcmVhdGUgbmV3IE1ldGFUcmFkZXIgNCBkZW1vIGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0ge2xvZ2luOiAnMTIzNDUnLCBwYXNzd29yZDogJ3F3ZXJ0eScsIHNlcnZlck5hbWU6ICdIdWdvc1dheS1EZW1vMycsIGludmVzdG9yUGFzc3dvcmQ6ICdxd2VydHknfTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IGFjY291bnQgPSBhd2FpdCBjbGllbnQuY3JlYXRlTVQ0RGVtb0FjY291bnQoXG4gICAgICB7XG4gICAgICAgIGFjY291bnRUeXBlOiAndHlwZScsXG4gICAgICAgIGJhbGFuY2U6IDEwLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLFxuICAgICAgICBsZXZlcmFnZTogMTUsXG4gICAgICAgIHNlcnZlck5hbWU6ICdIdWdvc1dheS1EZW1vMydcbiAgICAgIH0sICdwcm9maWxlSWQxJyk7XG4gICAgYWNjb3VudC5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoaHR0cENsaWVudC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IGAke3Byb3Zpc2lvbmluZ0FwaVVybH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXMvcHJvZmlsZUlkMS9tdDQtZGVtby1hY2NvdW50c2AsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgYWNjb3VudFR5cGU6ICd0eXBlJyxcbiAgICAgICAgYmFsYW5jZTogMTAsXG4gICAgICAgIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsXG4gICAgICAgIGxldmVyYWdlOiAxNSxcbiAgICAgICAgc2VydmVyTmFtZTogJ0h1Z29zV2F5LURlbW8zJ1xuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgfSwgJ2NyZWF0ZU1UNERlbW9BY2NvdW50Jyk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7TWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3JDbGllbnQjY3JlYXRlTVQ0RGVtb0FjY291bnR9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCBjcmVhdGUgTWV0YVRyYWRlciA0IGRlbW8gYWNjb3VudCB2aWEgQVBJIHdpdGggYWNjb3VudCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICBkb21haW5DbGllbnQudG9rZW4gPSAndG9rZW4nO1xuICAgIGNsaWVudCA9IG5ldyBNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudChodHRwQ2xpZW50LCBkb21haW5DbGllbnQpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjbGllbnQuY3JlYXRlTVQ0RGVtb0FjY291bnQoe30sICdwcm9maWxlSWQxJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuZmFpbCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvci5tZXNzYWdlLnNob3VsZC5lcXVhbChcbiAgICAgICAgJ1lvdSBjYW4gbm90IGludm9rZSBjcmVhdGVNVDREZW1vQWNjb3VudCBtZXRob2QsIGJlY2F1c2UgeW91IGhhdmUgY29ubmVjdGVkIHdpdGggYWNjb3VudCBhY2Nlc3MgdG9rZW4uICcgK1xuICAgICAgICAnUGxlYXNlIHVzZSBBUEkgYWNjZXNzIHRva2VuIGZyb20gaHR0cHM6Ly9hcHAubWV0YWFwaS5jbG91ZC90b2tlbiBwYWdlIHRvIGludm9rZSB0aGlzIG1ldGhvZC4nXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudCNjcmVhdGVNVDRMaXZlQWNjb3VudH1cbiAgICovXG4gIGl0KCdzaG91bGQgY3JlYXRlIG5ldyBNZXRhVHJhZGVyIDQgbGl2ZSBhY2Njb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhwZWN0ZWQgPSB7bG9naW46ICcxMjM0NScsIHBhc3N3b3JkOiAncXdlcnR5Jywgc2VydmVyTmFtZTogJ0h1Z29zV2F5LUxpdmUzJywgaW52ZXN0b3JQYXNzd29yZDogJ3F3ZXJ0eSd9O1xuICAgIHJlcXVlc3RTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBsZXQgYWNjb3VudCA9IGF3YWl0IGNsaWVudC5jcmVhdGVNVDRMaXZlQWNjb3VudChcbiAgICAgIHtcbiAgICAgICAgYWNjb3VudFR5cGU6ICd0eXBlJyxcbiAgICAgICAgYmFsYW5jZTogMTAsXG4gICAgICAgIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsXG4gICAgICAgIGxldmVyYWdlOiAxNSxcbiAgICAgICAgc2VydmVyTmFtZTogJ0h1Z29zV2F5LUxpdmUzJ1xuICAgICAgfSwgJ3Byb2ZpbGVJZDEnKTtcbiAgICBhY2NvdW50LnNob3VsZC5lcXVhbChleHBlY3RlZCk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShodHRwQ2xpZW50LnJlcXVlc3QsIHtcbiAgICAgIHVybDogYCR7cHJvdmlzaW9uaW5nQXBpVXJsfS91c2Vycy9jdXJyZW50L3Byb3Zpc2lvbmluZy1wcm9maWxlcy9wcm9maWxlSWQxL210NC1saXZlLWFjY291bnRzYCxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAgYm9keToge1xuICAgICAgICBhY2NvdW50VHlwZTogJ3R5cGUnLFxuICAgICAgICBiYWxhbmNlOiAxMCxcbiAgICAgICAgZW1haWw6ICd0ZXN0QHRlc3QuY29tJyxcbiAgICAgICAgbGV2ZXJhZ2U6IDE1LFxuICAgICAgICBzZXJ2ZXJOYW1lOiAnSHVnb3NXYXktTGl2ZTMnXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9LCAnY3JlYXRlTVQ0TGl2ZUFjY291bnQnKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudCNjcmVhdGVNVDRMaXZlQWNjb3VudH1cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IGNyZWF0ZSBNZXRhVHJhZGVyIDQgbGl2ZSBhY2NvdW50IHZpYSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudC50b2tlbiA9ICd0b2tlbic7XG4gICAgY2xpZW50ID0gbmV3IE1ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50KGh0dHBDbGllbnQsIGRvbWFpbkNsaWVudCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNsaWVudC5jcmVhdGVNVDRMaXZlQWNjb3VudCh7fSwgJ3Byb2ZpbGVJZDEnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5mYWlsKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIGNyZWF0ZU1UNExpdmVBY2NvdW50IG1ldGhvZCwgYmVjYXVzZSB5b3UgaGF2ZSBjb25uZWN0ZWQgd2l0aCBhY2NvdW50IGFjY2VzcyB0b2tlbi4gJyArXG4gICAgICAgICdQbGVhc2UgdXNlIEFQSSBhY2Nlc3MgdG9rZW4gZnJvbSBodHRwczovL2FwcC5tZXRhYXBpLmNsb3VkL3Rva2VuIHBhZ2UgdG8gaW52b2tlIHRoaXMgbWV0aG9kLidcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50I2NyZWF0ZU1UNURlbW9BY2NvdW50fVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBjcmVhdGUgbmV3IE1ldGFUcmFkZXIgNSBkZW1vIGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0ge2xvZ2luOiAnMTIzNDUnLCBwYXNzd29yZDogJ3F3ZXJ0eScsIHNlcnZlck5hbWU6ICdIdWdvc1dheS1EZW1vMycsIGludmVzdG9yUGFzc3dvcmQ6ICdxd2VydHknfTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IGFjY291bnQgPSBhd2FpdCBjbGllbnQuY3JlYXRlTVQ1RGVtb0FjY291bnQoXG4gICAgICB7XG4gICAgICAgIGFjY291bnRUeXBlOiAndHlwZScsXG4gICAgICAgIGJhbGFuY2U6IDEwLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLFxuICAgICAgICBsZXZlcmFnZTogMTUsXG4gICAgICAgIHNlcnZlck5hbWU6ICdIdWdvc1dheS1EZW1vMydcbiAgICAgIH0sICdwcm9maWxlSWQyJyk7XG4gICAgYWNjb3VudC5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoaHR0cENsaWVudC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IGAke3Byb3Zpc2lvbmluZ0FwaVVybH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXMvcHJvZmlsZUlkMi9tdDUtZGVtby1hY2NvdW50c2AsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgYWNjb3VudFR5cGU6ICd0eXBlJyxcbiAgICAgICAgYmFsYW5jZTogMTAsXG4gICAgICAgIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsXG4gICAgICAgIGxldmVyYWdlOiAxNSxcbiAgICAgICAgc2VydmVyTmFtZTogJ0h1Z29zV2F5LURlbW8zJ1xuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgfSwgJ2NyZWF0ZU1UNURlbW9BY2NvdW50Jyk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEB0ZXN0IHtNZXRhdHJhZGVyQWNjb3VudEdlbmVyYXRvckNsaWVudCNjcmVhdGVNVDVEZW1vQWNjb3VudH1cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IGNyZWF0ZSBNZXRhVHJhZGVyIDUgZGVtbyBhY2NvdW50IHZpYSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudC50b2tlbiA9ICd0b2tlbic7XG4gICAgY2xpZW50ID0gbmV3IE1ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50KGh0dHBDbGllbnQsIGRvbWFpbkNsaWVudCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNsaWVudC5jcmVhdGVNVDVEZW1vQWNjb3VudCh7fSwgJ3Byb2ZpbGVJZDInKTtcbiAgICAgIHNpbm9uLmFzc2VydC5mYWlsKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIGNyZWF0ZU1UNURlbW9BY2NvdW50IG1ldGhvZCwgYmVjYXVzZSB5b3UgaGF2ZSBjb25uZWN0ZWQgd2l0aCBhY2NvdW50IGFjY2VzcyB0b2tlbi4gJyArXG4gICAgICAgICdQbGVhc2UgdXNlIEFQSSBhY2Nlc3MgdG9rZW4gZnJvbSBodHRwczovL2FwcC5tZXRhYXBpLmNsb3VkL3Rva2VuIHBhZ2UgdG8gaW52b2tlIHRoaXMgbWV0aG9kLidcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50I2NyZWF0ZU1UNUxpdmVBY2NvdW50fVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBjcmVhdGUgbmV3IE1ldGFUcmFkZXIgNSBsaXZlIGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0ge2xvZ2luOiAnMTIzNDUnLCBwYXNzd29yZDogJ3F3ZXJ0eScsIHNlcnZlck5hbWU6ICdIdWdvc1dheS1MaXZlMycsIGludmVzdG9yUGFzc3dvcmQ6ICdxd2VydHknfTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IGFjY291bnQgPSBhd2FpdCBjbGllbnQuY3JlYXRlTVQ1TGl2ZUFjY291bnQoXG4gICAgICB7XG4gICAgICAgIGFjY291bnRUeXBlOiAndHlwZScsXG4gICAgICAgIGJhbGFuY2U6IDEwLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLFxuICAgICAgICBsZXZlcmFnZTogMTUsXG4gICAgICAgIHNlcnZlck5hbWU6ICdIdWdvc1dheS1MaXZlMydcbiAgICAgIH0sXG4gICAgICAncHJvZmlsZUlkMicpO1xuICAgIGFjY291bnQuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGh0dHBDbGllbnQucmVxdWVzdCwge1xuICAgICAgdXJsOiBgJHtwcm92aXNpb25pbmdBcGlVcmx9L3VzZXJzL2N1cnJlbnQvcHJvdmlzaW9uaW5nLXByb2ZpbGVzL3Byb2ZpbGVJZDIvbXQ1LWxpdmUtYWNjb3VudHNgLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiB7XG4gICAgICAgIGFjY291bnRUeXBlOiAndHlwZScsXG4gICAgICAgIGJhbGFuY2U6IDEwLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLFxuICAgICAgICBsZXZlcmFnZTogMTUsXG4gICAgICAgIHNlcnZlck5hbWU6ICdIdWdvc1dheS1MaXZlMydcbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgIH0sICdjcmVhdGVNVDVMaXZlQWNjb3VudCcpO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01ldGF0cmFkZXJBY2NvdW50R2VuZXJhdG9yQ2xpZW50I2NyZWF0ZU1UNUxpdmVBY2NvdW50fVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBub3QgY3JlYXRlIE1ldGFUcmFkZXIgNSBsaXZlIGFjY291bnQgdmlhIEFQSSB3aXRoIGFjY291bnQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgZG9tYWluQ2xpZW50LnRva2VuID0gJ3Rva2VuJztcbiAgICBjbGllbnQgPSBuZXcgTWV0YXRyYWRlckFjY291bnRHZW5lcmF0b3JDbGllbnQoaHR0cENsaWVudCwgZG9tYWluQ2xpZW50KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY2xpZW50LmNyZWF0ZU1UNUxpdmVBY2NvdW50KHt9LCAncHJvZmlsZUlkMicpO1xuICAgICAgc2lub24uYXNzZXJ0LmZhaWwoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgY3JlYXRlTVQ1TGl2ZUFjY291bnQgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG59KTtcbiJdfQ==