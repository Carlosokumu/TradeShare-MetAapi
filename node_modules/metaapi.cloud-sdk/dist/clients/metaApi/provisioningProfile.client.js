'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _metaApi = require('../metaApi.client');

var _metaApi2 = _interopRequireDefault(_metaApi);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * metaapi.cloud provisioning profile API client (see https://metaapi.cloud/docs/provisioning/)
 */
class ProvisioningProfileClient extends _metaApi2.default {

  /**
   * Provisioning profile model
   * @typedef {Object} ProvisioningProfileDto
   * @property {String} _id provisioning profile unique identifier
   * @property {String} name provisioning profile name
   * @property {Number} version MetaTrader version (allowed values are 4 and 5)
   * @property {String} status provisioning profile status (allowed values are new and active)
   * @property {String} brokerTimezone broker timezone name from Time Zone Database
   * @property {String} brokerDSTSwitchTimezone broker DST switch timezone name from Time Zone Database
   */

  /**
   * Retrieves provisioning profiles owned by user
   * (see https://metaapi.cloud/docs/provisioning/api/provisioningProfile/readProvisioningProfiles/)
   * Method is accessible only with API access token
   * @param {Number} version optional version filter (allowed values are 4 and 5)
   * @param {String} status optional status filter (allowed values are new and active)
   * @return {Promise<Array<ProvisioningProfileDto>>} promise resolving with provisioning profiles found
   */
  getProvisioningProfiles(version, status) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getProvisioningProfiles');
    }
    let qs = {};
    if (version) {
      qs.version = version;
    }
    if (status) {
      qs.status = status;
    }
    const opts = {
      url: `${this._host}/users/current/provisioning-profiles`,
      method: 'GET',
      qs,
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts, 'getProvisioningProfiles');
  }

  /**
   * Retrieves a provisioning profile by id (see
   * https://metaapi.cloud/docs/provisioning/api/provisioningProfile/readProvisioningProfile/). Throws an error if
   * profile is not found.
   * Method is accessible only with API access token
   * @param {String} id provisioning profile id
   * @return {Promise<ProvisioningProfileDto>} promise resolving with provisioning profile found
   */
  getProvisioningProfile(id) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getProvisioningProfile');
    }
    const opts = {
      url: `${this._host}/users/current/provisioning-profiles/${id}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts, 'getProvisioningProfile');
  }

  /**
   * New provisioning profile model
   * @typedef {Object} NewProvisioningProfileDto
   * @property {String} name provisioning profile name
   * @property {Number} version MetaTrader version (allowed values are 4 and 5)
   * @property {String} brokerTimezone broker timezone name from Time Zone Database
   * @property {String} brokerDSTSwitchTimezone broker DST switch timezone name from Time Zone Database
   */

  /**
   * Provisioning profile id model
   * @typedef {Object} ProvisioningProfileIdDto
   * @property {String} id provisioning profile unique identifier
   */

  /**
   * Creates a new provisioning profile (see
   * https://metaapi.cloud/docs/provisioning/api/provisioningProfile/createNewProvisioningProfile/). After creating a
   * provisioning profile you are required to upload extra files in order to activate the profile for further use.
   * Method is accessible only with API access token
   * @param {NewProvisioningProfileDto} provisioningProfile provisioning profile to create
   * @return {Promise<ProvisioningProfileIdDto>} promise resolving with an id of the provisioning profile created
   */
  createProvisioningProfile(provisioningProfile) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('createProvisioningProfile');
    }
    const opts = {
      url: `${this._host}/users/current/provisioning-profiles`,
      method: 'POST',
      headers: {
        'auth-token': this._token
      },
      json: true,
      body: provisioningProfile
    };
    return this._httpClient.request(opts, 'createProvisioningProfile');
  }

  /**
   * Uploads a file to a provisioning profile (see
   * https://metaapi.cloud/docs/provisioning/api/provisioningProfile/uploadFilesToProvisioningProfile/). Uploading a
   * file by name is allowed only for Node.js.
   * Method is accessible only with API access token
   * @param {String} provisioningProfileId provisioning profile id to upload file to
   * @param {String} fileName name of the file to upload. Allowed values are servers.dat for MT5 profile, broker.srv for
   * MT4 profile
   * @param {String|Buffer} file path to a file to upload or buffer containing file contents
   * @return {Promise} promise resolving when file upload is completed
   */
  uploadProvisioningProfileFile(provisioningProfileId, fileName, file) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('uploadProvisioningProfileFile');
    }
    if (typeof file === 'string') {
      file = _fs2.default.createReadStream(file);
    } else {
      file = {
        value: file,
        options: {
          filename: 'serverFile'
        }
      };
    }
    const opts = {
      method: 'PUT',
      url: `${this._host}/users/current/provisioning-profiles/${provisioningProfileId}/${fileName}`,
      formData: {
        file
      },
      json: true,
      headers: {
        'auth-token': this._token
      }
    };
    return this._httpClient.request(opts, 'uploadProvisioningProfileFile');
  }

  /**
   * Deletes a provisioning profile (see
   * https://metaapi.cloud/docs/provisioning/api/provisioningProfile/deleteProvisioningProfile/). Please note that in
   * order to delete a provisioning profile you need to delete MT accounts connected to it first.
   * Method is accessible only with API access token
   * @param {String} id provisioning profile id
   * @return {Promise} promise resolving when provisioning profile is deleted
   */
  deleteProvisioningProfile(id) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('deleteProvisioningProfile');
    }
    const opts = {
      url: `${this._host}/users/current/provisioning-profiles/${id}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts, 'deleteProvisioningProfile');
  }

  /**
   * Updated provisioning profile data
   * @typedef {Object} ProvisioningProfileUpdateDto
   * @property {String} name provisioning profile name
   */

  /**
   * Updates existing provisioning profile data (see
   * https://metaapi.cloud/docs/provisioning/api/provisioningProfile/updateProvisioningProfile/).
   * Method is accessible only with API access token
   * @param {String} id provisioning profile id
   * @param {ProvisioningProfileUpdateDto} provisioningProfile updated provisioning profile
   * @return {Promise} promise resolving when provisioning profile is updated
   */
  updateProvisioningProfile(id, provisioningProfile) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updateProvisioningProfile');
    }
    const opts = {
      url: `${this._host}/users/current/provisioning-profiles/${id}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      json: true,
      body: provisioningProfile
    };
    return this._httpClient.request(opts, 'updateProvisioningProfile');
  }

}
exports.default = ProvisioningProfileClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL21ldGFBcGkvcHJvdmlzaW9uaW5nUHJvZmlsZS5jbGllbnQuZXM2Il0sIm5hbWVzIjpbIlByb3Zpc2lvbmluZ1Byb2ZpbGVDbGllbnQiLCJNZXRhQXBpQ2xpZW50IiwiZ2V0UHJvdmlzaW9uaW5nUHJvZmlsZXMiLCJ2ZXJzaW9uIiwic3RhdHVzIiwiX2lzTm90Snd0VG9rZW4iLCJfaGFuZGxlTm9BY2Nlc3NFcnJvciIsInFzIiwib3B0cyIsInVybCIsIl9ob3N0IiwibWV0aG9kIiwiaGVhZGVycyIsIl90b2tlbiIsImpzb24iLCJfaHR0cENsaWVudCIsInJlcXVlc3QiLCJnZXRQcm92aXNpb25pbmdQcm9maWxlIiwiaWQiLCJjcmVhdGVQcm92aXNpb25pbmdQcm9maWxlIiwicHJvdmlzaW9uaW5nUHJvZmlsZSIsImJvZHkiLCJ1cGxvYWRQcm92aXNpb25pbmdQcm9maWxlRmlsZSIsInByb3Zpc2lvbmluZ1Byb2ZpbGVJZCIsImZpbGVOYW1lIiwiZmlsZSIsImZzIiwiY3JlYXRlUmVhZFN0cmVhbSIsInZhbHVlIiwib3B0aW9ucyIsImZpbGVuYW1lIiwiZm9ybURhdGEiLCJkZWxldGVQcm92aXNpb25pbmdQcm9maWxlIiwidXBkYXRlUHJvdmlzaW9uaW5nUHJvZmlsZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBOzs7O0FBRUE7Ozs7OztBQUVBOzs7QUFHZSxNQUFNQSx5QkFBTixTQUF3Q0MsaUJBQXhDLENBQXNEOztBQUVuRTs7Ozs7Ozs7Ozs7QUFXQTs7Ozs7Ozs7QUFRQUMsMEJBQXdCQyxPQUF4QixFQUFpQ0MsTUFBakMsRUFBeUM7QUFDdkMsUUFBSSxLQUFLQyxjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQix5QkFBMUIsQ0FBUDtBQUNEO0FBQ0QsUUFBSUMsS0FBSyxFQUFUO0FBQ0EsUUFBSUosT0FBSixFQUFhO0FBQ1hJLFNBQUdKLE9BQUgsR0FBYUEsT0FBYjtBQUNEO0FB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SUFBekIsRUFBK0IsMkJBQS9CLENBQVA7QUFDRDs7QUFFRDs7Ozs7O0FBTUE7Ozs7Ozs7O0FBUUF5Qiw0QkFBMEJmLEVBQTFCLEVBQThCRSxtQkFBOUIsRUFBbUQ7QUFDakQsUUFBSSxLQUFLZixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQiwyQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUUsT0FBTztBQUNYQyxXQUFNLEdBQUUsS0FBS0MsS0FBTSx3Q0FBdUNRLEVBQUcsRUFEbEQ7QUFFWFAsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLQztBQURaLE9BSEU7QUFNWEMsWUFBTSxJQU5LO0FBT1hPLFlBQU1EO0FBUEssS0FBYjtBQVNBLFdBQU8sS0FBS0wsV0FBTCxDQUFpQkMsT0FBakIsQ0FBeUJSLElBQXpCLEVBQStCLDJCQUEvQixDQUFQO0FBQ0Q7O0FBcE1rRTtrQkFBaERSLHlCIiwiZmlsZSI6InByb3Zpc2lvbmluZ1Byb2ZpbGUuY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG5pbXBvcnQgTWV0YUFwaUNsaWVudCBmcm9tICcuLi9tZXRhQXBpLmNsaWVudCc7XG5cbi8qKlxuICogbWV0YWFwaS5jbG91ZCBwcm92aXNpb25pbmcgcHJvZmlsZSBBUEkgY2xpZW50IChzZWUgaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvcHJvdmlzaW9uaW5nLylcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvdmlzaW9uaW5nUHJvZmlsZUNsaWVudCBleHRlbmRzIE1ldGFBcGlDbGllbnQge1xuXG4gIC8qKlxuICAgKiBQcm92aXNpb25pbmcgcHJvZmlsZSBtb2RlbFxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBQcm92aXNpb25pbmdQcm9maWxlRHRvXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBfaWQgcHJvdmlzaW9uaW5nIHByb2ZpbGUgdW5pcXVlIGlkZW50aWZpZXJcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWUgcHJvdmlzaW9uaW5nIHByb2ZpbGUgbmFtZVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gdmVyc2lvbiBNZXRhVHJhZGVyIHZlcnNpb24gKGFsbG93ZWQgdmFsdWVzIGFyZSA0IGFuZCA1KVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gc3RhdHVzIHByb3Zpc2lvbmluZyBwcm9maWxlIHN0YXR1cyAoYWxsb3dlZCB2YWx1ZXMgYXJlIG5ldyBhbmQgYWN0aXZlKVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gYnJva2VyVGltZXpvbmUgYnJva2VyIHRpbWV6b25lIG5hbWUgZnJvbSBUaW1lIFpvbmUgRGF0YWJhc2VcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGJyb2tlckRTVFN3aXRjaFRpbWV6b25lIGJyb2tlciBEU1Qgc3dpdGNoIHRpbWV6b25lIG5hbWUgZnJvbSBUaW1lIFpvbmUgRGF0YWJhc2VcbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBwcm92aXNpb25pbmcgcHJvZmlsZXMgb3duZWQgYnkgdXNlclxuICAgKiAoc2VlIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL3Byb3Zpc2lvbmluZy9hcGkvcHJvdmlzaW9uaW5nUHJvZmlsZS9yZWFkUHJvdmlzaW9uaW5nUHJvZmlsZXMvKVxuICAgKiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlblxuICAgKiBAcGFyYW0ge051bWJlcn0gdmVyc2lvbiBvcHRpb25hbCB2ZXJzaW9uIGZpbHRlciAoYWxsb3dlZCB2YWx1ZXMgYXJlIDQgYW5kIDUpXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdGF0dXMgb3B0aW9uYWwgc3RhdHVzIGZpbHRlciAoYWxsb3dlZCB2YWx1ZXMgYXJlIG5ldyBhbmQgYWN0aXZlKVxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PFByb3Zpc2lvbmluZ1Byb2ZpbGVEdG8+Pn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBwcm92aXNpb25pbmcgcHJvZmlsZXMgZm91bmRcbiAgICovXG4gIGdldFByb3Zpc2lvbmluZ1Byb2ZpbGVzKHZlcnNpb24sIHN0YXR1cykge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRQcm92aXNpb25pbmdQcm9maWxlcycpO1xuICAgIH1cbiAgICBsZXQgcXMgPSB7fTtcbiAgICBpZiAodmVyc2lvbikge1xuICAgICAgcXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgfVxuICAgIGlmIChzdGF0dXMpIHtcbiAgICAgIHFzLnN0YXR1cyA9IHN0YXR1cztcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXNgLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHFzLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzLCAnZ2V0UHJvdmlzaW9uaW5nUHJvZmlsZXMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSBwcm92aXNpb25pbmcgcHJvZmlsZSBieSBpZCAoc2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL3Byb3Zpc2lvbmluZy9hcGkvcHJvdmlzaW9uaW5nUHJvZmlsZS9yZWFkUHJvdmlzaW9uaW5nUHJvZmlsZS8pLiBUaHJvd3MgYW4gZXJyb3IgaWZcbiAgICogcHJvZmlsZSBpcyBub3QgZm91bmQuXG4gICAqIE1ldGhvZCBpcyBhY2Nlc3NpYmxlIG9ubHkgd2l0aCBBUEkgYWNjZXNzIHRva2VuXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBpZCBwcm92aXNpb25pbmcgcHJvZmlsZSBpZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlPFByb3Zpc2lvbmluZ1Byb2ZpbGVEdG8+fSBwcm9taXNlIHJlc29sdmluZyB3aXRoIHByb3Zpc2lvbmluZyBwcm9maWxlIGZvdW5kXG4gICAqL1xuICBnZXRQcm92aXNpb25pbmdQcm9maWxlKGlkKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXMvJHtpZH1gLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cywgJ2dldFByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOZXcgcHJvdmlzaW9uaW5nIHByb2ZpbGUgbW9kZWxcbiAgICogQHR5cGVkZWYge09iamVjdH0gTmV3UHJvdmlzaW9uaW5nUHJvZmlsZUR0b1xuICAgKiBAcHJvcGVydHkge1N0cmluZ30gbmFtZSBwcm92aXNpb25pbmcgcHJvZmlsZSBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSB2ZXJzaW9uIE1ldGFUcmFkZXIgdmVyc2lvbiAoYWxsb3dlZCB2YWx1ZXMgYXJlIDQgYW5kIDUpXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBicm9rZXJUaW1lem9uZSBicm9rZXIgdGltZXpvbmUgbmFtZSBmcm9tIFRpbWUgWm9uZSBEYXRhYmFzZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gYnJva2VyRFNUU3dpdGNoVGltZXpvbmUgYnJva2VyIERTVCBzd2l0Y2ggdGltZXpvbmUgbmFtZSBmcm9tIFRpbWUgWm9uZSBEYXRhYmFzZVxuICAgKi9cblxuICAvKipcbiAgICogUHJvdmlzaW9uaW5nIHByb2ZpbGUgaWQgbW9kZWxcbiAgICogQHR5cGVkZWYge09iamVjdH0gUHJvdmlzaW9uaW5nUHJvZmlsZUlkRHRvXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBpZCBwcm92aXNpb25pbmcgcHJvZmlsZSB1bmlxdWUgaWRlbnRpZmllclxuICAgKi9cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBwcm92aXNpb25pbmcgcHJvZmlsZSAoc2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL3Byb3Zpc2lvbmluZy9hcGkvcHJvdmlzaW9uaW5nUHJvZmlsZS9jcmVhdGVOZXdQcm92aXNpb25pbmdQcm9maWxlLykuIEFmdGVyIGNyZWF0aW5nIGFcbiAgICogcHJvdmlzaW9uaW5nIHByb2ZpbGUgeW91IGFyZSByZXF1aXJlZCB0byB1cGxvYWQgZXh0cmEgZmlsZXMgaW4gb3JkZXIgdG8gYWN0aXZhdGUgdGhlIHByb2ZpbGUgZm9yIGZ1cnRoZXIgdXNlLlxuICAgKiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlblxuICAgKiBAcGFyYW0ge05ld1Byb3Zpc2lvbmluZ1Byb2ZpbGVEdG99IHByb3Zpc2lvbmluZ1Byb2ZpbGUgcHJvdmlzaW9uaW5nIHByb2ZpbGUgdG8gY3JlYXRlXG4gICAqIEByZXR1cm4ge1Byb21pc2U8UHJvdmlzaW9uaW5nUHJvZmlsZUlkRHRvPn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBhbiBpZCBvZiB0aGUgcHJvdmlzaW9uaW5nIHByb2ZpbGUgY3JlYXRlZFxuICAgKi9cbiAgY3JlYXRlUHJvdmlzaW9uaW5nUHJvZmlsZShwcm92aXNpb25pbmdQcm9maWxlKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2NyZWF0ZVByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXNgLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgICAgYm9keTogcHJvdmlzaW9uaW5nUHJvZmlsZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzLCAnY3JlYXRlUHJvdmlzaW9uaW5nUHJvZmlsZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwbG9hZHMgYSBmaWxlIHRvIGEgcHJvdmlzaW9uaW5nIHByb2ZpbGUgKHNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9wcm92aXNpb25pbmcvYXBpL3Byb3Zpc2lvbmluZ1Byb2ZpbGUvdXBsb2FkRmlsZXNUb1Byb3Zpc2lvbmluZ1Byb2ZpbGUvKS4gVXBsb2FkaW5nIGFcbiAgICogZmlsZSBieSBuYW1lIGlzIGFsbG93ZWQgb25seSBmb3IgTm9kZS5qcy5cbiAgICogTWV0aG9kIGlzIGFjY2Vzc2libGUgb25seSB3aXRoIEFQSSBhY2Nlc3MgdG9rZW5cbiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3Zpc2lvbmluZ1Byb2ZpbGVJZCBwcm92aXNpb25pbmcgcHJvZmlsZSBpZCB0byB1cGxvYWQgZmlsZSB0b1xuICAgKiBAcGFyYW0ge1N0cmluZ30gZmlsZU5hbWUgbmFtZSBvZiB0aGUgZmlsZSB0byB1cGxvYWQuIEFsbG93ZWQgdmFsdWVzIGFyZSBzZXJ2ZXJzLmRhdCBmb3IgTVQ1IHByb2ZpbGUsIGJyb2tlci5zcnYgZm9yXG4gICAqIE1UNCBwcm9maWxlXG4gICAqIEBwYXJhbSB7U3RyaW5nfEJ1ZmZlcn0gZmlsZSBwYXRoIHRvIGEgZmlsZSB0byB1cGxvYWQgb3IgYnVmZmVyIGNvbnRhaW5pbmcgZmlsZSBjb250ZW50c1xuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHJlc29sdmluZyB3aGVuIGZpbGUgdXBsb2FkIGlzIGNvbXBsZXRlZFxuICAgKi9cbiAgdXBsb2FkUHJvdmlzaW9uaW5nUHJvZmlsZUZpbGUocHJvdmlzaW9uaW5nUHJvZmlsZUlkLCBmaWxlTmFtZSwgZmlsZSkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCd1cGxvYWRQcm92aXNpb25pbmdQcm9maWxlRmlsZScpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGZpbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBmaWxlID0gZnMuY3JlYXRlUmVhZFN0cmVhbShmaWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsZSA9IHtcbiAgICAgICAgdmFsdWU6IGZpbGUsXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBmaWxlbmFtZTogJ3NlcnZlckZpbGUnXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L3Byb3Zpc2lvbmluZy1wcm9maWxlcy8ke3Byb3Zpc2lvbmluZ1Byb2ZpbGVJZH0vJHtmaWxlTmFtZX1gLFxuICAgICAgZm9ybURhdGE6IHtcbiAgICAgICAgZmlsZVxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cywgJ3VwbG9hZFByb3Zpc2lvbmluZ1Byb2ZpbGVGaWxlJyk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIHByb3Zpc2lvbmluZyBwcm9maWxlIChzZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvcHJvdmlzaW9uaW5nL2FwaS9wcm92aXNpb25pbmdQcm9maWxlL2RlbGV0ZVByb3Zpc2lvbmluZ1Byb2ZpbGUvKS4gUGxlYXNlIG5vdGUgdGhhdCBpblxuICAgKiBvcmRlciB0byBkZWxldGUgYSBwcm92aXNpb25pbmcgcHJvZmlsZSB5b3UgbmVlZCB0byBkZWxldGUgTVQgYWNjb3VudHMgY29ubmVjdGVkIHRvIGl0IGZpcnN0LlxuICAgKiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlblxuICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgcHJvdmlzaW9uaW5nIHByb2ZpbGUgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBwcm92aXNpb25pbmcgcHJvZmlsZSBpcyBkZWxldGVkXG4gICAqL1xuICBkZWxldGVQcm92aXNpb25pbmdQcm9maWxlKGlkKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2RlbGV0ZVByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXMvJHtpZH1gLFxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cywgJ2RlbGV0ZVByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVkIHByb3Zpc2lvbmluZyBwcm9maWxlIGRhdGFcbiAgICogQHR5cGVkZWYge09iamVjdH0gUHJvdmlzaW9uaW5nUHJvZmlsZVVwZGF0ZUR0b1xuICAgKiBAcHJvcGVydHkge1N0cmluZ30gbmFtZSBwcm92aXNpb25pbmcgcHJvZmlsZSBuYW1lXG4gICAqL1xuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGV4aXN0aW5nIHByb3Zpc2lvbmluZyBwcm9maWxlIGRhdGEgKHNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9wcm92aXNpb25pbmcvYXBpL3Byb3Zpc2lvbmluZ1Byb2ZpbGUvdXBkYXRlUHJvdmlzaW9uaW5nUHJvZmlsZS8pLlxuICAgKiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlblxuICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgcHJvdmlzaW9uaW5nIHByb2ZpbGUgaWRcbiAgICogQHBhcmFtIHtQcm92aXNpb25pbmdQcm9maWxlVXBkYXRlRHRvfSBwcm92aXNpb25pbmdQcm9maWxlIHVwZGF0ZWQgcHJvdmlzaW9uaW5nIHByb2ZpbGVcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBwcm92aXNpb25pbmcgcHJvZmlsZSBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVQcm92aXNpb25pbmdQcm9maWxlKGlkLCBwcm92aXNpb25pbmdQcm9maWxlKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ3VwZGF0ZVByb3Zpc2lvbmluZ1Byb2ZpbGUnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9wcm92aXNpb25pbmctcHJvZmlsZXMvJHtpZH1gLFxuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgICBib2R5OiBwcm92aXNpb25pbmdQcm9maWxlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5faHR0cENsaWVudC5yZXF1ZXN0KG9wdHMsICd1cGRhdGVQcm92aXNpb25pbmdQcm9maWxlJyk7XG4gIH1cblxufVxuIl19