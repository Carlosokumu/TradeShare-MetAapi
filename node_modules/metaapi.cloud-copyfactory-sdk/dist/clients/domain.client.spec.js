'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _httpClient = require('./httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _domain = require('./domain.client');

var _domain2 = _interopRequireDefault(_domain);

var _errorHandler = require('./errorHandler');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {DomainClient}
 */
describe('DomainClient', () => {

  let domainClient;
  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let sandbox;
  let requestStub;
  let getRegionsStub;
  let getHostStub;
  let failoverRequestStub;
  let clock;
  const expected = [{ _id: 'ABCD' }];

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    domainClient = new _domain2.default(httpClient, token);
    clock = sandbox.useFakeTimers({ shouldAdvanceTime: true });
    failoverRequestStub = sandbox.stub(httpClient, 'requestWithFailover');
    requestStub = sandbox.stub(httpClient, 'request');
    requestStub.withArgs({
      url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
      method: 'GET',
      headers: {
        'auth-token': token
      }
    }).resolves(expected);
    getRegionsStub = requestStub.withArgs({
      url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/regions',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      json: true
    }).resolves(['vint-hill', 'us-west']);
    getHostStub = requestStub.withArgs({
      url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/servers/mt-client-api',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      json: true
    }).resolves({ domain: 'agiliumtrade.agiliumtrade.ai' });
  });

  afterEach(() => {
    sandbox.restore();
    clock.restore();
  });

  /**
   * @test {DomainClient#requestCopyFactory}
   */
  describe('requestCopyFactory', () => {

    const opts = {
      url: '/users/current/configuration/strategies',
      method: 'GET',
      headers: {
        'auth-token': token
      }
    };

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    it('should execute request', async () => {
      const response = await domainClient.requestCopyFactory(opts);
      _sinon2.default.assert.match(response, expected);
      _sinon2.default.assert.calledWith(requestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
        method: 'GET',
        headers: {
          'auth-token': token
        }
      });
    });

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    it('should use cached url on repeated request', async () => {
      await domainClient.requestCopyFactory(opts);
      const response = await domainClient.requestCopyFactory(opts);
      _sinon2.default.assert.calledWith(requestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
        method: 'GET',
        headers: {
          'auth-token': token
        }
      });
      _sinon2.default.assert.match(response, expected);
      _sinon2.default.assert.calledOnce(getHostStub);
      _sinon2.default.assert.calledOnce(getRegionsStub);
    });

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    it('should request url again if expired', async () => {
      await domainClient.requestCopyFactory(opts);
      await clock.tickAsync(610000);
      const response = await domainClient.requestCopyFactory(opts);
      _sinon2.default.assert.match(response, expected);
      _sinon2.default.assert.calledWith(requestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
        method: 'GET',
        headers: {
          'auth-token': token
        }
      });
      _sinon2.default.assert.calledTwice(getHostStub);
      _sinon2.default.assert.calledTwice(getRegionsStub);
    });

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    it('should return request error', async () => {
      requestStub.withArgs({
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
        method: 'GET',
        headers: {
          'auth-token': token
        }
      }).throws(new _errorHandler.ValidationError('test'));
      try {
        await domainClient.requestCopyFactory(opts);
        throw new Error('ValidationError expected');
      } catch (error) {
        error.name.should.equal('ValidationError');
      }
    });

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    it('should return error if failed to get host', async () => {
      getHostStub.throws(new _errorHandler.ValidationError('test'));
      try {
        await domainClient.requestCopyFactory(opts);
        throw new Error('ValidationError expected');
      } catch (error) {
        error.name.should.equal('ValidationError');
      }
    });

    /**
     * @test {DomainClient#requestCopyFactory}
     */
    describe('regions', () => {

      /**
       * @test {DomainClient#requestCopyFactory}
       */
      it('should return error if failed to get regions', async () => {
        getRegionsStub.throws(new _errorHandler.ValidationError('test'));
        try {
          await domainClient.requestCopyFactory(opts);
          throw new Error('ValidationError expected');
        } catch (error) {
          error.name.should.equal('ValidationError');
        }
      });

      /**
       * @test {DomainClient#requestCopyFactory}
       */
      it('should try another region if the first failed', async () => {
        requestStub.withArgs({
          url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/' + 'current/configuration/strategies',
          method: 'GET',
          headers: {
            'auth-token': token
          }
        }).rejects(new _errorHandler.InternalError('test'));
        requestStub.withArgs({
          url: 'https://copyfactory-api-v1.us-west.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
          method: 'GET',
          headers: {
            'auth-token': token
          }
        }).resolves(expected);
        const response = await domainClient.requestCopyFactory(opts);
        _sinon2.default.assert.calledWith(requestStub, {
          url: 'https://copyfactory-api-v1.us-west.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
          method: 'GET',
          headers: {
            'auth-token': token
          }
        });
        _sinon2.default.assert.match(response, expected);

        _sinon2.default.assert.calledOnce(getHostStub);
        _sinon2.default.assert.calledOnce(getRegionsStub);
      });

      /**
       * @test {DomainClient#requestCopyFactory}
       */
      it('should return error if all regions failed', async () => {
        requestStub.withArgs({
          url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.agiliumtrade.ai/users/' + 'current/configuration/strategies',
          method: 'GET',
          headers: {
            'auth-token': token
          }
        }).throws(new _errorHandler.InternalError('test'));
        requestStub.withArgs({
          url: 'https://copyfactory-api-v1.us-west.agiliumtrade.agiliumtrade.ai/users/current/configuration/strategies',
          method: 'GET',
          headers: {
            'auth-token': token
          }
        }).throws(new _errorHandler.InternalError('test'));

        try {
          await domainClient.requestCopyFactory(opts);
          throw new Error('InternalError expected');
        } catch (error) {
          error.name.should.equal('InternalError');
        }
      });
    });
  });

  /**
   * @test {DomainClient#request}
   */
  describe('request', () => {

    it('should execute request', async () => {
      const opts = {
        url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/accounts/accountId',
        method: 'GET',
        headers: {
          'auth-token': token
        },
        json: true
      };

      requestStub.withArgs(opts).resolves(expected);
      const response = await domainClient.request(opts);
      _sinon2.default.assert.match(response, expected);
      _sinon2.default.assert.calledWith(requestStub, opts);
    });
  });

  /**
   * @test {DomainClient#requestSignal}
   */
  describe('requestSignal', () => {

    const signalOpts = {
      url: '/users/current/subscribers/accountId/signals',
      method: 'GET',
      json: true
    };

    const expectedSignals = [{
      strategy: { id: '1234', name: 'Test strategy' },
      positionId: '123456',
      time: '2021-11-19T18:56:32.590Z',
      symbol: 'GBPUSD',
      type: 'limit',
      side: 'buy'
    }];

    let host;

    beforeEach(async () => {
      host = {
        host: 'https://copyfactory-api-v1',
        lastUpdated: Date.now(),
        regions: ['vint-hill'],
        domain: 'agiliumtrade.ai'
      };
      failoverRequestStub.withArgs({
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      }).resolves(expectedSignals);
      failoverRequestStub.withArgs({
        url: 'https://copyfactory-api-v1.us-west.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      }).rejects(new _errorHandler.InternalError('test'));
      await domainClient.getSignalClientHost('vint-hill');
    });

    /**
     * @test {DomainClient#requestSignal}
     */
    it('should execute a request', async () => {
      const response = await domainClient.requestSignal(signalOpts, host, 'accountId');
      _sinon2.default.assert.match(response, expectedSignals);
      _sinon2.default.assert.calledWith(failoverRequestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
    });

    /**
     * @test {DomainClient#requestSignal}
     */
    it('should execute a request with multiple regions', async () => {
      host.regions = ['vint-hill', 'us-west'];
      const response = await domainClient.requestSignal(signalOpts, host, 'accountId');
      _sinon2.default.assert.match(response, expectedSignals);
      _sinon2.default.assert.calledWith(failoverRequestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
      _sinon2.default.assert.calledWith(failoverRequestStub, {
        url: 'https://copyfactory-api-v1.us-west.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
    });

    /**
     * @test {DomainClient#requestSignal}
     */
    it('should return an error if all regions failed', async () => {
      host.regions = ['vint-hill', 'us-west'];
      failoverRequestStub.withArgs({
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      }).rejects(new _errorHandler.InternalError('test'));

      try {
        await domainClient.requestSignal(signalOpts, host, 'accountId');
        throw new Error('InternalError expected');
      } catch (error) {
        error.name.should.equal('InternalError');
      }
      _sinon2.default.assert.calledWith(failoverRequestStub, {
        url: 'https://copyfactory-api-v1.vint-hill.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
      _sinon2.default.assert.calledWith(failoverRequestStub, {
        url: 'https://copyfactory-api-v1.us-west.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
    });

    /**
     * @test {DomainClient#requestSignal}
     */
    it('should execute a request and update host if expired', async () => {
      const otherRegionOpts = {
        url: 'https://copyfactory-api-v1.germany.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      };
      const otherRegionStub = failoverRequestStub.withArgs(otherRegionOpts).resolves(expectedSignals);
      const replicaCallStub = failoverRequestStub.withArgs({
        url: 'https://copyfactory-api-v1.france.agiliumtrade.ai/users/current/subscribers/accountId/signals',
        method: 'GET',
        json: true,
        headers: {
          'auth-token': token
        }
      });
      const getAccountStub = failoverRequestStub.withArgs({
        url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/accounts/accountId',
        method: 'GET',
        headers: {
          'auth-token': token
        },
        json: true
      }).resolves({ _id: 'accountId', region: 'germany', accountReplicas: [{ _id: 'accountId2', region: 'france' }] });
      await domainClient.requestSignal(signalOpts, host, 'accountId');
      await new _promise2.default(res => setTimeout(res, 50));
      _sinon2.default.assert.notCalled(getAccountStub);
      _sinon2.default.assert.notCalled(otherRegionStub);
      _sinon2.default.assert.notCalled(replicaCallStub);
      await clock.tickAsync(610000);
      await domainClient.requestSignal(signalOpts, host, 'accountId');
      await new _promise2.default(res => setTimeout(res, 50));
      _sinon2.default.assert.calledOnce(getAccountStub);
      _sinon2.default.assert.notCalled(otherRegionStub);
      _sinon2.default.assert.notCalled(replicaCallStub);
      await domainClient.requestSignal(signalOpts, host, 'accountId');
      await new _promise2.default(res => setTimeout(res, 50));
      _sinon2.default.assert.calledOnce(getAccountStub);
      _sinon2.default.assert.calledOnce(otherRegionStub);
      _sinon2.default.assert.calledOnce(replicaCallStub);
    });
  });

  /**
   * @test {DomainClient#getAccountInfo}
   */
  describe('getAccountInfo', () => {

    let getAccountStub;
    let expectedAccount;

    beforeEach(() => {
      expectedAccount = { _id: 'accountId2', region: 'germany', accountReplicas: [] };
      getAccountStub = failoverRequestStub.withArgs({
        url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/accounts/accountId',
        method: 'GET',
        headers: {
          'auth-token': token
        },
        json: true
      }).resolves(expectedAccount);
    });

    /**
     * @test {DomainClient#getAccountInfo}
     */
    it('should get account', async () => {
      const account = await domainClient.getAccountInfo('accountId');
      _sinon2.default.assert.match(account, { id: 'accountId2', regions: ['germany'] });
    });

    /**
     * @test {DomainClient#getAccountInfo}
     */
    it('should get account with replicas', async () => {
      getAccountStub.resolves({
        _id: 'accountId',
        region: 'vint-hill',
        accountReplicas: [{
          _id: 'accountId2',
          region: 'us-west'
        }]
      });
      const account = await domainClient.getAccountInfo('accountId');
      _sinon2.default.assert.match(account, { id: 'accountId', regions: ['vint-hill', 'us-west'] });
    });

    /**
     * @test {TradingClient#getAccountInfo}
     */
    it('should get primary account if requested account is a replica', async () => {
      getAccountStub.resolves({
        _id: 'accountId',
        region: 'vint-hill',
        primaryAccountId: 'accountId2'
      });
      failoverRequestStub.withArgs({
        url: 'https://mt-provisioning-api-v1.agiliumtrade.agiliumtrade.ai/users/current/accounts/accountId2',
        method: 'GET',
        headers: {
          'auth-token': token
        },
        json: true
      }).resolves({
        _id: 'accountId2', region: 'us-west', accountReplicas: [{
          _id: 'accountId',
          region: 'vint-hill'
        }]
      });
      const account = await domainClient.getAccountInfo('accountId');
      _sinon2.default.assert.match(account, { id: 'accountId2', regions: ['us-west', 'vint-hill'] });
    });
  });

  /**
   * @test {DomainClient#getSignalClientHost}
   */
  describe('getSignalClientHost', () => {

    /**
     * @test {DomainClient#getSignalClientHost}
     */
    it('should return signal client host', async () => {
      const response = await domainClient.getSignalClientHost(['vint-hill']);
      _sinon2.default.assert.match(response, {
        host: 'https://copyfactory-api-v1',
        regions: ['vint-hill'],
        domain: 'agiliumtrade.agiliumtrade.ai'
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jbGllbnRzL2RvbWFpbi5jbGllbnQuc3BlYy5lczYiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJkb21haW5DbGllbnQiLCJ0b2tlbiIsImh0dHBDbGllbnQiLCJIdHRwQ2xpZW50Iiwic2FuZGJveCIsInJlcXVlc3RTdHViIiwiZ2V0UmVnaW9uc1N0dWIiLCJnZXRIb3N0U3R1YiIsImZhaWxvdmVyUmVxdWVzdFN0dWIiLCJjbG9jayIsImV4cGVjdGVkIiwiX2lkIiwiYmVmb3JlIiwic2lub24iLCJjcmVhdGVTYW5kYm94IiwiYmVmb3JlRWFjaCIsIkRvbWFpbkNsaWVudCIsInVzZUZha2VUaW1lcnMiLCJzaG91bGRBZHZhbmNlVGltZSIsInN0dWIiLCJ3aXRoQXJncyIsInVybCIsIm1ldGhvZCIsImhlYWRlcnMiLCJyZXNvbHZlcyIsImpzb24iLCJkb21haW4iLCJhZnRlckVhY2giLCJyZXN0b3JlIiwib3B0cyIsIml0IiwicmVzcG9uc2UiLCJyZXF1ZXN0Q29weUZhY3RvcnkiLCJhc3NlcnQiLCJtYXRjaCIsImNhbGxlZFdpdGgiLCJjYWxsZWRPbmNlIiwidGlja0FzeW5jIiwiY2FsbGVkVHdpY2UiLCJ0aHJvd3MiLCJWYWxpZGF0aW9uRXJyb3IiLCJFcnJvciIsImVycm9yIiwibmFtZSIsInNob3VsZCIsImVxdWFsIiwicmVqZWN0cyIsIkludGVybmFsRXJyb3IiLCJyZXF1ZXN0Iiwic2lnbmFsT3B0cyIsImV4cGVjdGVkU2lnbmFscyIsInN0cmF0ZWd5IiwiaWQiLCJwb3NpdGlvbklkIiwidGltZSIsInN5bWJvbCIsInR5cGUiLCJzaWRlIiwiaG9zdCIsImxhc3RVcGRhdGVkIiwiRGF0ZSIsIm5vdyIsInJlZ2lvbnMiLCJnZXRTaWduYWxDbGllbnRIb3N0IiwicmVxdWVzdFNpZ25hbCIsIm90aGVyUmVnaW9uT3B0cyIsIm90aGVyUmVnaW9uU3R1YiIsInJlcGxpY2FDYWxsU3R1YiIsImdldEFjY291bnRTdHViIiwicmVnaW9uIiwiYWNjb3VudFJlcGxpY2FzIiwicmVzIiwic2V0VGltZW91dCIsIm5vdENhbGxlZCIsImV4cGVjdGVkQWNjb3VudCIsImFjY291bnQiLCJnZXRBY2NvdW50SW5mbyIsInByaW1hcnlBY2NvdW50SWQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOzs7QUFHQUEsU0FBUyxjQUFULEVBQXlCLE1BQU07O0FBRTdCLE1BQUlDLFlBQUo7QUFDQSxRQUFNQyxRQUFRLHFCQUFkO0FBQ0EsTUFBSUMsYUFBYSxJQUFJQyxvQkFBSixFQUFqQjtBQUNBLE1BQUlDLE9BQUo7QUFDQSxNQUFJQyxXQUFKO0FBQ0EsTUFBSUMsY0FBSjtBQUNBLE1BQUlDLFdBQUo7QUFDQSxNQUFJQyxtQkFBSjtBQUNBLE1BQUlDLEtBQUo7QUFDQSxRQUFNQyxXQUFXLENBQUMsRUFBQ0MsS0FBSyxNQUFOLEVBQUQsQ0FBakI7O0FBRUFDLFNBQU8sTUFBTTtBQUNYUixjQUFVUyxnQkFBTUMsYUFBTixFQUFWO0FBQ0QsR0FGRDs7QUFJQUMsYUFBVyxNQUFNO0FBQ2ZmLG1CQUFlLElBQUlnQixnQkFBSixDQUFpQmQsVUFBakIsRUFBNkJELEtBQTdCLENBQWY7QUFDQVEsWUFBUUwsUUFBUWEsYUFBUixDQUFzQixFQUFDQyxtQkFBbUIsSUFBcEIsRUFBdEIsQ0FBUjtBQUNBViwwQkFBc0JKLFFBQVFlLElBQVIsQ0FBYWpCLFVBQWIsRUFBeUIscUJBQXpCLENBQXRCO0FBQ0FHLGtCQUFjRCxRQUFRZSxJQUFSLENBQWFqQixVQUFiLEVBQXlCLFNBQXpCLENBQWQ7QUFDQUcsZ0JBQVllLFFBQVosQ0FBcUI7QUFDbkJDLFdBQUssMEdBRGM7QUFFbkJDLGNBQVEsS0FGVztBQUduQkMsZUFBUztBQUNQLHNCQUFjdEI7QUFEUDtBQUhVLEtBQXJCLEVBTUd1QixRQU5ILENBTVlkLFFBTlo7QUFPQUoscUJBQWlCRCxZQUFZZSxRQUFaLENBQXFCO0FBQ3BDQyxXQUFLLG1GQUQrQjtBQUVwQ0MsY0FBUSxL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QUFtQkgsUUFBbkIsRUFBNkI7QUFDM0IyQixjQUFNLDRCQURxQjtBQUUzQkksaUJBQVMsQ0FBQyxXQUFELENBRmtCO0FBRzNCcEMsZ0JBQVE7QUFIbUIsT0FBN0I7QUFLRCxLQVBEO0FBU0QsR0FkRDtBQWdCRCxDQWhoQkQiLCJmaWxlIjoiZG9tYWluLmNsaWVudC5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgSHR0cENsaWVudCBmcm9tICcuL2h0dHBDbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBEb21haW5DbGllbnQgZnJvbSAnLi9kb21haW4uY2xpZW50JztcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciwgSW50ZXJuYWxFcnJvciB9IGZyb20gJy4vZXJyb3JIYW5kbGVyJztcblxuLyoqXG4gKiBAdGVzdCB7RG9tYWluQ2xpZW50fVxuICovXG5kZXNjcmliZSgnRG9tYWluQ2xpZW50JywgKCkgPT4ge1xuXG4gIGxldCBkb21haW5DbGllbnQ7XG4gIGNvbnN0IHRva2VuID0gJ2hlYWRlci5wYXlsb2FkLnNpZ24nO1xuICBsZXQgaHR0cENsaWVudCA9IG5ldyBIdHRwQ2xpZW50KCk7XG4gIGxldCBzYW5kYm94O1xuICBsZXQgcmVxdWVzdFN0dWI7XG4gIGxldCBnZXRSZWdpb25zU3R1YjtcbiAgbGV0IGdldEhvc3RTdHViO1xuICBsZXQgZmFpbG92ZXJSZXF1ZXN0U3R1YjtcbiAgbGV0IGNsb2NrO1xuICBjb25zdCBleHBlY3RlZCA9IFt7X2lkOiAnQUJDRCd9XTtcblxuICBiZWZvcmUoKCkgPT4ge1xuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudCA9IG5ldyBEb21haW5DbGllbnQoaHR0cENsaWVudCwgdG9rZW4pO1xuICAgIGNsb2NrID0gc2FuZGJveC51c2VGYWtlVGltZXJzKHtzaG91bGRBZHZhbmNlVGltZTogdHJ1ZX0pO1xuICAgIGZhaWxvdmVyUmVxdWVzdFN0dWIgPSBzYW5kYm94LnN0dWIoaHR0cENsaWVudCwgJ3JlcXVlc3RXaXRoRmFpbG92ZXInKTtcbiAgICByZXF1ZXN0U3R1YiA9IHNhbmRib3guc3R1YihodHRwQ2xpZW50LCAncmVxdWVzdCcpO1xuICAgIHJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgIHVybDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxLnZpbnQtaGlsbC5hZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9zdHJhdGVnaWVzJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgfSkucmVzb2x2ZXMoZXhwZWN0ZWQpO1xuICAgIGdldFJlZ2lvbnNTdHViID0gcmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgdXJsOiAnaHR0cHM6Ly9tdC1wcm92aXNpb25pbmctYXBpLXYxLmFnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWkvdXNlcnMvY3VycmVudC9yZWdpb25zJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgIH0pLnJlc29sdmVzKFsndmludC1oaWxsJywgJ3VzLXdlc3QnXSk7XG4gICAgZ2V0SG9zdFN0dWIgPSByZXF1ZXN0U3R1Yi53aXRoQXJncyh7XG4gICAgICB1cmw6ICdodHRwczovL210LXByb3Zpc2lvbmluZy1hcGktdjEuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3NlcnZlcnMvbXQtY2xpZW50LWFwaScsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9KS5yZXNvbHZlcyh7ZG9tYWluOiAnYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haSd9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICBjbG9jay5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3RDb3B5RmFjdG9yeX1cbiAgICovXG4gIGRlc2NyaWJlKCdyZXF1ZXN0Q29weUZhY3RvcnknLCAoKSA9PiB7XG5cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9zdHJhdGVnaWVzJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtEb21haW5DbGllbnQjcmVxdWVzdENvcHlGYWN0b3J5fVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKHJlc3BvbnNlLCBleHBlY3RlZCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChyZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcycsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtEb21haW5DbGllbnQjcmVxdWVzdENvcHlGYWN0b3J5fVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgdXNlIGNhY2hlZCB1cmwgb24gcmVwZWF0ZWQgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cyk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChyZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcycsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChyZXNwb25zZSwgZXhwZWN0ZWQpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2UoZ2V0SG9zdFN0dWIpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2UoZ2V0UmVnaW9uc1N0dWIpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZXF1ZXN0IHVybCBhZ2FpbiBpZiBleHBpcmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg2MTAwMDApO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKHJlc3BvbnNlLCBleHBlY3RlZCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChyZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcycsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRUd2ljZShnZXRIb3N0U3R1Yik7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkVHdpY2UoZ2V0UmVnaW9uc1N0dWIpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcmVxdWVzdCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEudmludC1oaWxsLmFnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWkvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMnLFxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICB9LFxuICAgICAgfSkudGhyb3dzKG5ldyBWYWxpZGF0aW9uRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZhbGlkYXRpb25FcnJvciBleHBlY3RlZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IubmFtZS5zaG91bGQuZXF1YWwoJ1ZhbGlkYXRpb25FcnJvcicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3IgaWYgZmFpbGVkIHRvIGdldCBob3N0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgZ2V0SG9zdFN0dWIudGhyb3dzKG5ldyBWYWxpZGF0aW9uRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZhbGlkYXRpb25FcnJvciBleHBlY3RlZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IubmFtZS5zaG91bGQuZXF1YWwoJ1ZhbGlkYXRpb25FcnJvcicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICovXG4gICAgZGVzY3JpYmUoJ3JlZ2lvbnMnLCAoKSA9PiB7XG5cbiAgICAgIC8qKlxuICAgICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICAgKi9cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIGlmIGZhaWxlZCB0byBnZXQgcmVnaW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgZ2V0UmVnaW9uc1N0dWIudGhyb3dzKG5ldyBWYWxpZGF0aW9uRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZhbGlkYXRpb25FcnJvciBleHBlY3RlZCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGVycm9yLm5hbWUuc2hvdWxkLmVxdWFsKCdWYWxpZGF0aW9uRXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICAgKi9cbiAgICAgIGl0KCdzaG91bGQgdHJ5IGFub3RoZXIgcmVnaW9uIGlmIHRoZSBmaXJzdCBmYWlsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy8nICtcbiAgICAgICAgICAnY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMnLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLnJlamVjdHMobmV3IEludGVybmFsRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICAgIHJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS51cy13ZXN0LmFnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWkvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMnLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICAgICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChyZXF1ZXN0U3R1Yiwge1xuICAgICAgICAgIHVybDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxLnVzLXdlc3QuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcycsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChyZXNwb25zZSwgZXhwZWN0ZWQpO1xuXG4gICAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlKGdldEhvc3RTdHViKTtcbiAgICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2UoZ2V0UmVnaW9uc1N0dWIpO1xuICAgICAgfSk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNyZXF1ZXN0Q29weUZhY3Rvcnl9XG4gICAgICAgKi9cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIGlmIGFsbCByZWdpb25zIGZhaWxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgcmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgICAgIHVybDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxLnZpbnQtaGlsbC5hZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpL3VzZXJzLycgKyBcbiAgICAgICAgICAnY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMnLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLnRocm93cyhuZXcgSW50ZXJuYWxFcnJvcigndGVzdCcpKTtcbiAgICAgICAgcmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgICAgIHVybDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxLnVzLXdlc3QuYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcycsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgfSkudGhyb3dzKG5ldyBJbnRlcm5hbEVycm9yKCd0ZXN0JykpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVybmFsRXJyb3IgZXhwZWN0ZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBlcnJvci5uYW1lLnNob3VsZC5lcXVhbCgnSW50ZXJuYWxFcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3R9XG4gICAqL1xuICBkZXNjcmliZSgncmVxdWVzdCcsICgpID0+IHtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgICAgdXJsOiAgJ2h0dHBzOi8vbXQtcHJvdmlzaW9uaW5nLWFwaS12MS5hZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAganNvbjogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgcmVxdWVzdFN0dWIud2l0aEFyZ3Mob3B0cykucmVzb2x2ZXMoZXhwZWN0ZWQpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb21haW5DbGllbnQucmVxdWVzdChvcHRzKTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChyZXNwb25zZSwgZXhwZWN0ZWQpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgocmVxdWVzdFN0dWIsIG9wdHMpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3RTaWduYWx9XG4gICAqL1xuICBkZXNjcmliZSgncmVxdWVzdFNpZ25hbCcsICgpID0+IHtcblxuICAgIGNvbnN0IHNpZ25hbE9wdHMgPSB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy9hY2NvdW50SWQvc2lnbmFscycsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG5cbiAgICBjb25zdCBleHBlY3RlZFNpZ25hbHMgPSBbe1xuICAgICAgc3RyYXRlZ3k6IHsgaWQ6ICcxMjM0JywgbmFtZTogJ1Rlc3Qgc3RyYXRlZ3knIH0sXG4gICAgICBwb3NpdGlvbklkOiAnMTIzNDU2JyxcbiAgICAgIHRpbWU6ICcyMDIxLTExLTE5VDE4OjU2OjMyLjU5MFonLFxuICAgICAgc3ltYm9sOiAnR0JQVVNEJyxcbiAgICAgIHR5cGU6ICdsaW1pdCcsXG4gICAgICBzaWRlOiAnYnV5JyxcbiAgICB9XTtcblxuICAgIGxldCBob3N0O1xuXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBob3N0ID0ge1xuICAgICAgICBob3N0OiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEnLFxuICAgICAgICBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKSxcbiAgICAgICAgcmVnaW9uczogWyd2aW50LWhpbGwnXSxcbiAgICAgICAgZG9tYWluOiAnYWdpbGl1bXRyYWRlLmFpJ1xuICAgICAgfTtcbiAgICAgIGZhaWxvdmVyUmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3NpZ25hbHMnLFxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICB9LFxuICAgICAgfSkucmVzb2x2ZXMoZXhwZWN0ZWRTaWduYWxzKTtcbiAgICAgIGZhaWxvdmVyUmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS51cy13ZXN0LmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC9zaWduYWxzJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgIH0pLnJlamVjdHMobmV3IEludGVybmFsRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICBhd2FpdCBkb21haW5DbGllbnQuZ2V0U2lnbmFsQ2xpZW50SG9zdCgndmludC1oaWxsJyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3RTaWduYWx9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIGEgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZG9tYWluQ2xpZW50LnJlcXVlc3RTaWduYWwoc2lnbmFsT3B0cywgaG9zdCwgJ2FjY291bnRJZCcpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKHJlc3BvbnNlLCBleHBlY3RlZFNpZ25hbHMpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoZmFpbG92ZXJSZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3NpZ25hbHMnLFxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3RTaWduYWx9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIGEgcmVxdWVzdCB3aXRoIG11bHRpcGxlIHJlZ2lvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBob3N0LnJlZ2lvbnMgPSBbJ3ZpbnQtaGlsbCcsICd1cy13ZXN0J107XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKHNpZ25hbE9wdHMsIGhvc3QsICdhY2NvdW50SWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChyZXNwb25zZSwgZXhwZWN0ZWRTaWduYWxzKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGZhaWxvdmVyUmVxdWVzdFN0dWIsIHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEudmludC1oaWxsLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC9zaWduYWxzJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoZmFpbG92ZXJSZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS51cy13ZXN0LmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC9zaWduYWxzJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtEb21haW5DbGllbnQjcmVxdWVzdFNpZ25hbH1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbiBlcnJvciBpZiBhbGwgcmVnaW9ucyBmYWlsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBob3N0LnJlZ2lvbnMgPSBbJ3ZpbnQtaGlsbCcsICd1cy13ZXN0J107XG4gICAgICBmYWlsb3ZlclJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEudmludC1oaWxsLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC9zaWduYWxzJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgIH0pLnJlamVjdHMobmV3IEludGVybmFsRXJyb3IoJ3Rlc3QnKSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKHNpZ25hbE9wdHMsIGhvc3QsICdhY2NvdW50SWQnKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnRlcm5hbEVycm9yIGV4cGVjdGVkJyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBlcnJvci5uYW1lLnNob3VsZC5lcXVhbCgnSW50ZXJuYWxFcnJvcicpO1xuICAgICAgfVxuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoZmFpbG92ZXJSZXF1ZXN0U3R1Yiwge1xuICAgICAgICB1cmw6ICdodHRwczovL2NvcHlmYWN0b3J5LWFwaS12MS52aW50LWhpbGwuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3NpZ25hbHMnLFxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChmYWlsb3ZlclJlcXVlc3RTdHViLCB7XG4gICAgICAgIHVybDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxLnVzLXdlc3QuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3NpZ25hbHMnLFxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I3JlcXVlc3RTaWduYWx9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIGEgcmVxdWVzdCBhbmQgdXBkYXRlIGhvc3QgaWYgZXhwaXJlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG90aGVyUmVnaW9uT3B0cyA9IHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEuZ2VybWFueS5hZ2lsaXVtdHJhZGUuYWkvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy9hY2NvdW50SWQvc2lnbmFscycsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGpzb246IHRydWUsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY29uc3Qgb3RoZXJSZWdpb25TdHViID0gZmFpbG92ZXJSZXF1ZXN0U3R1Yi53aXRoQXJncyhvdGhlclJlZ2lvbk9wdHMpLnJlc29sdmVzKGV4cGVjdGVkU2lnbmFscyk7XG4gICAgICBjb25zdCByZXBsaWNhQ2FsbFN0dWIgPSBmYWlsb3ZlclJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3B5ZmFjdG9yeS1hcGktdjEuZnJhbmNlLmFnaWxpdW10cmFkZS5haS91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC9zaWduYWxzJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZ2V0QWNjb3VudFN0dWIgPSBmYWlsb3ZlclJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgdXJsOiAgJ2h0dHBzOi8vbXQtcHJvdmlzaW9uaW5nLWFwaS12MS5hZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAganNvbjogdHJ1ZVxuICAgICAgfSkucmVzb2x2ZXMoe19pZDogJ2FjY291bnRJZCcsIHJlZ2lvbjogJ2dlcm1hbnknLCBhY2NvdW50UmVwbGljYXM6IFtcbiAgICAgICAge19pZDogJ2FjY291bnRJZDInLCByZWdpb246ICdmcmFuY2UnfVxuICAgICAgXX0pO1xuICAgICAgYXdhaXQgZG9tYWluQ2xpZW50LnJlcXVlc3RTaWduYWwoc2lnbmFsT3B0cywgaG9zdCwgJ2FjY291bnRJZCcpO1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCA1MCkpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChnZXRBY2NvdW50U3R1Yik7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKG90aGVyUmVnaW9uU3R1Yik7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKHJlcGxpY2FDYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoNjEwMDAwKTtcbiAgICAgIGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKHNpZ25hbE9wdHMsIGhvc3QsICdhY2NvdW50SWQnKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgNTApKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlKGdldEFjY291bnRTdHViKTtcbiAgICAgIHNpbm9uLmFzc2VydC5ub3RDYWxsZWQob3RoZXJSZWdpb25TdHViKTtcbiAgICAgIHNpbm9uLmFzc2VydC5ub3RDYWxsZWQocmVwbGljYUNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGRvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKHNpZ25hbE9wdHMsIGhvc3QsICdhY2NvdW50SWQnKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgNTApKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlKGdldEFjY291bnRTdHViKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlKG90aGVyUmVnaW9uU3R1Yik7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZShyZXBsaWNhQ2FsbFN0dWIpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I2dldEFjY291bnRJbmZvfVxuICAgKi9cbiAgZGVzY3JpYmUoJ2dldEFjY291bnRJbmZvJywgKCkgPT4ge1xuXG4gICAgbGV0IGdldEFjY291bnRTdHViO1xuICAgIGxldCBleHBlY3RlZEFjY291bnQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGV4cGVjdGVkQWNjb3VudCA9IHtfaWQ6ICdhY2NvdW50SWQyJywgcmVnaW9uOiAnZ2VybWFueScsIGFjY291bnRSZXBsaWNhczogW119O1xuICAgICAgZ2V0QWNjb3VudFN0dWIgPSBmYWlsb3ZlclJlcXVlc3RTdHViLndpdGhBcmdzKHtcbiAgICAgICAgdXJsOiAgJ2h0dHBzOi8vbXQtcHJvdmlzaW9uaW5nLWFwaS12MS5hZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAganNvbjogdHJ1ZVxuICAgICAgfSkucmVzb2x2ZXMoZXhwZWN0ZWRBY2NvdW50KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtEb21haW5DbGllbnQjZ2V0QWNjb3VudEluZm99XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCBnZXQgYWNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBkb21haW5DbGllbnQuZ2V0QWNjb3VudEluZm8oJ2FjY291bnRJZCcpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKGFjY291bnQsIHtpZDogJ2FjY291bnRJZDInLCByZWdpb25zOiBbJ2dlcm1hbnknXX0pO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNnZXRBY2NvdW50SW5mb31cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGdldCBhY2NvdW50IHdpdGggcmVwbGljYXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRBY2NvdW50U3R1Yi5yZXNvbHZlcyh7XG4gICAgICAgIF9pZDogJ2FjY291bnRJZCcsIFxuICAgICAgICByZWdpb246ICd2aW50LWhpbGwnLCBcbiAgICAgICAgYWNjb3VudFJlcGxpY2FzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgX2lkOiAnYWNjb3VudElkMicsIFxuICAgICAgICAgICAgcmVnaW9uOiAndXMtd2VzdCcsIFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgZG9tYWluQ2xpZW50LmdldEFjY291bnRJbmZvKCdhY2NvdW50SWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChhY2NvdW50LCB7aWQ6ICdhY2NvdW50SWQnLCByZWdpb25zOiBbJ3ZpbnQtaGlsbCcsICd1cy13ZXN0J119KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldEFjY291bnRJbmZvfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgZ2V0IHByaW1hcnkgYWNjb3VudCBpZiByZXF1ZXN0ZWQgYWNjb3VudCBpcyBhIHJlcGxpY2EnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRBY2NvdW50U3R1Yi5yZXNvbHZlcyh7XG4gICAgICAgIF9pZDogJ2FjY291bnRJZCcsIFxuICAgICAgICByZWdpb246ICd2aW50LWhpbGwnLCBcbiAgICAgICAgcHJpbWFyeUFjY291bnRJZDogJ2FjY291bnRJZDInXG4gICAgICB9KTtcbiAgICAgIGZhaWxvdmVyUmVxdWVzdFN0dWIud2l0aEFyZ3Moe1xuICAgICAgICB1cmw6ICAnaHR0cHM6Ly9tdC1wcm92aXNpb25pbmctYXBpLXYxLmFnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWkvdXNlcnMvY3VycmVudC9hY2NvdW50cy9hY2NvdW50SWQyJyxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAganNvbjogdHJ1ZVxuICAgICAgfSkucmVzb2x2ZXMoe1xuICAgICAgICBfaWQ6ICdhY2NvdW50SWQyJywgcmVnaW9uOiAndXMtd2VzdCcsIGFjY291bnRSZXBsaWNhczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIF9pZDogJ2FjY291bnRJZCcsIFxuICAgICAgICAgICAgcmVnaW9uOiAndmludC1oaWxsJywgXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBkb21haW5DbGllbnQuZ2V0QWNjb3VudEluZm8oJ2FjY291bnRJZCcpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKGFjY291bnQsIHtpZDogJ2FjY291bnRJZDInLCByZWdpb25zOiBbJ3VzLXdlc3QnLCAndmludC1oaWxsJ119KTtcbiAgICB9KTtcblxuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge0RvbWFpbkNsaWVudCNnZXRTaWduYWxDbGllbnRIb3N0fVxuICAgKi9cbiAgZGVzY3JpYmUoJ2dldFNpZ25hbENsaWVudEhvc3QnLCAoKSA9PiB7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7RG9tYWluQ2xpZW50I2dldFNpZ25hbENsaWVudEhvc3R9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2lnbmFsIGNsaWVudCBob3N0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb21haW5DbGllbnQuZ2V0U2lnbmFsQ2xpZW50SG9zdChbJ3ZpbnQtaGlsbCddKTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChyZXNwb25zZSwgeyBcbiAgICAgICAgaG9zdDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxJyxcbiAgICAgICAgcmVnaW9uczogWyd2aW50LWhpbGwnXSxcbiAgICAgICAgZG9tYWluOiAnYWdpbGl1bXRyYWRlLmFnaWxpdW10cmFkZS5haScgXG4gICAgICB9KTtcbiAgICB9KTtcblxuICB9KTtcblxufSk7XG4iXX0=