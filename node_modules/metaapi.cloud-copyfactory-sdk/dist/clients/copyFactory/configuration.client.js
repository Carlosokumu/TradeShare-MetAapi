'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _metaApi = require('../metaApi.client');

var _metaApi2 = _interopRequireDefault(_metaApi);

var _timeoutError = require('../timeoutError');

var _timeoutError2 = _interopRequireDefault(_timeoutError);

var _randomstring = require('randomstring');

var _randomstring2 = _interopRequireDefault(_randomstring);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * metaapi.cloud CopyFactory configuration API (trade copying configuration API) client (see
 * https://metaapi.cloud/docs/copyfactory/)
 */
class ConfigurationClient extends _metaApi2.default {

  /**
   * Constructs CopyFactory configuration API client instance
   * @param {DomainClient} domainClient domain client
   */
  constructor(domainClient) {
    super(domainClient);
    this._domainClient = domainClient;
  }

  /**
   * Strategy id
   * @typedef {Object} StrategyId
   * @property {String} id strategy id
   */

  /**
   * Retrieves new unused strategy id. Method is accessible only with API access token. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/generateStrategyId/
   * @return {Promise<StrategyId>} promise resolving with strategy id generated
   */
  generateStrategyId() {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('generateStrategyId');
    }
    const opts = {
      url: '/users/current/configuration/unused-strategy-id',
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Generates random account id
   * @return {String} account id
   */
  generateAccountId() {
    return _randomstring2.default.generate(64);
  }

  /**
   * Strategy signal delay
   * @typedef {Object} StrategySignalDelay
   * @property {Number} minInSeconds min extra trading signal delay value expressed in seconds
   * @property {Number} maxInSeconds max extra trading signal delay value expressed in seconds
   */

  /**
   * CopyFactory strategy subscriptions
   * @typedef {Object} CopyFactoryStrategySubscription
   * @property {String} strategyId id of the strategy to subscribe to
   * @property {Number} [multiplier] subscription multiplier, default is 1x
   * @property {Boolean} [skipPendingOrders] flag indicating that pending orders should not be copied. Default
   * is to copy pending orders
   * @property {String} [closeOnly] setting wich instructs the application not to open new positions. by-symbol
   * means that it is still allowed to open new positions with a symbol equal to the symbol of an existing strategy
   * position (can be used to gracefuly exit strategies trading in netting mode or placing a series of related trades
   * per symbol). immediately means to close all positions immediately. One of 'by-position', 'by-symbol', 'immediately'
   * @property {Number} [maxTradeRisk] max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] setting indicating whether to enable automatic trade
   * correlation reduction. Possible settings are not specified (disable correlation risk restrictions),
   * by-strategy (limit correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filter which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] strategy risk limits. You can configure trading to be
   * stopped once total drawdown generated during specific period is exceeded. Can be specified either for balance or
   * equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] stop loss value restriction
   * @property {Number} [maxLeverage] setting indicating maximum leverage allowed when opening a new positions.
   * Any trade which results in a higher leverage will be discarded
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeScaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {string[]} [allowedSides] Trade sides which will be copied. Buy trades only, sell trades only or all
   * trades. Default is to copy all trades
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {StrategySignalDelay} [signalDelay] extra trade copying delay introduced by trade copier before
   * applying the trade signal. You can configure either a fixed or a random delay
   * @property {boolean} [removed] flag indicating that the subscription was scheduled for removal once all subscription
   * positions will be closed
   */

  /**
   * CopyFactory strategy trade size scaling settings
   * @typedef {Object} CopyFactoryStrategyTradeSizeScaling
   * @property {string} mode If set to balance, the trade size on strategy subscriber will be scaled according
   * to balance to preserve risk. If set to equity, the trade size on strategy subscriber will be scaled according
   * to subscriber equity. If value is none, then trade size will be preserved irregardless of the subscriber
   * balance. If value is contractSize, then trade size will be scaled according to contract size. If fixedVolume
   * is set, then trade will be copied with a fixed volume of tradeVolume setting. If fixedRisk is set, then each
   * trade will be copied with a trade volume set to risk specific fraction of balance as configured by
   * riskFraction setting. Note, that in fixedRisk mode trades without a SL are not copied. If expression is
   * set, then trade volume will be calculated using a user-defined expression. Note, that expression trade
   * size scaling mode is intended for advanced users and we DO NOT RECOMMEND using it unless you understand
   * what are you doing, as mistakes in expression can result in loss.
   * Allowed values: none, contractSize, balance, equity, fixedVolume, fixedRisk, expression.
   * @property {number} [tradeVolume] Fixed trade volume for use with fixedVolume trade size scaling mode
   * @property {number} [riskFraction] Fixed risk fraction for use with fixedRisk trade size scaling mode
   * @property {boolean} [forceTinyTrades] if set to true, that trades smaller than minVolume - 0.5 * volumeStep will
   * be placed with minVolume volume, in spite that they will result in increased trade risk, as long as risk
   * increase is in line with maxRiskCoefficient configuration. Otherwise such trades will be skipped to avoid
   * taking excessive trade risk. Default is false.
   * @property {number} [maxRiskCoefficient] sometimes when placing a small trade, the risk taken can exceed the
   * subscription expectation due to volume rounding or forcefully placing tiny trades in accordance with
   * forceTinyTrades setting. The maxRiskCoefficient setting will act as an extra line of protection to restrict
   * trades if actual risk exceeds the value of expected subscription risk multiplied by maxRiskCoefficient. As a
   * result trade volume will be decreased correspondingly or trade will be skipped if resulting volume is less
   * than minVolume. Default value is 5, minimum value is 1.
   * @property {string} [expression] math.js expression which will be used to calculate trade volume
   * (see https://mathjs.org/docs/expressions/syntax.html). Following variables are available in expression
   * scope: providerVolume - provider signal trade size; providerTradeAmount - provider signal trade value in
   * trade copier base curency; multiplier - subscription multiplier value; providerBalance - provider balance
   * value in trade copier base currency; balance - subscriber balance value in trade copier base currency;
   * quoteOrOpenPrice - current asset price (for market orders) or open price (for pending orders) on subscriber
   * side; tickValue - current asset tick value on subscriber side expressed in trade copier base currency;
   * tickSize - tick size on subscriber side; providerScaledVolume - provider trade volume multiplied by provider
   * contract size; contractSize - subscriber contract size; providerStopLoss - provider signal stop loss price;
   * providerTakeProfit - provider signal take profit price; accountCurrencyExchangeRate - subscriber exchange
   * rate of account currency to trade copier base currency 
   */

  /**
   * CopyFactory symbol filter
   * @typedef {Object} CopyFactoryStrategySymbolFilter
   * @property {Array<String>} included list of symbols copied. Leave the value empty to copy all symbols
   * @property {Array<String>} excluded list of symbols excluded from copying. Leave the value empty to copy all symbols
   */

  /**
   * CopyFactory news risk filter
   * @typedef {Object} CopyFactoryStrategyNewsFilter
   * @property {CopyFactoryStrategyBreakingNewsFilter} [breakingNewsFilter] breaking news filter
   * @property {CopyFactoryStrategyCalendarNewsFilter} [calendarNewsFilter] calendar news filter
   */

  /**
   * CopyFactory breaking news risk filter
   * @typedef {Object} CopyFactoryStrategyBreakingNewsFilter
   * @property {Array<String>} priorities list of breaking news priorities to stop trading on, leave empty to disable
   * breaking news filter. One of high, medium, low.
   * @property {Number} [closePositionTimeGapInMinutes] time interval specifying when to force close an already
   * open position after breaking news. Default value is 60 minutes
   * @property {Number} [openPositionFollowingTimeGapInMinutes] time interval specifying when it is allowed to
   * open position after calendar news. Default value is 60 minutes
   */

  /**
   * CopyFactory calendar new filter
   * @typedef {Object} CopyFactoryStrategyCalendarNewsFilter
   * @property {Array<String>} priorities list of calendar news priorities to stop trading on, leave empty to disable
   * calendar news filter. One of election, high, medium, low.
   * @property {Number} [closePositionTimeGapInMinutes] time interval specifying when to force close an already
   * open position before calendar news. Default value is 60 minutes
   * @property {Number} [openPositionPrecedingTimeGapInMinutes] time interval specifying when it is still
   * allowed to open position before calendar news. Default value is 120 minutes
   * @property {Number} [openPositionFollowingTimeGapInMinutes] time interval specifying when it is allowed to
   * open position after calendar news. Default value is 60 minutes
   */

  /**
   * CopyFactory strategy risk limit type
   * @typedef {'day' | 'date' | 'week' | 'week-to-date' | 'month' | 'month-to-date' | 'quarter' | 'quarter-to-date' |
   * 'year' | 'year-to-date' | 'lifetime'} CopyFactoryStrategyRiskLimitType
   */

  /**
   * CopyFactory strategy risk limit apply to enum
   * @typedef {'balance-difference' | 'balance-minus-equity' | 'equity-difference'} CopyFactoryStrategyRiskLimitApplyTo
   */

  /**
   * CopyFactory risk limit filter
   * @typedef {Object} CopyFactoryStrategyRiskLimit
   * @property {CopyFactoryStrategyRiskLimitType} type restriction type
   * @property {CopyFactoryStrategyRiskLimitApplyTo} applyTo account metric to apply limit to
   * @property {Number} [maxAbsoluteRisk] max drawdown allowed, measured in account currency
   * @property {Number} [maxRelativeRisk] max drawdown allowed, measured in account currency
   * @property {Boolean} closePositions whether to force close positions when the risk is reached. If value is false
   * then only the new trades will be halted, but existing ones will not be closed
   * @property {Date|string|moment.Moment} [startTime] time to start risk tracking from. All previous trades will be ignored. You
   * can use this value to reset the filter after stopout event
   */

  /**
   * CopyFactory strategy max stop loss settings
   * @typedef {Object} CopyFactoryStrategyMaxStopLoss
   * @property {Number} value maximum SL value
   * @property {String} units SL units. Only pips value is supported at this point
   */

  /**
   * CopyFactory strategy symbol mapping
   * @typedef {Object} CopyFactoryStrategySymbolMapping
   * @property {String} from symbol name to convert from
   * @property {String} to symbol name to convert to
   */

  /**
   * CopyFactory account update
   * @typedef {Object} CopyFactorySubscriberUpdate
   * @property {String} name account human-readable name
   * @property {Number} [reservedMarginFraction] fraction of reserved margin to reduce a risk of margin call.
   * Default is to reserve no margin. We recommend using maxLeverage setting instead. Specified as a fraction of balance
   * thus the value is usually greater than 1
   * @property {Array<String>} [phoneNumbers] phone numbers to send sms notifications to. Leave empty to
   * receive no sms notifications
   * @property {Number} [minTradeAmount] value of minimal trade size allowed, expressed in amount of account
   * currency. Can be useful if your broker charges a fixed fee per transaction so that you can skip small trades with
   * high broker commission rates. Default is 0
   * @property {String} [closeOnly] setting wich instructs the application not to open new positions. by-symbol
   * means that it is still allowed to open new positions with a symbol equal to the symbol of an existing strategy
   * position (can be used to gracefuly exit strategies trading in netting mode or placing a series of related trades
   * per symbol). immediately means to close all positions immediately. One of 'by-position', 'by-symbol', 'immediately'
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] account risk limits. You can configure trading to be
   * stopped once total drawdown generated during specific period is exceeded. Can be specified either for balance or
   * equity drawdown
   * @property {Number} [maxLeverage] setting indicating maxumum leverage allowed when opening a new positions.
   * Any trade which results in a higher leverage will be discarded.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {string[]} [allowedSides] Trade sides which will be copied. Buy trades only, sell trades only or all
   * trades. Default is to copy all trades
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {StrategySignalDelay} [signalDelay] extra trade copying delay introduced by trade copier before
   * applying the trade signal. You can configure either a fixed or a random delay
   * @property {Array<CopyFactoryStrategySubscription>} subscriptions strategy subscriptions
   */

  /**
   * CopyFactory subscriber model
   * @typedef {CopyFactorySubscriberUpdate} CopyFactorySubscriber
   * @property {String} _id id of the MetaApi account to copy trades to 
   */

  /**
   * CopyFactory provider strategy
   * @typedef {CopyFactoryStrategyUpdate} CopyFactoryStrategy
   * @property {String} _id unique strategy id
   * @property {Number} platformCommissionRate commission rate the platform charges for strategy copying, applied to
   * commissions charged by provider. This commission applies only to accounts not managed directly by provider. Should
   * be fraction of 1
   * @property {String} [closeOnRemovalMode] position close mode on strategy or subscription removal. Preserve means
   * that positions will not be closed and will not be managed by CopyFactory. close-gracefully-by-position means
   * that positions will continue to be managed by CopyFactory, but only close signals will be copied.
   * close-gracefully-by-symbol means that positions will continue to be managed by CopyFactory, but only close
   * signals will be copied or signals to open positions for the symbols which already have positions opened.
   * close-immediately means that all positions will be closed immediately. Default is close-immediately.
   * This field can be changed via remove potfolio member API only, one of preserve, close-gracefully-by-position,
   * close-gracefully-by-symbol, close-immediately
   */

  /**
   * CopyFactory strategy commission scheme
   * @typedef {Object} CopyFactoryStrategyCommissionScheme
   * @property {String} type commission type. One of flat-fee, lots-traded, lots-won, amount-traded, amount-won,
   * high-water-mark
   * @property {String} billingPeriod billing period. One of week, month, quarter
   * @property {Number} commissionRate commission rate. Should be greater than or equal to zero if commission type is
   * flat-fee, lots-traded or lots-won, should be greater than or equal to zero and less than or equal to 1 if
   * commission type is amount-traded, amount-won, high-water-mark.
   */

  /**
   * CopyFactory strategy magic filter
   * @typedef {Object} CopyFactoryStrategyMagicFilter
   * @property {Array<String>} included list of magics (expert ids) or magic ranges copied. Leave the value empty to
   * copy all magics
   * @property {Array<String>} excluded list of magics (expert ids) or magic ranges excluded from copying. Leave the
   * value empty to copy all magics
   */

  /**
   * CopyFactory strategy time settings
   * @typedef {Object} CopyFactoryStrategyTimeSettings
   * @property {number} [lifetimeInHours] position lifetime. Default is to keep positions open up to 90 days
   * @property {number} [openingIntervalInMinutes] time interval to copy new positions. Default is to let 1
   * minute for the position to get copied. If position were not copied during this time, the copying will not be
   * retried anymore.
   * @property {boolean} [expirePendingOrderSignals] If set to true, the openingIntervalInMinutes setting will be
   * applied to pending order signals as well. By default pending order signals do not expire
   */

  /**
   * CopyFactory strategy equity curve filter
   * @typedef {Object} CopyFactoryStrategyEquityCurveFilter
   * @property {Number} period moving average period, must be greater or equal to 1
   * @property {String} timeframe moving average timeframe, a positive integer followed by time unit, e.g. 2h.
   * Allowed units are s, m, h, d and w.
   */

  /**
   * Retrieves CopyFactory copy trading strategies. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getStrategies/
   * @param {Boolean} [includeRemoved] flag instructing to include removed strategies in results
   * @param {Number} [limit] pagination limit
   * @param {Number} [offset] copy trading strategy id
   * @return {Promise<Array<CopyFactoryStrategy>>} promise resolving with CopyFactory strategies found
   */
  getStrategies(includeRemoved, limit, offset) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getStrategies');
    }
    let qs = {};
    if (includeRemoved !== undefined) {
      qs.includeRemoved = includeRemoved;
    }
    if (limit !== undefined) {
      qs.limit = limit;
    }
    if (offset !== undefined) {
      qs.offset = offset;
    }
    const opts = {
      url: '/users/current/configuration/strategies',
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      qs,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts, true);
  }

  /**
   * Retrieves CopyFactory copy trading strategy by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getStrategy/
   * @param {string} strategy id trading strategy id
   * @return {Promise<CopyFactoryStrategy>} promise resolving with CopyFactory strategy found
   */
  getStrategy(strategyId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getStrategy');
    }
    const opts = {
      url: `/users/current/configuration/strategies/${strategyId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * CopyFactory strategy drawdown filter
   * @typedef {Object} CopyFactoryStrategyDrawdownFilter
   * @property {Number} maxDrawdown maximum drawdown value after which action is executed. Drawdown should
   * be configured as a fraction of 1, i.e. 0.15 means 15% drawdown value
   * @property {String} action action to take when drawdown exceeds maxDrawdown value. include means the trading
   * signal will be transmitted only if dd is greater than maxDrawdown value. exclude means the trading signal 
   * will be transmitted only if dd is less than maxDrawdown value
   */

  /**
   * Telegram publishing settings
   * @typedef {Object} StrategyTelegramPublishingSettings
   * @property {String} token telegram bot API token
   * @property {String} chatId telegram chatId to publish signals to. It can reference either a public
   * channel (e.g. @myChannel), private channel (works by chat id only) or a user (works by chatId only).
   * Note that in order to publish signals to a channel bot must be an admin of the channel
   * @property {String} template telegram message template. A substring of ${description} will be replaced
   * with a signal description. Other variables you can use: ${operation}, ${orderId}, ${side}, ${type}, ${volume},
   * ${symbol}, ${openPrice}, ${stopLoss}, ${takeProfit}.
   */

  /**
   * Strategy Telegram integration settings
   * @typedef {Object} StrategyTelegramSettings
   * @property {StrategyTelegramPublishingSettings} publishing telegram publishing settings
   */

  /**
   * CopyFactory strategy update
   * @typedef {Object} CopyFactoryStrategyUpdate
   * @property {String} name strategy human-readable name
   * @property {String} description longer strategy human-readable description
   * @property {String} accountId id of the MetaApi account providing the strategy
   * @property {Boolean} [skipPendingOrders] flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {CopyFactoryStrategyCommissionScheme} [commissionScheme] commission scheme allowed by this strategy
   * @property {Number} [maxTradeRisk] max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] setting indicating whether to enable automatic trade
   * correlation reduction. Possible settings are not specified (disable correlation risk restrictions),
   * by-strategy (limit correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] stop loss value restriction
   * @property {Number} [maxLeverage] max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeScaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {string[]} [allowedSides] Trade sides which will be copied. Buy trades only, sell trades only or all
   * trades. Default is to copy all trades
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {StrategySignalDelay} [signalDelay] extra trade copying delay introduced by trade copier before
   * applying the trade signal. You can configure either a fixed or a random delay
   * @property {CopyFactoryStrategyMagicFilter} [magicFilter] magic (expert id) filter
   * @property {CopyFactoryStrategyEquityCurveFilter} [equityCurveFilter] filter which permits the trades only if account
   * equity is greater than balance moving average
   * @property {CopyFactoryStrategyDrawdownFilter} [drawdownFilter] master account strategy drawdown filter
   * @property {Array<String>} [symbolsTraded] symbols traded by this strategy. Specifying the symbols will improve trade
   * latency on first trades made by strategy. If you do not specify this setting the application will monitor the strategy
   * trades and detect the symbols automatically over time 
   * @property {StrategyTelegramSettings} [telegram] telegram publishing settings
   * @property {CopyFactoryStrategyTimeSettings} [timeSettings] settings to manage copying timeframe and position
   * lifetime. Default is to copy position within 1 minute from being opened at source and let the position to live for
   * up to 90 days
   */

  /**
   * Updates a CopyFactory strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updateStrategy/
   * @param {String} strategyId copy trading strategy id
   * @param {CopyFactoryStrategyUpdate} strategy trading strategy update
   * @return {Promise} promise resolving when strategy is updated
   */
  updateStrategy(strategyId, strategy) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updateStrategy');
    }
    const opts = {
      url: `/users/current/configuration/strategies/${strategyId}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: strategy,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * CopyFactory close instructions
   * @typedef {Object} CopyFactoryCloseInstructions
   * @property {String} [mode] position close mode on strategy or subscription removal. Preserve means
   * that positions will not be closed and will not be managed by CopyFactory.
   * close-gracefully-by-position means that positions will continue to be managed by CopyFactory,
   * but only close signals will be copied. close-gracefully-by-symbol means that positions will
   * continue to be managed by CopyFactory, but only close signals will be copied or signals to
   * open positions for the symbols which already have positions opened. close-immediately means
   * that all positions will be closed immediately. Default is close-immediately. One of 'preserve',
   * 'close-gracefully-by-position', 'close-gracefully-by-symbol', 'close-immediately'
   * @property {Date} [removeAfter] time to force remove object after. The object will be removed after
   * this time, even if positions are not yet closed fully. Default is current date plus 30 days.
   * Can not be less than 30 days or greater than current date plus 90 days. The setting is ignored
   * when a subscription is being removed
   */

  /**
   * Deletes a CopyFactory strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removeStrategy/
   * @param {String} strategyId copy trading strategy id
   * @param {CopyFactoryCloseInstructions} [closeInstructions] strategy close instructions
   * @return {Promise} promise resolving when strategy is removed
   */
  removeStrategy(strategyId, closeInstructions) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removeStrategy');
    }
    const opts = {
      url: `/users/current/configuration/strategies/${strategyId}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      body: closeInstructions,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Portfolio strategy member
   * @typedef {Object} CopyFactoryPortfolioStrategyMember
   * @property {String} strategyId member strategy id
   * @property {Number} multiplier copying multiplier (weight in the portfolio)
   * @property {Boolean} [skipPendingOrders] flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {Number} [maxTradeRisk] max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] setting indicating whether to enable automatic trade
   * correlation reduction. Possible settings are not specified (disable correlation risk restrictions),
   * by-strategy (limit correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] stop loss value restriction
   * @property {Number} [maxLeverage] max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeScaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {string[]} [allowedSides] Trade sides which will be copied. Buy trades only, sell trades only or all
   * trades. Default is to copy all trades
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {StrategySignalDelay} [signalDelay] extra trade copying delay introduced by trade copier before
   * applying the trade signal. You can configure either a fixed or a random delay
   * @property {String} [closeOnRemovalMode] position close mode on strategy or subscription removal. Preserve means
   * that positions will not be closed and will not be managed by CopyFactory. close-gracefully-by-position means
   * that positions will continue to be managed by CopyFactory, but only close signals will be copied.
   * close-gracefully-by-symbol means that positions will continue to be managed by CopyFactory, but only close
   * signals will be copied or signals to open positions for the symbols which already have positions opened.
   * close-immediately means that all positions will be closed immediately. Default is close-immediately.
   * This field can be changed via remove potfolio member API only, one of preserve, close-gracefully-by-position,
   * close-gracefully-by-symbol, close-immediately
   */

  /**
   * Portfolio strategy update
   * @typedef {Object} CopyFactoryPortfolioStrategyUpdate
   * @property {String} name strategy human-readable name
   * @property {String} description longer strategy human-readable description
   * @property {Array<CopyFactoryPortfolioStrategyMember>} members array of portfolio members
   * @property {CopyFactoryStrategyCommissionScheme} [commissionScheme] commission scheme allowed by this strategy. By
   * default monthly billing period with no commission is being used
   * @property {Boolean} [skipPendingOrders] flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {Number} [maxTradeRisk] max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] setting indicating whether to enable automatic trade
   * correlation reduction. Possible settings are not specified (disable correlation risk restrictions),
   * by-strategy (limit correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] stop loss value restriction
   * @property {Number} [maxLeverage] max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeScaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {string[]} [allowedSides] Trade sides which will be copied. Buy trades only, sell trades only or all
   * trades. Default is to copy all trades
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {StrategySignalDelay} [signalDelay] extra trade copying delay introduced by trade copier before
   * applying the trade signal. You can configure either a fixed or a random delay
   */

  /**
   * Portfolio strategy, i.e. the strategy which includes a set of other strategies
   * @typedef {CopyFactoryPortfolioStrategyUpdate} CopyFactoryPortfolioStrategy
   * @property {String} _id unique strategy id
   * @property {Number} platformCommissionRate commission rate the platform charges for strategy copying, applied to
   * commissions charged by provider. This commission applies only to accounts not managed directly by provider. Should
   * be fraction of 1
   * @property {String} [closeOnRemovalMode] position close mode on strategy or subscription removal. Preserve means
   * that positions will not be closed and will not be managed by CopyFactory. close-gracefully-by-position means
   * that positions will continue to be managed by CopyFactory, but only close signals will be copied.
   * close-gracefully-by-symbol means that positions will continue to be managed by CopyFactory, but only close
   * signals will be copied or signals to open positions for the symbols which already have positions opened.
   * close-immediately means that all positions will be closed immediately. Default is close-immediately.
   * This field can be changed via remove potfolio member API only, one of preserve, close-gracefully-by-position,
   * close-gracefully-by-symbol, close-immediately
   */

  /**
   * Retrieves CopyFactory copy portfolio strategies. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getPortfolioStrategies/
   * @param {Boolean} [includeRemoved] flag instructing to include removed portfolio strategies in results
   * @param {Number} [limit] pagination limit
   * @param {Number} [offset] copy trading strategy id
   * @return {Promise<Array<CopyFactoryPortfolioStrategy>>} promise resolving with CopyFactory portfolio strategies
   * found
   */
  getPortfolioStrategies(includeRemoved, limit, offset) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getPortfolioStrategies');
    }
    let qs = {};
    if (includeRemoved !== undefined) {
      qs.includeRemoved = includeRemoved;
    }
    if (limit !== undefined) {
      qs.limit = limit;
    }
    if (offset !== undefined) {
      qs.offset = offset;
    }
    const opts = {
      url: '/users/current/configuration/portfolio-strategies',
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      qs,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts, true);
  }

  /**
   * Retrieves CopyFactory copy portfolio strategy by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getPortfolioStrategy/
   * @param {string} portfolioId portfolio strategy id
   * @return {Promise<CopyFactoryPortfolioStrategy>} promise resolving with CopyFactory portfolio strategy found
   */
  getPortfolioStrategy(portfolioId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getPortfolioStrategy');
    }
    const opts = {
      url: `/users/current/configuration/portfolio-strategies/${portfolioId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Updates a CopyFactory portfolio strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updatePortfolioStrategy/
   * @param {String} portfolioId copy trading portfolio strategy id
   * @param {CopyFactoryPortfolioStrategyUpdate} portfolio portfolio strategy update
   * @return {Promise} promise resolving when portfolio strategy is updated
   */
  updatePortfolioStrategy(portfolioId, portfolio) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updatePortfolioStrategy');
    }
    const opts = {
      url: `/users/current/configuration/portfolio-strategies/${portfolioId}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: portfolio,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Deletes a CopyFactory portfolio strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removePortfolioStrategy/
   * @param {String} portfolioId portfolio strategy id
   * @param {CopyFactoryCloseInstructions} [closeInstructions] strategy close instructions
   * @return {Promise} promise resolving when portfolio strategy is removed
   */
  removePortfolioStrategy(portfolioId, closeInstructions) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removePortfolioStrategy');
    }
    const opts = {
      url: `/users/current/configuration/portfolio-strategies/${portfolioId}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      body: closeInstructions,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Deletes a CopyFactory portfolio strategy member. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removePortfolioStrategyMember/
   * @param {String} portfolioId portfolio strategy id
   * @param {String} strategyId id of the strategy to delete member for
   * @param {CopyFactoryCloseInstructions} [closeInstructions] strategy close instructions
   * @return {Promise} promise resolving when portfolio strategy is removed
   */
  removePortfolioStrategyMember(portfolioId, strategyId, closeInstructions) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removePortfolioStrategyMember');
    }
    const opts = {
      url: `/users/current/configuration/portfolio-strategies/${portfolioId}/members/${strategyId}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      body: closeInstructions,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Returns CopyFactory subscribers the user has configured. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/history/getSubscribers/
   * @param {Boolean} [includeRemoved] flag instructing to include removed subscribers in results
   * @param {Number} [limit] pagination limit
   * @param {Number} [offset] copy trading strategy id
   * @return {Promise<Array<CopyFactorySubscriber>>} promise resolving with subscribers found
   */
  getSubscribers(includeRemoved, limit, offset) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getSubscribers');
    }
    let qs = {};
    if (includeRemoved !== undefined) {
      qs.includeRemoved = includeRemoved;
    }
    if (limit !== undefined) {
      qs.limit = limit;
    }
    if (offset !== undefined) {
      qs.offset = offset;
    }
    const opts = {
      url: '/users/current/configuration/subscribers',
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      qs,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts, true);
  }

  /**
   * Returns CopyFactory subscriber by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getSubscriber/
   * @param {String} subscriberId subscriber id
   * @returns {Promise<CopyFactorySubscriber>} promise resolving with subscriber found
   */
  getSubscriber(subscriberId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getSubscriber');
    }
    const opts = {
      url: `/users/current/configuration/subscribers/${subscriberId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Updates CopyFactory subscriber configuration. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updateSubscriber/
   * @param {String} subscriberId subscriber id
   * @param {CopyFactorySubscriberUpdate} subscriber subscriber update
   * @returns {Promise} promise resolving when subscriber is updated
   */
  updateSubscriber(subscriberId, subscriber) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updateSubscriber');
    }
    const opts = {
      url: `/users/current/configuration/subscribers/${subscriberId}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: subscriber,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Deletes subscriber configuration. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removeSubscriber/
   * @param {String} subscriberId subscriber id
   * @param {CopyFactoryCloseInstructions} [closeInstructions] subscriber close instructions
   * @returns {Promise} promise resolving when subscriber is removed
   */
  removeSubscriber(subscriberId, closeInstructions) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removeSubscriber');
    }
    const opts = {
      url: `/users/current/configuration/subscribers/${subscriberId}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      body: closeInstructions,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

  /**
   * Deletes a subscription of subscriber to a strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removeSubscription/
   * @param {String} subscriberId subscriber id
   * @param {String} strategyId strategy id
   * @param {CopyFactoryCloseInstructions} [closeInstructions] subscriber close instructions
   * @returns {Promise} promise resolving when subscriber is removed
   */
  removeSubscription(subscriberId, strategyId, closeInstructions) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removeSubscription');
    }
    const opts = {
      url: `/users/current/configuration/subscribers/${subscriberId}/subscriptions/${strategyId}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      body: closeInstructions,
      json: true
    };
    return this._domainClient.requestCopyFactory(opts);
  }

}
exports.default = ConfigurationClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L2NvbmZpZ3VyYXRpb24uY2xpZW50LmVzNiJdLCJuYW1lcyI6WyJDb25maWd1cmF0aW9uQ2xpZW50IiwiTWV0YUFwaUNsaWVudCIsImNvbnN0cnVjdG9yIiwiZG9tYWluQ2xpZW50IiwiX2RvbWFpbkNsaWVudCIsImdlbmVyYXRlU3RyYXRlZ3lJZCIsIl9pc05vdEp3dFRva2VuIiwiX2hhbmRsZU5vQWNjZXNzRXJyb3IiLCJvcHRzIiwidXJsIiwibWV0aG9kIiwiaGVhZGVycyIsIl90b2tlbiIsImpzb24iLCJyZXF1ZXN0Q29weUZhY3RvcnkiLCJnZW5lcmF0ZUFjY291bnRJZCIsInJhbmRvbXN0cmluZyIsImdlbmVyYXRlIiwiZ2V0U3RyYXRlZ2llcyIsImluY2x1ZGVSZW1vdmVkIiwibGltaXQiLCJvZmZzZXQiLCJxcyIsInVuZGVmaW5lZCIsImdldFN0cmF0ZWd5Iiwic3RyYXRlZ3lJZCIsInVwZGF0ZVN0cmF0ZWd5Iiwic3RyYXRlZ3kiLCJib2R5IiwicmVtb3ZlU3RyYXRlZ3kiLCJjbG9zZUluc3RydWN0aW9ucyIsImdldFBvcnRmb2xpb1N0cmF0ZWdpZXMiLCJnZXRQb3J0Zm9saW9TdHJhdGVneSIsInBvcnRmb2xpb0lkIiwidXBkYXRlUG9ydGZvbGlvU3RyYXRlZ3kiLCJwb3J0Zm9saW8iLCJyZW1vdmVQb3J0Zm9saW9TdHJhdGVneSIsInJlbW92ZVBvcnRmb2xpb1N0cmF0ZWd5TWVtYmVyIiwiZ2V0U3Vic2NyaWJlcnMiLCJnZXRTdWJzY3JpYmVyIiwic3Vic2NyaWJlcklkIiwidXBkYXRlU3Vic2NyaWJlciIsInN1YnNjcmliZXIiLCJyZW1vdmVTdWJzY3JpYmVyIiwicmVtb3ZlU3Vic2NyaXB0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQTs7OztBQUllLE1BQU1BLG1CQUFOLFNBQWtDQyxpQkFBbEMsQ0FBZ0Q7O0FBRTdEOzs7O0FBSUFDLGNBQVlDLFlBQVosRUFBMEI7QUFDeEIsVUFBTUEsWUFBTjtBQUNBLFNBQUtDLGFBQUwsR0FBcUJELFlBQXJCO0FBQ0Q7O0FBRUQ7Ozs7OztBQU1BOzs7OztBQUtBRSx1QkFBcUI7QUFDbkIsUUFBSSxLQUFLQyxjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixvQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUMsT0FBTztBQUNYQyxXQUFLLGlEQURNO0FBRVhDLGNBQVEsS0FGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhDLFlBQU07QUFOSyxLQUFiO0FBUUEsV0FBTyxLQUFLVCxhQUFMLENBQW1CVSxrQkFBbkIsQ0FBc0NOLElBQXRDLENBQVA7QUFDRDs7QUFFRDs7OztBQUlBTyxzQkFBb0I7QUFDbEIsV0FBT0MsdUJBQWFDLFFBQWIsQ0FBc0IsRUFBdEIsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7O0FBT0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWdEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUNBOzs7Ozs7O0FBT0E7Ozs7Ozs7QUFPQTs7Ozs7Ozs7Ozs7QUFXQTs7Ozs7Ozs7Ozs7OztBQWFBOzs7Ozs7QUFNQTs7Ozs7QUFLQTs7Ozs7Ozs7Ozs7OztBQWFBOzs7Ozs7O0FBT0E7Ozs7Ozs7QUFPQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0NBOzs7Ozs7QUFNQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7Ozs7O0FBV0E7Ozs7Ozs7OztBQVNBOzs7Ozs7Ozs7OztBQVdBOzs7Ozs7OztBQVFBOzs7Ozs7OztBQVFBQyxnQkFBY0MsY0FBZCxFQUE4QkMsS0FBOUIsRUFBcUNDLE1BQXJDLEVBQTZDO0FBQzNDLFFBQUksS0FBS2YsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIsZUFBMUIsQ0FBUDtBQUNEO0FBQ0QsUUFBSWUsS0FBSyxFQUFUO0FBQ0EsUUFBR0gsbUJBQW1CSSxTQUF0QixFQUFpQztBQUMvQkQsU0FBR0gsY0FBSCxHQUFvQkEsY0FBcEI7QUFDRDtBQUNELFFBQUdDLFVBQVVHLFNBQWIsRUFBd0I7QUFDdEJELFNBQUdGLEtBQUgsR0FBV0EsS0FBWDtBQUNEO0FBQ0QsUUFBR0MsV0FBV0UsU0FBZCxFQUF5QjtBQUN2QkQsU0FBR0QsTUFBSCxHQUFZQSxNQUFaO0FBQ0Q7QUFDRCxVQUFNYixPQUFPO0FBQ1hDLFdBQUsseUNBRE07QUFFWEMsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLQztBQURaLE9BSEU7QUFNWFUsUUFOVztBQU9YVCxZQUFNO0FBUEssS0FBYjtBQVNBLFdBQU8sS0FBS1QsYUFBTCxDQUFtQlUsa0JBQW5CLENBQXNDTixJQUF0QyxFQUE0QyxJQUE1QyxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7OztBQU1BZ0IsY0FBWUMsVUFBWixFQUF3QjtBQUN0QixRQUFJLEtBQUtuQixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixhQUExQixDQUFQO0FBQ0Q7QUFDRCxVQUFNQyxPQUFPO0FBQ1hDLFdBQU0sMkNBQTBDZ0IsVUFBVyxFQURoRDtBQUVYZixjQUFRLEtBRkc7QUFHWEMsZUFBUztBQUNQLHNCQUFjLEtBQUtDO0FBRFosT0FIRTtBQU1YQyxZQUFNO0FBTkssS0FBYjtBQVFBLFdBQU8sS0FBS1QsYUFBTCxDQUFtQlUsa0JBQW5CLENBQXNDTixJQUF0QyxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7Ozs7QUFVQTs7Ozs7Ozs7Ozs7O0FBWUE7Ozs7OztBQU1BOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdURBOzs7Ozs7O0FBT0FrQixpQkFBZUQsVUFBZixFQUEyQkUsUUFBM0IsRUFBcUM7QUFDbkMsUUFBSSxLQUFLckIsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIsZ0JBQTFCLENBQVA7QUFDRDtBQUNELFVBQU1DLE9BQU87QUFDWEMsV0FBTSwyQ0FBMENnQixVQUFXLEVBRGhEO0FBRVhmLGNBQVEsS0FGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhnQixZQUFNRCxRQU5LO0FBT1hkLFlBQU07QUFQSyxLQUFiO0FBU0EsV0FBTyxLQUFLVCxhQUFMLENBQW1CVSxrQkFBbkIsQ0FBc0NOLElBQXRDLENBQVA7QUFDRDs7QUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7QUFPQXFCLGlCQUFlSixVQUFmLEVBQTJCSyxpQkFBM0IsRUFBOEM7QUFDNUMsUUFBSSxLQUFLeEIsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIsZ0JBQTFCLENBQVA7QUFDRDtBQUNELFVBQU1DLE9BQU87QUFDWEMsV0FBTSwyQ0FBMENnQixVQUFXLEVBRGhEO0FBRVhmLGNBQVEsUUFGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhnQixZQUFNRSxpQkFOSztBQU9YakIsWUFBTTtBQVBLLEtBQWI7QUFTQSxXQUFPLEtBQUtULGFBQUwsQ0FBbUJVLGtCQUFuQixDQUFzQ04sSUFBdEMsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7O0FBU0F1Qix5QkFBdUJaLGNBQXZCLEVBQXVDQyxLQUF2QyxFQUE4Q0MsTUFBOUMsRUFBc0Q7QUFDcEQsUUFBSSxLQUFLZixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQix3QkFBMUIsQ0FBUDtBQUNEO0FBQ0QsUUFBSWUsS0FBSyxFQUFUO0FBQ0EsUUFBR0gsbUJBQW1CSSxTQUF0QixFQUFpQztBQUMvQkQsU0FBR0gsY0FBSCxHQUFvQkEsY0FBcEI7QUFDRDtBQUNELFFBQUdDLFVBQVVHLFNBQWIsRUFBd0I7QUFDdEJELFNBQUdGLEtBQUgsR0FBV0EsS0FBWDtBQUNEO0FBQ0QsUUFBR0MsV0FBV0UsU0FBZCxFQUF5QjtBQUN2QkQsU0FBR0QsTUFBSCxHQUFZQSxNQUFaO0FBQ0Q7QUFDRCxVQUFNYixPQUFPO0FBQ1hDLFdBQUssbURBRE07QUFFWEMsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLQztBQURaLE9BSEU7QUFNWFUsUUFOVztBQU9YVCxZQUFNO0FBUEssS0FBYjtBQVNBLFdBQU8sS0FBS1QsYUFBTCxDQUFtQlUsa0JBQW5CLENBQXNDTixJQUF0QyxFQUE0QyxJQUE1QyxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7OztBQU1Bd0IsdUJBQXFCQyxXQUFyQixFQUFrQztBQUNoQyxRQUFJLEtBQUszQixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixzQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUMsT0FBTztBQUNYQyxXQUFNLHFEQUFvRHdCLFdBQVksRUFEM0Q7QUFFWHZCLGNBQVEsS0FGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhDLFlBQU07QUFOSyxLQUFiO0FBUUEsV0FBTyxLQUFLVCxhQUFMLENBQW1CVSxrQkFBbkIsQ0FBc0NOLElBQXRDLENBQVA7QUFDRDs7QUFFRDs7Ozs7OztBQU9BMEIsMEJBQXdCRCxXQUF4QixFQUFxQ0UsU0FBckMsRUFBZ0Q7QUFDOUMsUUFBSSxLQUFLN0IsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIseUJBQTFCLENBQVA7QUFDRDtBQUNELFVBQU1DLE9BQU87QUFDWEMsV0FBTSxxREFBb0R3QixXQUFZLEVBRDNEO0FBRVh2QixjQUFRLEtBRkc7QUFHWEMsZUFBUztBQUNQLHNCQUFjLEtBQUtDO0FBRFosT0FIRTtBQU1YZ0IsWUFBTU8sU0FOSztBQU9YdEIsWUFBTTtBQVBLLEtBQWI7QUFTQSxXQUFPLEtBQUtULGFBQUwsQ0FBbUJVLGtCQUFuQixDQUFzQ04sSUFBdEMsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7O0FBT0E0QiwwQkFBd0JILFdBQXhCLEVBQXFDSCxpQkFBckMsRUFBd0Q7QUFDdEQsUUFBSSxLQUFLeEIsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIseUJBQTFCLENBQVA7QUFDRDtBQUNELFVBQU1DLE9BQU87QUFDWEMsV0FBTSxxREFBb0R3QixXQUFZLEVBRDNEO0FBRVh2QixjQUFRLFFBRkc7QUFHWEMsZUFBUztBQUNQLHNCQUFjLEtBQUtDO0FBRFosT0FIRTtBQU1YZ0IsWUFBTUUsaUJBTks7QUFPWGpCLFlBQU07QUFQSyxLQUFiO0FBU0EsV0FBTyxLQUFLVCxhQUFMLENBQW1CVSxrQkFBbkIsQ0FBc0NOLElBQXRDLENBQVA7QUFDRDs7QUFFRDs7Ozs7Ozs7QUFRQTZCLGdDQUE4QkosV0FBOUIsRUFBMkNSLFVBQTNDLEVBQXVESyxpQkFBdkQsRUFBMEU7QUFDeEUsUUFBSSxLQUFLeEIsY0FBTCxFQUFKLEVBQTJCO0FBQ3pCLGFBQU8sS0FBS0Msb0JBQUwsQ0FBMEIsK0JBQTFCLENBQVA7QUFDRDtBQUNELFVBQU1DLE9BQU87QUFDWEMsV0FBTSxxREFBb0R3QixXQUFZLFlBQVdSLFVBQVcsRUFEakY7QUFFWGYsY0FBUSxRQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLQztBQURaLE9BSEU7QUFNWGdCLFlBQU1FLGlCQU5LO0FBT1hqQixZQUFNO0FBUEssS0FBYjtBQVNBLFdBQU8sS0FBS1QsYUFBTCxDQUFtQlUsa0JBQW5CLENBQXNDTixJQUF0QyxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7O0FBUUE4QixpQkFBZW5CLGNBQWYsRUFBK0JDLEtBQS9CLEVBQXNDQyxNQUF0QyxFQUE4QztBQUM1QyxRQUFJLEtBQUtmLGNBQUwsRUFBSixFQUEyQjtBQUN6QixhQUFPLEtBQUtDLG9CQUFMLENBQTBCLGdCQUExQixDQUFQO0FBQ0Q7QUFDRCxRQUFJZSxLQUFLLEVBQVQ7QUFDQSxRQUFHSCxtQkFBbUJJLFNBQXRCLEVBQWlDO0FBQy9CRCxTQUFHSCxjQUFILEdBQW9CQSxjQUFwQjtBQUNEO0FBQ0QsUUFBR0MsVUFBVUcsU0FBYixFQUF3QjtBQUN0QkQsU0FBR0YsS0FBSCxHQUFXQSxLQUFYO0FBQ0Q7QUFDRCxRQUFHQyxXQUFXRSxTQUFkLEVBQXlCO0FBQ3ZCRCxTQUFHRCxNQUFILEdBQVlBLE1BQVo7QUFDRDtBQUNELFVBQU1iLE9BQU87QUFDWEMsV0FBSywwQ0FETTtBQUVYQyxjQUFRLEtBRkc7QUFHWEMsZUFBUztBQUNQLHNCQUFjLEtBQUtDO0FBRFosT0FIRTtBQU1YVSxRQU5XO0FBT1hULFlBQU07QUFQSyxLQUFiO0FBU0EsV0FBTyxLQUFLVCxhQUFMLENBQW1CVSxrQkFBbkIsQ0FBc0NOLElBQXRDLEVBQTRDLElBQTVDLENBQVA7QUFDRDs7QUFFRDs7Ozs7O0FBTUErQixnQkFBY0MsWUFBZCxFQUE0QjtBQUMxQixRQUFJLEtBQUtsQyxjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixlQUExQixDQUFQO0FBQ0Q7QUFDRCxVQUFNQyxPQUFPO0FBQ1hDLFdBQU0sNENBQTJDK0IsWUFBYSxFQURuRDtBQUVYOUIsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLQztBQURaLE9BSEU7QUFNWEMsWUFBTTtBQU5LLEtBQWI7QUFRQSxXQUFPLEtBQUtULGFBQUwsQ0FBbUJVLGtCQUFuQixDQUFzQ04sSUFBdEMsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7O0FBT0FpQyxtQkFBaUJELFlBQWpCLEVBQStCRSxVQUEvQixFQUEyQztBQUN6QyxRQUFJLEtBQUtwQyxjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixrQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUMsT0FBTztBQUNYQyxXQUFNLDRDQUEyQytCLFlBQWEsRUFEbkQ7QUFFWDlCLGNBQVEsS0FGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhnQixZQUFNYyxVQU5LO0FBT1g3QixZQUFNO0FBUEssS0FBYjtBQVNBLFdBQU8sS0FBS1QsYUFBTCxDQUFtQlUsa0JBQW5CLENBQXNDTixJQUF0QyxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7QUFPQW1DLG1CQUFpQkgsWUFBakIsRUFBK0JWLGlCQUEvQixFQUFrRDtBQUNoRCxRQUFJLEtBQUt4QixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixrQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUMsT0FBTztBQUNYQyxXQUFNLDRDQUEyQytCLFlBQWEsRUFEbkQ7QUFFWDlCLGNBQVEsUUFGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhnQixZQUFNRSxpQkFOSztBQU9YakIsWUFBTTtBQVBLLEtBQWI7QUFTQSxXQUFPLEtBQUtULGFBQUwsQ0FBbUJVLGtCQUFuQixDQUFzQ04sSUFBdEMsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7OztBQVFBb0MscUJBQW1CSixZQUFuQixFQUFpQ2YsVUFBakMsRUFBNkNLLGlCQUE3QyxFQUFnRTtBQUM5RCxRQUFJLEtBQUt4QixjQUFMLEVBQUosRUFBMkI7QUFDekIsYUFBTyxLQUFLQyxvQkFBTCxDQUEwQixvQkFBMUIsQ0FBUDtBQUNEO0FBQ0QsVUFBTUMsT0FBTztBQUNYQyxXQUFNLDRDQUEyQytCLFlBQWEsa0JBQWlCZixVQUFXLEVBRC9FO0FBRVhmLGNBQVEsUUFGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS0M7QUFEWixPQUhFO0FBTVhnQixZQUFNRSxpQkFOSztBQU9YakIsWUFBTTtBQVBLLEtBQWI7QUFTQSxXQUFPLEtBQUtULGFBQUwsQ0FBbUJVLGtCQUFuQixDQUFzQ04sSUFBdEMsQ0FBUDtBQUNEOztBQTMyQjREO2tCQUExQ1IsbUIiLCJmaWxlIjoiY29uZmlndXJhdGlvbi5jbGllbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBNZXRhQXBpQ2xpZW50IGZyb20gJy4uL21ldGFBcGkuY2xpZW50JztcbmltcG9ydCBUaW1lb3V0RXJyb3IgZnJvbSAnLi4vdGltZW91dEVycm9yJztcbmltcG9ydCByYW5kb21zdHJpbmcgZnJvbSAncmFuZG9tc3RyaW5nJztcblxuLyoqXG4gKiBtZXRhYXBpLmNsb3VkIENvcHlGYWN0b3J5IGNvbmZpZ3VyYXRpb24gQVBJICh0cmFkZSBjb3B5aW5nIGNvbmZpZ3VyYXRpb24gQVBJKSBjbGllbnQgKHNlZVxuICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvKVxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb25maWd1cmF0aW9uQ2xpZW50IGV4dGVuZHMgTWV0YUFwaUNsaWVudCB7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgQ29weUZhY3RvcnkgY29uZmlndXJhdGlvbiBBUEkgY2xpZW50IGluc3RhbmNlXG4gICAqIEBwYXJhbSB7RG9tYWluQ2xpZW50fSBkb21haW5DbGllbnQgZG9tYWluIGNsaWVudFxuICAgKi9cbiAgY29uc3RydWN0b3IoZG9tYWluQ2xpZW50KSB7XG4gICAgc3VwZXIoZG9tYWluQ2xpZW50KTtcbiAgICB0aGlzLl9kb21haW5DbGllbnQgPSBkb21haW5DbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICogU3RyYXRlZ3kgaWRcbiAgICogQHR5cGVkZWYge09iamVjdH0gU3RyYXRlZ3lJZFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gaWQgc3RyYXRlZ3kgaWRcbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBuZXcgdW51c2VkIHN0cmF0ZWd5IGlkLiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlbi4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2VuZXJhdGVTdHJhdGVneUlkL1xuICAgKiBAcmV0dXJuIHtQcm9taXNlPFN0cmF0ZWd5SWQ+fSBwcm9taXNlIHJlc29sdmluZyB3aXRoIHN0cmF0ZWd5IGlkIGdlbmVyYXRlZFxuICAgKi9cbiAgZ2VuZXJhdGVTdHJhdGVneUlkKCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZW5lcmF0ZVN0cmF0ZWd5SWQnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vdW51c2VkLXN0cmF0ZWd5LWlkJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgcmFuZG9tIGFjY291bnQgaWRcbiAgICogQHJldHVybiB7U3RyaW5nfSBhY2NvdW50IGlkXG4gICAqL1xuICBnZW5lcmF0ZUFjY291bnRJZCgpIHtcbiAgICByZXR1cm4gcmFuZG9tc3RyaW5nLmdlbmVyYXRlKDY0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdHJhdGVneSBzaWduYWwgZGVsYXlcbiAgICogQHR5cGVkZWYge09iamVjdH0gU3RyYXRlZ3lTaWduYWxEZWxheVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gbWluSW5TZWNvbmRzIG1pbiBleHRyYSB0cmFkaW5nIHNpZ25hbCBkZWxheSB2YWx1ZSBleHByZXNzZWQgaW4gc2Vjb25kc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gbWF4SW5TZWNvbmRzIG1heCBleHRyYSB0cmFkaW5nIHNpZ25hbCBkZWxheSB2YWx1ZSBleHByZXNzZWQgaW4gc2Vjb25kc1xuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgc3Vic2NyaXB0aW9uc1xuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5U3Vic2NyaXB0aW9uXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzdHJhdGVneUlkIGlkIG9mIHRoZSBzdHJhdGVneSB0byBzdWJzY3JpYmUgdG9cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttdWx0aXBsaWVyXSBzdWJzY3JpcHRpb24gbXVsdGlwbGllciwgZGVmYXVsdCBpcyAxeFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuIERlZmF1bHRcbiAgICogaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge1N0cmluZ30gW2Nsb3NlT25seV0gc2V0dGluZyB3aWNoIGluc3RydWN0cyB0aGUgYXBwbGljYXRpb24gbm90IHRvIG9wZW4gbmV3IHBvc2l0aW9ucy4gYnktc3ltYm9sXG4gICAqIG1lYW5zIHRoYXQgaXQgaXMgc3RpbGwgYWxsb3dlZCB0byBvcGVuIG5ldyBwb3NpdGlvbnMgd2l0aCBhIHN5bWJvbCBlcXVhbCB0byB0aGUgc3ltYm9sIG9mIGFuIGV4aXN0aW5nIHN0cmF0ZWd5XG4gICAqIHBvc2l0aW9uIChjYW4gYmUgdXNlZCB0byBncmFjZWZ1bHkgZXhpdCBzdHJhdGVnaWVzIHRyYWRpbmcgaW4gbmV0dGluZyBtb2RlIG9yIHBsYWNpbmcgYSBzZXJpZXMgb2YgcmVsYXRlZCB0cmFkZXNcbiAgICogcGVyIHN5bWJvbCkuIGltbWVkaWF0ZWx5IG1lYW5zIHRvIGNsb3NlIGFsbCBwb3NpdGlvbnMgaW1tZWRpYXRlbHkuIE9uZSBvZiAnYnktcG9zaXRpb24nLCAnYnktc3ltYm9sJywgJ2ltbWVkaWF0ZWx5J1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heFRyYWRlUmlza10gbWF4IHJpc2sgcGVyIHRyYWRlLCBleHByZXNzZWQgYXMgYSBmcmFjdGlvbiBvZiAxLiBJZiB0cmFkZSBoYXMgYSBTTCwgdGhlXG4gICAqIHRyYWRlIHNpemUgd2lsbCBiZSBhZGp1c3RlZCB0byBtYXRjaCB0aGUgcmlzayBsaW1pdC4gSWYgbm90LCB0aGUgdHJhZGUgU0wgd2lsbCBiZSBhcHBsaWVkIGFjY29yZGluZyB0byB0aGUgcmlza1xuICAgKiBsaW1pdFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtyZXZlcnNlXSBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGUgc3RyYXRlZ3kgc2hvdWxkIGJlIGNvcGllZCBpbiBhIHJldmVyc2UgZGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcmVkdWNlQ29ycmVsYXRpb25zXSBzZXR0aW5nIGluZGljYXRpbmcgd2hldGhlciB0byBlbmFibGUgYXV0b21hdGljIHRyYWRlXG4gICAqIGNvcnJlbGF0aW9uIHJlZHVjdGlvbi4gUG9zc2libGUgc2V0dGluZ3MgYXJlIG5vdCBzcGVjaWZpZWQgKGRpc2FibGUgY29ycmVsYXRpb24gcmlzayByZXN0cmljdGlvbnMpLFxuICAgKiBieS1zdHJhdGVneSAobGltaXQgY29ycmVsYXRpb25zIGZvciB0aGUgc3RyYXRlZ3kpIG9yIGJ5LWFjY291bnQgKGxpbWl0IGNvcnJlbGF0aW9ucyBmb3IgdGhlIGFjY291bnQpXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbEZpbHRlcn0gW3N5bWJvbEZpbHRlcl0gc3ltYm9sIGZpbHRlciB3aGljaCBjYW4gYmUgdXNlZCB0byBjb3B5IG9ubHkgc3BlY2lmaWNcbiAgICogc3ltYm9scyBvciBleGNsdWRlIHNvbWUgc3ltYm9scyBmcm9tIGNvcHlpbmdcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TmV3c0ZpbHRlcn0gW25ld3NGaWx0ZXJdIG5ld3MgcmlzayBmaWx0ZXIgY29uZmlndXJhdGlvblxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lSaXNrTGltaXQ+fSBbcmlza0xpbWl0c10gc3RyYXRlZ3kgcmlzayBsaW1pdHMuIFlvdSBjYW4gY29uZmlndXJlIHRyYWRpbmcgdG8gYmVcbiAgICogc3RvcHBlZCBvbmNlIHRvdGFsIGRyYXdkb3duIGdlbmVyYXRlZCBkdXJpbmcgc3BlY2lmaWMgcGVyaW9kIGlzIGV4Y2VlZGVkLiBDYW4gYmUgc3BlY2lmaWVkIGVpdGhlciBmb3IgYmFsYW5jZSBvclxuICAgKiBlcXVpdHkgZHJhd2Rvd25cbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TWF4U3RvcExvc3N9IFttYXhTdG9wTG9zc10gc3RvcCBsb3NzIHZhbHVlIHJlc3RyaWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4TGV2ZXJhZ2VdIHNldHRpbmcgaW5kaWNhdGluZyBtYXhpbXVtIGxldmVyYWdlIGFsbG93ZWQgd2hlbiBvcGVuaW5nIGEgbmV3IHBvc2l0aW9ucy5cbiAgICogQW55IHRyYWRlIHdoaWNoIHJlc3VsdHMgaW4gYSBoaWdoZXIgbGV2ZXJhZ2Ugd2lsbCBiZSBkaXNjYXJkZWRcbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sTWFwcGluZz59IFtzeW1ib2xNYXBwaW5nXSBkZWZpbmVzIGhvdyBzeW1ib2wgbmFtZSBzaG91bGQgYmUgY2hhbmdlZCB3aGVuXG4gICAqIHRyYWRpbmcgKGUuZy4gd2hlbiBicm9rZXIgdXNlcyBzeW1ib2wgbmFtZXMgd2l0aCB1bnVzdWFsIHN1ZmZpeGVzKS4gQnkgZGVmYXVsdCB0aGlzIHNldHRpbmcgaXMgZGlzYWJsZWQgYW5kIHRoZVxuICAgKiB0cmFkZXMgYXJlIGNvcGllZCB1c2luZyBzaWduYWwgc291cmNlIHN5bWJvbCBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVRyYWRlU2l6ZVNjYWxpbmd9IFt0cmFkZVNpemVTY2FsaW5nXSBUcmFkZSBzaXplIHNjYWxpbmcgc2V0dGluZ3MuIEJ5IGRlZmF1bHQgdGhlXG4gICAqIHRyYWRlIHNpemUgb24gc3RyYXRlZ3kgc3Vic2NyaWJlciBzaWRlIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byBiYWxhbmNlIHRvIHByZXNlcnZlIHJpc2suXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlTdG9wTG9zc10gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgc3RvcCBsb3NzIHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSBzdG9wXG4gICAqIGxvc3MuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlUYWtlUHJvZml0XSBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0YWtlIHByb2ZpdCBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgdGFrZVxuICAgKiBwcm9maXQuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nW119IFthbGxvd2VkU2lkZXNdIFRyYWRlIHNpZGVzIHdoaWNoIHdpbGwgYmUgY29waWVkLiBCdXkgdHJhZGVzIG9ubHksIHNlbGwgdHJhZGVzIG9ubHkgb3IgYWxsXG4gICAqIHRyYWRlcy4gRGVmYXVsdCBpcyB0byBjb3B5IGFsbCB0cmFkZXNcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5UcmFkZVZvbHVtZV0gTWluaW11bSB0cmFkZSB2b2x1bWUgdG8gY29weS4gVHJhZGUgc2lnbmFscyB3aXRoIGEgc21hbGxlciB2b2x1bWUgd2lsbCBub3QgYmVcbiAgICogY29waWVkXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4VHJhZGVWb2x1bWVdIE1heGltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIGxhcmdlciB2b2x1bWUgd2lsbCBiZSBjb3BpZWRcbiAgICogd2l0aCBtYXhpbXVtIHZvbHVtZSBpbnN0ZWFkXG4gICAqIEBwcm9wZXJ0eSB7U3RyYXRlZ3lTaWduYWxEZWxheX0gW3NpZ25hbERlbGF5XSBleHRyYSB0cmFkZSBjb3B5aW5nIGRlbGF5IGludHJvZHVjZWQgYnkgdHJhZGUgY29waWVyIGJlZm9yZVxuICAgKiBhcHBseWluZyB0aGUgdHJhZGUgc2lnbmFsLiBZb3UgY2FuIGNvbmZpZ3VyZSBlaXRoZXIgYSBmaXhlZCBvciBhIHJhbmRvbSBkZWxheVxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtyZW1vdmVkXSBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIHdhcyBzY2hlZHVsZWQgZm9yIHJlbW92YWwgb25jZSBhbGwgc3Vic2NyaXB0aW9uXG4gICAqIHBvc2l0aW9ucyB3aWxsIGJlIGNsb3NlZFxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgdHJhZGUgc2l6ZSBzY2FsaW5nIHNldHRpbmdzXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lUcmFkZVNpemVTY2FsaW5nXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBtb2RlIElmIHNldCB0byBiYWxhbmNlLCB0aGUgdHJhZGUgc2l6ZSBvbiBzdHJhdGVneSBzdWJzY3JpYmVyIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZ1xuICAgKiB0byBiYWxhbmNlIHRvIHByZXNlcnZlIHJpc2suIElmIHNldCB0byBlcXVpdHksIHRoZSB0cmFkZSBzaXplIG9uIHN0cmF0ZWd5IHN1YnNjcmliZXIgd2lsbCBiZSBzY2FsZWQgYWNjb3JkaW5nXG4gICAqIHRvIHN1YnNjcmliZXIgZXF1aXR5LiBJZiB2YWx1ZSBpcyBub25lLCB0aGVuIHRyYWRlIHNpemUgd2lsbCBiZSBwcmVzZXJ2ZWQgaXJyZWdhcmRsZXNzIG9mIHRoZSBzdWJzY3JpYmVyXG4gICAqIGJhbGFuY2UuIElmIHZhbHVlIGlzIGNvbnRyYWN0U2l6ZSwgdGhlbiB0cmFkZSBzaXplIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byBjb250cmFjdCBzaXplLiBJZiBmaXhlZFZvbHVtZVxuICAgKiBpcyBzZXQsIHRoZW4gdHJhZGUgd2lsbCBiZSBjb3BpZWQgd2l0aCBhIGZpeGVkIHZvbHVtZSBvZiB0cmFkZVZvbHVtZSBzZXR0aW5nLiBJZiBmaXhlZFJpc2sgaXMgc2V0LCB0aGVuIGVhY2hcbiAgICogdHJhZGUgd2lsbCBiZSBjb3BpZWQgd2l0aCBhIHRyYWRlIHZvbHVtZSBzZXQgdG8gcmlzayBzcGVjaWZpYyBmcmFjdGlvbiBvZiBiYWxhbmNlIGFzIGNvbmZpZ3VyZWQgYnlcbiAgICogcmlza0ZyYWN0aW9uIHNldHRpbmcuIE5vdGUsIHRoYXQgaW4gZml4ZWRSaXNrIG1vZGUgdHJhZGVzIHdpdGhvdXQgYSBTTCBhcmUgbm90IGNvcGllZC4gSWYgZXhwcmVzc2lvbiBpc1xuICAgKiBzZXQsIHRoZW4gdHJhZGUgdm9sdW1lIHdpbGwgYmUgY2FsY3VsYXRlZCB1c2luZyBhIHVzZXItZGVmaW5lZCBleHByZXNzaW9uLiBOb3RlLCB0aGF0IGV4cHJlc3Npb24gdHJhZGVcbiAgICogc2l6ZSBzY2FsaW5nIG1vZGUgaXMgaW50ZW5kZWQgZm9yIGFkdmFuY2VkIHVzZXJzIGFuZCB3ZSBETyBOT1QgUkVDT01NRU5EIHVzaW5nIGl0IHVubGVzcyB5b3UgdW5kZXJzdGFuZFxuICAgKiB3aGF0IGFyZSB5b3UgZG9pbmcsIGFzIG1pc3Rha2VzIGluIGV4cHJlc3Npb24gY2FuIHJlc3VsdCBpbiBsb3NzLlxuICAgKiBBbGxvd2VkIHZhbHVlczogbm9uZSwgY29udHJhY3RTaXplLCBiYWxhbmNlLCBlcXVpdHksIGZpeGVkVm9sdW1lLCBmaXhlZFJpc2ssIGV4cHJlc3Npb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdHJhZGVWb2x1bWVdIEZpeGVkIHRyYWRlIHZvbHVtZSBmb3IgdXNlIHdpdGggZml4ZWRWb2x1bWUgdHJhZGUgc2l6ZSBzY2FsaW5nIG1vZGVcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFtyaXNrRnJhY3Rpb25dIEZpeGVkIHJpc2sgZnJhY3Rpb24gZm9yIHVzZSB3aXRoIGZpeGVkUmlzayB0cmFkZSBzaXplIHNjYWxpbmcgbW9kZVxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtmb3JjZVRpbnlUcmFkZXNdIGlmIHNldCB0byB0cnVlLCB0aGF0IHRyYWRlcyBzbWFsbGVyIHRoYW4gbWluVm9sdW1lIC0gMC41ICogdm9sdW1lU3RlcCB3aWxsXG4gICAqIGJlIHBsYWNlZCB3aXRoIG1pblZvbHVtZSB2b2x1bWUsIGluIHNwaXRlIHRoYXQgdGhleSB3aWxsIHJlc3VsdCBpbiBpbmNyZWFzZWQgdHJhZGUgcmlzaywgYXMgbG9uZyBhcyByaXNrXG4gICAqIGluY3JlYXNlIGlzIGluIGxpbmUgd2l0aCBtYXhSaXNrQ29lZmZpY2llbnQgY29uZmlndXJhdGlvbi4gT3RoZXJ3aXNlIHN1Y2ggdHJhZGVzIHdpbGwgYmUgc2tpcHBlZCB0byBhdm9pZFxuICAgKiB0YWtpbmcgZXhjZXNzaXZlIHRyYWRlIHJpc2suIERlZmF1bHQgaXMgZmFsc2UuXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4Umlza0NvZWZmaWNpZW50XSBzb21ldGltZXMgd2hlbiBwbGFjaW5nIGEgc21hbGwgdHJhZGUsIHRoZSByaXNrIHRha2VuIGNhbiBleGNlZWQgdGhlXG4gICAqIHN1YnNjcmlwdGlvbiBleHBlY3RhdGlvbiBkdWUgdG8gdm9sdW1lIHJvdW5kaW5nIG9yIGZvcmNlZnVsbHkgcGxhY2luZyB0aW55IHRyYWRlcyBpbiBhY2NvcmRhbmNlIHdpdGhcbiAgICogZm9yY2VUaW55VHJhZGVzIHNldHRpbmcuIFRoZSBtYXhSaXNrQ29lZmZpY2llbnQgc2V0dGluZyB3aWxsIGFjdCBhcyBhbiBleHRyYSBsaW5lIG9mIHByb3RlY3Rpb24gdG8gcmVzdHJpY3RcbiAgICogdHJhZGVzIGlmIGFjdHVhbCByaXNrIGV4Y2VlZHMgdGhlIHZhbHVlIG9mIGV4cGVjdGVkIHN1YnNjcmlwdGlvbiByaXNrIG11bHRpcGxpZWQgYnkgbWF4Umlza0NvZWZmaWNpZW50LiBBcyBhXG4gICAqIHJlc3VsdCB0cmFkZSB2b2x1bWUgd2lsbCBiZSBkZWNyZWFzZWQgY29ycmVzcG9uZGluZ2x5IG9yIHRyYWRlIHdpbGwgYmUgc2tpcHBlZCBpZiByZXN1bHRpbmcgdm9sdW1lIGlzIGxlc3NcbiAgICogdGhhbiBtaW5Wb2x1bWUuIERlZmF1bHQgdmFsdWUgaXMgNSwgbWluaW11bSB2YWx1ZSBpcyAxLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2V4cHJlc3Npb25dIG1hdGguanMgZXhwcmVzc2lvbiB3aGljaCB3aWxsIGJlIHVzZWQgdG8gY2FsY3VsYXRlIHRyYWRlIHZvbHVtZVxuICAgKiAoc2VlIGh0dHBzOi8vbWF0aGpzLm9yZy9kb2NzL2V4cHJlc3Npb25zL3N5bnRheC5odG1sKS4gRm9sbG93aW5nIHZhcmlhYmxlcyBhcmUgYXZhaWxhYmxlIGluIGV4cHJlc3Npb25cbiAgICogc2NvcGU6IHByb3ZpZGVyVm9sdW1lIC0gcHJvdmlkZXIgc2lnbmFsIHRyYWRlIHNpemU7IHByb3ZpZGVyVHJhZGVBbW91bnQgLSBwcm92aWRlciBzaWduYWwgdHJhZGUgdmFsdWUgaW5cbiAgICogdHJhZGUgY29waWVyIGJhc2UgY3VyZW5jeTsgbXVsdGlwbGllciAtIHN1YnNjcmlwdGlvbiBtdWx0aXBsaWVyIHZhbHVlOyBwcm92aWRlckJhbGFuY2UgLSBwcm92aWRlciBiYWxhbmNlXG4gICAqIHZhbHVlIGluIHRyYWRlIGNvcGllciBiYXNlIGN1cnJlbmN5OyBiYWxhbmNlIC0gc3Vic2NyaWJlciBiYWxhbmNlIHZhbHVlIGluIHRyYWRlIGNvcGllciBiYXNlIGN1cnJlbmN5O1xuICAgKiBxdW90ZU9yT3BlblByaWNlIC0gY3VycmVudCBhc3NldCBwcmljZSAoZm9yIG1hcmtldCBvcmRlcnMpIG9yIG9wZW4gcHJpY2UgKGZvciBwZW5kaW5nIG9yZGVycykgb24gc3Vic2NyaWJlclxuICAgKiBzaWRlOyB0aWNrVmFsdWUgLSBjdXJyZW50IGFzc2V0IHRpY2sgdmFsdWUgb24gc3Vic2NyaWJlciBzaWRlIGV4cHJlc3NlZCBpbiB0cmFkZSBjb3BpZXIgYmFzZSBjdXJyZW5jeTtcbiAgICogdGlja1NpemUgLSB0aWNrIHNpemUgb24gc3Vic2NyaWJlciBzaWRlOyBwcm92aWRlclNjYWxlZFZvbHVtZSAtIHByb3ZpZGVyIHRyYWRlIHZvbHVtZSBtdWx0aXBsaWVkIGJ5IHByb3ZpZGVyXG4gICAqIGNvbnRyYWN0IHNpemU7IGNvbnRyYWN0U2l6ZSAtIHN1YnNjcmliZXIgY29udHJhY3Qgc2l6ZTsgcHJvdmlkZXJTdG9wTG9zcyAtIHByb3ZpZGVyIHNpZ25hbCBzdG9wIGxvc3MgcHJpY2U7XG4gICAqIHByb3ZpZGVyVGFrZVByb2ZpdCAtIHByb3ZpZGVyIHNpZ25hbCB0YWtlIHByb2ZpdCBwcmljZTsgYWNjb3VudEN1cnJlbmN5RXhjaGFuZ2VSYXRlIC0gc3Vic2NyaWJlciBleGNoYW5nZVxuICAgKiByYXRlIG9mIGFjY291bnQgY3VycmVuY3kgdG8gdHJhZGUgY29waWVyIGJhc2UgY3VycmVuY3kgXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzeW1ib2wgZmlsdGVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lTeW1ib2xGaWx0ZXJcbiAgICogQHByb3BlcnR5IHtBcnJheTxTdHJpbmc+fSBpbmNsdWRlZCBsaXN0IG9mIHN5bWJvbHMgY29waWVkLiBMZWF2ZSB0aGUgdmFsdWUgZW1wdHkgdG8gY29weSBhbGwgc3ltYm9sc1xuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IGV4Y2x1ZGVkIGxpc3Qgb2Ygc3ltYm9scyBleGNsdWRlZCBmcm9tIGNvcHlpbmcuIExlYXZlIHRoZSB2YWx1ZSBlbXB0eSB0byBjb3B5IGFsbCBzeW1ib2xzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBuZXdzIHJpc2sgZmlsdGVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lOZXdzRmlsdGVyXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneUJyZWFraW5nTmV3c0ZpbHRlcn0gW2JyZWFraW5nTmV3c0ZpbHRlcl0gYnJlYWtpbmcgbmV3cyBmaWx0ZXJcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5Q2FsZW5kYXJOZXdzRmlsdGVyfSBbY2FsZW5kYXJOZXdzRmlsdGVyXSBjYWxlbmRhciBuZXdzIGZpbHRlclxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgYnJlYWtpbmcgbmV3cyByaXNrIGZpbHRlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5QnJlYWtpbmdOZXdzRmlsdGVyXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8U3RyaW5nPn0gcHJpb3JpdGllcyBsaXN0IG9mIGJyZWFraW5nIG5ld3MgcHJpb3JpdGllcyB0byBzdG9wIHRyYWRpbmcgb24sIGxlYXZlIGVtcHR5IHRvIGRpc2FibGVcbiAgICogYnJlYWtpbmcgbmV3cyBmaWx0ZXIuIE9uZSBvZiBoaWdoLCBtZWRpdW0sIGxvdy5cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFtjbG9zZVBvc2l0aW9uVGltZUdhcEluTWludXRlc10gdGltZSBpbnRlcnZhbCBzcGVjaWZ5aW5nIHdoZW4gdG8gZm9yY2UgY2xvc2UgYW4gYWxyZWFkeVxuICAgKiBvcGVuIHBvc2l0aW9uIGFmdGVyIGJyZWFraW5nIG5ld3MuIERlZmF1bHQgdmFsdWUgaXMgNjAgbWludXRlc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW29wZW5Qb3NpdGlvbkZvbGxvd2luZ1RpbWVHYXBJbk1pbnV0ZXNdIHRpbWUgaW50ZXJ2YWwgc3BlY2lmeWluZyB3aGVuIGl0IGlzIGFsbG93ZWQgdG9cbiAgICogb3BlbiBwb3NpdGlvbiBhZnRlciBjYWxlbmRhciBuZXdzLiBEZWZhdWx0IHZhbHVlIGlzIDYwIG1pbnV0ZXNcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IGNhbGVuZGFyIG5ldyBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneUNhbGVuZGFyTmV3c0ZpbHRlclxuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IHByaW9yaXRpZXMgbGlzdCBvZiBjYWxlbmRhciBuZXdzIHByaW9yaXRpZXMgdG8gc3RvcCB0cmFkaW5nIG9uLCBsZWF2ZSBlbXB0eSB0byBkaXNhYmxlXG4gICAqIGNhbGVuZGFyIG5ld3MgZmlsdGVyLiBPbmUgb2YgZWxlY3Rpb24sIGhpZ2gsIG1lZGl1bSwgbG93LlxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW2Nsb3NlUG9zaXRpb25UaW1lR2FwSW5NaW51dGVzXSB0aW1lIGludGVydmFsIHNwZWNpZnlpbmcgd2hlbiB0byBmb3JjZSBjbG9zZSBhbiBhbHJlYWR5XG4gICAqIG9wZW4gcG9zaXRpb24gYmVmb3JlIGNhbGVuZGFyIG5ld3MuIERlZmF1bHQgdmFsdWUgaXMgNjAgbWludXRlc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW29wZW5Qb3NpdGlvblByZWNlZGluZ1RpbWVHYXBJbk1pbnV0ZXNdIHRpbWUgaW50ZXJ2YWwgc3BlY2lmeWluZyB3aGVuIGl0IGlzIHN0aWxsXG4gICAqIGFsbG93ZWQgdG8gb3BlbiBwb3NpdGlvbiBiZWZvcmUgY2FsZW5kYXIgbmV3cy4gRGVmYXVsdCB2YWx1ZSBpcyAxMjAgbWludXRlc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW29wZW5Qb3NpdGlvbkZvbGxvd2luZ1RpbWVHYXBJbk1pbnV0ZXNdIHRpbWUgaW50ZXJ2YWwgc3BlY2lmeWluZyB3aGVuIGl0IGlzIGFsbG93ZWQgdG9cbiAgICogb3BlbiBwb3NpdGlvbiBhZnRlciBjYWxlbmRhciBuZXdzLiBEZWZhdWx0IHZhbHVlIGlzIDYwIG1pbnV0ZXNcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHJpc2sgbGltaXQgdHlwZVxuICAgKiBAdHlwZWRlZiB7J2RheScgfCAnZGF0ZScgfCAnd2VlaycgfCAnd2Vlay10by1kYXRlJyB8ICdtb250aCcgfCAnbW9udGgtdG8tZGF0ZScgfCAncXVhcnRlcicgfCAncXVhcnRlci10by1kYXRlJyB8XG4gICAqICd5ZWFyJyB8ICd5ZWFyLXRvLWRhdGUnIHwgJ2xpZmV0aW1lJ30gQ29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdFR5cGVcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHJpc2sgbGltaXQgYXBwbHkgdG8gZW51bVxuICAgKiBAdHlwZWRlZiB7J2JhbGFuY2UtZGlmZmVyZW5jZScgfCAnYmFsYW5jZS1taW51cy1lcXVpdHknIHwgJ2VxdWl0eS1kaWZmZXJlbmNlJ30gQ29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdEFwcGx5VG9cbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHJpc2sgbGltaXQgZmlsdGVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lSaXNrTGltaXRcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5Umlza0xpbWl0VHlwZX0gdHlwZSByZXN0cmljdGlvbiB0eXBlXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdEFwcGx5VG99IGFwcGx5VG8gYWNjb3VudCBtZXRyaWMgdG8gYXBwbHkgbGltaXQgdG9cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYXhBYnNvbHV0ZVJpc2tdIG1heCBkcmF3ZG93biBhbGxvd2VkLCBtZWFzdXJlZCBpbiBhY2NvdW50IGN1cnJlbmN5XG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4UmVsYXRpdmVSaXNrXSBtYXggZHJhd2Rvd24gYWxsb3dlZCwgbWVhc3VyZWQgaW4gYWNjb3VudCBjdXJyZW5jeVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGNsb3NlUG9zaXRpb25zIHdoZXRoZXIgdG8gZm9yY2UgY2xvc2UgcG9zaXRpb25zIHdoZW4gdGhlIHJpc2sgaXMgcmVhY2hlZC4gSWYgdmFsdWUgaXMgZmFsc2VcbiAgICogdGhlbiBvbmx5IHRoZSBuZXcgdHJhZGVzIHdpbGwgYmUgaGFsdGVkLCBidXQgZXhpc3Rpbmcgb25lcyB3aWxsIG5vdCBiZSBjbG9zZWRcbiAgICogQHByb3BlcnR5IHtEYXRlfHN0cmluZ3xtb21lbnQuTW9tZW50fSBbc3RhcnRUaW1lXSB0aW1lIHRvIHN0YXJ0IHJpc2sgdHJhY2tpbmcgZnJvbS4gQWxsIHByZXZpb3VzIHRyYWRlcyB3aWxsIGJlIGlnbm9yZWQuIFlvdVxuICAgKiBjYW4gdXNlIHRoaXMgdmFsdWUgdG8gcmVzZXQgdGhlIGZpbHRlciBhZnRlciBzdG9wb3V0IGV2ZW50XG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBtYXggc3RvcCBsb3NzIHNldHRpbmdzXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lNYXhTdG9wTG9zc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gdmFsdWUgbWF4aW11bSBTTCB2YWx1ZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdW5pdHMgU0wgdW5pdHMuIE9ubHkgcGlwcyB2YWx1ZSBpcyBzdXBwb3J0ZWQgYXQgdGhpcyBwb2ludFxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgc3ltYm9sIG1hcHBpbmdcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVN5bWJvbE1hcHBpbmdcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGZyb20gc3ltYm9sIG5hbWUgdG8gY29udmVydCBmcm9tXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0byBzeW1ib2wgbmFtZSB0byBjb252ZXJ0IHRvXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBhY2NvdW50IHVwZGF0ZVxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN1YnNjcmliZXJVcGRhdGVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWUgYWNjb3VudCBodW1hbi1yZWFkYWJsZSBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbcmVzZXJ2ZWRNYXJnaW5GcmFjdGlvbl0gZnJhY3Rpb24gb2YgcmVzZXJ2ZWQgbWFyZ2luIHRvIHJlZHVjZSBhIHJpc2sgb2YgbWFyZ2luIGNhbGwuXG4gICAqIERlZmF1bHQgaXMgdG8gcmVzZXJ2ZSBubyBtYXJnaW4uIFdlIHJlY29tbWVuZCB1c2luZyBtYXhMZXZlcmFnZSBzZXR0aW5nIGluc3RlYWQuIFNwZWNpZmllZCBhcyBhIGZyYWN0aW9uIG9mIGJhbGFuY2VcbiAgICogdGh1cyB0aGUgdmFsdWUgaXMgdXN1YWxseSBncmVhdGVyIHRoYW4gMVxuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IFtwaG9uZU51bWJlcnNdIHBob25lIG51bWJlcnMgdG8gc2VuZCBzbXMgbm90aWZpY2F0aW9ucyB0by4gTGVhdmUgZW1wdHkgdG9cbiAgICogcmVjZWl2ZSBubyBzbXMgbm90aWZpY2F0aW9uc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21pblRyYWRlQW1vdW50XSB2YWx1ZSBvZiBtaW5pbWFsIHRyYWRlIHNpemUgYWxsb3dlZCwgZXhwcmVzc2VkIGluIGFtb3VudCBvZiBhY2NvdW50XG4gICAqIGN1cnJlbmN5LiBDYW4gYmUgdXNlZnVsIGlmIHlvdXIgYnJva2VyIGNoYXJnZXMgYSBmaXhlZCBmZWUgcGVyIHRyYW5zYWN0aW9uIHNvIHRoYXQgeW91IGNhbiBza2lwIHNtYWxsIHRyYWRlcyB3aXRoXG4gICAqIGhpZ2ggYnJva2VyIGNvbW1pc3Npb24gcmF0ZXMuIERlZmF1bHQgaXMgMFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gW2Nsb3NlT25seV0gc2V0dGluZyB3aWNoIGluc3RydWN0cyB0aGUgYXBwbGljYXRpb24gbm90IHRvIG9wZW4gbmV3IHBvc2l0aW9ucy4gYnktc3ltYm9sXG4gICAqIG1lYW5zIHRoYXQgaXQgaXMgc3RpbGwgYWxsb3dlZCB0byBvcGVuIG5ldyBwb3NpdGlvbnMgd2l0aCBhIHN5bWJvbCBlcXVhbCB0byB0aGUgc3ltYm9sIG9mIGFuIGV4aXN0aW5nIHN0cmF0ZWd5XG4gICAqIHBvc2l0aW9uIChjYW4gYmUgdXNlZCB0byBncmFjZWZ1bHkgZXhpdCBzdHJhdGVnaWVzIHRyYWRpbmcgaW4gbmV0dGluZyBtb2RlIG9yIHBsYWNpbmcgYSBzZXJpZXMgb2YgcmVsYXRlZCB0cmFkZXNcbiAgICogcGVyIHN5bWJvbCkuIGltbWVkaWF0ZWx5IG1lYW5zIHRvIGNsb3NlIGFsbCBwb3NpdGlvbnMgaW1tZWRpYXRlbHkuIE9uZSBvZiAnYnktcG9zaXRpb24nLCAnYnktc3ltYm9sJywgJ2ltbWVkaWF0ZWx5J1xuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lSaXNrTGltaXQ+fSBbcmlza0xpbWl0c10gYWNjb3VudCByaXNrIGxpbWl0cy4gWW91IGNhbiBjb25maWd1cmUgdHJhZGluZyB0byBiZVxuICAgKiBzdG9wcGVkIG9uY2UgdG90YWwgZHJhd2Rvd24gZ2VuZXJhdGVkIGR1cmluZyBzcGVjaWZpYyBwZXJpb2QgaXMgZXhjZWVkZWQuIENhbiBiZSBzcGVjaWZpZWQgZWl0aGVyIGZvciBiYWxhbmNlIG9yXG4gICAqIGVxdWl0eSBkcmF3ZG93blxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heExldmVyYWdlXSBzZXR0aW5nIGluZGljYXRpbmcgbWF4dW11bSBsZXZlcmFnZSBhbGxvd2VkIHdoZW4gb3BlbmluZyBhIG5ldyBwb3NpdGlvbnMuXG4gICAqIEFueSB0cmFkZSB3aGljaCByZXN1bHRzIGluIGEgaGlnaGVyIGxldmVyYWdlIHdpbGwgYmUgZGlzY2FyZGVkLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5U3RvcExvc3NdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHN0b3AgbG9zcyBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgc3RvcFxuICAgKiBsb3NzLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5VGFrZVByb2ZpdF0gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGFrZSBwcm9maXQgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHRha2VcbiAgICogcHJvZml0LlxuICAgKiBAcHJvcGVydHkge3N0cmluZ1tdfSBbYWxsb3dlZFNpZGVzXSBUcmFkZSBzaWRlcyB3aGljaCB3aWxsIGJlIGNvcGllZC4gQnV5IHRyYWRlcyBvbmx5LCBzZWxsIHRyYWRlcyBvbmx5IG9yIGFsbFxuICAgKiB0cmFkZXMuIERlZmF1bHQgaXMgdG8gY29weSBhbGwgdHJhZGVzXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWluVHJhZGVWb2x1bWVdIE1pbmltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIHNtYWxsZXIgdm9sdW1lIHdpbGwgbm90IGJlXG4gICAqIGNvcGllZFxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21heFRyYWRlVm9sdW1lXSBNYXhpbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBsYXJnZXIgdm9sdW1lIHdpbGwgYmUgY29waWVkXG4gICAqIHdpdGggbWF4aW11bSB2b2x1bWUgaW5zdGVhZFxuICAgKiBAcHJvcGVydHkge1N0cmF0ZWd5U2lnbmFsRGVsYXl9IFtzaWduYWxEZWxheV0gZXh0cmEgdHJhZGUgY29weWluZyBkZWxheSBpbnRyb2R1Y2VkIGJ5IHRyYWRlIGNvcGllciBiZWZvcmVcbiAgICogYXBwbHlpbmcgdGhlIHRyYWRlIHNpZ25hbC4gWW91IGNhbiBjb25maWd1cmUgZWl0aGVyIGEgZml4ZWQgb3IgYSByYW5kb20gZGVsYXlcbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5U3Vic2NyaXB0aW9uPn0gc3Vic2NyaXB0aW9ucyBzdHJhdGVneSBzdWJzY3JpcHRpb25zXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdWJzY3JpYmVyIG1vZGVsXG4gICAqIEB0eXBlZGVmIHtDb3B5RmFjdG9yeVN1YnNjcmliZXJVcGRhdGV9IENvcHlGYWN0b3J5U3Vic2NyaWJlclxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gX2lkIGlkIG9mIHRoZSBNZXRhQXBpIGFjY291bnQgdG8gY29weSB0cmFkZXMgdG8gXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBwcm92aWRlciBzdHJhdGVneVxuICAgKiBAdHlwZWRlZiB7Q29weUZhY3RvcnlTdHJhdGVneVVwZGF0ZX0gQ29weUZhY3RvcnlTdHJhdGVneVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gX2lkIHVuaXF1ZSBzdHJhdGVneSBpZFxuICAgKiBAcHJvcGVydHkge051bWJlcn0gcGxhdGZvcm1Db21taXNzaW9uUmF0ZSBjb21taXNzaW9uIHJhdGUgdGhlIHBsYXRmb3JtIGNoYXJnZXMgZm9yIHN0cmF0ZWd5IGNvcHlpbmcsIGFwcGxpZWQgdG9cbiAgICogY29tbWlzc2lvbnMgY2hhcmdlZCBieSBwcm92aWRlci4gVGhpcyBjb21taXNzaW9uIGFwcGxpZXMgb25seSB0byBhY2NvdW50cyBub3QgbWFuYWdlZCBkaXJlY3RseSBieSBwcm92aWRlci4gU2hvdWxkXG4gICAqIGJlIGZyYWN0aW9uIG9mIDFcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtjbG9zZU9uUmVtb3ZhbE1vZGVdIHBvc2l0aW9uIGNsb3NlIG1vZGUgb24gc3RyYXRlZ3kgb3Igc3Vic2NyaXB0aW9uIHJlbW92YWwuIFByZXNlcnZlIG1lYW5zXG4gICAqIHRoYXQgcG9zaXRpb25zIHdpbGwgbm90IGJlIGNsb3NlZCBhbmQgd2lsbCBub3QgYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeS4gY2xvc2UtZ3JhY2VmdWxseS1ieS1wb3NpdGlvbiBtZWFuc1xuICAgKiB0aGF0IHBvc2l0aW9ucyB3aWxsIGNvbnRpbnVlIHRvIGJlIG1hbmFnZWQgYnkgQ29weUZhY3RvcnksIGJ1dCBvbmx5IGNsb3NlIHNpZ25hbHMgd2lsbCBiZSBjb3BpZWQuXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sIG1lYW5zIHRoYXQgcG9zaXRpb25zIHdpbGwgY29udGludWUgdG8gYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeSwgYnV0IG9ubHkgY2xvc2VcbiAgICogc2lnbmFscyB3aWxsIGJlIGNvcGllZCBvciBzaWduYWxzIHRvIG9wZW4gcG9zaXRpb25zIGZvciB0aGUgc3ltYm9scyB3aGljaCBhbHJlYWR5IGhhdmUgcG9zaXRpb25zIG9wZW5lZC5cbiAgICogY2xvc2UtaW1tZWRpYXRlbHkgbWVhbnMgdGhhdCBhbGwgcG9zaXRpb25zIHdpbGwgYmUgY2xvc2VkIGltbWVkaWF0ZWx5LiBEZWZhdWx0IGlzIGNsb3NlLWltbWVkaWF0ZWx5LlxuICAgKiBUaGlzIGZpZWxkIGNhbiBiZSBjaGFuZ2VkIHZpYSByZW1vdmUgcG90Zm9saW8gbWVtYmVyIEFQSSBvbmx5LCBvbmUgb2YgcHJlc2VydmUsIGNsb3NlLWdyYWNlZnVsbHktYnktcG9zaXRpb24sXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sLCBjbG9zZS1pbW1lZGlhdGVseVxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgY29tbWlzc2lvbiBzY2hlbWVcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneUNvbW1pc3Npb25TY2hlbWVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHR5cGUgY29tbWlzc2lvbiB0eXBlLiBPbmUgb2YgZmxhdC1mZWUsIGxvdHMtdHJhZGVkLCBsb3RzLXdvbiwgYW1vdW50LXRyYWRlZCwgYW1vdW50LXdvbixcbiAgICogaGlnaC13YXRlci1tYXJrXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBiaWxsaW5nUGVyaW9kIGJpbGxpbmcgcGVyaW9kLiBPbmUgb2Ygd2VlaywgbW9udGgsIHF1YXJ0ZXJcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IGNvbW1pc3Npb25SYXRlIGNvbW1pc3Npb24gcmF0ZS4gU2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB6ZXJvIGlmIGNvbW1pc3Npb24gdHlwZSBpc1xuICAgKiBmbGF0LWZlZSwgbG90cy10cmFkZWQgb3IgbG90cy13b24sIHNob3VsZCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gemVybyBhbmQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIDEgaWZcbiAgICogY29tbWlzc2lvbiB0eXBlIGlzIGFtb3VudC10cmFkZWQsIGFtb3VudC13b24sIGhpZ2gtd2F0ZXItbWFyay5cbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IG1hZ2ljIGZpbHRlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5TWFnaWNGaWx0ZXJcbiAgICogQHByb3BlcnR5IHtBcnJheTxTdHJpbmc+fSBpbmNsdWRlZCBsaXN0IG9mIG1hZ2ljcyAoZXhwZXJ0IGlkcykgb3IgbWFnaWMgcmFuZ2VzIGNvcGllZC4gTGVhdmUgdGhlIHZhbHVlIGVtcHR5IHRvXG4gICAqIGNvcHkgYWxsIG1hZ2ljc1xuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IGV4Y2x1ZGVkIGxpc3Qgb2YgbWFnaWNzIChleHBlcnQgaWRzKSBvciBtYWdpYyByYW5nZXMgZXhjbHVkZWQgZnJvbSBjb3B5aW5nLiBMZWF2ZSB0aGVcbiAgICogdmFsdWUgZW1wdHkgdG8gY29weSBhbGwgbWFnaWNzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSB0aW1lIHNldHRpbmdzXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lUaW1lU2V0dGluZ3NcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFtsaWZldGltZUluSG91cnNdIHBvc2l0aW9uIGxpZmV0aW1lLiBEZWZhdWx0IGlzIHRvIGtlZXAgcG9zaXRpb25zIG9wZW4gdXAgdG8gOTAgZGF5c1xuICAgKiBAcHJvcGVydHkge251bWJlcn0gW29wZW5pbmdJbnRlcnZhbEluTWludXRlc10gdGltZSBpbnRlcnZhbCB0byBjb3B5IG5ldyBwb3NpdGlvbnMuIERlZmF1bHQgaXMgdG8gbGV0IDFcbiAgICogbWludXRlIGZvciB0aGUgcG9zaXRpb24gdG8gZ2V0IGNvcGllZC4gSWYgcG9zaXRpb24gd2VyZSBub3QgY29waWVkIGR1cmluZyB0aGlzIHRpbWUsIHRoZSBjb3B5aW5nIHdpbGwgbm90IGJlXG4gICAqIHJldHJpZWQgYW55bW9yZS5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbZXhwaXJlUGVuZGluZ09yZGVyU2lnbmFsc10gSWYgc2V0IHRvIHRydWUsIHRoZSBvcGVuaW5nSW50ZXJ2YWxJbk1pbnV0ZXMgc2V0dGluZyB3aWxsIGJlXG4gICAqIGFwcGxpZWQgdG8gcGVuZGluZyBvcmRlciBzaWduYWxzIGFzIHdlbGwuIEJ5IGRlZmF1bHQgcGVuZGluZyBvcmRlciBzaWduYWxzIGRvIG5vdCBleHBpcmVcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IGVxdWl0eSBjdXJ2ZSBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneUVxdWl0eUN1cnZlRmlsdGVyXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBwZXJpb2QgbW92aW5nIGF2ZXJhZ2UgcGVyaW9kLCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gMVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdGltZWZyYW1lIG1vdmluZyBhdmVyYWdlIHRpbWVmcmFtZSwgYSBwb3NpdGl2ZSBpbnRlZ2VyIGZvbGxvd2VkIGJ5IHRpbWUgdW5pdCwgZS5nLiAyaC5cbiAgICogQWxsb3dlZCB1bml0cyBhcmUgcywgbSwgaCwgZCBhbmQgdy5cbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBDb3B5RmFjdG9yeSBjb3B5IHRyYWRpbmcgc3RyYXRlZ2llcy4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2V0U3RyYXRlZ2llcy9cbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5jbHVkZVJlbW92ZWRdIGZsYWcgaW5zdHJ1Y3RpbmcgdG8gaW5jbHVkZSByZW1vdmVkIHN0cmF0ZWdpZXMgaW4gcmVzdWx0c1xuICAgKiBAcGFyYW0ge051bWJlcn0gW2xpbWl0XSBwYWdpbmF0aW9uIGxpbWl0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb2Zmc2V0XSBjb3B5IHRyYWRpbmcgc3RyYXRlZ3kgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZTxBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5Pj59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggQ29weUZhY3Rvcnkgc3RyYXRlZ2llcyBmb3VuZFxuICAgKi9cbiAgZ2V0U3RyYXRlZ2llcyhpbmNsdWRlUmVtb3ZlZCwgbGltaXQsIG9mZnNldCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRTdHJhdGVnaWVzJyk7XG4gICAgfVxuICAgIGxldCBxcyA9IHt9O1xuICAgIGlmKGluY2x1ZGVSZW1vdmVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmluY2x1ZGVSZW1vdmVkID0gaW5jbHVkZVJlbW92ZWQ7XG4gICAgfVxuICAgIGlmKGxpbWl0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmxpbWl0ID0gbGltaXQ7XG4gICAgfVxuICAgIGlmKG9mZnNldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxcy5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMnLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIHFzLFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cywgdHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIENvcHlGYWN0b3J5IGNvcHkgdHJhZGluZyBzdHJhdGVneSBieSBpZC4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2V0U3RyYXRlZ3kvXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJhdGVneSBpZCB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEByZXR1cm4ge1Byb21pc2U8Q29weUZhY3RvcnlTdHJhdGVneT59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggQ29weUZhY3Rvcnkgc3RyYXRlZ3kgZm91bmRcbiAgICovXG4gIGdldFN0cmF0ZWd5KHN0cmF0ZWd5SWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcignZ2V0U3RyYXRlZ3knKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcy8ke3N0cmF0ZWd5SWR9YCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBkcmF3ZG93biBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneURyYXdkb3duRmlsdGVyXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBtYXhEcmF3ZG93biBtYXhpbXVtIGRyYXdkb3duIHZhbHVlIGFmdGVyIHdoaWNoIGFjdGlvbiBpcyBleGVjdXRlZC4gRHJhd2Rvd24gc2hvdWxkXG4gICAqIGJlIGNvbmZpZ3VyZWQgYXMgYSBmcmFjdGlvbiBvZiAxLCBpLmUuIDAuMTUgbWVhbnMgMTUlIGRyYXdkb3duIHZhbHVlXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBhY3Rpb24gYWN0aW9uIHRvIHRha2Ugd2hlbiBkcmF3ZG93biBleGNlZWRzIG1heERyYXdkb3duIHZhbHVlLiBpbmNsdWRlIG1lYW5zIHRoZSB0cmFkaW5nXG4gICAqIHNpZ25hbCB3aWxsIGJlIHRyYW5zbWl0dGVkIG9ubHkgaWYgZGQgaXMgZ3JlYXRlciB0aGFuIG1heERyYXdkb3duIHZhbHVlLiBleGNsdWRlIG1lYW5zIHRoZSB0cmFkaW5nIHNpZ25hbCBcbiAgICogd2lsbCBiZSB0cmFuc21pdHRlZCBvbmx5IGlmIGRkIGlzIGxlc3MgdGhhbiBtYXhEcmF3ZG93biB2YWx1ZVxuICAgKi9cblxuICAvKipcbiAgICogVGVsZWdyYW0gcHVibGlzaGluZyBzZXR0aW5nc1xuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBTdHJhdGVneVRlbGVncmFtUHVibGlzaGluZ1NldHRpbmdzXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0b2tlbiB0ZWxlZ3JhbSBib3QgQVBJIHRva2VuXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBjaGF0SWQgdGVsZWdyYW0gY2hhdElkIHRvIHB1Ymxpc2ggc2lnbmFscyB0by4gSXQgY2FuIHJlZmVyZW5jZSBlaXRoZXIgYSBwdWJsaWNcbiAgICogY2hhbm5lbCAoZS5nLiBAbXlDaGFubmVsKSwgcHJpdmF0ZSBjaGFubmVsICh3b3JrcyBieSBjaGF0IGlkIG9ubHkpIG9yIGEgdXNlciAod29ya3MgYnkgY2hhdElkIG9ubHkpLlxuICAgKiBOb3RlIHRoYXQgaW4gb3JkZXIgdG8gcHVibGlzaCBzaWduYWxzIHRvIGEgY2hhbm5lbCBib3QgbXVzdCBiZSBhbiBhZG1pbiBvZiB0aGUgY2hhbm5lbFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdGVtcGxhdGUgdGVsZWdyYW0gbWVzc2FnZSB0ZW1wbGF0ZS4gQSBzdWJzdHJpbmcgb2YgJHtkZXNjcmlwdGlvbn0gd2lsbCBiZSByZXBsYWNlZFxuICAgKiB3aXRoIGEgc2lnbmFsIGRlc2NyaXB0aW9uLiBPdGhlciB2YXJpYWJsZXMgeW91IGNhbiB1c2U6ICR7b3BlcmF0aW9ufSwgJHtvcmRlcklkfSwgJHtzaWRlfSwgJHt0eXBlfSwgJHt2b2x1bWV9LFxuICAgKiAke3N5bWJvbH0sICR7b3BlblByaWNlfSwgJHtzdG9wTG9zc30sICR7dGFrZVByb2ZpdH0uXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdHJhdGVneSBUZWxlZ3JhbSBpbnRlZ3JhdGlvbiBzZXR0aW5nc1xuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBTdHJhdGVneVRlbGVncmFtU2V0dGluZ3NcbiAgICogQHByb3BlcnR5IHtTdHJhdGVneVRlbGVncmFtUHVibGlzaGluZ1NldHRpbmdzfSBwdWJsaXNoaW5nIHRlbGVncmFtIHB1Ymxpc2hpbmcgc2V0dGluZ3NcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHVwZGF0ZVxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5VXBkYXRlXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBuYW1lIHN0cmF0ZWd5IGh1bWFuLXJlYWRhYmxlIG5hbWVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGRlc2NyaXB0aW9uIGxvbmdlciBzdHJhdGVneSBodW1hbi1yZWFkYWJsZSBkZXNjcmlwdGlvblxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gYWNjb3VudElkIGlkIG9mIHRoZSBNZXRhQXBpIGFjY291bnQgcHJvdmlkaW5nIHRoZSBzdHJhdGVneVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuXG4gICAqIERlZmF1bHQgaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lDb21taXNzaW9uU2NoZW1lfSBbY29tbWlzc2lvblNjaGVtZV0gY29tbWlzc2lvbiBzY2hlbWUgYWxsb3dlZCBieSB0aGlzIHN0cmF0ZWd5XG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4VHJhZGVSaXNrXSBtYXggcmlzayBwZXIgdHJhZGUsIGV4cHJlc3NlZCBhcyBhIGZyYWN0aW9uIG9mIDEuIElmIHRyYWRlIGhhcyBhIFNMLCB0aGVcbiAgICogdHJhZGUgc2l6ZSB3aWxsIGJlIGFkanVzdGVkIHRvIG1hdGNoIHRoZSByaXNrIGxpbWl0LiBJZiBub3QsIHRoZSB0cmFkZSBTTCB3aWxsIGJlIGFwcGxpZWQgYWNjb3JkaW5nIHRvIHRoZSByaXNrXG4gICAqIGxpbWl0XG4gICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW3JldmVyc2VdIGZsYWcgaW5kaWNhdGluZyB0aGF0IHRoZSBzdHJhdGVneSBzaG91bGQgYmUgY29waWVkIGluIGEgcmV2ZXJzZSBkaXJlY3Rpb25cbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtyZWR1Y2VDb3JyZWxhdGlvbnNdIHNldHRpbmcgaW5kaWNhdGluZyB3aGV0aGVyIHRvIGVuYWJsZSBhdXRvbWF0aWMgdHJhZGVcbiAgICogY29ycmVsYXRpb24gcmVkdWN0aW9uLiBQb3NzaWJsZSBzZXR0aW5ncyBhcmUgbm90IHNwZWNpZmllZCAoZGlzYWJsZSBjb3JyZWxhdGlvbiByaXNrIHJlc3RyaWN0aW9ucyksXG4gICAqIGJ5LXN0cmF0ZWd5IChsaW1pdCBjb3JyZWxhdGlvbnMgZm9yIHRoZSBzdHJhdGVneSkgb3IgYnktYWNjb3VudCAobGltaXQgY29ycmVsYXRpb25zIGZvciB0aGUgYWNjb3VudClcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sRmlsdGVyfSBbc3ltYm9sRmlsdGVyXSBzeW1ib2wgZmlsdGVycyB3aGljaCBjYW4gYmUgdXNlZCB0byBjb3B5IG9ubHkgc3BlY2lmaWNcbiAgICogc3ltYm9scyBvciBleGNsdWRlIHNvbWUgc3ltYm9scyBmcm9tIGNvcHlpbmdcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TmV3c0ZpbHRlcn0gW25ld3NGaWx0ZXJdIG5ld3MgcmlzayBmaWx0ZXIgY29uZmlndXJhdGlvblxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lSaXNrTGltaXQ+fSBbcmlza0xpbWl0c10gc3RyYXRlZ3kgcmlzayBsaW1pdHMuIFlvdSBjYW4gY29uZmlndXJlXG4gICAqIHRyYWRpbmcgdG8gYmUgc3RvcHBlZCBvbmNlIHRvdGFsIGRyYXdkb3duIGdlbmVyYXRlZCBkdXJpbmcgc3BlY2lmaWMgcGVyaW9kIGlzIGV4Y2VlZGVkLiBDYW4gYmUgc3BlY2lmaWVkIGVpdGhlciBmb3JcbiAgICogYmFsYW5jZSBvciBlcXVpdHkgZHJhd2Rvd25cbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TWF4U3RvcExvc3N9IFttYXhTdG9wTG9zc10gc3RvcCBsb3NzIHZhbHVlIHJlc3RyaWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4TGV2ZXJhZ2VdIG1heCBsZXZlcmFnZSByaXNrIHJlc3RyaWN0aW9uLiBBbGwgdHJhZGVzIHJlc3VsdGluZyBpbiBhIGxldmVyYWdlIHZhbHVlXG4gICAqIGhpZ2hlciB0aGFuIHNwZWNpZmllZCB3aWxsIGJlIHNraXBwZWRcbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sTWFwcGluZz59IFtzeW1ib2xNYXBwaW5nXSBkZWZpbmVzIGhvdyBzeW1ib2wgbmFtZSBzaG91bGQgYmUgY2hhbmdlZCB3aGVuXG4gICAqIHRyYWRpbmcgKGUuZy4gd2hlbiBicm9rZXIgdXNlcyBzeW1ib2wgbmFtZXMgd2l0aCB1bnVzdWFsIHN1ZmZpeGVzKS4gQnkgZGVmYXVsdCB0aGlzIHNldHRpbmcgaXMgZGlzYWJsZWQgYW5kIHRoZVxuICAgKiB0cmFkZXMgYXJlIGNvcGllZCB1c2luZyBzaWduYWwgc291cmNlIHN5bWJvbCBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVRyYWRlU2l6ZVNjYWxpbmd9IFt0cmFkZVNpemVTY2FsaW5nXSBUcmFkZSBzaXplIHNjYWxpbmcgc2V0dGluZ3MuIEJ5IGRlZmF1bHQgdGhlXG4gICAqIHRyYWRlIHNpemUgb24gc3RyYXRlZ3kgc3Vic2NyaWJlciBzaWRlIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byBiYWxhbmNlIHRvIHByZXNlcnZlIHJpc2suXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlTdG9wTG9zc10gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgc3RvcCBsb3NzIHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSBzdG9wXG4gICAqIGxvc3MuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlUYWtlUHJvZml0XSBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0YWtlIHByb2ZpdCBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgdGFrZVxuICAgKiBwcm9maXQuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nW119IFthbGxvd2VkU2lkZXNdIFRyYWRlIHNpZGVzIHdoaWNoIHdpbGwgYmUgY29waWVkLiBCdXkgdHJhZGVzIG9ubHksIHNlbGwgdHJhZGVzIG9ubHkgb3IgYWxsXG4gICAqIHRyYWRlcy4gRGVmYXVsdCBpcyB0byBjb3B5IGFsbCB0cmFkZXNcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5UcmFkZVZvbHVtZV0gTWluaW11bSB0cmFkZSB2b2x1bWUgdG8gY29weS4gVHJhZGUgc2lnbmFscyB3aXRoIGEgc21hbGxlciB2b2x1bWUgd2lsbCBub3QgYmVcbiAgICogY29waWVkXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4VHJhZGVWb2x1bWVdIE1heGltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIGxhcmdlciB2b2x1bWUgd2lsbCBiZSBjb3BpZWRcbiAgICogd2l0aCBtYXhpbXVtIHZvbHVtZSBpbnN0ZWFkXG4gICAqIEBwcm9wZXJ0eSB7U3RyYXRlZ3lTaWduYWxEZWxheX0gW3NpZ25hbERlbGF5XSBleHRyYSB0cmFkZSBjb3B5aW5nIGRlbGF5IGludHJvZHVjZWQgYnkgdHJhZGUgY29waWVyIGJlZm9yZVxuICAgKiBhcHBseWluZyB0aGUgdHJhZGUgc2lnbmFsLiBZb3UgY2FuIGNvbmZpZ3VyZSBlaXRoZXIgYSBmaXhlZCBvciBhIHJhbmRvbSBkZWxheVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lNYWdpY0ZpbHRlcn0gW21hZ2ljRmlsdGVyXSBtYWdpYyAoZXhwZXJ0IGlkKSBmaWx0ZXJcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5RXF1aXR5Q3VydmVGaWx0ZXJ9IFtlcXVpdHlDdXJ2ZUZpbHRlcl0gZmlsdGVyIHdoaWNoIHBlcm1pdHMgdGhlIHRyYWRlcyBvbmx5IGlmIGFjY291bnRcbiAgICogZXF1aXR5IGlzIGdyZWF0ZXIgdGhhbiBiYWxhbmNlIG1vdmluZyBhdmVyYWdlXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneURyYXdkb3duRmlsdGVyfSBbZHJhd2Rvd25GaWx0ZXJdIG1hc3RlciBhY2NvdW50IHN0cmF0ZWd5IGRyYXdkb3duIGZpbHRlclxuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IFtzeW1ib2xzVHJhZGVkXSBzeW1ib2xzIHRyYWRlZCBieSB0aGlzIHN0cmF0ZWd5LiBTcGVjaWZ5aW5nIHRoZSBzeW1ib2xzIHdpbGwgaW1wcm92ZSB0cmFkZVxuICAgKiBsYXRlbmN5IG9uIGZpcnN0IHRyYWRlcyBtYWRlIGJ5IHN0cmF0ZWd5LiBJZiB5b3UgZG8gbm90IHNwZWNpZnkgdGhpcyBzZXR0aW5nIHRoZSBhcHBsaWNhdGlvbiB3aWxsIG1vbml0b3IgdGhlIHN0cmF0ZWd5XG4gICAqIHRyYWRlcyBhbmQgZGV0ZWN0IHRoZSBzeW1ib2xzIGF1dG9tYXRpY2FsbHkgb3ZlciB0aW1lIFxuICAgKiBAcHJvcGVydHkge1N0cmF0ZWd5VGVsZWdyYW1TZXR0aW5nc30gW3RlbGVncmFtXSB0ZWxlZ3JhbSBwdWJsaXNoaW5nIHNldHRpbmdzXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVRpbWVTZXR0aW5nc30gW3RpbWVTZXR0aW5nc10gc2V0dGluZ3MgdG8gbWFuYWdlIGNvcHlpbmcgdGltZWZyYW1lIGFuZCBwb3NpdGlvblxuICAgKiBsaWZldGltZS4gRGVmYXVsdCBpcyB0byBjb3B5IHBvc2l0aW9uIHdpdGhpbiAxIG1pbnV0ZSBmcm9tIGJlaW5nIG9wZW5lZCBhdCBzb3VyY2UgYW5kIGxldCB0aGUgcG9zaXRpb24gdG8gbGl2ZSBmb3JcbiAgICogdXAgdG8gOTAgZGF5c1xuICAgKi9cblxuICAvKipcbiAgICogVXBkYXRlcyBhIENvcHlGYWN0b3J5IHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi91cGRhdGVTdHJhdGVneS9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmF0ZWd5SWQgY29weSB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlTdHJhdGVneVVwZGF0ZX0gc3RyYXRlZ3kgdHJhZGluZyBzdHJhdGVneSB1cGRhdGVcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBzdHJhdGVneSBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVTdHJhdGVneShzdHJhdGVneUlkLCBzdHJhdGVneSkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCd1cGRhdGVTdHJhdGVneScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9zdHJhdGVnaWVzLyR7c3RyYXRlZ3lJZH1gLFxuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IHN0cmF0ZWd5LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgY2xvc2UgaW5zdHJ1Y3Rpb25zXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5Q2xvc2VJbnN0cnVjdGlvbnNcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFttb2RlXSBwb3NpdGlvbiBjbG9zZSBtb2RlIG9uIHN0cmF0ZWd5IG9yIHN1YnNjcmlwdGlvbiByZW1vdmFsLiBQcmVzZXJ2ZSBtZWFuc1xuICAgKiB0aGF0IHBvc2l0aW9ucyB3aWxsIG5vdCBiZSBjbG9zZWQgYW5kIHdpbGwgbm90IGJlIG1hbmFnZWQgYnkgQ29weUZhY3RvcnkuXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktcG9zaXRpb24gbWVhbnMgdGhhdCBwb3NpdGlvbnMgd2lsbCBjb250aW51ZSB0byBiZSBtYW5hZ2VkIGJ5IENvcHlGYWN0b3J5LFxuICAgKiBidXQgb25seSBjbG9zZSBzaWduYWxzIHdpbGwgYmUgY29waWVkLiBjbG9zZS1ncmFjZWZ1bGx5LWJ5LXN5bWJvbCBtZWFucyB0aGF0IHBvc2l0aW9ucyB3aWxsXG4gICAqIGNvbnRpbnVlIHRvIGJlIG1hbmFnZWQgYnkgQ29weUZhY3RvcnksIGJ1dCBvbmx5IGNsb3NlIHNpZ25hbHMgd2lsbCBiZSBjb3BpZWQgb3Igc2lnbmFscyB0b1xuICAgKiBvcGVuIHBvc2l0aW9ucyBmb3IgdGhlIHN5bWJvbHMgd2hpY2ggYWxyZWFkeSBoYXZlIHBvc2l0aW9ucyBvcGVuZWQuIGNsb3NlLWltbWVkaWF0ZWx5IG1lYW5zXG4gICAqIHRoYXQgYWxsIHBvc2l0aW9ucyB3aWxsIGJlIGNsb3NlZCBpbW1lZGlhdGVseS4gRGVmYXVsdCBpcyBjbG9zZS1pbW1lZGlhdGVseS4gT25lIG9mICdwcmVzZXJ2ZScsXG4gICAqICdjbG9zZS1ncmFjZWZ1bGx5LWJ5LXBvc2l0aW9uJywgJ2Nsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sJywgJ2Nsb3NlLWltbWVkaWF0ZWx5J1xuICAgKiBAcHJvcGVydHkge0RhdGV9IFtyZW1vdmVBZnRlcl0gdGltZSB0byBmb3JjZSByZW1vdmUgb2JqZWN0IGFmdGVyLiBUaGUgb2JqZWN0IHdpbGwgYmUgcmVtb3ZlZCBhZnRlclxuICAgKiB0aGlzIHRpbWUsIGV2ZW4gaWYgcG9zaXRpb25zIGFyZSBub3QgeWV0IGNsb3NlZCBmdWxseS4gRGVmYXVsdCBpcyBjdXJyZW50IGRhdGUgcGx1cyAzMCBkYXlzLlxuICAgKiBDYW4gbm90IGJlIGxlc3MgdGhhbiAzMCBkYXlzIG9yIGdyZWF0ZXIgdGhhbiBjdXJyZW50IGRhdGUgcGx1cyA5MCBkYXlzLiBUaGUgc2V0dGluZyBpcyBpZ25vcmVkXG4gICAqIHdoZW4gYSBzdWJzY3JpcHRpb24gaXMgYmVpbmcgcmVtb3ZlZFxuICAgKi9cblxuICAvKipcbiAgICogRGVsZXRlcyBhIENvcHlGYWN0b3J5IHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9yZW1vdmVTdHJhdGVneS9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmF0ZWd5SWQgY29weSB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlDbG9zZUluc3RydWN0aW9uc30gW2Nsb3NlSW5zdHJ1Y3Rpb25zXSBzdHJhdGVneSBjbG9zZSBpbnN0cnVjdGlvbnNcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBzdHJhdGVneSBpcyByZW1vdmVkXG4gICAqL1xuICByZW1vdmVTdHJhdGVneShzdHJhdGVneUlkLCBjbG9zZUluc3RydWN0aW9ucykge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZW1vdmVTdHJhdGVneScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9zdHJhdGVnaWVzLyR7c3RyYXRlZ3lJZH1gLFxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IGNsb3NlSW5zdHJ1Y3Rpb25zLFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogUG9ydGZvbGlvIHN0cmF0ZWd5IG1lbWJlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5TWVtYmVyXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzdHJhdGVneUlkIG1lbWJlciBzdHJhdGVneSBpZFxuICAgKiBAcHJvcGVydHkge051bWJlcn0gbXVsdGlwbGllciBjb3B5aW5nIG11bHRpcGxpZXIgKHdlaWdodCBpbiB0aGUgcG9ydGZvbGlvKVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuXG4gICAqIERlZmF1bHQgaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heFRyYWRlUmlza10gbWF4IHJpc2sgcGVyIHRyYWRlLCBleHByZXNzZWQgYXMgYSBmcmFjdGlvbiBvZiAxLiBJZiB0cmFkZSBoYXMgYSBTTCwgdGhlXG4gICAqIHRyYWRlIHNpemUgd2lsbCBiZSBhZGp1c3RlZCB0byBtYXRjaCB0aGUgcmlzayBsaW1pdC4gSWYgbm90LCB0aGUgdHJhZGUgU0wgd2lsbCBiZSBhcHBsaWVkIGFjY29yZGluZyB0byB0aGUgcmlza1xuICAgKiBsaW1pdFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtyZXZlcnNlXSBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGUgc3RyYXRlZ3kgc2hvdWxkIGJlIGNvcGllZCBpbiBhIHJldmVyc2UgZGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcmVkdWNlQ29ycmVsYXRpb25zXSBzZXR0aW5nIGluZGljYXRpbmcgd2hldGhlciB0byBlbmFibGUgYXV0b21hdGljIHRyYWRlXG4gICAqIGNvcnJlbGF0aW9uIHJlZHVjdGlvbi4gUG9zc2libGUgc2V0dGluZ3MgYXJlIG5vdCBzcGVjaWZpZWQgKGRpc2FibGUgY29ycmVsYXRpb24gcmlzayByZXN0cmljdGlvbnMpLFxuICAgKiBieS1zdHJhdGVneSAobGltaXQgY29ycmVsYXRpb25zIGZvciB0aGUgc3RyYXRlZ3kpIG9yIGJ5LWFjY291bnQgKGxpbWl0IGNvcnJlbGF0aW9ucyBmb3IgdGhlIGFjY291bnQpXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbEZpbHRlcn0gW3N5bWJvbEZpbHRlcl0gc3ltYm9sIGZpbHRlcnMgd2hpY2ggY2FuIGJlIHVzZWQgdG8gY29weSBvbmx5IHNwZWNpZmljXG4gICAqIHN5bWJvbHMgb3IgZXhjbHVkZSBzb21lIHN5bWJvbHMgZnJvbSBjb3B5aW5nXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU5ld3NGaWx0ZXJ9IFtuZXdzRmlsdGVyXSBuZXdzIHJpc2sgZmlsdGVyIGNvbmZpZ3VyYXRpb25cbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5Umlza0xpbWl0Pn0gW3Jpc2tMaW1pdHNdIHN0cmF0ZWd5IHJpc2sgbGltaXRzLiBZb3UgY2FuIGNvbmZpZ3VyZVxuICAgKiB0cmFkaW5nIHRvIGJlIHN0b3BwZWQgb25jZSB0b3RhbCBkcmF3ZG93biBnZW5lcmF0ZWQgZHVyaW5nIHNwZWNpZmljIHBlcmlvZCBpcyBleGNlZWRlZC4gQ2FuIGJlIHNwZWNpZmllZCBlaXRoZXIgZm9yXG4gICAqIGJhbGFuY2Ugb3IgZXF1aXR5IGRyYXdkb3duXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU1heFN0b3BMb3NzfSBbbWF4U3RvcExvc3NdIHN0b3AgbG9zcyB2YWx1ZSByZXN0cmljdGlvblxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heExldmVyYWdlXSBtYXggbGV2ZXJhZ2UgcmlzayByZXN0cmljdGlvbi4gQWxsIHRyYWRlcyByZXN1bHRpbmcgaW4gYSBsZXZlcmFnZSB2YWx1ZVxuICAgKiBoaWdoZXIgdGhhbiBzcGVjaWZpZWQgd2lsbCBiZSBza2lwcGVkXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbE1hcHBpbmc+fSBbc3ltYm9sTWFwcGluZ10gZGVmaW5lcyBob3cgc3ltYm9sIG5hbWUgc2hvdWxkIGJlIGNoYW5nZWQgd2hlblxuICAgKiB0cmFkaW5nIChlLmcuIHdoZW4gYnJva2VyIHVzZXMgc3ltYm9sIG5hbWVzIHdpdGggdW51c3VhbCBzdWZmaXhlcykuIEJ5IGRlZmF1bHQgdGhpcyBzZXR0aW5nIGlzIGRpc2FibGVkIGFuZCB0aGVcbiAgICogdHJhZGVzIGFyZSBjb3BpZWQgdXNpbmcgc2lnbmFsIHNvdXJjZSBzeW1ib2wgbmFtZVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lUcmFkZVNpemVTY2FsaW5nfSBbdHJhZGVTaXplU2NhbGluZ10gVHJhZGUgc2l6ZSBzY2FsaW5nIHNldHRpbmdzLiBCeSBkZWZhdWx0IHRoZVxuICAgKiB0cmFkZSBzaXplIG9uIHN0cmF0ZWd5IHN1YnNjcmliZXIgc2lkZSB3aWxsIGJlIHNjYWxlZCBhY2NvcmRpbmcgdG8gYmFsYW5jZSB0byBwcmVzZXJ2ZSByaXNrLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5U3RvcExvc3NdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHN0b3AgbG9zcyBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgc3RvcFxuICAgKiBsb3NzLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5VGFrZVByb2ZpdF0gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGFrZSBwcm9maXQgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHRha2VcbiAgICogcHJvZml0LlxuICAgKiBAcHJvcGVydHkge3N0cmluZ1tdfSBbYWxsb3dlZFNpZGVzXSBUcmFkZSBzaWRlcyB3aGljaCB3aWxsIGJlIGNvcGllZC4gQnV5IHRyYWRlcyBvbmx5LCBzZWxsIHRyYWRlcyBvbmx5IG9yIGFsbFxuICAgKiB0cmFkZXMuIERlZmF1bHQgaXMgdG8gY29weSBhbGwgdHJhZGVzXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWluVHJhZGVWb2x1bWVdIE1pbmltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIHNtYWxsZXIgdm9sdW1lIHdpbGwgbm90IGJlXG4gICAqIGNvcGllZFxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21heFRyYWRlVm9sdW1lXSBNYXhpbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBsYXJnZXIgdm9sdW1lIHdpbGwgYmUgY29waWVkXG4gICAqIHdpdGggbWF4aW11bSB2b2x1bWUgaW5zdGVhZFxuICAgKiBAcHJvcGVydHkge1N0cmF0ZWd5U2lnbmFsRGVsYXl9IFtzaWduYWxEZWxheV0gZXh0cmEgdHJhZGUgY29weWluZyBkZWxheSBpbnRyb2R1Y2VkIGJ5IHRyYWRlIGNvcGllciBiZWZvcmVcbiAgICogYXBwbHlpbmcgdGhlIHRyYWRlIHNpZ25hbC4gWW91IGNhbiBjb25maWd1cmUgZWl0aGVyIGEgZml4ZWQgb3IgYSByYW5kb20gZGVsYXlcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtjbG9zZU9uUmVtb3ZhbE1vZGVdIHBvc2l0aW9uIGNsb3NlIG1vZGUgb24gc3RyYXRlZ3kgb3Igc3Vic2NyaXB0aW9uIHJlbW92YWwuIFByZXNlcnZlIG1lYW5zXG4gICAqIHRoYXQgcG9zaXRpb25zIHdpbGwgbm90IGJlIGNsb3NlZCBhbmQgd2lsbCBub3QgYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeS4gY2xvc2UtZ3JhY2VmdWxseS1ieS1wb3NpdGlvbiBtZWFuc1xuICAgKiB0aGF0IHBvc2l0aW9ucyB3aWxsIGNvbnRpbnVlIHRvIGJlIG1hbmFnZWQgYnkgQ29weUZhY3RvcnksIGJ1dCBvbmx5IGNsb3NlIHNpZ25hbHMgd2lsbCBiZSBjb3BpZWQuXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sIG1lYW5zIHRoYXQgcG9zaXRpb25zIHdpbGwgY29udGludWUgdG8gYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeSwgYnV0IG9ubHkgY2xvc2VcbiAgICogc2lnbmFscyB3aWxsIGJlIGNvcGllZCBvciBzaWduYWxzIHRvIG9wZW4gcG9zaXRpb25zIGZvciB0aGUgc3ltYm9scyB3aGljaCBhbHJlYWR5IGhhdmUgcG9zaXRpb25zIG9wZW5lZC5cbiAgICogY2xvc2UtaW1tZWRpYXRlbHkgbWVhbnMgdGhhdCBhbGwgcG9zaXRpb25zIHdpbGwgYmUgY2xvc2VkIGltbWVkaWF0ZWx5LiBEZWZhdWx0IGlzIGNsb3NlLWltbWVkaWF0ZWx5LlxuICAgKiBUaGlzIGZpZWxkIGNhbiBiZSBjaGFuZ2VkIHZpYSByZW1vdmUgcG90Zm9saW8gbWVtYmVyIEFQSSBvbmx5LCBvbmUgb2YgcHJlc2VydmUsIGNsb3NlLWdyYWNlZnVsbHktYnktcG9zaXRpb24sXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sLCBjbG9zZS1pbW1lZGlhdGVseVxuICAgKi9cblxuICAvKipcbiAgICogUG9ydGZvbGlvIHN0cmF0ZWd5IHVwZGF0ZVxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5VXBkYXRlXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBuYW1lIHN0cmF0ZWd5IGh1bWFuLXJlYWRhYmxlIG5hbWVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGRlc2NyaXB0aW9uIGxvbmdlciBzdHJhdGVneSBodW1hbi1yZWFkYWJsZSBkZXNjcmlwdGlvblxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5UG9ydGZvbGlvU3RyYXRlZ3lNZW1iZXI+fSBtZW1iZXJzIGFycmF5IG9mIHBvcnRmb2xpbyBtZW1iZXJzXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneUNvbW1pc3Npb25TY2hlbWV9IFtjb21taXNzaW9uU2NoZW1lXSBjb21taXNzaW9uIHNjaGVtZSBhbGxvd2VkIGJ5IHRoaXMgc3RyYXRlZ3kuIEJ5XG4gICAqIGRlZmF1bHQgbW9udGhseSBiaWxsaW5nIHBlcmlvZCB3aXRoIG5vIGNvbW1pc3Npb24gaXMgYmVpbmcgdXNlZFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuXG4gICAqIERlZmF1bHQgaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heFRyYWRlUmlza10gbWF4IHJpc2sgcGVyIHRyYWRlLCBleHByZXNzZWQgYXMgYSBmcmFjdGlvbiBvZiAxLiBJZiB0cmFkZSBoYXMgYSBTTCwgdGhlXG4gICAqIHRyYWRlIHNpemUgd2lsbCBiZSBhZGp1c3RlZCB0byBtYXRjaCB0aGUgcmlzayBsaW1pdC4gSWYgbm90LCB0aGUgdHJhZGUgU0wgd2lsbCBiZSBhcHBsaWVkIGFjY29yZGluZyB0byB0aGUgcmlza1xuICAgKiBsaW1pdFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtyZXZlcnNlXSBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGUgc3RyYXRlZ3kgc2hvdWxkIGJlIGNvcGllZCBpbiBhIHJldmVyc2UgZGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcmVkdWNlQ29ycmVsYXRpb25zXSBzZXR0aW5nIGluZGljYXRpbmcgd2hldGhlciB0byBlbmFibGUgYXV0b21hdGljIHRyYWRlXG4gICAqIGNvcnJlbGF0aW9uIHJlZHVjdGlvbi4gUG9zc2libGUgc2V0dGluZ3MgYXJlIG5vdCBzcGVjaWZpZWQgKGRpc2FibGUgY29ycmVsYXRpb24gcmlzayByZXN0cmljdGlvbnMpLFxuICAgKiBieS1zdHJhdGVneSAobGltaXQgY29ycmVsYXRpb25zIGZvciB0aGUgc3RyYXRlZ3kpIG9yIGJ5LWFjY291bnQgKGxpbWl0IGNvcnJlbGF0aW9ucyBmb3IgdGhlIGFjY291bnQpXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbEZpbHRlcn0gW3N5bWJvbEZpbHRlcl0gc3ltYm9sIGZpbHRlcnMgd2hpY2ggY2FuIGJlIHVzZWQgdG8gY29weSBvbmx5IHNwZWNpZmljXG4gICAqIHN5bWJvbHMgb3IgZXhjbHVkZSBzb21lIHN5bWJvbHMgZnJvbSBjb3B5aW5nXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU5ld3NGaWx0ZXJ9IFtuZXdzRmlsdGVyXSBuZXdzIHJpc2sgZmlsdGVyIGNvbmZpZ3VyYXRpb25cbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5Umlza0xpbWl0Pn0gW3Jpc2tMaW1pdHNdIHN0cmF0ZWd5IHJpc2sgbGltaXRzLiBZb3UgY2FuIGNvbmZpZ3VyZVxuICAgKiB0cmFkaW5nIHRvIGJlIHN0b3BwZWQgb25jZSB0b3RhbCBkcmF3ZG93biBnZW5lcmF0ZWQgZHVyaW5nIHNwZWNpZmljIHBlcmlvZCBpcyBleGNlZWRlZC4gQ2FuIGJlIHNwZWNpZmllZCBlaXRoZXIgZm9yXG4gICAqIGJhbGFuY2Ugb3IgZXF1aXR5IGRyYXdkb3duXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU1heFN0b3BMb3NzfSBbbWF4U3RvcExvc3NdIHN0b3AgbG9zcyB2YWx1ZSByZXN0cmljdGlvblxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heExldmVyYWdlXSBtYXggbGV2ZXJhZ2UgcmlzayByZXN0cmljdGlvbi4gQWxsIHRyYWRlcyByZXN1bHRpbmcgaW4gYSBsZXZlcmFnZSB2YWx1ZVxuICAgKiBoaWdoZXIgdGhhbiBzcGVjaWZpZWQgd2lsbCBiZSBza2lwcGVkXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbE1hcHBpbmc+fSBbc3ltYm9sTWFwcGluZ10gZGVmaW5lcyBob3cgc3ltYm9sIG5hbWUgc2hvdWxkIGJlIGNoYW5nZWQgd2hlblxuICAgKiB0cmFkaW5nIChlLmcuIHdoZW4gYnJva2VyIHVzZXMgc3ltYm9sIG5hbWVzIHdpdGggdW51c3VhbCBzdWZmaXhlcykuIEJ5IGRlZmF1bHQgdGhpcyBzZXR0aW5nIGlzIGRpc2FibGVkIGFuZCB0aGVcbiAgICogdHJhZGVzIGFyZSBjb3BpZWQgdXNpbmcgc2lnbmFsIHNvdXJjZSBzeW1ib2wgbmFtZVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lUcmFkZVNpemVTY2FsaW5nfSBbdHJhZGVTaXplU2NhbGluZ10gVHJhZGUgc2l6ZSBzY2FsaW5nIHNldHRpbmdzLiBCeSBkZWZhdWx0IHRoZVxuICAgKiB0cmFkZSBzaXplIG9uIHN0cmF0ZWd5IHN1YnNjcmliZXIgc2lkZSB3aWxsIGJlIHNjYWxlZCBhY2NvcmRpbmcgdG8gYmFsYW5jZSB0byBwcmVzZXJ2ZSByaXNrLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5U3RvcExvc3NdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHN0b3AgbG9zcyBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgc3RvcFxuICAgKiBsb3NzLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5VGFrZVByb2ZpdF0gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGFrZSBwcm9maXQgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHRha2VcbiAgICogcHJvZml0LlxuICAgKiBAcHJvcGVydHkge3N0cmluZ1tdfSBbYWxsb3dlZFNpZGVzXSBUcmFkZSBzaWRlcyB3aGljaCB3aWxsIGJlIGNvcGllZC4gQnV5IHRyYWRlcyBvbmx5LCBzZWxsIHRyYWRlcyBvbmx5IG9yIGFsbFxuICAgKiB0cmFkZXMuIERlZmF1bHQgaXMgdG8gY29weSBhbGwgdHJhZGVzXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWluVHJhZGVWb2x1bWVdIE1pbmltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIHNtYWxsZXIgdm9sdW1lIHdpbGwgbm90IGJlXG4gICAqIGNvcGllZFxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21heFRyYWRlVm9sdW1lXSBNYXhpbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBsYXJnZXIgdm9sdW1lIHdpbGwgYmUgY29waWVkXG4gICAqIHdpdGggbWF4aW11bSB2b2x1bWUgaW5zdGVhZFxuICAgKiBAcHJvcGVydHkge1N0cmF0ZWd5U2lnbmFsRGVsYXl9IFtzaWduYWxEZWxheV0gZXh0cmEgdHJhZGUgY29weWluZyBkZWxheSBpbnRyb2R1Y2VkIGJ5IHRyYWRlIGNvcGllciBiZWZvcmVcbiAgICogYXBwbHlpbmcgdGhlIHRyYWRlIHNpZ25hbC4gWW91IGNhbiBjb25maWd1cmUgZWl0aGVyIGEgZml4ZWQgb3IgYSByYW5kb20gZGVsYXlcbiAgICovXG5cbiAgLyoqXG4gICAqIFBvcnRmb2xpbyBzdHJhdGVneSwgaS5lLiB0aGUgc3RyYXRlZ3kgd2hpY2ggaW5jbHVkZXMgYSBzZXQgb2Ygb3RoZXIgc3RyYXRlZ2llc1xuICAgKiBAdHlwZWRlZiB7Q29weUZhY3RvcnlQb3J0Zm9saW9TdHJhdGVneVVwZGF0ZX0gQ29weUZhY3RvcnlQb3J0Zm9saW9TdHJhdGVneVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gX2lkIHVuaXF1ZSBzdHJhdGVneSBpZFxuICAgKiBAcHJvcGVydHkge051bWJlcn0gcGxhdGZvcm1Db21taXNzaW9uUmF0ZSBjb21taXNzaW9uIHJhdGUgdGhlIHBsYXRmb3JtIGNoYXJnZXMgZm9yIHN0cmF0ZWd5IGNvcHlpbmcsIGFwcGxpZWQgdG9cbiAgICogY29tbWlzc2lvbnMgY2hhcmdlZCBieSBwcm92aWRlci4gVGhpcyBjb21taXNzaW9uIGFwcGxpZXMgb25seSB0byBhY2NvdW50cyBub3QgbWFuYWdlZCBkaXJlY3RseSBieSBwcm92aWRlci4gU2hvdWxkXG4gICAqIGJlIGZyYWN0aW9uIG9mIDFcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtjbG9zZU9uUmVtb3ZhbE1vZGVdIHBvc2l0aW9uIGNsb3NlIG1vZGUgb24gc3RyYXRlZ3kgb3Igc3Vic2NyaXB0aW9uIHJlbW92YWwuIFByZXNlcnZlIG1lYW5zXG4gICAqIHRoYXQgcG9zaXRpb25zIHdpbGwgbm90IGJlIGNsb3NlZCBhbmQgd2lsbCBub3QgYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeS4gY2xvc2UtZ3JhY2VmdWxseS1ieS1wb3NpdGlvbiBtZWFuc1xuICAgKiB0aGF0IHBvc2l0aW9ucyB3aWxsIGNvbnRpbnVlIHRvIGJlIG1hbmFnZWQgYnkgQ29weUZhY3RvcnksIGJ1dCBvbmx5IGNsb3NlIHNpZ25hbHMgd2lsbCBiZSBjb3BpZWQuXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sIG1lYW5zIHRoYXQgcG9zaXRpb25zIHdpbGwgY29udGludWUgdG8gYmUgbWFuYWdlZCBieSBDb3B5RmFjdG9yeSwgYnV0IG9ubHkgY2xvc2VcbiAgICogc2lnbmFscyB3aWxsIGJlIGNvcGllZCBvciBzaWduYWxzIHRvIG9wZW4gcG9zaXRpb25zIGZvciB0aGUgc3ltYm9scyB3aGljaCBhbHJlYWR5IGhhdmUgcG9zaXRpb25zIG9wZW5lZC5cbiAgICogY2xvc2UtaW1tZWRpYXRlbHkgbWVhbnMgdGhhdCBhbGwgcG9zaXRpb25zIHdpbGwgYmUgY2xvc2VkIGltbWVkaWF0ZWx5LiBEZWZhdWx0IGlzIGNsb3NlLWltbWVkaWF0ZWx5LlxuICAgKiBUaGlzIGZpZWxkIGNhbiBiZSBjaGFuZ2VkIHZpYSByZW1vdmUgcG90Zm9saW8gbWVtYmVyIEFQSSBvbmx5LCBvbmUgb2YgcHJlc2VydmUsIGNsb3NlLWdyYWNlZnVsbHktYnktcG9zaXRpb24sXG4gICAqIGNsb3NlLWdyYWNlZnVsbHktYnktc3ltYm9sLCBjbG9zZS1pbW1lZGlhdGVseVxuICAgKi9cblxuICAvKipcbiAgICogUmV0cmlldmVzIENvcHlGYWN0b3J5IGNvcHkgcG9ydGZvbGlvIHN0cmF0ZWdpZXMuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldFBvcnRmb2xpb1N0cmF0ZWdpZXMvXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2luY2x1ZGVSZW1vdmVkXSBmbGFnIGluc3RydWN0aW5nIHRvIGluY2x1ZGUgcmVtb3ZlZCBwb3J0Zm9saW8gc3RyYXRlZ2llcyBpbiByZXN1bHRzXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbGltaXRdIHBhZ2luYXRpb24gbGltaXRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvZmZzZXRdIGNvcHkgdHJhZGluZyBzdHJhdGVneSBpZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PENvcHlGYWN0b3J5UG9ydGZvbGlvU3RyYXRlZ3k+Pn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBDb3B5RmFjdG9yeSBwb3J0Zm9saW8gc3RyYXRlZ2llc1xuICAgKiBmb3VuZFxuICAgKi9cbiAgZ2V0UG9ydGZvbGlvU3RyYXRlZ2llcyhpbmNsdWRlUmVtb3ZlZCwgbGltaXQsIG9mZnNldCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRQb3J0Zm9saW9TdHJhdGVnaWVzJyk7XG4gICAgfVxuICAgIGxldCBxcyA9IHt9O1xuICAgIGlmKGluY2x1ZGVSZW1vdmVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmluY2x1ZGVSZW1vdmVkID0gaW5jbHVkZVJlbW92ZWQ7XG4gICAgfVxuICAgIGlmKGxpbWl0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmxpbWl0ID0gbGltaXQ7XG4gICAgfVxuICAgIGlmKG9mZnNldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxcy5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBxcyxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMsIHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBDb3B5RmFjdG9yeSBjb3B5IHBvcnRmb2xpbyBzdHJhdGVneSBieSBpZC4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2V0UG9ydGZvbGlvU3RyYXRlZ3kvXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwb3J0Zm9saW9JZCBwb3J0Zm9saW8gc3RyYXRlZ3kgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZTxDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5Pn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBDb3B5RmFjdG9yeSBwb3J0Zm9saW8gc3RyYXRlZ3kgZm91bmRcbiAgICovXG4gIGdldFBvcnRmb2xpb1N0cmF0ZWd5KHBvcnRmb2xpb0lkKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFBvcnRmb2xpb1N0cmF0ZWd5Jyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzLyR7cG9ydGZvbGlvSWR9YCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGEgQ29weUZhY3RvcnkgcG9ydGZvbGlvIHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi91cGRhdGVQb3J0Zm9saW9TdHJhdGVneS9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHBvcnRmb2xpb0lkIGNvcHkgdHJhZGluZyBwb3J0Zm9saW8gc3RyYXRlZ3kgaWRcbiAgICogQHBhcmFtIHtDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5VXBkYXRlfSBwb3J0Zm9saW8gcG9ydGZvbGlvIHN0cmF0ZWd5IHVwZGF0ZVxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHJlc29sdmluZyB3aGVuIHBvcnRmb2xpbyBzdHJhdGVneSBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVQb3J0Zm9saW9TdHJhdGVneShwb3J0Zm9saW9JZCwgcG9ydGZvbGlvKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ3VwZGF0ZVBvcnRmb2xpb1N0cmF0ZWd5Jyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzLyR7cG9ydGZvbGlvSWR9YCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBwb3J0Zm9saW8sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgQ29weUZhY3RvcnkgcG9ydGZvbGlvIHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9yZW1vdmVQb3J0Zm9saW9TdHJhdGVneS9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHBvcnRmb2xpb0lkIHBvcnRmb2xpbyBzdHJhdGVneSBpZFxuICAgKiBAcGFyYW0ge0NvcHlGYWN0b3J5Q2xvc2VJbnN0cnVjdGlvbnN9IFtjbG9zZUluc3RydWN0aW9uc10gc3RyYXRlZ3kgY2xvc2UgaW5zdHJ1Y3Rpb25zXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgcmVzb2x2aW5nIHdoZW4gcG9ydGZvbGlvIHN0cmF0ZWd5IGlzIHJlbW92ZWRcbiAgICovXG4gIHJlbW92ZVBvcnRmb2xpb1N0cmF0ZWd5KHBvcnRmb2xpb0lkLCBjbG9zZUluc3RydWN0aW9ucykge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZW1vdmVQb3J0Zm9saW9TdHJhdGVneScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9wb3J0Zm9saW8tc3RyYXRlZ2llcy8ke3BvcnRmb2xpb0lkfWAsXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogY2xvc2VJbnN0cnVjdGlvbnMsXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgQ29weUZhY3RvcnkgcG9ydGZvbGlvIHN0cmF0ZWd5IG1lbWJlci4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vcmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3lNZW1iZXIvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBwb3J0Zm9saW9JZCBwb3J0Zm9saW8gc3RyYXRlZ3kgaWRcbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmF0ZWd5SWQgaWQgb2YgdGhlIHN0cmF0ZWd5IHRvIGRlbGV0ZSBtZW1iZXIgZm9yXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlDbG9zZUluc3RydWN0aW9uc30gW2Nsb3NlSW5zdHJ1Y3Rpb25zXSBzdHJhdGVneSBjbG9zZSBpbnN0cnVjdGlvbnNcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBwb3J0Zm9saW8gc3RyYXRlZ3kgaXMgcmVtb3ZlZFxuICAgKi9cbiAgcmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3lNZW1iZXIocG9ydGZvbGlvSWQsIHN0cmF0ZWd5SWQsIGNsb3NlSW5zdHJ1Y3Rpb25zKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ3JlbW92ZVBvcnRmb2xpb1N0cmF0ZWd5TWVtYmVyJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzLyR7cG9ydGZvbGlvSWR9L21lbWJlcnMvJHtzdHJhdGVneUlkfWAsXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogY2xvc2VJbnN0cnVjdGlvbnMsXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIENvcHlGYWN0b3J5IHN1YnNjcmliZXJzIHRoZSB1c2VyIGhhcyBjb25maWd1cmVkLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvaGlzdG9yeS9nZXRTdWJzY3JpYmVycy9cbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5jbHVkZVJlbW92ZWRdIGZsYWcgaW5zdHJ1Y3RpbmcgdG8gaW5jbHVkZSByZW1vdmVkIHN1YnNjcmliZXJzIGluIHJlc3VsdHNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtsaW1pdF0gcGFnaW5hdGlvbiBsaW1pdFxuICAgKiBAcGFyYW0ge051bWJlcn0gW29mZnNldF0gY29weSB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXk8Q29weUZhY3RvcnlTdWJzY3JpYmVyPj59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggc3Vic2NyaWJlcnMgZm91bmRcbiAgICovXG4gIGdldFN1YnNjcmliZXJzKGluY2x1ZGVSZW1vdmVkLCBsaW1pdCwgb2Zmc2V0KSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFN1YnNjcmliZXJzJyk7XG4gICAgfVxuICAgIGxldCBxcyA9IHt9O1xuICAgIGlmKGluY2x1ZGVSZW1vdmVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmluY2x1ZGVSZW1vdmVkID0gaW5jbHVkZVJlbW92ZWQ7XG4gICAgfVxuICAgIGlmKGxpbWl0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHFzLmxpbWl0ID0gbGltaXQ7XG4gICAgfVxuICAgIGlmKG9mZnNldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxcy5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N1YnNjcmliZXJzJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBxcyxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMsIHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgQ29weUZhY3Rvcnkgc3Vic2NyaWJlciBieSBpZC4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2V0U3Vic2NyaWJlci9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHN1YnNjcmliZXJJZCBzdWJzY3JpYmVyIGlkXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPENvcHlGYWN0b3J5U3Vic2NyaWJlcj59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggc3Vic2NyaWJlciBmb3VuZFxuICAgKi9cbiAgZ2V0U3Vic2NyaWJlcihzdWJzY3JpYmVySWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcignZ2V0U3Vic2NyaWJlcicpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9zdWJzY3JpYmVycy8ke3N1YnNjcmliZXJJZH1gLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgQ29weUZhY3Rvcnkgc3Vic2NyaWJlciBjb25maWd1cmF0aW9uLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi91cGRhdGVTdWJzY3JpYmVyL1xuICAgKiBAcGFyYW0ge1N0cmluZ30gc3Vic2NyaWJlcklkIHN1YnNjcmliZXIgaWRcbiAgICogQHBhcmFtIHtDb3B5RmFjdG9yeVN1YnNjcmliZXJVcGRhdGV9IHN1YnNjcmliZXIgc3Vic2NyaWJlciB1cGRhdGVcbiAgICogQHJldHVybnMge1Byb21pc2V9IHByb21pc2UgcmVzb2x2aW5nIHdoZW4gc3Vic2NyaWJlciBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVTdWJzY3JpYmVyKHN1YnNjcmliZXJJZCwgc3Vic2NyaWJlcikge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCd1cGRhdGVTdWJzY3JpYmVyJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N1YnNjcmliZXJzLyR7c3Vic2NyaWJlcklkfWAsXG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogc3Vic2NyaWJlcixcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgc3Vic2NyaWJlciBjb25maWd1cmF0aW9uLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9yZW1vdmVTdWJzY3JpYmVyL1xuICAgKiBAcGFyYW0ge1N0cmluZ30gc3Vic2NyaWJlcklkIHN1YnNjcmliZXIgaWRcbiAgICogQHBhcmFtIHtDb3B5RmFjdG9yeUNsb3NlSW5zdHJ1Y3Rpb25zfSBbY2xvc2VJbnN0cnVjdGlvbnNdIHN1YnNjcmliZXIgY2xvc2UgaW5zdHJ1Y3Rpb25zXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBwcm9taXNlIHJlc29sdmluZyB3aGVuIHN1YnNjcmliZXIgaXMgcmVtb3ZlZFxuICAgKi9cbiAgcmVtb3ZlU3Vic2NyaWJlcihzdWJzY3JpYmVySWQsIGNsb3NlSW5zdHJ1Y3Rpb25zKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ3JlbW92ZVN1YnNjcmliZXInKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3Vic2NyaWJlcnMvJHtzdWJzY3JpYmVySWR9YCxcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBjbG9zZUluc3RydWN0aW9ucyxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSBzdWJzY3JpcHRpb24gb2Ygc3Vic2NyaWJlciB0byBhIHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9yZW1vdmVTdWJzY3JpcHRpb24vXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJzY3JpYmVySWQgc3Vic2NyaWJlciBpZFxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyYXRlZ3lJZCBzdHJhdGVneSBpZFxuICAgKiBAcGFyYW0ge0NvcHlGYWN0b3J5Q2xvc2VJbnN0cnVjdGlvbnN9IFtjbG9zZUluc3RydWN0aW9uc10gc3Vic2NyaWJlciBjbG9zZSBpbnN0cnVjdGlvbnNcbiAgICogQHJldHVybnMge1Byb21pc2V9IHByb21pc2UgcmVzb2x2aW5nIHdoZW4gc3Vic2NyaWJlciBpcyByZW1vdmVkXG4gICAqL1xuICByZW1vdmVTdWJzY3JpcHRpb24oc3Vic2NyaWJlcklkLCBzdHJhdGVneUlkLCBjbG9zZUluc3RydWN0aW9ucykge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZW1vdmVTdWJzY3JpcHRpb24nKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3Vic2NyaWJlcnMvJHtzdWJzY3JpYmVySWR9L3N1YnNjcmlwdGlvbnMvJHtzdHJhdGVneUlkfWAsXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogY2xvc2VJbnN0cnVjdGlvbnMsXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeShvcHRzKTtcbiAgfVxuXG59XG4iXX0=