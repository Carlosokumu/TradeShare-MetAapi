'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _httpClient = require('../../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _domain = require('../../domain.client');

var _domain2 = _interopRequireDefault(_domain);

var _userLogListener = require('./userLogListener');

var _userLogListener2 = _interopRequireDefault(_userLogListener);

var _transactionListenerManager = require('./transactionListenerManager');

var _transactionListenerManager2 = _interopRequireDefault(_transactionListenerManager);

var _errorHandler = require('../../errorHandler');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {TransactionListenerManager}
 */
describe('TransactionListenerManager', () => {

  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let domainClient;
  let sandbox;
  let clock;
  let transactionListenerManager;
  let getTransactionsStub, listener, callStub;

  let expected = [{
    id: '64664661:close',
    type: 'DEAL_TYPE_SELL',
    time: new Date('2020-08-08T08:57:30.328Z')
  }, {
    id: '64664660:close',
    type: 'DEAL_TYPE_SELL',
    time: new Date('2020-08-08T07:57:30.328Z')
  }];

  let expected2 = [{
    id: '64664663:close',
    type: 'DEAL_TYPE_SELL',
    time: new Date('2020-08-08T10:57:30.328Z')
  }, {
    id: '64664662:close',
    type: 'DEAL_TYPE_SELL',
    time: new Date('2020-08-08T09:57:30.328Z')
  }];

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    clock = sandbox.useFakeTimers({ shouldAdvanceTime: true });
    domainClient = new _domain2.default(httpClient, token);
    transactionListenerManager = new _transactionListenerManager2.default(domainClient);
    getTransactionsStub = sandbox.stub(domainClient, 'requestCopyFactory');
    callStub = _sinon2.default.stub();

    class Listener extends _userLogListener2.default {

      async onTransaction(transactionEvent) {
        console.log('EVENT', transactionEvent);
        callStub(transactionEvent);
      }

    }

    listener = new Listener();
  });

  afterEach(() => {
    sandbox.restore();
    clock.restore();
  });

  describe('Strategy transactions', () => {

    beforeEach(() => {
      getTransactionsStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return [];
      }).withArgs({
        url: '/users/current/strategies/ABCD/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected;
      }).withArgs({
        url: '/users/current/strategies/ABCD/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected2;
      });
    });

    /**
     * @test {TransactionListenerManager#addStrategyTransactionListener}
     */
    it('should add listener', async () => {
      const id = transactionListenerManager.addStrategyTransactionListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.calledWith(callStub, expected2);
      transactionListenerManager.removeStrategyTransactionListener(id);
    });

    /**
     * @test {TransactionListenerManager#addStrategyTransactionListener}
     */
    it('should remove listener', async () => {
      const id = transactionListenerManager.addStrategyTransactionListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(800);
      transactionListenerManager.removeStrategyTransactionListener(id);
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.callCount(callStub, 1);
    });

    /**
     * @test {TransactionListenerManager#addStrategyTransactionListener}
     */
    it('should wait if error returned', async () => {
      getTransactionsStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return [];
      }).withArgs({
        url: '/users/current/strategies/ABCD/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return expected;
      }).onFirstCall().rejects(new Error('test')).onSecondCall().rejects(new Error('test'));
      const id = transactionListenerManager.addStrategyTransactionListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getTransactionsStub, 1);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(2000);
      _sinon2.default.assert.callCount(getTransactionsStub, 3);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(800);
      _sinon2.default.assert.calledWith(callStub, expected);
      transactionListenerManager.removeStrategyTransactionListener(id);
    });

    /**
     * @test {TransactionListenerManager#addStrategyTransactionListener}
     */
    it('should remove listener on not found error', async () => {
      getTransactionsStub.withArgs({
        url: '/users/current/strategies/ABCD/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        throw new _errorHandler.NotFoundError('test');
      });
      transactionListenerManager.addStrategyTransactionListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(100);
      _sinon2.default.assert.callCount(getTransactionsStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1100);
      _sinon2.default.assert.callCount(callStub, 1);
    });
  });

  describe('Subscriber transactions', () => {

    beforeEach(() => {
      getTransactionsStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return [];
      }).withArgs({
        url: '/users/current/subscribers/accountId/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected;
      }).withArgs({
        url: '/users/current/subscribers/accountId/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected2;
      });
    });

    /**
     * @test {TransactionListenerManager#addSubscriberTransactionListener}
     */
    it('should add listener', async () => {
      const id = transactionListenerManager.addSubscriberTransactionListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.calledWith(callStub, expected2);
      transactionListenerManager.removeSubscriberTransactionListener(id);
    });

    /**
     * @test {TransactionListenerManager#addSubscriberTransactionListener}
     */
    it('should remove listener', async () => {
      const id = transactionListenerManager.addSubscriberTransactionListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(800);
      transactionListenerManager.removeSubscriberTransactionListener(id);
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.callCount(callStub, 1);
    });

    /**
     * @test {TransactionListenerManager#addSubscriberTransactionListener}
     */
    it('should wait if error returned', async () => {
      getTransactionsStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return [];
      }).withArgs({
        url: '/users/current/subscribers/accountId/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return expected;
      }).onFirstCall().rejects(new Error('test')).onSecondCall().rejects(new Error('test'));
      const id = transactionListenerManager.addSubscriberTransactionListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getTransactionsStub, 1);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(2000);
      _sinon2.default.assert.callCount(getTransactionsStub, 3);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(800);
      _sinon2.default.assert.calledWith(callStub, expected);
      transactionListenerManager.removeSubscriberTransactionListener(id);
    });

    /**
     * @test {TransactionListenerManager#addSubscriberTransactionListener}
     */
    it('should remove listener on not found error', async () => {
      getTransactionsStub.withArgs({
        url: '/users/current/subscribers/accountId/transactions/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        throw new _errorHandler.NotFoundError('test');
      });
      transactionListenerManager.addSubscriberTransactionListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(100);
      _sinon2.default.assert.callCount(getTransactionsStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getTransactionsStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1100);
      _sinon2.default.assert.callCount(callStub, 1);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L3N0cmVhbWluZy90cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlci5zcGVjLmVzNiJdLCJuYW1lcyI6WyJkZXNjcmliZSIsInRva2VuIiwiaHR0cENsaWVudCIsIkh0dHBDbGllbnQiLCJkb21haW5DbGllbnQiLCJzYW5kYm94IiwiY2xvY2siLCJ0cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciIsImdldFRyYW5zYWN0aW9uc1N0dWIiLCJsaXN0ZW5lciIsImNhbGxTdHViIiwiZXhwZWN0ZWQiLCJpZCIsInR5cGUiLCJ0aW1lIiwiRGF0ZSIsImV4cGVjdGVkMiIsImJlZm9yZSIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImJlZm9yZUVhY2giLCJ1c2VGYWtlVGltZXJzIiwic2hvdWxkQWR2YW5jZVRpbWUiLCJEb21haW5DbGllbnQiLCJUcmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciIsInN0dWIiLCJMaXN0ZW5lciIsIlRyYW5zYWN0aW9uTGlzdGVuZXIiLCJvblRyYW5zYWN0aW9uIiwidHJhbnNhY3Rpb25FdmVudCIsImNvbnNvbGUiLCJsb2ciLCJhZnRlckVhY2giLCJyZXN0b3JlIiwiY2FsbHNGYWtlIiwib3B0cyIsInJlcyIsInNldFRpbWVvdXQiLCJ3aXRoQXJncyIsInVybCIsIm1ldGhvZCIsInFzIiwic3RhcnRUaW1lIiwibGltaXQiLCJoZWFkZXJzIiwianNvbiIsIml0IiwiYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyIiwidGlja0FzeW5jIiwiYXNzZXJ0IiwiY2FsbGVkV2l0aCIsInJlbW92ZVN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lciIsImNhbGxDb3VudCIsIm9uRmlyc3RDYWxsIiwicmVqZWN0cyIsIkVycm9yIiwib25TZWNvbmRDYWxsIiwibm90Q2FsbGVkIiwiTm90Rm91bmRFcnJvciIsImFkZFN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyIiwicmVtb3ZlU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7O0FBR0FBLFNBQVMsNEJBQVQsRUFBdUMsTUFBTTs7QUFFM0MsUUFBTUMsUUFBUSxxQkFBZDtBQUNBLE1BQUlDLGFBQWEsSUFBSUMsb0JBQUosRUFBakI7QUFDQSxNQUFJQyxZQUFKO0FBQ0EsTUFBSUMsT0FBSjtBQUNBLE1BQUlDLEtBQUo7QUFDQSxNQUFJQywwQkFBSjtBQUNBLE1BQUlDLG1CQUFKLEVBQXlCQyxRQUF6QixFQUFtQ0MsUUFBbkM7O0FBRUEsTUFBSUMsV0FBVyxDQUFDO0FBQ2RDLFFBQUksZ0JBRFU7QUFFZEMsVUFBTSxnQkFGUTtBQUdkQyxVQUFNLElBQUlDLElBQUosQ0FBUywwQkFBVDtBQUhRLEdBQUQsRUFLZjtBQUNFSCxRQUFJLGdCQUROO0FBRUVDLFVBQU0sZ0JBRlI7QUFHRUMsVUFBTSxJQUFJQyxJQUFKLENBQVMsMEJBQVQ7QUFIUixHQUxlLENBQWY7O0FBV0EsTUFBSUMsWUFBWSxDQUFDO0FBQ2ZKLFFBQUksZ0JBRFc7QUFFZkMsVUFBTSxnQkFGUztBQUdmQyxVQUFNLElBQUlDLElBQUosQ0FBUywwQkFBVDtBQUhTLEdBQUQsRUFLaEI7QUFDRUgsUUFBSSxnQkFETjtBQUVFQyxVQUFNLGdCQUZSO0FBR0VDLFVBQU0sSUFBSUMsSUFBSixDQUFTLDBCQUFUO0FBSFIsR0FMZ0IsQ0FBaEI7O0FBV0FFLFNBQU8sTUFBTTtBQUNYWixjQUFVYSxnQkFBTUMsYUFBTixFQUFWO0FBQ0QsR0FGRDs7QUFJQUMsYUFBVyxNQUFNO0FBQ2ZkLFlBQVFELFFBQVFnQixhQUFSLENBQXNCLEVBQUNDLG1CQUFtQixJQUFwQixFQUF0QixDQUFSO0FBQ0FsQixtQkFBZSxJQUFJbUIsZ0JBQUosQ0FBaUJyQixVQUFqQixFQUE2QkQsS0FBN0IsQ0FBZjtBQUNBTSxpQ0FBNkIsSUFBSWlCLG9DQUFKLENBQStCcEIsWUFBL0IsQ0FBN0I7QUFDQUksMEJBQXNCSCxRQUFRb0IsSUFBUixDQUFhckIsWUFBYixFQUEyQixvQkFBM0IsQ0FBdEI7QUFDQU0sZUFBV1EsZ0JBQU1PLElBQU4sRUFBWDs7QUFFQSxVQUFNQyxRQUFOLFNBQXVCQyx5QkFBdkIsQ0FBMkM7O0FBRXpDLFlBQU1DLGFBQU4sQ0FBb0JDLGdCQUFwQixFQUFzQztBQUNwQ0MsZ0JBQVFDLEdBQVIsQ0FBWSxPQUFaLEVBQXFCRixnQkFBckI7QUFDQW5CLGlCQUFTbUIsZ0JBQVQ7QUFDRDs7QUFMd0M7O0FBUzNDcEIsZUFBVyxJQUFJaUIsUUFBSixFQUFYO0FBQ0QsR0FqQkQ7O0FBbUJBTSxZQUFVLE1BQU07QUFDZDNCLFlBQVE0QixPQUFSO0FBQ0EzQixVQUFNMkIsT0FBTjtBQUNELEdBSEQ7O0FBS0FqQyxXQUFTLHVCQUFULEVBQWtDLE1BQU07O0FBRXRDb0IsZUFBVyxNQUFNO0FBQ2ZaLDBCQUNHMEIsU0FESCxDQUNhLE1BQU9DLElBQVAsSUFBZ0I7QUFDekIsY0FBTSxzQkFBWUMsT0FBT0MsV0FBV0QsR0FBWCxFQUFnQixJQUFoQixDQUFuQixDQUFOO0FBQ0EsZUFBTyxFQUFQO0FBQ0QsT0FKSCxFQUtHRSxRQUxILENBS1k7QUFDUkMsYUFBSyxvREFERztBQUVSQyxnQkFBUSxLQUZBO0FBR1JDLFlBQUk7QUFDRkMscUJBQVcsSUFBSTNCLElBQUosQ0FBUywwQkFBVCxDQURUO0FBRUY0QixpQkFBTztBQUZMLFNBSEk7QUFPUkMsaUJBQVM7QUFDUCx3QkFBYzNDO0FBRFAsU0FQRDtBQVVSNEMsY0FBTTtBQVZFLE9BTFosRUFnQktYLFNBaEJMLENBZ0JlLE1BQU9DLElBQVAsSUFBZ0I7QUFDM0IsY0FBTSxzQkFBWUMsT0FBT0MsV0FBV0QsR0FBWCxFQUFnQixJQUFoQixDQUFuQixDQUFOO0FBQ0EsZUFBT3pCLFFBQVA7QUFDRCxPQW5CSCxFQW9CRzJCLFFBcEJILENBb0JZO0FBQ1JDLGFBQUssb0RBREc7QUFFUkMsZ0JBQVEsS0FGQTtBQUdSQyxZQUFJO0FBQ0ZDLHFCQUFXLElBQUkzQixJQUFKLENBQVMsMEJBQVQsQ0FEVDtBQUVGNEIsaUJBQU87QUFGTCxTQUhJO0FBT1JDLGlCQUFTO0FBQ1Asd0JBQWMzQztBQURQLFNBUEQ7QUFVUjRDLGNBQU07QUFWRSxPQXBCWixFQStCS1gsU0EvQkwsQ0ErQmUsTUFBT0MsSUFBUCxJQUFnQjtBQUMzQixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLElBQWhCLENBQW5CLENBQU47QUFDQSxlQUFPcEIsU0FBUDtBQUNELE9BbENIO0FBbUNELEtBcENEOztBQXNDQTs7O0FBR0E4QixPQUFHLHFCQUFILEVBQTBCLFlBQVk7QUFDcEMsWUFBTWxDLEtBQUtMLDJCQUEyQndDLDhCQUEzQixDQUEwRHRDLFFBQTFELEVBQW9FLE1BQXBFLEVBQ1QsSUFBSU0sSUFBSixDQUFTLDBCQUFULENBRFMsQ0FBWDtBQUVBLFlBQU1ULE1BQU0wQyxTQUFOLENBQWdCLElBQWhCLENBQU47QUFDQTlCLHNCQUFNK0IsTUFBTixDQUFhQyxVQUFiLENBQXdCeEMsUUFBeEIsRUFBa0NDLFFBQWxDO0FBQ0FPLHNCQUFNK0IsTUFBTixDQUFhQyxVQUFiLENBQXdCeEMsUUFBeEIsRUFBa0NNLFNBQWxDO0FBQ0FULGlDQUEyQjRDLGlDQUEzQixDQUE2RHZDLEVBQTdEO0FBQ0QsS0FQRDs7QUFTQTs7O0FBR0FrQyxPQUFHLHdCQUFILEVBQTZCLFlBQVk7QUFDdkMsWUFBTWxDLEtBQUtMLDJCQUEyQndDLDhCQUEzQixDQUEwRHRDLFFBQTFELEVBQW9FLE1BQXBFLEVBQ1QsSUFBSU0sSUFBSixDQUFTLDBCQUFULENBRFMsQ0FBWDtBQUVBLFlBQU1ULE1BQU0wQyxTQUFOLENBQWdCLEdBQWhCLENBQU47QUFDQXpDLGlDQUEyQjRDLGlDQUEzQixDQUE2RHZDLEVBQTdEO0FBQ0EsWUFBTU4sTUFBTTBDLFNBQU4sQ0FBZ0IsSUFBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFDLFVBQWIsQ0FBd0J4QyxRQUF4QixFQUFrQ0MsUUFBbEM7QUFDQU8sc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUIxQyxRQUF2QixFQUFpQyxDQUFqQztBQUNELEtBUkQ7O0FBVUE7OztBQUdBb0MsT0FBRywrQkFBSCxFQUFvQyxZQUFZO0FBQzlDdEMsMEJBQ0cwQixTQURILENBQ2EsTUFBT0MsSUFBUCxJQUFnQjtBQUN6QixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLEdBQWhCLENBQW5CLENBQU47QUFDQSxlQUFPLEVBQVA7QUFDRCxPQUpILEVBS0dFLFFBTEgsQ0FLWTtBQUNSQyxhQUFLLG9EQURHO0FBRVJDLGdCQUFRLEtBRkE7QUFHUkMsWUFBSTtBQUNGQyxxQkFBVyxJQUFJM0IsSUFBSixDQUFTLDBCQUFULENBRFQ7QUFFRjRCLGlCQUFPO0FBRkwsU0FISTtBQU9SQyxpQkFBUztBQUNQLHdCQUFjM0M7QUFEUCxTQVBEO0FBVVI0QyxjQUFNO0FBVkUsT0FMWixFQWdCS1gsU0FoQkwsQ0FnQmUsTUFBT0MsSUFBUCxJQUFnQjtBQUMzQixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLEdBQWhCLENBQW5CLENBQU47QUFDQSxlQUFPekIsUUFBUDtBQUNELE9BbkJILEVBb0JHMEMsV0FwQkgsR0FvQmlCQyxPQXBCakIsQ0FvQnlCLElBQUlDLEtBQUosQ0FBVSxNQUFWLENBcEJ6QixFQXFCR0MsWUFyQkgsR0FxQmtCRixPQXJCbEIsQ0FxQjBCLElBQUlDLEtBQUosQ0FBVSxNQUFWLENBckIxQjtBQXNCQSxZQUFNM0MsS0FBS0wsMkJBQTJCd0MsOEJBQTNCLENBQTBEdEMsUUFBMUQsRUFBb0UsTUFBcEUsRUFDVCxJQUFJTSxJQUFKLENBQVMsMEJBQVQsQ0FEUyxDQUFYO0FBRUEsWUFBTVQsTUFBTTBDLFNBQU4sQ0FBZ0IsR0FBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUI1QyxtQkFBdkIsRUFBNEMsQ0FBNUM7QUFDQVUsc0JBQU0rQixNQUFOLENBQWFRLFNBQWIsQ0FBdUIvQyxRQUF2QjtBQUNBLFlBQU1KLE1BQU0wQyxTQUFOLENBQWdCLEdBQWhCLENBQU47QUFDQTlCLHNCQUFNK0IsTUFBTixDQUFhRyxTQUFiLENBQXVCNUMsbUJBQXZCLEVBQTRDLENBQTVDO0FBQ0FVLHNCQUFNK0IsTUFBTixDQUFhUSxTQUFiLENBQXVCL0MsUUFBdkI7QUFDQSxZQUFNSixNQUFNMEMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjVDLG1CQUF2QixFQUE0QyxDQUE1QztBQUNBVSxzQkFBTStCLE1BQU4sQ0FBYVEsU0FBYixDQUF1Qi9DLFFBQXZCO0FBQ0EsWUFBTUosTUFBTTBDLFNBQU4sQ0FBZ0IsR0FBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFDLFVBQWIsQ0FBd0J4QyxRQUF4QixFQUFrQ0MsUUFBbEM7QUFDQUosaUNBQTJCNEMsaUNBQTNCLENBQTZEdkMsRUFBN0Q7QUFDRCxLQXJDRDs7QUF1Q0E7OztBQUdBa0MsT0FBRywyQ0FBSCxFQUFnRCxZQUFZO0FBQzFEdEMsMEJBQ0c4QixRQURILENBQ1k7QUFDUkMsYUFBSyxvREFERztBQUVSQyxnQkFBUSxLQUZBO0FBR1JDLFlBQUk7QUFDRkMscUJBQVcsSUFBSTNCLElBQUosQ0FBUywwQkFBVCxDQURUO0FBRUY0QixpQkFBTztBQUZMLFNBSEk7QUFPUkMsaUJBQVM7QUFDUCx3QkFBYzNDO0FBRFAsU0FQRDtBQVVSNEMsY0FBTTtBQVZFLE9BRFosRUFZS1gsU0FaTCxDQVllLE1BQU9DLElBQVAsSUFBZ0I7QUFDM0IsY0FBTSxzQkFBWUMsT0FBT0MsV0FBV0QsR0FBWCxFQUFnQixJQUFoQixDQUFuQixDQUFOO0FBQ0EsY0FBTSxJQUFJc0IsMkJBQUosQ0FBa0IsTUFBbEIsQ0FBTjtBQUNELE9BZkg7QUFnQkFuRCxpQ0FBMkJ3Qyw4QkFBM0IsQ0FBMER0QyxRQUExRCxFQUFvRSxNQUFwRSxFQUNFLElBQUlNLElBQUosQ0FBUywwQkFBVCxDQURGO0FBRUEsWUFBTVQsTUFBTTBDLFNBQU4sQ0FBZ0IsR0FBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUI1QyxtQkFBdkIsRUFBNEMsQ0FBNUM7QUFDQSxZQUFNRixNQUFNMEMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjVDLG1CQUF2QixFQUE0QyxDQUE1QztBQUNBVSxzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjFDLFFBQXZCLEVBQWlDLENBQWpDO0FBQ0EsWUFBTUosTUFBTTBDLFNBQU4sQ0FBZ0IsSUFBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUI1QyxtQkFBdkIsRUFBNEMsQ0FBNUM7QUFDQVUsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUIxQyxRQUF2QixFQUFpQyxDQUFqQztBQUNBLFlBQU1KLE1BQU0wQyxTQUFOLENBQWdCLElBQWhCLENBQU47QUFDQTlCLHNCQUFNK0IsTUFBTixDQUFhRyxTQUFiLENBQXVCMUMsUUFBdkIsRUFBaUMsQ0FBakM7QUFDRCxLQTdCRDtBQStCRCxHQTdJRDs7QUErSUFWLFdBQVMseUJBQVQsRUFBb0MsTUFBTTs7QUFFeENvQixlQUFXLE1BQU07QUFDZlosMEJBQ0cwQixTQURILENBQ2EsTUFBT0MsSUFBUCxJQUFnQjtBQUN6QixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLElBQWhCLENBQW5CLENBQU47QUFDQSxlQUFPLEVBQVA7QUFDRCxPQUpILEVBS0dFLFFBTEgsQ0FLWTtBQUNSQyxhQUFLLDBEQURHO0FBRVJDLGdCQUFRLEtBRkE7QUFHUkMsWUFBSTtBQUNGQyxxQkFBVyxJQUFJM0IsSUFBSixDQUFTLDBCQUFULENBRFQ7QUFFRjRCLGlCQUFPO0FBRkwsU0FISTtBQU9SQyxpQkFBUztBQUNQLHdCQUFjM0M7QUFEUCxTQVBEO0FBVVI0QyxjQUFNO0FBVkUsT0FMWixFQWdCS1gsU0FoQkwsQ0FnQmUsTUFBT0MsSUFBUCxJQUFnQjtBQUMzQixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLElBQWhCLENBQW5CLENBQU47QUFDQSxlQUFPekIsUUFBUDtBQUNELE9BbkJILEVBb0JHMkIsUUFwQkgsQ0FvQlk7QUFDUkMsYUFBSywwREFERztBQUVSQyxnQkFBUSxLQUZBO0FBR1JDLFlBQUk7QUFDRkMscUJBQVcsSUFBSTNCLElBQUosQ0FBUywwQkFBVCxDQURUO0FBRUY0QixpQkFBTztBQUZMLFNBSEk7QUFPUkMsaUJBQVM7QUFDUCx3QkFBYzNDO0FBRFAsU0FQRDtBQVVSNEMsY0FBTTtBQVZFLE9BcEJaLEVBK0JLWCxTQS9CTCxDQStCZSxNQUFPQyxJQUFQLElBQWdCO0FBQzNCLGNBQU0sc0JBQVlDLE9BQU9DLFdBQVdELEdBQVgsRUFBZ0IsSUFBaEIsQ0FBbkIsQ0FBTjtBQUNBLGVBQU9wQixTQUFQO0FBQ0QsT0FsQ0g7QUFtQ0QsS0FwQ0Q7O0FBc0NBOzs7QUFHQThCLE9BQUcscUJBQUgsRUFBMEIsWUFBWTtBQUNwQyxZQUFNbEMsS0FBS0wsMkJBQTJCb0QsZ0NBQTNCLENBQTREbEQsUUFBNUQsRUFBc0UsV0FBdEUsRUFDVCxJQUFJTSxJQUFKLENBQVMsMEJBQVQsQ0FEUyxDQUFYO0FBRUEsWUFBTVQsTUFBTTBDLFNBQU4sQ0FBZ0IsSUFBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFDLFVBQWIsQ0FBd0J4QyxRQUF4QixFQUFrQ0MsUUFBbEM7QUFDQU8sc0JBQU0rQixNQUFOLENBQWFDLFVBQWIsQ0FBd0J4QyxRQUF4QixFQUFrQ00sU0FBbEM7QUFDQVQsaUNBQTJCcUQsbUNBQTNCLENBQStEaEQsRUFBL0Q7QUFDRCxLQVBEOztBQVNBOzs7QUFHQWtDLE9BQUcsd0JBQUgsRUFBNkIsWUFBWTtBQUN2QyxZQUFNbEMsS0FBS0wsMkJBQTJCb0QsZ0NBQTNCLENBQTREbEQsUUFBNUQsRUFBc0UsV0FBdEUsRUFDVCxJQUFJTSxJQUFKLENBQVMsMEJBQVQsQ0FEUyxDQUFYO0FBRUEsWUFBTVQsTUFBTTBDLFNBQU4sQ0FBZ0IsR0FBaEIsQ0FBTjtBQUNBekMsaUNBQTJCcUQsbUNBQTNCLENBQStEaEQsRUFBL0Q7QUFDQSxZQUFNTixNQUFNMEMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUMsVUFBYixDQUF3QnhDLFFBQXhCLEVBQWtDQyxRQUFsQztBQUNBTyxzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjFDLFFBQXZCLEVBQWlDLENBQWpDO0FBQ0QsS0FSRDs7QUFVQTs7O0FBR0FvQyxPQUFHLCtCQUFILEVBQW9DLFlBQVk7QUFDOUN0QywwQkFDRzBCLFNBREgsQ0FDYSxNQUFPQyxJQUFQLElBQWdCO0FBQ3pCLGNBQU0sc0JBQVlDLE9BQU9DLFdBQVdELEdBQVgsRUFBZ0IsR0FBaEIsQ0FBbkIsQ0FBTjtBQUNBLGVBQU8sRUFBUDtBQUNELE9BSkgsRUFLR0UsUUFMSCxDQUtZO0FBQ1JDLGFBQUssMERBREc7QUFFUkMsZ0JBQVEsS0FGQTtBQUdSQyxZQUFJO0FBQ0ZDLHFCQUFXLElBQUkzQixJQUFKLENBQVMsMEJBQVQsQ0FEVDtBQUVGNEIsaUJBQU87QUFGTCxTQUhJO0FBT1JDLGlCQUFTO0FBQ1Asd0JBQWMzQztBQURQLFNBUEQ7QUFVUjRDLGNBQU07QUFWRSxPQUxaLEVBZ0JLWCxTQWhCTCxDQWdCZSxNQUFPQyxJQUFQLElBQWdCO0FBQzNCLGNBQU0sc0JBQVlDLE9BQU9DLFdBQVdELEdBQVgsRUFBZ0IsR0FBaEIsQ0FBbkIsQ0FBTjtBQUNBLGVBQU96QixRQUFQO0FBQ0QsT0FuQkgsRUFvQkcwQyxXQXBCSCxHQW9CaUJDLE9BcEJqQixDQW9CeUIsSUFBSUMsS0FBSixDQUFVLE1BQVYsQ0FwQnpCLEVBcUJHQyxZQXJCSCxHQXFCa0JGLE9BckJsQixDQXFCMEIsSUFBSUMsS0FBSixDQUFVLE1BQVYsQ0FyQjFCO0FBc0JBLFlBQU0zQyxLQUFLTCwyQkFBMkJvRCxnQ0FBM0IsQ0FBNERsRCxRQUE1RCxFQUFzRSxXQUF0RSxFQUNULElBQUlNLElBQUosQ0FBUywwQkFBVCxDQURTLENBQVg7QUFFQSxZQUFNVCxNQUFNMEMsU0FBTixDQUFnQixHQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjVDLG1CQUF2QixFQUE0QyxDQUE1QztBQUNBVSxzQkFBTStCLE1BQU4sQ0FBYVEsU0FBYixDQUF1Qi9DLFFBQXZCO0FBQ0EsWUFBTUosTUFBTTBDLFNBQU4sQ0FBZ0IsR0FBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUI1QyxtQkFBdkIsRUFBNEMsQ0FBNUM7QUFDQVUsc0JBQU0rQixNQUFOLENBQWFRLFNBQWIsQ0FBdUIvQyxRQUF2QjtBQUNBLFlBQU1KLE1BQU0wQyxTQUFOLENBQWdCLElBQWhCLENBQU47QUFDQTlCLHNCQUFNK0IsTUFBTixDQUFhRyxTQUFiLENBQXVCNUMsbUJBQXZCLEVBQTRDLENBQTVDO0FBQ0FVLHNCQUFNK0IsTUFBTixDQUFhUSxTQUFiLENBQXVCL0MsUUFBdkI7QUFDQSxZQUFNSixNQUFNMEMsU0FBTixDQUFnQixHQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUMsVUFBYixDQUF3QnhDLFFBQXhCLEVBQWtDQyxRQUFsQztBQUNBSixpQ0FBMkJxRCxtQ0FBM0IsQ0FBK0RoRCxFQUEvRDtBQUNELEtBckNEOztBQXVDQTs7O0FBR0FrQyxPQUFHLDJDQUFILEVBQWdELFlBQVk7QUFDMUR0QywwQkFDRzhCLFFBREgsQ0FDWTtBQUNSQyxhQUFLLDBEQURHO0FBRVJDLGdCQUFRLEtBRkE7QUFHUkMsWUFBSTtBQUNGQyxxQkFBVyxJQUFJM0IsSUFBSixDQUFTLDBCQUFULENBRFQ7QUFFRjRCLGlCQUFPO0FBRkwsU0FISTtBQU9SQyxpQkFBUztBQUNQLHdCQUFjM0M7QUFEUCxTQVBEO0FBVVI0QyxjQUFNO0FBVkUsT0FEWixFQVlLWCxTQVpMLENBWWUsTUFBT0MsSUFBUCxJQUFnQjtBQUMzQixjQUFNLHNCQUFZQyxPQUFPQyxXQUFXRCxHQUFYLEVBQWdCLElBQWhCLENBQW5CLENBQU47QUFDQSxjQUFNLElBQUlzQiwyQkFBSixDQUFrQixNQUFsQixDQUFOO0FBQ0QsT0FmSDtBQWdCQW5ELGlDQUEyQm9ELGdDQUEzQixDQUE0RGxELFFBQTVELEVBQXNFLFdBQXRFLEVBQ0UsSUFBSU0sSUFBSixDQUFTLDBCQUFULENBREY7QUFFQSxZQUFNVCxNQUFNMEMsU0FBTixDQUFnQixHQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjVDLG1CQUF2QixFQUE0QyxDQUE1QztBQUNBLFlBQU1GLE1BQU0wQyxTQUFOLENBQWdCLElBQWhCLENBQU47QUFDQTlCLHNCQUFNK0IsTUFBTixDQUFhRyxTQUFiLENBQXVCNUMsbUJBQXZCLEVBQTRDLENBQTVDO0FBQ0FVLHNCQUFNK0IsTUFBTixDQUFhRyxTQUFiLENBQXVCMUMsUUFBdkIsRUFBaUMsQ0FBakM7QUFDQSxZQUFNSixNQUFNMEMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E5QixzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjVDLG1CQUF2QixFQUE0QyxDQUE1QztBQUNBVSxzQkFBTStCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjFDLFFBQXZCLEVBQWlDLENBQWpDO0FBQ0EsWUFBTUosTUFBTTBDLFNBQU4sQ0FBZ0IsSUFBaEIsQ0FBTjtBQUNBOUIsc0JBQU0rQixNQUFOLENBQWFHLFNBQWIsQ0FBdUIxQyxRQUF2QixFQUFpQyxDQUFqQztBQUNELEtBN0JEO0FBK0JELEdBN0lEO0FBK0lELENBMVZEIiwiZmlsZSI6InRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBIdHRwQ2xpZW50IGZyb20gJy4uLy4uL2h0dHBDbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBEb21haW5DbGllbnQgZnJvbSAnLi4vLi4vZG9tYWluLmNsaWVudCc7XG5pbXBvcnQgVHJhbnNhY3Rpb25MaXN0ZW5lciBmcm9tICcuL3VzZXJMb2dMaXN0ZW5lcic7XG5pbXBvcnQgVHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIgZnJvbSAnLi90cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlcic7XG5pbXBvcnQge05vdEZvdW5kRXJyb3J9IGZyb20gJy4uLy4uL2Vycm9ySGFuZGxlcic7XG5cbi8qKlxuICogQHRlc3Qge1RyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyfVxuICovXG5kZXNjcmliZSgnVHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXInLCAoKSA9PiB7XG5cbiAgY29uc3QgdG9rZW4gPSAnaGVhZGVyLnBheWxvYWQuc2lnbic7XG4gIGxldCBodHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTtcbiAgbGV0IGRvbWFpbkNsaWVudDtcbiAgbGV0IHNhbmRib3g7XG4gIGxldCBjbG9jaztcbiAgbGV0IHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyO1xuICBsZXQgZ2V0VHJhbnNhY3Rpb25zU3R1YiwgbGlzdGVuZXIsIGNhbGxTdHViO1xuXG4gIGxldCBleHBlY3RlZCA9IFt7XG4gICAgaWQ6ICc2NDY2NDY2MTpjbG9zZScsXG4gICAgdHlwZTogJ0RFQUxfVFlQRV9TRUxMJyxcbiAgICB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjhaJyksXG4gIH0sXG4gIHtcbiAgICBpZDogJzY0NjY0NjYwOmNsb3NlJyxcbiAgICB0eXBlOiAnREVBTF9UWVBFX1NFTEwnLFxuICAgIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA3OjU3OjMwLjMyOFonKSxcbiAgfV07XG5cbiAgbGV0IGV4cGVjdGVkMiA9IFt7XG4gICAgaWQ6ICc2NDY2NDY2MzpjbG9zZScsXG4gICAgdHlwZTogJ0RFQUxfVFlQRV9TRUxMJyxcbiAgICB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQxMDo1NzozMC4zMjhaJyksXG4gIH0sXG4gIHtcbiAgICBpZDogJzY0NjY0NjYyOmNsb3NlJyxcbiAgICB0eXBlOiAnREVBTF9UWVBFX1NFTEwnLFxuICAgIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA5OjU3OjMwLjMyOFonKSxcbiAgfV07XG5cbiAgYmVmb3JlKCgpID0+IHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjbG9jayA9IHNhbmRib3gudXNlRmFrZVRpbWVycyh7c2hvdWxkQWR2YW5jZVRpbWU6IHRydWV9KTtcbiAgICBkb21haW5DbGllbnQgPSBuZXcgRG9tYWluQ2xpZW50KGh0dHBDbGllbnQsIHRva2VuKTtcbiAgICB0cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciA9IG5ldyBUcmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlcihkb21haW5DbGllbnQpO1xuICAgIGdldFRyYW5zYWN0aW9uc1N0dWIgPSBzYW5kYm94LnN0dWIoZG9tYWluQ2xpZW50LCAncmVxdWVzdENvcHlGYWN0b3J5Jyk7XG4gICAgY2FsbFN0dWIgPSBzaW5vbi5zdHViKCk7XG5cbiAgICBjbGFzcyBMaXN0ZW5lciBleHRlbmRzIFRyYW5zYWN0aW9uTGlzdGVuZXIge1xuXG4gICAgICBhc3luYyBvblRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uRXZlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0VWRU5UJywgdHJhbnNhY3Rpb25FdmVudCk7XG4gICAgICAgIGNhbGxTdHViKHRyYW5zYWN0aW9uRXZlbnQpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgbGlzdGVuZXIgPSBuZXcgTGlzdGVuZXIoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICBjbG9jay5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdHJhdGVneSB0cmFuc2FjdGlvbnMnLCAoKSA9PiB7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGdldFRyYW5zYWN0aW9uc1N0dWJcbiAgICAgICAgLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMTAwMCkpO1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSlcbiAgICAgICAgLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdHJhdGVnaWVzL0FCQ0QvdHJhbnNhY3Rpb25zL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQ7XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3RyYXRlZ2llcy9BQkNEL3RyYW5zYWN0aW9ucy9zdHJlYW0nLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcXM6IHtcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDg6NTc6MzAuMzI5WicpLFxuICAgICAgICAgICAgbGltaXQ6IDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgfSkuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCAxMDAwKSk7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdGVkMjtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgYWRkIGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSB0cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlci5hZGRTdHJhdGVneVRyYW5zYWN0aW9uTGlzdGVuZXIobGlzdGVuZXIsICdBQkNEJyxcbiAgICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygyMjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBleHBlY3RlZCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgZXhwZWN0ZWQyKTtcbiAgICAgIHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcihpZCk7XG4gICAgfSk7XG4gIFxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciNhZGRTdHJhdGVneVRyYW5zYWN0aW9uTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpZCA9IHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0ZW5lciwgJ0FCQ0QnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDgwMCk7XG4gICAgICB0cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlci5yZW1vdmVTdHJhdGVneVRyYW5zYWN0aW9uTGlzdGVuZXIoaWQpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDIyMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgIH0pO1xuICBcbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgd2FpdCBpZiBlcnJvciByZXR1cm5lZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGdldFRyYW5zYWN0aW9uc1N0dWJcbiAgICAgICAgLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgNTAwKSk7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9KVxuICAgICAgICAud2l0aEFyZ3Moe1xuICAgICAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvQUJDRC90cmFuc2FjdGlvbnMvc3RyZWFtJyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgICAgIGxpbWl0OiAxMDAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgIH0pLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgNTAwKSk7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdGVkO1xuICAgICAgICB9KVxuICAgICAgICAub25GaXJzdENhbGwoKS5yZWplY3RzKG5ldyBFcnJvcigndGVzdCcpKVxuICAgICAgICAub25TZWNvbmRDYWxsKCkucmVqZWN0cyhuZXcgRXJyb3IoJ3Rlc3QnKSk7XG4gICAgICBjb25zdCBpZCA9IHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0ZW5lciwgJ0FCQ0QnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDYwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFRyYW5zYWN0aW9uc1N0dWIsIDEpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChjYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoNjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VHJhbnNhY3Rpb25zU3R1YiwgMik7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygyMDAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VHJhbnNhY3Rpb25zU3R1YiwgMyk7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg4MDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcihpZCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGxpc3RlbmVyIG9uIG5vdCBmb3VuZCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGdldFRyYW5zYWN0aW9uc1N0dWJcbiAgICAgICAgLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdHJhdGVnaWVzL0FCQ0QvdHJhbnNhY3Rpb25zL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjlaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcigndGVzdCcpO1xuICAgICAgICB9KTtcbiAgICAgIHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0ZW5lciwgJ0FCQ0QnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDEwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFRyYW5zYWN0aW9uc1N0dWIsIDEpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDEwMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRUcmFuc2FjdGlvbnNTdHViLCAyKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDEwMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRUcmFuc2FjdGlvbnNTdHViLCAyKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDExMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChjYWxsU3R1YiwgMSk7XG4gICAgfSk7XG4gICAgXG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdWJzY3JpYmVyIHRyYW5zYWN0aW9ucycsICgpID0+IHtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgZ2V0VHJhbnNhY3Rpb25zU3R1YlxuICAgICAgICAuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCAxMDAwKSk7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9KVxuICAgICAgICAud2l0aEFyZ3Moe1xuICAgICAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2FjY291bnRJZC90cmFuc2FjdGlvbnMvc3RyZWFtJyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgICAgIGxpbWl0OiAxMDAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgIH0pLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMTAwMCkpO1xuICAgICAgICAgIHJldHVybiBleHBlY3RlZDtcbiAgICAgICAgfSlcbiAgICAgICAgLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy9hY2NvdW50SWQvdHJhbnNhY3Rpb25zL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjlaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQyO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciNhZGRTdWJzY3JpYmVyVHJhbnNhY3Rpb25MaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBsaXN0ZW5lcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIuYWRkU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIobGlzdGVuZXIsICdhY2NvdW50SWQnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDIyMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBleHBlY3RlZDIpO1xuICAgICAgdHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIucmVtb3ZlU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIoaWQpO1xuICAgIH0pO1xuICBcbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIjYWRkU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpZCA9IHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLmFkZFN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyKGxpc3RlbmVyLCAnYWNjb3VudElkJyxcbiAgICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg4MDApO1xuICAgICAgdHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIucmVtb3ZlU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIoaWQpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDIyMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgIH0pO1xuICBcbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIjYWRkU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCB3YWl0IGlmIGVycm9yIHJldHVybmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZ2V0VHJhbnNhY3Rpb25zU3R1YlxuICAgICAgICAuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCA1MDApKTtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3RyYW5zYWN0aW9ucy9zdHJlYW0nLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcXM6IHtcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpLFxuICAgICAgICAgICAgbGltaXQ6IDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgfSkuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCA1MDApKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQ7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbkZpcnN0Q2FsbCgpLnJlamVjdHMobmV3IEVycm9yKCd0ZXN0JykpXG4gICAgICAgIC5vblNlY29uZENhbGwoKS5yZWplY3RzKG5ldyBFcnJvcigndGVzdCcpKTtcbiAgICAgIGNvbnN0IGlkID0gdHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIuYWRkU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIobGlzdGVuZXIsICdhY2NvdW50SWQnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDYwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFRyYW5zYWN0aW9uc1N0dWIsIDEpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChjYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoNjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VHJhbnNhY3Rpb25zU3R1YiwgMik7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygyMDAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VHJhbnNhY3Rpb25zU3R1YiwgMyk7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg4MDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHRyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyKGlkKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciNhZGRTdWJzY3JpYmVyVHJhbnNhY3Rpb25MaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBsaXN0ZW5lciBvbiBub3QgZm91bmQgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRUcmFuc2FjdGlvbnNTdHViXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3RyYW5zYWN0aW9ucy9zdHJlYW0nLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcXM6IHtcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDg6NTc6MzAuMzI5WicpLFxuICAgICAgICAgICAgbGltaXQ6IDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgfSkuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCAxMDAwKSk7XG4gICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXJyb3IoJ3Rlc3QnKTtcbiAgICAgICAgfSk7XG4gICAgICB0cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlci5hZGRTdWJzY3JpYmVyVHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0ZW5lciwgJ2FjY291bnRJZCcsXG4gICAgICAgIG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VHJhbnNhY3Rpb25zU3R1YiwgMSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTAwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFRyYW5zYWN0aW9uc1N0dWIsIDIpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChjYWxsU3R1YiwgMSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTAwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFRyYW5zYWN0aW9uc1N0dWIsIDIpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChjYWxsU3R1YiwgMSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTEwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGNhbGxTdHViLCAxKTtcbiAgICB9KTtcbiAgICBcbiAgfSk7XG5cbn0pO1xuIl19