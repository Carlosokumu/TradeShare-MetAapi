'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _httpClient = require('../../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _domain = require('../../domain.client');

var _domain2 = _interopRequireDefault(_domain);

var _userLogListener = require('./userLogListener');

var _userLogListener2 = _interopRequireDefault(_userLogListener);

var _userLogListenerManager = require('./userLogListenerManager');

var _userLogListenerManager2 = _interopRequireDefault(_userLogListenerManager);

var _errorHandler = require('../../errorHandler');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {UserLogListenerManager}
 */
describe('UserLogListenerManager', () => {

  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let domainClient;
  let sandbox;
  let clock;
  let userLogListenerManager;
  let getUserLogStub, listener, callStub;

  let expected = [{
    time: new Date('2020-08-08T08:57:30.328Z'),
    level: 'INFO',
    message: 'message1'
  }, {
    time: new Date('2020-08-08T07:57:30.328Z'),
    level: 'INFO',
    message: 'message0'
  }];

  let expected2 = [{
    time: new Date('2020-08-08T10:57:30.328Z'),
    level: 'INFO',
    message: 'message3'
  }, {
    time: new Date('2020-08-08T09:57:30.328Z'),
    level: 'INFO',
    message: 'message2'
  }];

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    clock = sandbox.useFakeTimers({ shouldAdvanceTime: true });
    domainClient = new _domain2.default(httpClient, token);
    userLogListenerManager = new _userLogListenerManager2.default(domainClient);
    getUserLogStub = sandbox.stub(domainClient, 'requestCopyFactory');
    callStub = _sinon2.default.stub();

    class Listener extends _userLogListener2.default {

      async onUserLog(transactionEvent) {
        callStub(transactionEvent);
      }

    }

    listener = new Listener();
  });

  afterEach(() => {
    sandbox.restore();
    clock.restore();
  });

  describe('Strategy transactions', () => {

    beforeEach(() => {
      getUserLogStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return [];
      }).withArgs({
        url: '/users/current/strategies/ABCD/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected;
      }).withArgs({
        url: '/users/current/strategies/ABCD/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected2;
      });
    });

    /**
     * @test {UserLogListenerManager#addStrategyLogListener}
     */
    it('should add listener', async () => {
      const id = userLogListenerManager.addStrategyLogListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.calledWith(callStub, expected2);
      userLogListenerManager.removeStrategyLogListener(id);
    });

    /**
     * @test {UserLogListenerManager#addStrategyLogListener}
     */
    it('should remove listener', async () => {
      const id = userLogListenerManager.addStrategyLogListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(800);
      userLogListenerManager.removeStrategyLogListener(id);
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.callCount(callStub, 1);
    });

    /**
     * @test {UserLogListenerManager#addStrategyLogListener}
     */
    it('should wait if error returned', async () => {
      getUserLogStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return [];
      }).withArgs({
        url: '/users/current/strategies/ABCD/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return expected;
      }).onFirstCall().rejects(new Error('test')).onSecondCall().rejects(new Error('test'));
      const id = userLogListenerManager.addStrategyLogListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getUserLogStub, 1);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(2000);
      _sinon2.default.assert.callCount(getUserLogStub, 3);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(800);
      _sinon2.default.assert.calledWith(callStub, expected);
      userLogListenerManager.removeStrategyLogListener(id);
    });

    /**
     * @test {UserLogListenerManager#addStrategyLogListener}
     */
    it('should remove listener on not found error', async () => {
      getUserLogStub.withArgs({
        url: '/users/current/strategies/ABCD/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        throw new _errorHandler.NotFoundError('test');
      });
      userLogListenerManager.addStrategyLogListener(listener, 'ABCD', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(100);
      _sinon2.default.assert.callCount(getUserLogStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1100);
      _sinon2.default.assert.callCount(callStub, 1);
    });
  });

  describe('Subscriber transactions', () => {

    beforeEach(() => {
      getUserLogStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return [];
      }).withArgs({
        url: '/users/current/subscribers/accountId/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected;
      }).withArgs({
        url: '/users/current/subscribers/accountId/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        return expected2;
      });
    });

    /**
     * @test {UserLogListenerManager#addSubscriberLogListener}
     */
    it('should add listener', async () => {
      const id = userLogListenerManager.addSubscriberLogListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.calledWith(callStub, expected2);
      userLogListenerManager.removeSubscriberLogListener(id);
    });

    /**
     * @test {UserLogListenerManager#addSubscriberLogListener}
     */
    it('should remove stopout listener', async () => {
      const id = userLogListenerManager.addSubscriberLogListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(800);
      userLogListenerManager.removeSubscriberLogListener(id);
      await clock.tickAsync(2200);
      _sinon2.default.assert.calledWith(callStub, expected);
      _sinon2.default.assert.callCount(callStub, 1);
    });

    /**
     * @test {UserLogListenerManager#addSubscriberLogListener}
     */
    it('should wait if error returned', async () => {
      getUserLogStub.callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return [];
      }).withArgs({
        url: '/users/current/subscribers/accountId/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T00:00:00.000Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 500));
        return expected;
      }).onFirstCall().rejects(new Error('test')).onSecondCall().rejects(new Error('test'));
      const id = userLogListenerManager.addSubscriberLogListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getUserLogStub, 1);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(600);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(2000);
      _sinon2.default.assert.callCount(getUserLogStub, 3);
      _sinon2.default.assert.notCalled(callStub);
      await clock.tickAsync(800);
      _sinon2.default.assert.calledWith(callStub, expected);
      userLogListenerManager.removeSubscriberLogListener(id);
    });

    /**
     * @test {UserLogListenerManager#addSubscriberLogListener}
     */
    it('should remove listener on not found error', async () => {
      getUserLogStub.withArgs({
        url: '/users/current/subscribers/accountId/user-log/stream',
        method: 'GET',
        qs: {
          startTime: new Date('2020-08-08T08:57:30.329Z'),
          limit: 1000
        },
        headers: {
          'auth-token': token
        },
        json: true
      }).callsFake(async opts => {
        await new _promise2.default(res => setTimeout(res, 1000));
        throw new _errorHandler.NotFoundError('test');
      });
      userLogListenerManager.addSubscriberLogListener(listener, 'accountId', new Date('2020-08-08T00:00:00.000Z'));
      await clock.tickAsync(100);
      _sinon2.default.assert.callCount(getUserLogStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1000);
      _sinon2.default.assert.callCount(getUserLogStub, 2);
      _sinon2.default.assert.callCount(callStub, 1);
      await clock.tickAsync(1100);
      _sinon2.default.assert.callCount(callStub, 1);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L3N0cmVhbWluZy91c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLnNwZWMuZXM2Il0sIm5hbWVzIjpbImRlc2NyaWJlIiwidG9rZW4iLCJodHRwQ2xpZW50IiwiSHR0cENsaWVudCIsImRvbWFpbkNsaWVudCIsInNhbmRib3giLCJjbG9jayIsInVzZXJMb2dMaXN0ZW5lck1hbmFnZXIiLCJnZXRVc2VyTG9nU3R1YiIsImxpc3RlbmVyIiwiY2FsbFN0dWIiLCJleHBlY3RlZCIsInRpbWUiLCJEYXRlIiwibGV2ZWwiLCJtZXNzYWdlIiwiZXhwZWN0ZWQyIiwiYmVmb3JlIiwic2lub24iLCJjcmVhdGVTYW5kYm94IiwiYmVmb3JlRWFjaCIsInVzZUZha2VUaW1lcnMiLCJzaG91bGRBZHZhbmNlVGltZSIsIkRvbWFpbkNsaWVudCIsIlVzZXJMb2dMaXN0ZW5lck1hbmFnZXIiLCJzdHViIiwiTGlzdGVuZXIiLCJVc2VyTG9nTGlzdGVuZXIiLCJvblVzZXJMb2ciLCJ0cmFuc2FjdGlvbkV2ZW50IiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsImNhbGxzRmFrZSIsIm9wdHMiLCJyZXMiLCJzZXRUaW1lb3V0Iiwid2l0aEFyZ3MiLCJ1cmwiLCJtZXRob2QiLCJxcyIsInN0YXJ0VGltZSIsImxpbWl0IiwiaGVhZGVycyIsImpzb24iLCJpdCIsImlkIiwiYWRkU3RyYXRlZ3lMb2dMaXN0ZW5lciIsInRpY2tBc3luYyIsImFzc2VydCIsImNhbGxlZFdpdGgiLCJyZW1vdmVTdHJhdGVneUxvZ0xpc3RlbmVyIiwiY2FsbENvdW50Iiwib25GaXJzdENhbGwiLCJyZWplY3RzIiwiRXJyb3IiLCJvblNlY29uZENhbGwiLCJub3RDYWxsZWQiLCJOb3RGb3VuZEVycm9yIiwiYWRkU3Vic2NyaWJlckxvZ0xpc3RlbmVyIiwicmVtb3ZlU3Vic2NyaWJlckxvZ0xpc3RlbmVyIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUE7Ozs7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QVQsQ0FERjtBQUVBLFlBQU1QLE1BQU15QyxTQUFOLENBQWdCLEdBQWhCLENBQU47QUFDQTdCLHNCQUFNOEIsTUFBTixDQUFhRyxTQUFiLENBQXVCM0MsY0FBdkIsRUFBdUMsQ0FBdkM7QUFDQSxZQUFNRixNQUFNeUMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E3QixzQkFBTThCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjNDLGNBQXZCLEVBQXVDLENBQXZDO0FBQ0FVLHNCQUFNOEIsTUFBTixDQUFhRyxTQUFiLENBQXVCekMsUUFBdkIsRUFBaUMsQ0FBakM7QUFDQSxZQUFNSixNQUFNeUMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E3QixzQkFBTThCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QjNDLGNBQXZCLEVBQXVDLENBQXZDO0FBQ0FVLHNCQUFNOEIsTUFBTixDQUFhRyxTQUFiLENBQXVCekMsUUFBdkIsRUFBaUMsQ0FBakM7QUFDQSxZQUFNSixNQUFNeUMsU0FBTixDQUFnQixJQUFoQixDQUFOO0FBQ0E3QixzQkFBTThCLE1BQU4sQ0FBYUcsU0FBYixDQUF1QnpDLFFBQXZCLEVBQWlDLENBQWpDO0FBQ0QsS0E3QkQ7QUErQkQsR0E3SUQ7QUErSUQsQ0F0VkQiLCJmaWxlIjoidXNlckxvZ0xpc3RlbmVyTWFuYWdlci5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgSHR0cENsaWVudCBmcm9tICcuLi8uLi9odHRwQ2xpZW50JztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgRG9tYWluQ2xpZW50IGZyb20gJy4uLy4uL2RvbWFpbi5jbGllbnQnO1xuaW1wb3J0IFVzZXJMb2dMaXN0ZW5lciBmcm9tICcuL3VzZXJMb2dMaXN0ZW5lcic7XG5pbXBvcnQgVXNlckxvZ0xpc3RlbmVyTWFuYWdlciBmcm9tICcuL3VzZXJMb2dMaXN0ZW5lck1hbmFnZXInO1xuaW1wb3J0IHtOb3RGb3VuZEVycm9yfSBmcm9tICcuLi8uLi9lcnJvckhhbmRsZXInO1xuXG4vKipcbiAqIEB0ZXN0IHtVc2VyTG9nTGlzdGVuZXJNYW5hZ2VyfVxuICovXG5kZXNjcmliZSgnVXNlckxvZ0xpc3RlbmVyTWFuYWdlcicsICgpID0+IHtcblxuICBjb25zdCB0b2tlbiA9ICdoZWFkZXIucGF5bG9hZC5zaWduJztcbiAgbGV0IGh0dHBDbGllbnQgPSBuZXcgSHR0cENsaWVudCgpO1xuICBsZXQgZG9tYWluQ2xpZW50O1xuICBsZXQgc2FuZGJveDtcbiAgbGV0IGNsb2NrO1xuICBsZXQgdXNlckxvZ0xpc3RlbmVyTWFuYWdlcjtcbiAgbGV0IGdldFVzZXJMb2dTdHViLCBsaXN0ZW5lciwgY2FsbFN0dWI7XG5cbiAgbGV0IGV4cGVjdGVkID0gW3tcbiAgICB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjhaJyksXG4gICAgbGV2ZWw6ICdJTkZPJyxcbiAgICBtZXNzYWdlOiAnbWVzc2FnZTEnXG4gIH0sXG4gIHtcbiAgICB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwNzo1NzozMC4zMjhaJyksXG4gICAgbGV2ZWw6ICdJTkZPJyxcbiAgICBtZXNzYWdlOiAnbWVzc2FnZTAnXG4gIH1dO1xuXG4gIGxldCBleHBlY3RlZDIgPSBbe1xuICAgIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDEwOjU3OjMwLjMyOFonKSxcbiAgICBsZXZlbDogJ0lORk8nLFxuICAgIG1lc3NhZ2U6ICdtZXNzYWdlMydcbiAgfSxcbiAge1xuICAgIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA5OjU3OjMwLjMyOFonKSxcbiAgICBsZXZlbDogJ0lORk8nLFxuICAgIG1lc3NhZ2U6ICdtZXNzYWdlMidcbiAgfV07XG5cbiAgYmVmb3JlKCgpID0+IHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjbG9jayA9IHNhbmRib3gudXNlRmFrZVRpbWVycyh7c2hvdWxkQWR2YW5jZVRpbWU6IHRydWV9KTtcbiAgICBkb21haW5DbGllbnQgPSBuZXcgRG9tYWluQ2xpZW50KGh0dHBDbGllbnQsIHRva2VuKTtcbiAgICB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyID0gbmV3IFVzZXJMb2dMaXN0ZW5lck1hbmFnZXIoZG9tYWluQ2xpZW50KTtcbiAgICBnZXRVc2VyTG9nU3R1YiA9IHNhbmRib3guc3R1Yihkb21haW5DbGllbnQsICdyZXF1ZXN0Q29weUZhY3RvcnknKTtcbiAgICBjYWxsU3R1YiA9IHNpbm9uLnN0dWIoKTtcblxuICAgIGNsYXNzIExpc3RlbmVyIGV4dGVuZHMgVXNlckxvZ0xpc3RlbmVyIHtcblxuICAgICAgYXN5bmMgb25Vc2VyTG9nKHRyYW5zYWN0aW9uRXZlbnQpIHtcbiAgICAgICAgY2FsbFN0dWIodHJhbnNhY3Rpb25FdmVudCk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgIGNsb2NrLnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0cmF0ZWd5IHRyYW5zYWN0aW9ucycsICgpID0+IHtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgZ2V0VXNlckxvZ1N0dWJcbiAgICAgICAgLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMTAwMCkpO1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSlcbiAgICAgICAgLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdHJhdGVnaWVzL0FCQ0QvdXNlci1sb2cvc3RyZWFtJyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgICAgIGxpbWl0OiAxMDAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgIH0pLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMTAwMCkpO1xuICAgICAgICAgIHJldHVybiBleHBlY3RlZDtcbiAgICAgICAgfSlcbiAgICAgICAgLndpdGhBcmdzKHtcbiAgICAgICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9zdHJhdGVnaWVzL0FCQ0QvdXNlci1sb2cvc3RyZWFtJyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA4OjU3OjMwLjMyOVonKSxcbiAgICAgICAgICAgIGxpbWl0OiAxMDAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgIH0pLmNhbGxzRmFrZShhc3luYyAob3B0cykgPT4ge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMTAwMCkpO1xuICAgICAgICAgIHJldHVybiBleHBlY3RlZDI7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1VzZXJMb2dMaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBsaXN0ZW5lcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5hZGRTdHJhdGVneUxvZ0xpc3RlbmVyKGxpc3RlbmVyLCAnQUJDRCcsIG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMjIwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgZXhwZWN0ZWQpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkMik7XG4gICAgICB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN0cmF0ZWd5TG9nTGlzdGVuZXIoaWQpO1xuICAgIH0pO1xuICBcbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VXNlckxvZ0xpc3RlbmVyTWFuYWdlciNhZGRTdHJhdGVneUxvZ0xpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIobGlzdGVuZXIsICdBQkNEJywgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg4MDApO1xuICAgICAgdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5yZW1vdmVTdHJhdGVneUxvZ0xpc3RlbmVyKGlkKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygyMjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBleHBlY3RlZCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGNhbGxTdHViLCAxKTtcbiAgICB9KTtcbiAgXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1VzZXJMb2dMaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIHdhaXQgaWYgZXJyb3IgcmV0dXJuZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRVc2VyTG9nU3R1YlxuICAgICAgICAuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCA1MDApKTtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3RyYXRlZ2llcy9BQkNEL3VzZXItbG9nL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDUwMCkpO1xuICAgICAgICAgIHJldHVybiBleHBlY3RlZDtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uRmlyc3RDYWxsKCkucmVqZWN0cyhuZXcgRXJyb3IoJ3Rlc3QnKSlcbiAgICAgICAgLm9uU2Vjb25kQ2FsbCgpLnJlamVjdHMobmV3IEVycm9yKCd0ZXN0JykpO1xuICAgICAgY29uc3QgaWQgPSB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIobGlzdGVuZXIsICdBQkNEJywgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg2MDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMSk7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYyg2MDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMik7XG4gICAgICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGNhbGxTdHViKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygyMDAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VXNlckxvZ1N0dWIsIDMpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChjYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoODAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBleHBlY3RlZCk7XG4gICAgICB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN0cmF0ZWd5TG9nTGlzdGVuZXIoaWQpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1VzZXJMb2dMaXN0ZW5lck1hbmFnZXIjYWRkU3RyYXRlZ3lMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBsaXN0ZW5lciBvbiBub3QgZm91bmQgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRVc2VyTG9nU3R1YlxuICAgICAgICAud2l0aEFyZ3Moe1xuICAgICAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvQUJDRC91c2VyLWxvZy9zdHJlYW0nLFxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcXM6IHtcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDg6NTc6MzAuMzI5WicpLFxuICAgICAgICAgICAgbGltaXQ6IDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgfSkuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCAxMDAwKSk7XG4gICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXJyb3IoJ3Rlc3QnKTtcbiAgICAgICAgfSk7XG4gICAgICB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIobGlzdGVuZXIsICdBQkNEJyxcbiAgICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygxMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTAwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFVzZXJMb2dTdHViLCAyKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDEwMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMik7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGNhbGxTdHViLCAxKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygxMTAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgIH0pO1xuICAgIFxuICB9KTtcblxuICBkZXNjcmliZSgnU3Vic2NyaWJlciB0cmFuc2FjdGlvbnMnLCAoKSA9PiB7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGdldFVzZXJMb2dTdHViXG4gICAgICAgIC5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3VzZXItbG9nL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQ7XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3VzZXItbG9nL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjlaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQyO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtVc2VyTG9nTGlzdGVuZXJNYW5hZ2VyI2FkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBsaXN0ZW5lcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5hZGRTdWJzY3JpYmVyTG9nTGlzdGVuZXIobGlzdGVuZXIsICdhY2NvdW50SWQnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDIyMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGV4cGVjdGVkKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBleHBlY3RlZDIpO1xuICAgICAgdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5yZW1vdmVTdWJzY3JpYmVyTG9nTGlzdGVuZXIoaWQpO1xuICAgIH0pO1xuICBcbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VXNlckxvZ0xpc3RlbmVyTWFuYWdlciNhZGRTdWJzY3JpYmVyTG9nTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgc3RvcG91dCBsaXN0ZW5lcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5hZGRTdWJzY3JpYmVyTG9nTGlzdGVuZXIobGlzdGVuZXIsICdhY2NvdW50SWQnLFxuICAgICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJykpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDgwMCk7XG4gICAgICB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN1YnNjcmliZXJMb2dMaXN0ZW5lcihpZCk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMjIwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgZXhwZWN0ZWQpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChjYWxsU3R1YiwgMSk7XG4gICAgfSk7XG4gIFxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtVc2VyTG9nTGlzdGVuZXJNYW5hZ2VyI2FkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIHdhaXQgaWYgZXJyb3IgcmV0dXJuZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnZXRVc2VyTG9nU3R1YlxuICAgICAgICAuY2FsbHNGYWtlKGFzeW5jIChvcHRzKSA9PiB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCA1MDApKTtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0pXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3VzZXItbG9nL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwMDowMDowMC4wMDBaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDUwMCkpO1xuICAgICAgICAgIHJldHVybiBleHBlY3RlZDtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uRmlyc3RDYWxsKCkucmVqZWN0cyhuZXcgRXJyb3IoJ3Rlc3QnKSlcbiAgICAgICAgLm9uU2Vjb25kQ2FsbCgpLnJlamVjdHMobmV3IEVycm9yKCd0ZXN0JykpO1xuICAgICAgY29uc3QgaWQgPSB1c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcihsaXN0ZW5lciwgJ2FjY291bnRJZCcsXG4gICAgICAgIG5ldyBEYXRlKCcyMDIwLTA4LTA4VDAwOjAwOjAwLjAwMFonKSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoNjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VXNlckxvZ1N0dWIsIDEpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChjYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoNjAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoZ2V0VXNlckxvZ1N0dWIsIDIpO1xuICAgICAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChjYWxsU3R1Yik7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMjAwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFVzZXJMb2dTdHViLCAzKTtcbiAgICAgIHNpbm9uLmFzc2VydC5ub3RDYWxsZWQoY2FsbFN0dWIpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDgwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgZXhwZWN0ZWQpO1xuICAgICAgdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5yZW1vdmVTdWJzY3JpYmVyTG9nTGlzdGVuZXIoaWQpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1VzZXJMb2dMaXN0ZW5lck1hbmFnZXIjYWRkU3Vic2NyaWJlckxvZ0xpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGxpc3RlbmVyIG9uIG5vdCBmb3VuZCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGdldFVzZXJMb2dTdHViXG4gICAgICAgIC53aXRoQXJncyh7XG4gICAgICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvYWNjb3VudElkL3VzZXItbG9nL3N0cmVhbScsXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBxczoge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wOFQwODo1NzozMC4zMjlaJyksXG4gICAgICAgICAgICBsaW1pdDogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9KS5jYWxsc0Zha2UoYXN5bmMgKG9wdHMpID0+IHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcigndGVzdCcpO1xuICAgICAgICB9KTtcbiAgICAgIHVzZXJMb2dMaXN0ZW5lck1hbmFnZXIuYWRkU3Vic2NyaWJlckxvZ0xpc3RlbmVyKGxpc3RlbmVyLCAnYWNjb3VudElkJyxcbiAgICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDhUMDA6MDA6MDAuMDAwWicpKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygxMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMSk7XG4gICAgICBhd2FpdCBjbG9jay50aWNrQXN5bmMoMTAwMCk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGdldFVzZXJMb2dTdHViLCAyKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgICAgYXdhaXQgY2xvY2sudGlja0FzeW5jKDEwMDApO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxDb3VudChnZXRVc2VyTG9nU3R1YiwgMik7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbENvdW50KGNhbGxTdHViLCAxKTtcbiAgICAgIGF3YWl0IGNsb2NrLnRpY2tBc3luYygxMTAwKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsQ291bnQoY2FsbFN0dWIsIDEpO1xuICAgIH0pO1xuICAgIFxuICB9KTtcblxufSk7XG4iXX0=