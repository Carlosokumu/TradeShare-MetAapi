'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _randomstring = require('randomstring');

var _randomstring2 = _interopRequireDefault(_randomstring);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * CopyFactory client for signal requests
 */
class SignalClient {

  /**
   * Constructs CopyFactory signal client instance
   * @param {string} accountId account id
   * @param {Object} host host data
   * @param {DomainClient} domainClient domain client
   */
  constructor(accountId, host, domainClient) {
    this._accountId = accountId;
    this._domainClient = domainClient;
    this._host = host;
  }

  /**
   * Generates random signal id
   * @return {String} signal id
   */
  generateSignalId() {
    return _randomstring2.default.generate(8);
  }

  /**
   * CopyFactory external signal update payload
   * @typedef {Object} CopyFactoryExternalSignalUpdate
   * @property {String} symbol trade symbol
   * @property {String} type trade type (one of POSITION_TYPE_BUY, POSITION_TYPE_SELL, ORDER_TYPE_BUY_LIMIT, ORDER_TYPE_SELL_LIMIT, 
   * ORDER_TYPE_BUY_STOP, ORDER_TYPE_SELL_STOP)
   * @property {Date} time time the signal was emitted at
   * @property {Date} [updateTime] last time of the signal update
   * @property {Number} volume volume traded
   * @property {Number} [magic] expert advisor id
   * @property {Number} [stopLoss] stop loss price
   * @property {Number} [takeProfit] take profit price
   * @property {Number} [openPrice] pending or market order open price
   */

  /**
   * CopyFactory trading signal
   * @typedef {Object} CopyFactoryTradingSignal
   * @property {CopyFactoryStrategyIdAndName} strategy strategy the signal arrived from
   * @property {String} positionId id of the position the signal was generated from
   * @property {Date} time signal time
   * @property {String} symbol symbol traded
   * @property {String} type type of the trade (one of market, limit, stop)
   * @property {String} side side of the trade (one of buy, sell, close)
   * @property {Number} [openPrice] open price for limit and stop orders
   * @property {Number} [stopLoss] stop loss price
   * @property {Number} [takeProfit] take profit price
   * @property {Number} signalVolume the signal volume
   * @property {Number} subscriberVolume the volume already open on subscriber side
   * @property {Number} subscriberProfit total profit of the position on subscriber side
   * @property {Date} closeAfter the time the signal will be automatically closed at
   * @property {Boolean} [closeOnly] flag indicating that only closing side of this signal will be copied
   */

  /**
   * CopyFactory external signal remove payload
   * @typedef {Object} CopyFactoryExternalSignalRemove
   * @property {Date} time the time signal was removed (closed) at
   */

  /**
   * Returns trading signals the subscriber is subscribed to. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/getTradingSignals/
   * @returns {Promise<Array<CopyFactoryTradingSignal>>}
   */
  getTradingSignals() {
    const opts = {
      url: `/users/current/subscribers/${this._accountId}/signals`,
      method: 'GET',
      headers: {
        'auth-token': this._domainClient.token
      },
      json: true
    };
    return this._domainClient.requestSignal(opts, this._host, this._accountId);
  }

  /**
   * Updates external signal for a strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/updateExternalSignal/
   * @param {String} strategyId strategy id
   * @param {String} signalId external signal id (should be 8 alphanumerical symbols)
   * @param {CopyFactoryExternalSignalUpdate} signal signal update payload
   * @return {Promise} promise which resolves when the external signal is updated
   */
  updateExternalSignal(strategyId, signalId, signal) {
    const opts = {
      url: `/users/current/strategies/${strategyId}/external-signals/${signalId}`,
      method: 'PUT',
      headers: {
        'auth-token': this._domainClient.token
      },
      body: signal,
      json: true
    };
    return this._domainClient.requestSignal(opts, this._host, this._accountId);
  }

  /**
   * CopyFactory external signal remove payload
   * @typedef {Object} CopyFactoryExternalSignalRemove
   * @property {Date} time the time signal was removed (closed) at
   */

  /**
   * Removes (closes) external signal for a strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/removeExternalSignal/
   * @param {String} strategyId strategy id
   * @param {String} signalId external signal id
   * @param {CopyFactoryExternalSignalRemove} signal signal removal payload
   * @return {Promise} promise which resolves when the external signal is removed
   */
  removeExternalSignal(strategyId, signalId, signal) {
    const opts = {
      url: `/users/current/strategies/${strategyId}/external-signals/${signalId}/remove`,
      method: 'POST',
      headers: {
        'auth-token': this._domainClient.token
      },
      body: signal,
      json: true
    };
    return this._domainClient.requestSignal(opts, this._host, this._accountId);
  }
}
exports.default = SignalClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L3NpZ25hbC5jbGllbnQuZXM2Il0sIm5hbWVzIjpbIlNpZ25hbENsaWVudCIsImNvbnN0cnVjdG9yIiwiYWNjb3VudElkIiwiaG9zdCIsImRvbWFpbkNsaWVudCIsIl9hY2NvdW50SWQiLCJfZG9tYWluQ2xpZW50IiwiX2hvc3QiLCJnZW5lcmF0ZVNpZ25hbElkIiwicmFuZG9tc3RyaW5nIiwiZ2VuZXJhdGUiLCJnZXRUcmFkaW5nU2lnbmFscyIsIm9wdHMiLCJ1cmwiLCJtZXRob2QiLCJoZWFkZXJzIiwidG9rZW4iLCJqc29uIiwicmVxdWVzdFNpZ25hbCIsInVwZGF0ZUV4dGVybmFsU2lnbmFsIiwic3RyYXRlZ3lJZCIsInNpZ25hbElkIiwic2lnbmFsIiwiYm9keSIsInJlbW92ZUV4dGVybmFsU2lnbmFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7Ozs7O0FBRUE7OztBQUdlLE1BQU1BLFlBQU4sQ0FBbUI7O0FBRWhDOzs7Ozs7QUFNQUMsY0FBWUMsU0FBWixFQUF1QkMsSUFBdkIsRUFBNkJDLFlBQTdCLEVBQTJDO0FBQ3pDLFNBQUtDLFVBQUwsR0FBa0JILFNBQWxCO0FBQ0EsU0FBS0ksYUFBTCxHQUFxQkYsWUFBckI7QUFDQSxTQUFLRyxLQUFMLEdBQWFKLElBQWI7QUFDRDs7QUFFRDs7OztBQUlBSyxxQkFBbUI7QUFDakIsV0FBT0MsdUJBQWFDLFFBQWIsQ0FBc0IsQ0FBdEIsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7Ozs7Ozs7Ozs7QUFlQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1CQTs7Ozs7O0FBTUE7Ozs7O0FBS0FDLHNCQUFvQjtBQUNsQixVQUFNQyxPQUFPO0FBQ1hDLFdBQU0sOEJBQTZCLEtBQUtSLFVBQVcsVUFEeEM7QUFFWFMsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLVCxhQUFMLENBQW1CVTtBQUQxQixPQUhFO0FBTVhDLFlBQU07QUFOSyxLQUFiO0FBUUEsV0FBTyxLQUFLWCxhQUFMLENBQW1CWSxhQUFuQixDQUFpQ04sSUFBakMsRUFBdUMsS0FBS0wsS0FBNUMsRUFBbUQsS0FBS0YsVUFBeEQsQ0FBUDtBQUNEOztBQUVEOzs7Ozs7OztBQVFBYyx1QkFBcUJDLFVBQXJCLEVBQWlDQyxRQUFqQyxFQUEyQ0MsTUFBM0MsRUFBbUQ7QUFDakQsVUFBTVYsT0FBTztBQUNYQyxXQUFNLDZCQUE0Qk8sVUFBVyxxQkFBb0JDLFFBQVMsRUFEL0Q7QUFFWFAsY0FBUSxLQUZHO0FBR1hDLGVBQVM7QUFDUCxzQkFBYyxLQUFLVCxhQUFMLENBQW1CVTtBQUQxQixPQUhFO0FBTVhPLFlBQU1ELE1BTks7QUFPWEwsWUFBTTtBQVBLLEtBQWI7QUFTQSxXQUFPLEtBQUtYLGFBQUwsQ0FBbUJZLGFBQW5CLENBQWlDTixJQUFqQyxFQUF1QyxLQUFLTCxLQUE1QyxFQUFtRCxLQUFLRixVQUF4RCxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7OztBQU1BOzs7Ozs7OztBQVFBbUIsdUJBQXFCSixVQUFyQixFQUFpQ0MsUUFBakMsRUFBMkNDLE1BQTNDLEVBQW1EO0FBQ2pELFVBQU1WLE9BQU87QUFDWEMsV0FBTSw2QkFBNEJPLFVBQVcscUJBQW9CQyxRQUFTLFNBRC9EO0FBRVhQLGNBQVEsTUFGRztBQUdYQyxlQUFTO0FBQ1Asc0JBQWMsS0FBS1QsYUFBTCxDQUFtQlU7QUFEMUIsT0FIRTtBQU1YTyxZQUFNRCxNQU5LO0FBT1hMLFlBQU07QUFQSyxLQUFiO0FBU0EsV0FBTyxLQUFLWCxhQUFMLENBQW1CWSxhQUFuQixDQUFpQ04sSUFBakMsRUFBdUMsS0FBS0wsS0FBNUMsRUFBbUQsS0FBS0YsVUFBeEQsQ0FBUDtBQUNEO0FBN0grQjtrQkFBYkwsWSIsImZpbGUiOiJzaWduYWwuY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJhbmRvbXN0cmluZyBmcm9tICdyYW5kb21zdHJpbmcnO1xuXG4vKipcbiAqIENvcHlGYWN0b3J5IGNsaWVudCBmb3Igc2lnbmFsIHJlcXVlc3RzXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNpZ25hbENsaWVudCB7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgQ29weUZhY3Rvcnkgc2lnbmFsIGNsaWVudCBpbnN0YW5jZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gYWNjb3VudElkIGFjY291bnQgaWRcbiAgICogQHBhcmFtIHtPYmplY3R9IGhvc3QgaG9zdCBkYXRhXG4gICAqIEBwYXJhbSB7RG9tYWluQ2xpZW50fSBkb21haW5DbGllbnQgZG9tYWluIGNsaWVudFxuICAgKi9cbiAgY29uc3RydWN0b3IoYWNjb3VudElkLCBob3N0LCBkb21haW5DbGllbnQpIHtcbiAgICB0aGlzLl9hY2NvdW50SWQgPSBhY2NvdW50SWQ7XG4gICAgdGhpcy5fZG9tYWluQ2xpZW50ID0gZG9tYWluQ2xpZW50O1xuICAgIHRoaXMuX2hvc3QgPSBob3N0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyByYW5kb20gc2lnbmFsIGlkXG4gICAqIEByZXR1cm4ge1N0cmluZ30gc2lnbmFsIGlkXG4gICAqL1xuICBnZW5lcmF0ZVNpZ25hbElkKCkge1xuICAgIHJldHVybiByYW5kb21zdHJpbmcuZ2VuZXJhdGUoOCk7XG4gIH1cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgZXh0ZXJuYWwgc2lnbmFsIHVwZGF0ZSBwYXlsb2FkXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5RXh0ZXJuYWxTaWduYWxVcGRhdGVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHN5bWJvbCB0cmFkZSBzeW1ib2xcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHR5cGUgdHJhZGUgdHlwZSAob25lIG9mIFBPU0lUSU9OX1RZUEVfQlVZLCBQT1NJVElPTl9UWVBFX1NFTEwsIE9SREVSX1RZUEVfQlVZX0xJTUlULCBPUkRFUl9UWVBFX1NFTExfTElNSVQsIFxuICAgKiBPUkRFUl9UWVBFX0JVWV9TVE9QLCBPUkRFUl9UWVBFX1NFTExfU1RPUClcbiAgICogQHByb3BlcnR5IHtEYXRlfSB0aW1lIHRpbWUgdGhlIHNpZ25hbCB3YXMgZW1pdHRlZCBhdFxuICAgKiBAcHJvcGVydHkge0RhdGV9IFt1cGRhdGVUaW1lXSBsYXN0IHRpbWUgb2YgdGhlIHNpZ25hbCB1cGRhdGVcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHZvbHVtZSB2b2x1bWUgdHJhZGVkXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWFnaWNdIGV4cGVydCBhZHZpc29yIGlkXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbc3RvcExvc3NdIHN0b3AgbG9zcyBwcmljZVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW3Rha2VQcm9maXRdIHRha2UgcHJvZml0IHByaWNlXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbb3BlblByaWNlXSBwZW5kaW5nIG9yIG1hcmtldCBvcmRlciBvcGVuIHByaWNlXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSB0cmFkaW5nIHNpZ25hbFxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVRyYWRpbmdTaWduYWxcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5SWRBbmROYW1lfSBzdHJhdGVneSBzdHJhdGVneSB0aGUgc2lnbmFsIGFycml2ZWQgZnJvbVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gcG9zaXRpb25JZCBpZCBvZiB0aGUgcG9zaXRpb24gdGhlIHNpZ25hbCB3YXMgZ2VuZXJhdGVkIGZyb21cbiAgICogQHByb3BlcnR5IHtEYXRlfSB0aW1lIHNpZ25hbCB0aW1lXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzeW1ib2wgc3ltYm9sIHRyYWRlZFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdHlwZSB0eXBlIG9mIHRoZSB0cmFkZSAob25lIG9mIG1hcmtldCwgbGltaXQsIHN0b3ApXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzaWRlIHNpZGUgb2YgdGhlIHRyYWRlIChvbmUgb2YgYnV5LCBzZWxsLCBjbG9zZSlcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFtvcGVuUHJpY2VdIG9wZW4gcHJpY2UgZm9yIGxpbWl0IGFuZCBzdG9wIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW3N0b3BMb3NzXSBzdG9wIGxvc3MgcHJpY2VcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFt0YWtlUHJvZml0XSB0YWtlIHByb2ZpdCBwcmljZVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gc2lnbmFsVm9sdW1lIHRoZSBzaWduYWwgdm9sdW1lXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBzdWJzY3JpYmVyVm9sdW1lIHRoZSB2b2x1bWUgYWxyZWFkeSBvcGVuIG9uIHN1YnNjcmliZXIgc2lkZVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gc3Vic2NyaWJlclByb2ZpdCB0b3RhbCBwcm9maXQgb2YgdGhlIHBvc2l0aW9uIG9uIHN1YnNjcmliZXIgc2lkZVxuICAgKiBAcHJvcGVydHkge0RhdGV9IGNsb3NlQWZ0ZXIgdGhlIHRpbWUgdGhlIHNpZ25hbCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY2xvc2VkIGF0XG4gICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW2Nsb3NlT25seV0gZmxhZyBpbmRpY2F0aW5nIHRoYXQgb25seSBjbG9zaW5nIHNpZGUgb2YgdGhpcyBzaWduYWwgd2lsbCBiZSBjb3BpZWRcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IGV4dGVybmFsIHNpZ25hbCByZW1vdmUgcGF5bG9hZFxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeUV4dGVybmFsU2lnbmFsUmVtb3ZlXG4gICAqIEBwcm9wZXJ0eSB7RGF0ZX0gdGltZSB0aGUgdGltZSBzaWduYWwgd2FzIHJlbW92ZWQgKGNsb3NlZCkgYXRcbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJhZGluZyBzaWduYWxzIHRoZSBzdWJzY3JpYmVyIGlzIHN1YnNjcmliZWQgdG8uIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS90cmFkaW5nL2dldFRyYWRpbmdTaWduYWxzL1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheTxDb3B5RmFjdG9yeVRyYWRpbmdTaWduYWw+Pn1cbiAgICovXG4gIGdldFRyYWRpbmdTaWduYWxzKCkge1xuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy8ke3RoaXMuX2FjY291bnRJZH0vc2lnbmFsc2AsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX2RvbWFpbkNsaWVudC50b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdFNpZ25hbChvcHRzLCB0aGlzLl9ob3N0LCB0aGlzLl9hY2NvdW50SWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgZXh0ZXJuYWwgc2lnbmFsIGZvciBhIHN0cmF0ZWd5LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvdHJhZGluZy91cGRhdGVFeHRlcm5hbFNpZ25hbC9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmF0ZWd5SWQgc3RyYXRlZ3kgaWRcbiAgICogQHBhcmFtIHtTdHJpbmd9IHNpZ25hbElkIGV4dGVybmFsIHNpZ25hbCBpZCAoc2hvdWxkIGJlIDggYWxwaGFudW1lcmljYWwgc3ltYm9scylcbiAgICogQHBhcmFtIHtDb3B5RmFjdG9yeUV4dGVybmFsU2lnbmFsVXBkYXRlfSBzaWduYWwgc2lnbmFsIHVwZGF0ZSBwYXlsb2FkXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2hlbiB0aGUgZXh0ZXJuYWwgc2lnbmFsIGlzIHVwZGF0ZWRcbiAgICovXG4gIHVwZGF0ZUV4dGVybmFsU2lnbmFsKHN0cmF0ZWd5SWQsIHNpZ25hbElkLCBzaWduYWwpIHtcbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvc3RyYXRlZ2llcy8ke3N0cmF0ZWd5SWR9L2V4dGVybmFsLXNpZ25hbHMvJHtzaWduYWxJZH1gLFxuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl9kb21haW5DbGllbnQudG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBzaWduYWwsXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RTaWduYWwob3B0cywgdGhpcy5faG9zdCwgdGhpcy5fYWNjb3VudElkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBleHRlcm5hbCBzaWduYWwgcmVtb3ZlIHBheWxvYWRcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFJlbW92ZVxuICAgKiBAcHJvcGVydHkge0RhdGV9IHRpbWUgdGhlIHRpbWUgc2lnbmFsIHdhcyByZW1vdmVkIChjbG9zZWQpIGF0XG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZW1vdmVzIChjbG9zZXMpIGV4dGVybmFsIHNpZ25hbCBmb3IgYSBzdHJhdGVneS4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL3RyYWRpbmcvcmVtb3ZlRXh0ZXJuYWxTaWduYWwvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJhdGVneUlkIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzaWduYWxJZCBleHRlcm5hbCBzaWduYWwgaWRcbiAgICogQHBhcmFtIHtDb3B5RmFjdG9yeUV4dGVybmFsU2lnbmFsUmVtb3ZlfSBzaWduYWwgc2lnbmFsIHJlbW92YWwgcGF5bG9hZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdoZW4gdGhlIGV4dGVybmFsIHNpZ25hbCBpcyByZW1vdmVkXG4gICAqL1xuICByZW1vdmVFeHRlcm5hbFNpZ25hbChzdHJhdGVneUlkLCBzaWduYWxJZCwgc2lnbmFsKSB7XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvJHtzdHJhdGVneUlkfS9leHRlcm5hbC1zaWduYWxzLyR7c2lnbmFsSWR9L3JlbW92ZWAsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl9kb21haW5DbGllbnQudG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBzaWduYWwsXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RTaWduYWwob3B0cywgdGhpcy5faG9zdCwgdGhpcy5fYWNjb3VudElkKTtcbiAgfVxufSJdfQ==