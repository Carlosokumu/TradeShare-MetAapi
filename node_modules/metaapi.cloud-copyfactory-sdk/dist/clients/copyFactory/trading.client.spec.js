'use strict';

var _httpClient = require('../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _trading = require('./trading.client');

var _trading2 = _interopRequireDefault(_trading);

var _domain = require('../domain.client');

var _domain2 = _interopRequireDefault(_domain);

var _stopoutListener = require('./streaming/stopoutListener');

var _stopoutListener2 = _interopRequireDefault(_stopoutListener);

var _userLogListener = require('./streaming/userLogListener');

var _userLogListener2 = _interopRequireDefault(_userLogListener);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {TradingClient}
 */
describe('TradingClient', () => {

  let tradingClient;
  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let domainClient;
  let sandbox;
  let requestStub;

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    domainClient = new _domain2.default(httpClient, token);
    tradingClient = new _trading2.default(domainClient);
    requestStub = sandbox.stub(domainClient, 'requestCopyFactory');
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {TradingClient#resynchronize}
   */
  it('should resynchronize CopyFactory account', async () => {
    await tradingClient.resynchronize('e8867baa-5ec2-45ae-9930-4d5cea18d0d6', ['ABCD'], ['0123456']);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/subscribers/e8867baa-5ec2-45ae-9930-4d5cea18d0d6/resynchronize',
      method: 'POST',
      headers: {
        'auth-token': token
      },
      json: true,
      qs: {
        strategyId: ['ABCD'],
        positionId: ['0123456']
      }
    });
  });

  /**
   * @test {TradingClient#resynchronize}
   */
  it('should not resynchronize account with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    tradingClient = new _trading2.default(domainClient);
    try {
      await tradingClient.resynchronize('e8867baa-5ec2-45ae-9930-4d5cea18d0d6');
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke resynchronize method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getStopouts}
   */
  it('should retrieve stopouts', async () => {
    let expected = [{
      strategyId: 'accountId',
      reason: 'monthly-balance',
      stoppedAt: new Date('2020-08-08T07:57:30.328Z'),
      strategy: {
        id: 'ABCD',
        name: 'Strategy'
      },
      reasonDescription: 'total strategy equity drawdown exceeded limit',
      sequenceNumber: 2
    }];
    requestStub.resolves(expected);
    let stopouts = await tradingClient.getStopouts('e8867baa-5ec2-45ae-9930-4d5cea18d0d6');
    stopouts.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/subscribers/e8867baa-5ec2-45ae-9930-4d5cea18d0d6/stopouts',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      json: true
    });
  });

  /**
   * @test {TradingClient#getStopouts}
   */
  it('should not retrieve stopouts from API with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    tradingClient = new _trading2.default(domainClient);
    try {
      await tradingClient.getStopouts('e8867baa-5ec2-45ae-9930-4d5cea18d0d6');
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke getStopouts method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#resetStopouts}
   */
  it('should reset stopouts', async () => {
    await tradingClient.resetStopouts('e8867baa-5ec2-45ae-9930-4d5cea18d0d6', 'ABCD', 'daily-equity');
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/subscribers/' + 'e8867baa-5ec2-45ae-9930-4d5cea18d0d6/subscription-strategies/ABCD/stopouts/daily-equity/reset',
      method: 'POST',
      headers: {
        'auth-token': token
      },
      json: true
    });
  });

  /**
   * @test {TradingClient#resetStopouts}
   */
  it('should not reset stopouts with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    tradingClient = new _trading2.default(domainClient);
    try {
      await tradingClient.resetStopouts('e8867baa-5ec2-45ae-9930-4d5cea18d0d6', 'ABCD', 'daily-equity');
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke resetStopouts method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getUserLog}
   */
  it('should retrieve copy trading user log', async () => {
    let expected = [{
      time: new Date('2020-08-08T07:57:30.328Z'),
      level: 'INFO',
      message: 'message'
    }];
    requestStub.resolves(expected);
    let records = await tradingClient.getUserLog('e8867baa-5ec2-45ae-9930-4d5cea18d0d6', new Date('2020-08-01T00:00:00.000Z'), new Date('2020-08-10T00:00:00.000Z'), 10, 100);
    records.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/subscribers/e8867baa-5ec2-45ae-9930-4d5cea18d0d6/user-log',
      method: 'GET',
      qs: {
        startTime: new Date('2020-08-01T00:00:00.000Z'),
        endTime: new Date('2020-08-10T00:00:00.000Z'),
        offset: 10,
        limit: 100
      },
      headers: {
        'auth-token': token
      },
      json: true
    }, true);
  });

  /**
   * @test {TradingClient#getUserLog}
   */
  it('should not retrieve copy trading user log from API with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    tradingClient = new _trading2.default(domainClient);
    try {
      await tradingClient.getUserLog('e8867baa-5ec2-45ae-9930-4d5cea18d0d6');
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke getUserLog method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getStrategyLog}
   */
  it('should retrieve copy trading strategy log', async () => {
    let expected = [{
      time: new Date('2020-08-08T07:57:30.328Z'),
      level: 'INFO',
      message: 'message'
    }];
    requestStub.resolves(expected);
    let records = await tradingClient.getStrategyLog('ABCD', new Date('2020-08-01T00:00:00.000Z'), new Date('2020-08-10T00:00:00.000Z'), 10, 100);
    records.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/strategies/ABCD/user-log',
      method: 'GET',
      qs: {
        startTime: new Date('2020-08-01T00:00:00.000Z'),
        endTime: new Date('2020-08-10T00:00:00.000Z'),
        offset: 10,
        limit: 100
      },
      headers: {
        'auth-token': token
      },
      json: true
    }, true);
  });

  /**
   * @test {TradingClient#getStrategyLog}
   */
  it('should not retrieve copy trading strategy log from API with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    tradingClient = new _trading2.default(domainClient);
    try {
      await tradingClient.getStrategyLog('ABCD');
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke getStrategyLog method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getSignalClient}
   */
  describe('getSignalClient', () => {
    let getAccountStub;

    beforeEach(() => {
      getAccountStub = sandbox.stub(domainClient, 'getAccountInfo').withArgs('accountId');
      getAccountStub.resolves({ id: 'accountId', regions: ['vint-hill'] });
      sandbox.stub(domainClient, 'getSignalClientHost').callsFake(regions => ({
        host: 'https://copyfactory-api-v1',
        regions,
        domain: 'agiliumtrade.ai'
      }));
    });

    /**
     * @test {TradingClient#getSignalClient}
     */
    it('should get account', async () => {
      const client = await tradingClient.getSignalClient('accountId');
      _sinon2.default.assert.match(client._accountId, 'accountId');
      _sinon2.default.assert.match(client._host.regions, ['vint-hill']);
    });
  });

  /**
   * @test {TradingClient#addStopoutListener}
   * @test {TradingClient#removeStopoutListener}
   */
  describe('stopoutListener', () => {

    let listener;

    beforeEach(() => {

      class Listener extends _stopoutListener2.default {
        async onStopout(strategyStopoutEvent) {}
      }

      listener = new Listener();
    });

    /**
     * @test {TradingClient#addStopoutListener}
     */
    it('should add stopout listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._stopoutListenerManager, 'addStopoutListener').returns('listenerId');
      const listenerId = tradingClient.addStopoutListener(listener, 'accountId', 'ABCD', 1);
      _sinon2.default.assert.match(listenerId, 'listenerId');
      _sinon2.default.assert.calledWith(callStub, listener, 'accountId', 'ABCD', 1);
    });

    /**
     * @test {TradingClient#removeStopoutListener}
     */
    it('should remove stopout listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._stopoutListenerManager, 'removeStopoutListener');
      tradingClient.removeStopoutListener('id');
      _sinon2.default.assert.calledWith(callStub, 'id');
    });
  });

  /**
   * @test {TradingClient#addStrategyLogListener}
   * @test {TradingClient#removeStopoutListener}
   */
  describe('userLogListener', () => {

    let listener;

    beforeEach(() => {

      class Listener extends _userLogListener2.default {
        async onStopout(strategyStopoutEvent) {}
      }

      listener = new Listener();
    });

    /**
     * @test {TradingClient#addStrategyLogListener}
     */
    it('should add strategy listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._userLogListenerManager, 'addStrategyLogListener').returns('listenerId');
      const listenerId = tradingClient.addStrategyLogListener(listener, 'ABCD');
      _sinon2.default.assert.match(listenerId, 'listenerId');
      _sinon2.default.assert.calledWith(callStub, listener, 'ABCD');
    });

    /**
     * @test {TradingClient#removeStrategyLogListener}
     */
    it('should remove strategy listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._userLogListenerManager, 'removeStrategyLogListener');
      tradingClient.removeStrategyLogListener('id');
      _sinon2.default.assert.calledWith(callStub, 'id');
    });

    /**
     * @test {TradingClient#addSubscriberLogListener}
     */
    it('should add subscriber listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._userLogListenerManager, 'addSubscriberLogListener').returns('listenerId');
      const listenerId = tradingClient.addSubscriberLogListener(listener, 'accountId');
      _sinon2.default.assert.match(listenerId, 'listenerId');
      _sinon2.default.assert.calledWith(callStub, listener, 'accountId');
    });

    /**
     * @test {TradingClient#removeSubscriberLogListener}
     */
    it('should remove subscriber listener', async () => {
      const callStub = _sinon2.default.stub(tradingClient._userLogListenerManager, 'removeSubscriberLogListener');
      tradingClient.removeSubscriberLogListener('id');
      _sinon2.default.assert.calledWith(callStub, 'id');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L3RyYWRpbmcuY2xpZW50LnNwZWMuZXM2Il0sIm5hbWVzIjpbImRlc2NyaWJlIiwidHJhZGluZ0NsaWVudCIsInRva2VuIiwiaHR0cENsaWVudCIsIkh0dHBDbGllbnQiLCJkb21haW5DbGllbnQiLCJzYW5kYm94IiwicmVxdWVzdFN0dWIiLCJiZWZvcmUiLCJzaW5vbiIsImNyZWF0ZVNhbmRib3giLCJiZWZvcmVFYWNoIiwiRG9tYWluQ2xpZW50IiwiVHJhZGluZ0NsaWVudCIsInN0dWIiLCJhZnRlckVhY2giLCJyZXN0b3JlIiwiaXQiLCJyZXN5bmNocm9uaXplIiwiYXNzZXJ0IiwiY2FsbGVkT25jZVdpdGhFeGFjdGx5IiwicmVxdWVzdENvcHlGYWN0b3J5IiwidXJsIiwibWV0aG9kIiwiaGVhZGVycyIsImpzb24iLCJxcyIsInN0cmF0ZWd5SWQiLCJwb3NpdGlvbklkIiwiRXJyb3IiLCJlcnJvciIsIm5hbWUiLCJzaG91bGQiLCJlcXVhbCIsIm1lc3NhZ2UiLCJleHBlY3RlZCIsInJlYXNvbiIsInN0b3BwZWRBdCIsIkRhdGUiLCJzdHJhdGVneSIsImlkIiwicmVhc29uRGVzY3JpcHRpb24iLCJzZXF1ZW5jZU51bWJlciIsInJlc29sdmVzIiwic3RvcG91dHMiLCJnZXRTdG9wb3V0cyIsInJlc2V0U3RvcG91dHMiLCJ0aW1lIiwibGV2ZWwiLCJyZWNvcmRzIiwiZ2V0VXNlckxvZyIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJvZmZzZXQiLCJsaW1pdCIsImdldFN0cmF0ZWd5TG9nIiwiZ2V0QWNjb3VudFN0dWIiLCJ3aXRoQXJncyIsInJlZ2lvbnMiLCJjYWxsc0Zha2UiLCJob3N0IiwiZG9tYWluIiwiY2xpZW50IiwiZ2V0U2lnbmFsQ2xpZW50IiwibWF0Y2giLCJfYWNjb3VudElkIiwiX2hvc3QiLCJsaXN0ZW5lciIsIkxpc3RlbmVyIiwiU3RvcG91dExpc3RlbmVyIiwib25TdG9wb3V0Iiwic3RyYXRlZ3lTdG9wb3V0RXZlbnQiLCJjYWxsU3R1YiIsIl9zdG9wb3V0TGlzdGVuZXJNYW5hZ2VyIiwicmV0dXJucyIsImxpc3RlbmVySWQiLCJhZGRTdG9wb3V0TGlzdGVuZXIiLCJjYWxsZWRXaXRoIiwicmVtb3ZlU3RvcG91dExpc3RlbmVyIiwiVXNlckxvZ0xpc3RlbmVyIiwiX3VzZXJMb2dMaXN0ZW5lck1hbmFnZXIiLCJhZGRTdHJhdGVneUxvZ0xpc3RlbmVyIiwicmVtb3ZlU3RyYXRlZ3lMb2dMaXN0ZW5lciIsImFkZFN1YnNjcmliZXJMb2dMaXN0ZW5lciIsInJlbW92ZVN1YnNjcmliZXJMb2dMaXN0ZW5lciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQTs7O0FBR0FBLFNBQVMsZUFBVCxFQUEwQixNQUFNOztBQUU5QixNQUFJQyxhQUFKO0FBQ0EsUUFBTUMsUUFBUSxxQkFBZDtBQUNBLE1BQUlDLGFBQWEsSUFBSUMsb0JBQUosRUFBakI7QUFDQSxNQUFJQyxZQUFKO0FBQ0EsTUFBSUMsT0FBSjtBQUNBLE1BQUlDLFdBQUo7O0FBRUFDLFNBQU8sTUFBTTtBQUNYRixjQUFVRyxnQkFBTUMsYUFBTixFQUFWO0FBQ0QsR0FGRDs7QUFJQUMsYUFBVyxNQUFNO0FBQ2ZOLG1CQUFlLElBQUlPLGdCQUFKLENBQWlCVCxVQUFqQixFQUE2QkQsS0FBN0IsQ0FBZjtBQUNBRCxvQkFBZ0IsSUFBSVksaUJBQUosQ0FBa0JSLFlBQWxCLENBQWhCO0FBQ0FFLGtCQUFjRCxRQUFRUSxJQUFSLENBQWFULFlBQWIsRUFBMkIsb0JBQTNCLENBQWQ7QUFDRCxHQUpEOztBQU1BVSxZQUFVLE1BQU07QUFDZFQsWUFBUVUsT0FBUjtBQUNELEdBRkQ7O0FBSUE7OztBQUdBQyxLQUFHLDBDQUFILEVBQStDLFlBQVk7QUFDekQsVUFBTWhCLGNBQWNpQixhQUFkLENBQTRCLHNDQUE1QixFQUFvRSxDQUFDLE1BQUQsQ0FBcEUsRUFDSixDQUFDLFNBQUQsQ0FESSxDQUFOO0FBRUFULG9CQUFNVSxNQUFOLENBQWFDLHFCQUFiLENBQW1DZixhQUFhZ0Isa0JBQWhELEVBQW9FO0FBQ2xFQyxXQUFLLCtFQUQ2RDtBQUVsRUMsY0FBUSxNQUYwRDtBQUdsRUMsZUFBUztBQUNQLHNCQUFjdEI7QUFEUCxPQUh5RDtBQU1sRXVCLFlBQU0sSUFONEQ7QUFPbEVDLFVBQUk7QUFDRkMsb0JBQVksQ0FBQyxNQUFELENBRFY7QUFFRkMsb0JBQVksQ0FBQyxTQUFEO0FBRlY7QUFQOEQsS0FBcEU7QUFZRCxHQWZEOztBQWlCQTs7O0FBR0FYLEtBQUcscURBQUgsRUFBMEQsWUFBWTtBQUNwRVosbUJBQWUsSUFBSU8sZ0JBQUosQ0FBaUJULFVBQWpCLEVBQTZCLE9BQTdCLENBQWY7QUFDQUYsb0JBQWdCLElBQUlZLGlCQUFKLENBQWtCUixZQUFsQixDQUFoQjtBQUNBLFFBQUk7QUFDRixZQUFNSixjQUFjaUIsYUFBZCxDQUE0QixzQ0FBNUIsQ0FBTjtBQUNBLFlBQU0sSUFBSVcsS0FBSixDQUFVLDRCQUFWLENBQU47QUFDRCxLQUhELENBR0UsT0FBT0MsS0FBUCxFQUFjO0FBQ2RBLFlBQU1DLElBQU4sQ0FBV0MsTUFBWCxDQUFrQkMsS0FBbEIsQ0FBd0IsbUJBQXhCO0FBQ0FILFlBQU1JLE9BQU4sQ0FBY0YsTUFBZCxDQUFxQkMsS0FBckIsQ0FDRSxvR0FDQSw4RkFGRjtBQUlEO0FBQ0YsR0FiRDs7QUFlQTs7O0FBR0FoQixLQUFHLDBCQUFILEVBQStCLFlBQVk7QUFDekMsUUFBSWtCLFdBQVcsQ0FBQztBQUNkUixrQkFBWSxXQURFO0FBRWRTLGNBQVEsaUJBRk07QUFHZEMsaUJBQVcsSUFBSUMsSUFBSixDQUFTLDBCQUFULENBSEc7QUFJZEMsZ0JBQVU7QUFDUkMsWUFBSSxNQURJO0FBRVJULGNBQU07QUFGRSxPQUpJO0FBUWRVLHlCQUFtQiwrQ0FSTDtBQVNkQyxzQkFBZ0I7QUFURixLQUFELENBQWY7QUFXQW5DLGdCQUFZb0MsUUFBWixDQUFxQlIsUUFBckI7QUFDQSxRQUFJUyxXQUFXLE1BQU0zQyxjQUFjNEMsV0FBZCxDQUEwQixzQ0FBMUIsQ0FBckI7QUFDQUQsYUFBU1osTUFBVCxDQUFnQkMsS0FBaEIsQ0FBc0JFLFFBQXRCO0FBQ0ExQixvQkFBTVUsTUFBTixDQUFhQyxxQkFBYixDQUFtQ2YsYUFBYWdCLGtCQUFoRCxFQUFvRTtBQUNsRUMsV0FBSywwRUFENkQ7QUFFbEVDLGNBQVEsS0FGMEQ7QUFHbEVDLGVBQVM7QUFDUCxzQkFBY3RCO0FBRFAsT0FIeUQ7QUFNbEV1QixZQUFNO0FBTjRELEtBQXBFO0FBUUQsR0F2QkQ7O0FBeUJBOzs7QUFHQVIsS0FBRywwREFBSCxFQUErRCxZQUFZO0FBQ3pFWixtQkFBZSxJQUFJTyxnQkFBSixDQUFpQlQsVUFBakIsRUFBNkIsT0FBN0IsQ0FBZjtBQUNBRixvQkFBZ0IsSUFBSVksaUJBQUosQ0FBa0JSLFlBQWxCLENBQWhCO0FBQ0EsUUFBSTtBQUNGLFlBQU1KLGNBQWM0QyxXQUFkLENBQTBCLHNDQUExQixDQUFOO0FBQ0EsWUFBTSxJQUFJaEIsS0FBSixDQUFVLDRCQUFWLENBQU47QUFDRCxLQUhELENBR0UsT0FBT0MsS0FBUCxFQUFjO0FBQ2RBLFlBQU1DLElBQU4sQ0FBV0MsTUFBWCxDQUFrQkMsS0FBbEIsQ0FBd0IsbUJBQXhCO0FBQ0FILFlBQU1JLE9BQU4sQ0FBY0YsTUFBZCxDQUFxQkMsS0FBckIsQ0FDRSxrR0FDQSw4RkFGRjtBQUlEO0FBQ0YsR0FiRDs7QUFlQTs7O0FBR0FoQixLQUFHLHVCQUFILEVBQTRCLFlBQVk7QUFDdEMsVUFBTWhCLGNBQWM2QyxhQUFkLENBQTRCLHNDQUE1QixFQUFvRSxNQUFwRSxFQUE0RSxjQUE1RSxDQUFOO0FBQ0FyQyxvQkFBTVUsTUFBTixDQUFhQyxxQkFBYixDQUFtQ2YsYUFBYWdCLGtCQUFoRCxFQUFvRTtBQUNsRUMsV0FBSyxnQ0FDSCwrRkFGZ0U7QUFHbEVDLGNBQVEsTUFIMEQ7QUFJbEVDLGVBQVM7QUFDUCxzQkFBY3RCO0FBRFAsT0FKeUQ7QUFPbEV1QixZQUFNO0FBUDRELEtBQXBFO0FBU0QsR0FYRDs7QUFhQTs7O0FBR0FSLEtBQUcsOENBQUgsRUFBbUQsWUFBWTtBQUM3RFosbUJBQWUsSUFBSU8sZ0JBQUosQ0FBaUJULFVBQWpCLEVBQTZCLE9BQTdCLENBQWY7QUFDQUYsb0JBQWdCLElBQUlZLGlCQUFKLENBQWtCUixZQUFsQixDQUFoQjtBQUNBLFFBQUk7QUFDRixZQUFNSixjQUFjNkMsYUFBZCxDQUE0QixzQ0FBNUIsRUFDSixNQURJLEVBQ0ksY0FESixDQUFOO0FBRUEsWUFBTSxJQUFJakIsS0FBSixDQUFVLDRCQUFWLENBQU47QUFDRCxLQUpELENBSUUsT0FBT0MsS0FBUCxFQUFjO0FBQ2RBLFlBQU1DLElBQU4sQ0FBV0MsTUFBWCxDQUFrQkMsS0FBbEIsQ0FBd0IsbUJBQXhCO0FBQ0FILFlBQU1JLE9BQU4sQ0FBY0YsTUFBZCxDQUFxQkMsS0FBckIsQ0FDRSxvR0FDQSw4RkFGRjtBQUlEO0FBQ0YsR0FkRDs7QUFnQkE7OztBQUdBaEIsS0FBRyx1Q0FBSCxFQUE0QyxZQUFZO0FBQ3RELFFBQUlrQixXQUFXLENBQUM7QUFDZFksWUFBTSxJQUFJVCxJQUFKLENBQVMsMEJBQVQsQ0FEUTtBQUVkVSxhQUFPLE1BRk87QUFHZGQsZUFBUztBQUhLLEtBQUQsQ0FBZjtBQUtBM0IsZ0JBQVlvQyxRQUFaLENBQXFCUixRQUFyQjtBQUNBLFFBQUljLFVBQVUsTUFBTWhELGNBQWNpRCxVQUFkLENBQXlCLHNDQUF6QixFQUNsQixJQUFJWixJQUFKLENBQVMsMEJBQVQsQ0FEa0IsRUFDb0IsSUFBSUEsSUFBSixDQUFTLDBCQUFULENBRHBCLEVBQzBELEVBRDFELEVBQzhELEdBRDlELENBQXBCO0FBRUFXLFlBQVFqQixNQUFSLENBQWVDLEtBQWYsQ0FBcUJFLFFBQXJCO0FBQ0ExQixvQkFBTVUsTUFBTixDQUFhQyxxQkFBYixDQUFtQ2YsYUFBYWdCLGtCQUFoRCxFQUFvRTtBQUNsRUMsV0FBSywwRUFENkQ7QUFFbEVDLGNBQVEsS0FGMEQ7QUFHbEVHLFVBQUk7QUFDRnlCLG1CQUFXLElBQUliLElBQUosQ0FBUywwQkFBVCxDQURUO0FBRUZjLGlCQUFTLElBQUlkLElBQUosQ0FBUywwQkFBVCxDQUZQO0FBR0ZlLGdCQUFRLEVBSE47QUFJRkMsZUFBTztBQUpMLE9BSDhEO0FBU2xFOUIsZUFBUztBQUNQLHNCQUFjdEI7QUFEUCxPQVR5RDtBQVlsRXVCLFlBQU07QUFaNEQsS0FBcEUsRUFhRyxJQWJIO0FBY0QsR0F4QkQ7O0FBMEJBOzs7QUFHQVIsS0FBRyx1RUFBSCxFQUE0RSxZQUFZO0FBQ3RGWixtQkFBZSxJQUFJTyxnQkFBSixDQUFpQlQsVUFBakIsRUFBNkIsT0FBN0IsQ0FBZjtBQUNBRixvQkFBZ0IsSUFBSVksaUJBQUosQ0FBa0JSLFlBQWxCLENBQWhCO0FBQ0EsUUFBSTtBQUNGLFlBQU1KLGNBQWNpRCxVQUFkLENBQXlCLHNDQUF6QixDQUFOO0FBQ0EsWUFBTSxJQUFJckIsS0FBSixDQUFVLDRCQUFWLENBQU47QUFDRCxLQUhELENBR0UsT0FBT0MsS0FBUCxFQUFjO0FBQ2RBLFlBQU1DLElBQU4sQ0FBV0MsTUFBWCxDQUFrQkMsS0FBbEIsQ0FBd0IsbUJBQXhCO0FBQ0FILFlBQU1JLE9BQU4sQ0FBY0YsTUFBZCxDQUFxQkMsS0FBckIsQ0FDRSxpR0FDQSw4RkFGRjtBQUlEO0FBQ0YsR0FiRDs7QUFlQTs7O0FBR0FoQixLQUFHLDJDQUFILEVBQWdELFlBQVk7QUFDMUQsUUFBSWtCLFdBQVcsQ0FDYjtBQUNFWSxZQUFNLElBQUlULElBQUosQ0FBUywwQkFBVCxDQURSO0FBRUVVLGFBQU8sTUFGVDtBQUdFZCxlQUFTO0FBSFgsS0FEYSxDQUFmO0FBT0EzQixnQkFBWW9DLFFBQVosQ0FBcUJSLFFBQXJCO0FBQ0EsUUFBSWMsVUFBVSxNQUFNaEQsY0FBY3NELGNBQWQsQ0FBNkIsTUFBN0IsRUFDbEIsSUFBSWpCLElBQUosQ0FBUywwQkFBVCxDQURrQixFQUNvQixJQUFJQSxJQUFKLENBQVMsMEJBQVQsQ0FEcEIsRUFDMEQsRUFEMUQsRUFDOEQsR0FEOUQsQ0FBcEI7QUFFQVcsWUFBUWpCLE1BQVIsQ0FBZUMsS0FBZixDQUFxQkUsUUFBckI7QUFDQTFCLG9CQUFNVSxNQUFOLENBQWFDLHFCQUFiLENBQW1DZixhQUFhZ0Isa0JBQWhELEVBQW9FO0FBQ2xFQyxXQUFLLHlDQUQ2RDtBQUVsRUMsY0FBUSxLQUYwRDtBQUdsRUcsVUFBSTtBQUNGeUIsbUJBQVcsSUFBSWIsSUFBSixDQUFTLDBCQUFULENBRFQ7QUFFRmMsaUJBQVMsSUFBSWQsSUFBSixDQUFTLDBCQUFULENBRlA7QUFHRmUsZ0JBQVEsRUFITjtBQUlGQyxlQUFPO0FBSkwsT0FIOEQ7QUFTbEU5QixlQUFTO0FBQ1Asc0JBQWN0QjtBQURQLE9BVHlEO0FBWWxFdUIsWUFBTTtBQVo0RCxLQUFwRSxFQWFHLElBYkg7QUFjRCxHQTFCRDs7QUE0QkE7OztBQUdBUixLQUFHLDJFQUFILEVBQWdGLFlBQVk7QUFDMUZaLG1CQUFlLElBQUlPLGdCQUFKLENBQWlCVCxVQUFqQixFQUE2QixPQUE3QixDQUFmO0FBQ0FGLG9CQUFnQixJQUFJWSxpQkFBSixDQUFrQlIsWUFBbEIsQ0FBaEI7QUFDQSxRQUFJO0FBQ0YsWUFBTUosY0FBY3NELGNBQWQsQ0FBNkIsTUFBN0IsQ0FBTjtBQUNBLFlBQU0sSUFBSTFCLEtBQUosQ0FBVSw0QkFBVixDQUFOO0FBQ0QsS0FIRCxDQUdFLE9BQU9DLEtBQVAsRUFBYztBQUNkQSxZQUFNQyxJQUFOLENBQVdDLE1BQVgsQ0FBa0JDLEtBQWxCLENBQXdCLG1CQUF4QjtBQUNBSCxZQUFNSSxPQUFOLENBQWNGLE1BQWQsQ0FBcUJDLEtBQXJCLENBQ0UscUdBQ0UsOEZBRko7QUFJRDtBQUNGLEdBYkQ7O0FBZUE7OztBQUdBakMsV0FBUyxpQkFBVCxFQUE0QixNQUFNO0FBQ2hDLFFBQUl3RCxjQUFKOztBQUVBN0MsZUFBVyxNQUFNO0FBQ2Y2Qyx1QkFBaUJsRCxRQUFRUSxJQUFSLENBQWFULFlBQWIsRUFBMkIsZ0JBQTNCLEVBQTZDb0QsUUFBN0MsQ0FBc0QsV0FBdEQsQ0FBakI7QUFDQUQscUJBQWViLFFBQWYsQ0FBd0IsRUFBQ0gsSUFBSSxXQUFMLEVBQWtCa0IsU0FBUyxDQUFDLFdBQUQsQ0FBM0IsRUFBeEI7QUFDQXBELGNBQVFRLElBQVIsQ0FBYVQsWUFBYixFQUEyQixxQkFBM0IsRUFDR3NELFNBREgsQ0FDY0QsT0FBRCxLQUFjO0FBQ3ZCRSxjQUFNLDRCQURpQjtBQUV2QkYsZUFGdUI7QUFHdkJHLGdCQUFRO0FBSGUsT0FBZCxDQURiO0FBTUQsS0FURDs7QUFXQTs7O0FBR0E1QyxPQUFHLG9CQUFILEVBQXlCLFlBQVk7QUFDbkMsWUFBTTZDLFNBQVMsTUFBTTdELGNBQWM4RCxlQUFkLENBQThCLFdBQTlCLENBQXJCO0FBQ0F0RCxzQkFBTVUsTUFBTixDQUFhNkMsS0FBYixDQUFtQkYsT0FBT0csVUFBMUIsRUFBc0MsV0FBdEM7QUFDQXhELHNCQUFNVSxNQUFOLENBQWE2QyxLQUFiLENBQW1CRixPQUFPSSxLQUFQLENBQWFSLE9BQWhDLEVBQXlDLENBQUMsV0FBRCxDQUF6QztBQUNELEtBSkQ7QUFNRCxHQXZCRDs7QUF5QkE7Ozs7QUFJQTFELFdBQVMsaUJBQVQsRUFBNEIsTUFBTTs7QUFFaEMsUUFBSW1FLFFBQUo7O0FBRUF4RCxlQUFXLE1BQU07O0FBRWYsWUFBTXlELFFBQU4sU0FBdUJDLHlCQUF2QixDQUF1QztBQUNyQyxjQUFNQyxTQUFOLENBQWdCQyxvQkFBaEIsRUFBc0MsQ0FBRTtBQURIOztBQUl2Q0osaUJBQVcsSUFBSUMsUUFBSixFQUFYO0FBQ0QsS0FQRDs7QUFTQTs7O0FBR0FuRCxPQUFHLDZCQUFILEVBQWtDLFlBQVk7QUFDNUMsWUFBTXVELFdBQVcvRCxnQkFBTUssSUFBTixDQUFXYixjQUFjd0UsdUJBQXpCLEVBQWtELG9CQUFsRCxFQUF3RUMsT0FBeEUsQ0FBZ0YsWUFBaEYsQ0FBakI7QUFDQSxZQUFNQyxhQUFhMUUsY0FBYzJFLGtCQUFkLENBQWlDVCxRQUFqQyxFQUEyQyxXQUEzQyxFQUF3RCxNQUF4RCxFQUFnRSxDQUFoRSxDQUFuQjtBQUNBMUQsc0JBQU1VLE1BQU4sQ0FBYTZDLEtBQWIsQ0FBbUJXLFVBQW5CLEVBQStCLFlBQS9CO0FBQ0FsRSxzQkFBTVUsTUFBTixDQUFhMEQsVUFBYixDQUF3QkwsUUFBeEIsRUFBa0NMLFFBQWxDLEVBQTRDLFdBQTVDLEVBQXlELE1BQXpELEVBQWlFLENBQWpFO0FBQ0QsS0FMRDs7QUFPQTs7O0FBR0FsRCxPQUFHLGdDQUFILEVBQXFDLFlBQVk7QUFDL0MsWUFBTXVELFdBQVcvRCxnQkFBTUssSUFBTixDQUFXYixjQUFjd0UsdUJBQXpCLEVBQWtELHVCQUFsRCxDQUFqQjtBQUNBeEUsb0JBQWM2RSxxQkFBZCxDQUFvQyxJQUFwQztBQUNBckUsc0JBQU1VLE1BQU4sQ0FBYTBELFVBQWIsQ0FBd0JMLFFBQXhCLEVBQWtDLElBQWxDO0FBQ0QsS0FKRDtBQU1ELEdBaENEOztBQWtDQTs7OztBQUlBeEUsV0FBUyxpQkFBVCxFQUE0QixNQUFNOztBQUVoQyxRQUFJbUUsUUFBSjs7QUFFQXhELGVBQVcsTUFBTTs7QUFFZixZQUFNeUQsUUFBTixTQUF1QlcseUJBQXZCLENBQXVDO0FBQ3JDLGNBQU1ULFNBQU4sQ0FBZ0JDLG9CQUFoQixFQUFzQyxDQUFFO0FBREg7O0FBSXZDSixpQkFBVyxJQUFJQyxRQUFKLEVBQVg7QUFDRCxLQVBEOztBQVNBOzs7QUFHQW5ELE9BQUcsOEJBQUgsRUFBbUMsWUFBWTtBQUM3QyxZQUFNdUQsV0FBVy9ELGdCQUFNSyxJQUFOLENBQVdiLGNBQWMrRSx1QkFBekIsRUFBa0Qsd0JBQWxELEVBQ2ROLE9BRGMsQ0FDTixZQURNLENBQWpCO0FBRUEsWUFBTUMsYUFBYTFFLGNBQWNnRixzQkFBZCxDQUFxQ2QsUUFBckMsRUFBK0MsTUFBL0MsQ0FBbkI7QUFDQTFELHNCQUFNVSxNQUFOLENBQWE2QyxLQUFiLENBQW1CVyxVQUFuQixFQUErQixZQUEvQjtBQUNBbEUsc0JBQU1VLE1BQU4sQ0FBYTBELFVBQWIsQ0FBd0JMLFFBQXhCLEVBQWtDTCxRQUFsQyxFQUE0QyxNQUE1QztBQUNELEtBTkQ7O0FBUUE7OztBQUdBbEQsT0FBRyxpQ0FBSCxFQUFzQyxZQUFZO0FBQ2hELFlBQU11RCxXQUFXL0QsZ0JBQU1LLElBQU4sQ0FBV2IsY0FBYytFLHVCQUF6QixFQUFrRCwyQkFBbEQsQ0FBakI7QUFDQS9FLG9CQUFjaUYseUJBQWQsQ0FBd0MsSUFBeEM7QUFDQXpFLHNCQUFNVSxNQUFOLENBQWEwRCxVQUFiLENBQXdCTCxRQUF4QixFQUFrQyxJQUFsQztBQUNELEtBSkQ7O0FBTUE7OztBQUdBdkQsT0FBRyxnQ0FBSCxFQUFxQyxZQUFZO0FBQy9DLFlBQU11RCxXQUFXL0QsZ0JBQU1LLElBQU4sQ0FBV2IsY0FBYytFLHVCQUF6QixFQUFrRCwwQkFBbEQsRUFDZE4sT0FEYyxDQUNOLFlBRE0sQ0FBakI7QUFFQSxZQUFNQyxhQUFhMUUsY0FBY2tGLHdCQUFkLENBQXVDaEIsUUFBdkMsRUFBaUQsV0FBakQsQ0FBbkI7QUFDQTFELHNCQUFNVSxNQUFOLENBQWE2QyxLQUFiLENBQW1CVyxVQUFuQixFQUErQixZQUEvQjtBQUNBbEUsc0JBQU1VLE1BQU4sQ0FBYTBELFVBQWIsQ0FBd0JMLFFBQXhCLEVBQWtDTCxRQUFsQyxFQUE0QyxXQUE1QztBQUNELEtBTkQ7O0FBUUE7OztBQUdBbEQsT0FBRyxtQ0FBSCxFQUF3QyxZQUFZO0FBQ2xELFlBQU11RCxXQUFXL0QsZ0JBQU1LLElBQU4sQ0FBV2IsY0FBYytFLHVCQUF6QixFQUFrRCw2QkFBbEQsQ0FBakI7QUFDQS9FLG9CQUFjbUYsMkJBQWQsQ0FBMEMsSUFBMUM7QUFDQTNFLHNCQUFNVSxNQUFOLENBQWEwRCxVQUFiLENBQXdCTCxRQUF4QixFQUFrQyxJQUFsQztBQUNELEtBSkQ7QUFNRCxHQXJERDtBQXVERCxDQTNXRCIsImZpbGUiOiJ0cmFkaW5nLmNsaWVudC5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgSHR0cENsaWVudCBmcm9tICcuLi9odHRwQ2xpZW50JztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgVHJhZGluZ0NsaWVudCBmcm9tICcuL3RyYWRpbmcuY2xpZW50JztcbmltcG9ydCBEb21haW5DbGllbnQgZnJvbSAnLi4vZG9tYWluLmNsaWVudCc7XG5pbXBvcnQgU3RvcG91dExpc3RlbmVyIGZyb20gJy4vc3RyZWFtaW5nL3N0b3BvdXRMaXN0ZW5lcic7XG5pbXBvcnQgVXNlckxvZ0xpc3RlbmVyIGZyb20gJy4vc3RyZWFtaW5nL3VzZXJMb2dMaXN0ZW5lcic7XG5cbi8qKlxuICogQHRlc3Qge1RyYWRpbmdDbGllbnR9XG4gKi9cbmRlc2NyaWJlKCdUcmFkaW5nQ2xpZW50JywgKCkgPT4ge1xuXG4gIGxldCB0cmFkaW5nQ2xpZW50O1xuICBjb25zdCB0b2tlbiA9ICdoZWFkZXIucGF5bG9hZC5zaWduJztcbiAgbGV0IGh0dHBDbGllbnQgPSBuZXcgSHR0cENsaWVudCgpO1xuICBsZXQgZG9tYWluQ2xpZW50O1xuICBsZXQgc2FuZGJveDtcbiAgbGV0IHJlcXVlc3RTdHViO1xuXG4gIGJlZm9yZSgoKSA9PiB7XG4gICAgc2FuZGJveCA9IHNpbm9uLmNyZWF0ZVNhbmRib3goKTtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgZG9tYWluQ2xpZW50ID0gbmV3IERvbWFpbkNsaWVudChodHRwQ2xpZW50LCB0b2tlbik7XG4gICAgdHJhZGluZ0NsaWVudCA9IG5ldyBUcmFkaW5nQ2xpZW50KGRvbWFpbkNsaWVudCk7XG4gICAgcmVxdWVzdFN0dWIgPSBzYW5kYm94LnN0dWIoZG9tYWluQ2xpZW50LCAncmVxdWVzdENvcHlGYWN0b3J5Jyk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNyZXN5bmNocm9uaXplfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXN5bmNocm9uaXplIENvcHlGYWN0b3J5IGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgdHJhZGluZ0NsaWVudC5yZXN5bmNocm9uaXplKCdlODg2N2JhYS01ZWMyLTQ1YWUtOTkzMC00ZDVjZWExOGQwZDYnLCBbJ0FCQ0QnXSxcbiAgICAgIFsnMDEyMzQ1NiddKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGRvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3RvcnksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzL2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNi9yZXN5bmNocm9uaXplJyxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICAgIHFzOiB7XG4gICAgICAgIHN0cmF0ZWd5SWQ6IFsnQUJDRCddLFxuICAgICAgICBwb3NpdGlvbklkOiBbJzAxMjM0NTYnXVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjcmVzeW5jaHJvbml6ZX1cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IHJlc3luY2hyb25pemUgYWNjb3VudCB3aXRoIGFjY291bnQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgZG9tYWluQ2xpZW50ID0gbmV3IERvbWFpbkNsaWVudChodHRwQ2xpZW50LCAndG9rZW4nKTtcbiAgICB0cmFkaW5nQ2xpZW50ID0gbmV3IFRyYWRpbmdDbGllbnQoZG9tYWluQ2xpZW50KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdHJhZGluZ0NsaWVudC5yZXN5bmNocm9uaXplKCdlODg2N2JhYS01ZWMyLTQ1YWUtOTkzMC00ZDVjZWExOGQwZDYnKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kQWNjZXNzRXJyb3IgZXhwZWN0ZWQnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3IubmFtZS5zaG91bGQuZXF1YWwoJ01ldGhvZEFjY2Vzc0Vycm9yJyk7XG4gICAgICBlcnJvci5tZXNzYWdlLnNob3VsZC5lcXVhbChcbiAgICAgICAgJ1lvdSBjYW4gbm90IGludm9rZSByZXN5bmNocm9uaXplIG1ldGhvZCwgYmVjYXVzZSB5b3UgaGF2ZSBjb25uZWN0ZWQgd2l0aCBhY2NvdW50IGFjY2VzcyB0b2tlbi4gJyArXG4gICAgICAgICdQbGVhc2UgdXNlIEFQSSBhY2Nlc3MgdG9rZW4gZnJvbSBodHRwczovL2FwcC5tZXRhYXBpLmNsb3VkL3Rva2VuIHBhZ2UgdG8gaW52b2tlIHRoaXMgbWV0aG9kLidcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjZ2V0U3RvcG91dHN9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHJpZXZlIHN0b3BvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IFt7XG4gICAgICBzdHJhdGVneUlkOiAnYWNjb3VudElkJyxcbiAgICAgIHJlYXNvbjogJ21vbnRobHktYmFsYW5jZScsXG4gICAgICBzdG9wcGVkQXQ6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA3OjU3OjMwLjMyOFonKSxcbiAgICAgIHN0cmF0ZWd5OiB7XG4gICAgICAgIGlkOiAnQUJDRCcsXG4gICAgICAgIG5hbWU6ICdTdHJhdGVneSdcbiAgICAgIH0sXG4gICAgICByZWFzb25EZXNjcmlwdGlvbjogJ3RvdGFsIHN0cmF0ZWd5IGVxdWl0eSBkcmF3ZG93biBleGNlZWRlZCBsaW1pdCcsXG4gICAgICBzZXF1ZW5jZU51bWJlcjogMlxuICAgIH1dO1xuICAgIHJlcXVlc3RTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBsZXQgc3RvcG91dHMgPSBhd2FpdCB0cmFkaW5nQ2xpZW50LmdldFN0b3BvdXRzKCdlODg2N2JhYS01ZWMyLTQ1YWUtOTkzMC00ZDVjZWExOGQwZDYnKTtcbiAgICBzdG9wb3V0cy5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2L3N0b3BvdXRzJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjZ2V0U3RvcG91dHN9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCByZXRyaWV2ZSBzdG9wb3V0cyBmcm9tIEFQSSB3aXRoIGFjY291bnQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgZG9tYWluQ2xpZW50ID0gbmV3IERvbWFpbkNsaWVudChodHRwQ2xpZW50LCAndG9rZW4nKTtcbiAgICB0cmFkaW5nQ2xpZW50ID0gbmV3IFRyYWRpbmdDbGllbnQoZG9tYWluQ2xpZW50KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdHJhZGluZ0NsaWVudC5nZXRTdG9wb3V0cygnZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2Jyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZEFjY2Vzc0Vycm9yIGV4cGVjdGVkJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm5hbWUuc2hvdWxkLmVxdWFsKCdNZXRob2RBY2Nlc3NFcnJvcicpO1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgZ2V0U3RvcG91dHMgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNyZXNldFN0b3BvdXRzfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXNldCBzdG9wb3V0cycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCB0cmFkaW5nQ2xpZW50LnJlc2V0U3RvcG91dHMoJ2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNicsICdBQkNEJywgJ2RhaWx5LWVxdWl0eScpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvJyArXG4gICAgICAgICdlODg2N2JhYS01ZWMyLTQ1YWUtOTkzMC00ZDVjZWExOGQwZDYvc3Vic2NyaXB0aW9uLXN0cmF0ZWdpZXMvQUJDRC9zdG9wb3V0cy9kYWlseS1lcXVpdHkvcmVzZXQnLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjcmVzZXRTdG9wb3V0c31cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IHJlc2V0IHN0b3BvdXRzIHdpdGggYWNjb3VudCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICBkb21haW5DbGllbnQgPSBuZXcgRG9tYWluQ2xpZW50KGh0dHBDbGllbnQsICd0b2tlbicpO1xuICAgIHRyYWRpbmdDbGllbnQgPSBuZXcgVHJhZGluZ0NsaWVudChkb21haW5DbGllbnQpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0cmFkaW5nQ2xpZW50LnJlc2V0U3RvcG91dHMoJ2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNicsXG4gICAgICAgICdBQkNEJywgJ2RhaWx5LWVxdWl0eScpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2RBY2Nlc3NFcnJvciBleHBlY3RlZCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvci5uYW1lLnNob3VsZC5lcXVhbCgnTWV0aG9kQWNjZXNzRXJyb3InKTtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIHJlc2V0U3RvcG91dHMgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNnZXRVc2VyTG9nfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBjb3B5IHRyYWRpbmcgdXNlciBsb2cnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0gW3tcbiAgICAgIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA3OjU3OjMwLjMyOFonKSxcbiAgICAgIGxldmVsOiAnSU5GTycsXG4gICAgICBtZXNzYWdlOiAnbWVzc2FnZSdcbiAgICB9XTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IHJlY29yZHMgPSBhd2FpdCB0cmFkaW5nQ2xpZW50LmdldFVzZXJMb2coJ2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNicsXG4gICAgICBuZXcgRGF0ZSgnMjAyMC0wOC0wMVQwMDowMDowMC4wMDBaJyksIG5ldyBEYXRlKCcyMDIwLTA4LTEwVDAwOjAwOjAwLjAwMFonKSwgMTAsIDEwMCk7XG4gICAgcmVjb3Jkcy5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RDb3B5RmFjdG9yeSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2L3VzZXItbG9nJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBxczoge1xuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTAxVDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgZW5kVGltZTogbmV3IERhdGUoJzIwMjAtMDgtMTBUMDA6MDA6MDAuMDAwWicpLFxuICAgICAgICBvZmZzZXQ6IDEwLFxuICAgICAgICBsaW1pdDogMTAwXG4gICAgICB9LFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9LCB0cnVlKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldFVzZXJMb2d9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCByZXRyaWV2ZSBjb3B5IHRyYWRpbmcgdXNlciBsb2cgZnJvbSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudCA9IG5ldyBEb21haW5DbGllbnQoaHR0cENsaWVudCwgJ3Rva2VuJyk7XG4gICAgdHJhZGluZ0NsaWVudCA9IG5ldyBUcmFkaW5nQ2xpZW50KGRvbWFpbkNsaWVudCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRyYWRpbmdDbGllbnQuZ2V0VXNlckxvZygnZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2Jyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZEFjY2Vzc0Vycm9yIGV4cGVjdGVkJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm5hbWUuc2hvdWxkLmVxdWFsKCdNZXRob2RBY2Nlc3NFcnJvcicpO1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgZ2V0VXNlckxvZyBtZXRob2QsIGJlY2F1c2UgeW91IGhhdmUgY29ubmVjdGVkIHdpdGggYWNjb3VudCBhY2Nlc3MgdG9rZW4uICcgK1xuICAgICAgICAnUGxlYXNlIHVzZSBBUEkgYWNjZXNzIHRva2VuIGZyb20gaHR0cHM6Ly9hcHAubWV0YWFwaS5jbG91ZC90b2tlbiBwYWdlIHRvIGludm9rZSB0aGlzIG1ldGhvZC4nXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldFN0cmF0ZWd5TG9nfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBjb3B5IHRyYWRpbmcgc3RyYXRlZ3kgbG9nJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IFtcbiAgICAgIHtcbiAgICAgICAgdGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDc6NTc6MzAuMzI4WicpLFxuICAgICAgICBsZXZlbDogJ0lORk8nLFxuICAgICAgICBtZXNzYWdlOiAnbWVzc2FnZSdcbiAgICAgIH1cbiAgICBdO1xuICAgIHJlcXVlc3RTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBsZXQgcmVjb3JkcyA9IGF3YWl0IHRyYWRpbmdDbGllbnQuZ2V0U3RyYXRlZ3lMb2coJ0FCQ0QnLFxuICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDFUMDA6MDA6MDAuMDAwWicpLCBuZXcgRGF0ZSgnMjAyMC0wOC0xMFQwMDowMDowMC4wMDBaJyksIDEwLCAxMDApO1xuICAgIHJlY29yZHMuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGRvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3RvcnksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvQUJDRC91c2VyLWxvZycsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgcXM6IHtcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wMVQwMDowMDowMC4wMDBaJyksXG4gICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTEwVDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgb2Zmc2V0OiAxMCxcbiAgICAgICAgbGltaXQ6IDEwMFxuICAgICAgfSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgfSwgdHJ1ZSk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldFN0cmF0ZWd5TG9nfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBub3QgcmV0cmlldmUgY29weSB0cmFkaW5nIHN0cmF0ZWd5IGxvZyBmcm9tIEFQSSB3aXRoIGFjY291bnQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgZG9tYWluQ2xpZW50ID0gbmV3IERvbWFpbkNsaWVudChodHRwQ2xpZW50LCAndG9rZW4nKTtcbiAgICB0cmFkaW5nQ2xpZW50ID0gbmV3IFRyYWRpbmdDbGllbnQoZG9tYWluQ2xpZW50KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdHJhZGluZ0NsaWVudC5nZXRTdHJhdGVneUxvZygnQUJDRCcpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2RBY2Nlc3NFcnJvciBleHBlY3RlZCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvci5uYW1lLnNob3VsZC5lcXVhbCgnTWV0aG9kQWNjZXNzRXJyb3InKTtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIGdldFN0cmF0ZWd5TG9nIG1ldGhvZCwgYmVjYXVzZSB5b3UgaGF2ZSBjb25uZWN0ZWQgd2l0aCBhY2NvdW50IGFjY2VzcyB0b2tlbi4gJyArXG4gICAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNnZXRTaWduYWxDbGllbnR9XG4gICAqL1xuICBkZXNjcmliZSgnZ2V0U2lnbmFsQ2xpZW50JywgKCkgPT4ge1xuICAgIGxldCBnZXRBY2NvdW50U3R1YjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgZ2V0QWNjb3VudFN0dWIgPSBzYW5kYm94LnN0dWIoZG9tYWluQ2xpZW50LCAnZ2V0QWNjb3VudEluZm8nKS53aXRoQXJncygnYWNjb3VudElkJyk7XG4gICAgICBnZXRBY2NvdW50U3R1Yi5yZXNvbHZlcyh7aWQ6ICdhY2NvdW50SWQnLCByZWdpb25zOiBbJ3ZpbnQtaGlsbCddfSk7XG4gICAgICBzYW5kYm94LnN0dWIoZG9tYWluQ2xpZW50LCAnZ2V0U2lnbmFsQ2xpZW50SG9zdCcpXG4gICAgICAgIC5jYWxsc0Zha2UoKHJlZ2lvbnMpID0+ICh7XG4gICAgICAgICAgaG9zdDogJ2h0dHBzOi8vY29weWZhY3RvcnktYXBpLXYxJyxcbiAgICAgICAgICByZWdpb25zLFxuICAgICAgICAgIGRvbWFpbjogJ2FnaWxpdW10cmFkZS5haSdcbiAgICAgICAgfSkpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjZ2V0U2lnbmFsQ2xpZW50fVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgZ2V0IGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0cmFkaW5nQ2xpZW50LmdldFNpZ25hbENsaWVudCgnYWNjb3VudElkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQubWF0Y2goY2xpZW50Ll9hY2NvdW50SWQsICdhY2NvdW50SWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5tYXRjaChjbGllbnQuX2hvc3QucmVnaW9ucywgWyd2aW50LWhpbGwnXSk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2FkZFN0b3BvdXRMaXN0ZW5lcn1cbiAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjcmVtb3ZlU3RvcG91dExpc3RlbmVyfVxuICAgKi9cbiAgZGVzY3JpYmUoJ3N0b3BvdXRMaXN0ZW5lcicsICgpID0+IHtcblxuICAgIGxldCBsaXN0ZW5lcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuXG4gICAgICBjbGFzcyBMaXN0ZW5lciBleHRlbmRzIFN0b3BvdXRMaXN0ZW5lciB7XG4gICAgICAgIGFzeW5jIG9uU3RvcG91dChzdHJhdGVneVN0b3BvdXRFdmVudCkge31cbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXIgPSBuZXcgTGlzdGVuZXIoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2FkZFN0b3BvdXRMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBzdG9wb3V0IGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbFN0dWIgPSBzaW5vbi5zdHViKHRyYWRpbmdDbGllbnQuX3N0b3BvdXRMaXN0ZW5lck1hbmFnZXIsICdhZGRTdG9wb3V0TGlzdGVuZXInKS5yZXR1cm5zKCdsaXN0ZW5lcklkJyk7XG4gICAgICBjb25zdCBsaXN0ZW5lcklkID0gdHJhZGluZ0NsaWVudC5hZGRTdG9wb3V0TGlzdGVuZXIobGlzdGVuZXIsICdhY2NvdW50SWQnLCAnQUJDRCcsIDEpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKGxpc3RlbmVySWQsICdsaXN0ZW5lcklkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgbGlzdGVuZXIsICdhY2NvdW50SWQnLCAnQUJDRCcsIDEpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjcmVtb3ZlU3RvcG91dExpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIHN0b3BvdXQgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNpbm9uLnN0dWIodHJhZGluZ0NsaWVudC5fc3RvcG91dExpc3RlbmVyTWFuYWdlciwgJ3JlbW92ZVN0b3BvdXRMaXN0ZW5lcicpO1xuICAgICAgdHJhZGluZ0NsaWVudC5yZW1vdmVTdG9wb3V0TGlzdGVuZXIoJ2lkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgJ2lkJyk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2FkZFN0cmF0ZWd5TG9nTGlzdGVuZXJ9XG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I3JlbW92ZVN0b3BvdXRMaXN0ZW5lcn1cbiAgICovXG4gIGRlc2NyaWJlKCd1c2VyTG9nTGlzdGVuZXInLCAoKSA9PiB7XG5cbiAgICBsZXQgbGlzdGVuZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcblxuICAgICAgY2xhc3MgTGlzdGVuZXIgZXh0ZW5kcyBVc2VyTG9nTGlzdGVuZXIge1xuICAgICAgICBhc3luYyBvblN0b3BvdXQoc3RyYXRlZ3lTdG9wb3V0RXZlbnQpIHt9XG4gICAgICB9XG5cbiAgICAgIGxpc3RlbmVyID0gbmV3IExpc3RlbmVyKCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNhZGRTdHJhdGVneUxvZ0xpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgYWRkIHN0cmF0ZWd5IGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbFN0dWIgPSBzaW5vbi5zdHViKHRyYWRpbmdDbGllbnQuX3VzZXJMb2dMaXN0ZW5lck1hbmFnZXIsICdhZGRTdHJhdGVneUxvZ0xpc3RlbmVyJylcbiAgICAgICAgLnJldHVybnMoJ2xpc3RlbmVySWQnKTtcbiAgICAgIGNvbnN0IGxpc3RlbmVySWQgPSB0cmFkaW5nQ2xpZW50LmFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIobGlzdGVuZXIsICdBQkNEJyk7XG4gICAgICBzaW5vbi5hc3NlcnQubWF0Y2gobGlzdGVuZXJJZCwgJ2xpc3RlbmVySWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBsaXN0ZW5lciwgJ0FCQ0QnKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I3JlbW92ZVN0cmF0ZWd5TG9nTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgc3RyYXRlZ3kgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNpbm9uLnN0dWIodHJhZGluZ0NsaWVudC5fdXNlckxvZ0xpc3RlbmVyTWFuYWdlciwgJ3JlbW92ZVN0cmF0ZWd5TG9nTGlzdGVuZXInKTtcbiAgICAgIHRyYWRpbmdDbGllbnQucmVtb3ZlU3RyYXRlZ3lMb2dMaXN0ZW5lcignaWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCAnaWQnKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2FkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBzdWJzY3JpYmVyIGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbFN0dWIgPSBzaW5vbi5zdHViKHRyYWRpbmdDbGllbnQuX3VzZXJMb2dMaXN0ZW5lck1hbmFnZXIsICdhZGRTdWJzY3JpYmVyTG9nTGlzdGVuZXInKVxuICAgICAgICAucmV0dXJucygnbGlzdGVuZXJJZCcpO1xuICAgICAgY29uc3QgbGlzdGVuZXJJZCA9IHRyYWRpbmdDbGllbnQuYWRkU3Vic2NyaWJlckxvZ0xpc3RlbmVyKGxpc3RlbmVyLCAnYWNjb3VudElkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQubWF0Y2gobGlzdGVuZXJJZCwgJ2xpc3RlbmVySWQnKTtcbiAgICAgIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGNhbGxTdHViLCBsaXN0ZW5lciwgJ2FjY291bnRJZCcpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge1RyYWRpbmdDbGllbnQjcmVtb3ZlU3Vic2NyaWJlckxvZ0xpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIHN1YnNjcmliZXIgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNpbm9uLnN0dWIodHJhZGluZ0NsaWVudC5fdXNlckxvZ0xpc3RlbmVyTWFuYWdlciwgJ3JlbW92ZVN1YnNjcmliZXJMb2dMaXN0ZW5lcicpO1xuICAgICAgdHJhZGluZ0NsaWVudC5yZW1vdmVTdWJzY3JpYmVyTG9nTGlzdGVuZXIoJ2lkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgJ2lkJyk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbn0pO1xuIl19