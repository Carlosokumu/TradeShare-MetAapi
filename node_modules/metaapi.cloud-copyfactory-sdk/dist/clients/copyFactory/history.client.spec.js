'use strict';

var _httpClient = require('../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _history = require('./history.client');

var _history2 = _interopRequireDefault(_history);

var _domain = require('../domain.client');

var _domain2 = _interopRequireDefault(_domain);

var _transactionListener = require('./streaming//transactionListener');

var _transactionListener2 = _interopRequireDefault(_transactionListener);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {HistoryClient}
 */
describe('HistoryClient', () => {

  let copyFactoryClient;
  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let domainClient;
  let sandbox;
  let requestStub;

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    domainClient = new _domain2.default(httpClient, token);
    copyFactoryClient = new _history2.default(domainClient);
    requestStub = sandbox.stub(domainClient, 'requestCopyFactory');
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {HistoryClient#getProvidedTransactions}
   */
  it('should retrieve transactions performed on provided strategies from API', async () => {
    let expected = [{
      id: '64664661:close',
      type: 'DEAL_TYPE_SELL',
      time: new Date('2020-08-02T21:01:01.830Z'),
      subscriberId: 'e8867baa-5ec2-45ae-9930-4d5cea18d0d6',
      symbol: 'EURJPY',
      subscriberUser: {
        id: 'subscriberId',
        name: 'Subscriber'
      },
      demo: false,
      providerUser: {
        id: 'providerId',
        name: 'Provider'
      },
      strategy: {
        id: 'ABCD'
      },
      improvement: 0,
      providerCommission: 0,
      platformCommission: 0,
      quantity: -0.04,
      lotPrice: 117566.08744776,
      tickPrice: 124.526,
      amount: -4702.643497910401,
      commission: -0.14,
      swap: -0.14,
      profit: 0.49
    }];
    let from = new Date();
    let till = new Date();
    requestStub.resolves(expected);
    let transactions = await copyFactoryClient.getProvidedTransactions(from, till, ['ABCD'], ['e8867baa-5ec2-45ae-9930-4d5cea18d0d6'], 100, 200);
    transactions.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/provided-transactions',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      qs: {
        from,
        till,
        strategyId: ['ABCD'],
        subscriberId: ['e8867baa-5ec2-45ae-9930-4d5cea18d0d6'],
        offset: 100,
        limit: 200
      },
      json: true
    }, true);
  });

  /**
   * @test {HistoryClient#getProvidedTransactions}
   */
  it('should not retrieve transactions on provided strategies from API with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    copyFactoryClient = new _history2.default(domainClient);
    try {
      await copyFactoryClient.getProvidedTransactions(new Date(), new Date());
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke getProvidedTransactions method, because you have connected with account ' + 'access token. Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {HistoryClient#getSubscriptionTransactions}
   */
  it('should retrieve transactions performed on strategies current user is subscribed to from API', async () => {
    let expected = [{
      id: '64664661:close',
      type: 'DEAL_TYPE_SELL',
      time: new Date('2020-08-02T21:01:01.830Z'),
      subscriberId: 'e8867baa-5ec2-45ae-9930-4d5cea18d0d6',
      symbol: 'EURJPY',
      subscriberUser: {
        id: 'subscriberId',
        name: 'Subscriber'
      },
      demo: false,
      providerUser: {
        id: 'providerId',
        name: 'Provider'
      },
      strategy: {
        id: 'ABCD'
      },
      improvement: 0,
      providerCommission: 0,
      platformCommission: 0,
      quantity: -0.04,
      lotPrice: 117566.08744776,
      tickPrice: 124.526,
      amount: -4702.643497910401,
      commission: -0.14,
      swap: -0.14,
      profit: 0.49
    }];
    let from = new Date();
    let till = new Date();
    requestStub.resolves(expected);
    let transactions = await copyFactoryClient.getSubscriptionTransactions(from, till, ['ABCD'], ['e8867baa-5ec2-45ae-9930-4d5cea18d0d6'], 100, 200);
    transactions.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestCopyFactory, {
      url: '/users/current/subscription-transactions',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      json: true,
      qs: {
        from,
        till,
        strategyId: ['ABCD'],
        subscriberId: ['e8867baa-5ec2-45ae-9930-4d5cea18d0d6'],
        offset: 100,
        limit: 200
      }
    }, true);
  });

  /**
   * @test {HistoryClient#getSubscriptionTransactions}
   */
  it('should not retrieve transactions on strategies subscribed to from API with account token', async () => {
    domainClient = new _domain2.default(httpClient, 'token');
    copyFactoryClient = new _history2.default(domainClient);
    try {
      await copyFactoryClient.getSubscriptionTransactions(new Date(), new Date());
      throw new Error('MethodAccessError expected');
    } catch (error) {
      error.name.should.equal('MethodAccessError');
      error.message.should.equal('You can not invoke getSubscriptionTransactions method, because you have connected with account ' + 'access token. Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {HistoryClient#addStrategyTransactionListener}
   * @test {HistoryClient#removeStopoutListener}
   */
  describe('transactionListener', () => {

    let listener;

    beforeEach(() => {

      class Listener extends _transactionListener2.default {
        async onStopout(strategyStopoutEvent) {}
      }

      listener = new Listener();
    });

    /**
     * @test {HistoryClient#addStrategyTransactionListener}
     */
    it('should add strategy listener', async () => {
      const callStub = _sinon2.default.stub(copyFactoryClient._transactionListenerManager, 'addStrategyTransactionListener').returns('listenerId');
      const listenerId = copyFactoryClient.addStrategyTransactionListener(listener, 'ABCD');
      _sinon2.default.assert.match(listenerId, 'listenerId');
      _sinon2.default.assert.calledWith(callStub, listener, 'ABCD');
    });

    /**
     * @test {HistoryClient#removeStrategyTransactionListener}
     */
    it('should remove strategy listener', async () => {
      const callStub = _sinon2.default.stub(copyFactoryClient._transactionListenerManager, 'removeStrategyTransactionListener');
      copyFactoryClient.removeStrategyTransactionListener('id');
      _sinon2.default.assert.calledWith(callStub, 'id');
    });

    /**
     * @test {HistoryClient#addSubscriberTransactionListener}
     */
    it('should add subscriber listener', async () => {
      const callStub = _sinon2.default.stub(copyFactoryClient._transactionListenerManager, 'addSubscriberTransactionListener').returns('listenerId');
      const listenerId = copyFactoryClient.addSubscriberTransactionListener(listener, 'accountId');
      _sinon2.default.assert.match(listenerId, 'listenerId');
      _sinon2.default.assert.calledWith(callStub, listener, 'accountId');
    });

    /**
     * @test {HistoryClient#removeSubscriberTransactionListener}
     */
    it('should remove subscriber listener', async () => {
      const callStub = _sinon2.default.stub(copyFactoryClient._transactionListenerManager, 'removeSubscriberTransactionListener');
      copyFactoryClient.removeSubscriberTransactionListener('id');
      _sinon2.default.assert.calledWith(callStub, 'id');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L2hpc3RvcnkuY2xpZW50LnNwZWMuZXM2Il0sIm5hbWVzIjpbImRlc2NyaWJlIiwiY29weUZhY3RvcnlDbGllbnQiLCJ0b2tlbiIsImh0dHBDbGllbnQiLCJIdHRwQ2xpZW50IiwiZG9tYWluQ2xpZW50Iiwic2FuZGJveCIsInJlcXVlc3RTdHViIiwiYmVmb3JlIiwic2lub24iLCJjcmVhdGVTYW5kYm94IiwiYmVmb3JlRWFjaCIsIkRvbWFpbkNsaWVudCIsIkhpc3RvcnlDbGllbnQiLCJzdHViIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsIml0IiwiZXhwZWN0ZWQiLCJpZCIsInR5cGUiLCJ0aW1lIiwiRGF0ZSIsInN1YnNjcmliZXJJZCIsInN5bWJvbCIsInN1YnNjcmliZXJVc2VyIiwibmFtZSIsImRlbW8iLCJwcm92aWRlclVzZXIiLCJzdHJhdGVneSIsImltcHJvdmVtZW50IiwicHJvdmlkZXJDb21taXNzaW9uIiwicGxhdGZvcm1Db21taXNzaW9uIiwicXVhbnRpdHkiLCJsb3RQcmljZSIsInRpY2tQcmljZSIsImFtb3VudCIsImNvbW1pc3Npb24iLCJzd2FwIiwicHJvZml0IiwiZnJvbSIsInRpbGwiLCJyZXNvbHZlcyIsInRyYW5zYWN0aW9ucyIsImdldFByb3ZpZGVkVHJhbnNhY3Rpb25zIiwic2hvdWxkIiwiZXF1YWwiLCJhc3NlcnQiLCJjYWxsZWRPbmNlV2l0aEV4YWN0bHkiLCJyZXF1ZXN0Q29weUZhY3RvcnkiLCJ1cmwiLCJtZXRob2QiLCJoZWFkZXJzIiwicXMiLCJzdHJhdGVneUlkIiwib2Zmc2V0IiwibGltaXQiLCJqc29uIiwiRXJyb3IiLCJlcnJvciIsIm1lc3NhZ2UiLCJnZXRTdWJzY3JpcHRpb25UcmFuc2FjdGlvbnMiLCJsaXN0ZW5lciIsIkxpc3RlbmVyIiwiVHJhbnNhY3Rpb25MaXN0ZW5lciIsIm9uU3RvcG91dCIsInN0cmF0ZWd5U3RvcG91dEV2ZW50IiwiY2FsbFN0dWIiLCJfdHJhbnNhY3Rpb25MaXN0ZW5lck1hbmFnZXIiLCJyZXR1cm5zIiwibGlzdGVuZXJJZCIsImFkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lciIsIm1hdGNoIiwiY2FsbGVkV2l0aCIsInJlbW92ZVN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lciIsImFkZFN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyIiwicmVtb3ZlU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBOzs7QUFHQUEsU0FBUyxlQUFULEVBQTBCLE1BQU07O0FBRTlCLE1BQUlDLGlCQUFKO0FBQ0EsUUFBTUMsUUFBUSxxQkFBZDtBQUNBLE1BQUlDLGFBQWEsSUFBSUMsb0JBQUosRUFBakI7QUFDQSxNQUFJQyxZQUFKO0FBQ0EsTUFBSUMsT0FBSjtBQUNBLE1BQUlDLFdBQUo7O0FBRUFDLFNBQU8sTUFBTTtBQUNYRixjQUFVRyxnQkFBTUMsYUFBTixFQUFWO0FBQ0QsR0FGRDs7QUFJQUMsYUFBVyxNQUFNO0FBQ2ZOLG1CQUFlLElBQUlPLGdCQUFKLENBQWlCVCxVQUFqQixFQUE2QkQsS0FBN0IsQ0FBZjtBQUNBRCx3QkFBb0IsSUFBSVksaUJBQUosQ0FBa0JSLFlBQWxCLENBQXBCO0FBQ0FFLGtCQUFjRCxRQUFRUSxJQUFSLENBQWFULFlBQWIsRUFBMkIsb0JBQTNCLENBQWQ7QUFDRCxHQUpEOztBQU1BVSxZQUFVLE1BQU07QUFDZFQsWUFBUVUsT0FBUjtBQUNELEdBRkQ7O0FBSUE7OztBQUdBQyxLQUFHLHdFQUFILEVBQTZFLFlBQVk7QUFDdkYsUUFBSUMsV0FBVyxDQUFDO0FBQ2RDLFVBQUksZ0JBRFU7QUFFZEMsWUFBTSxnQkFGUTtBQUdkQyxZQUFNLElBQUlDLElBQUosQ0FBUywwQkFBVCxDQUhRO0FBSWRDLG9CQUFjLHNDQUpBO0FBS2RDLGNBQVEsUUFMTTtBQU1kQyxzQkFBZ0I7QUFDZE4s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O0FBQ0FqRSxzQkFBTXNDLE1BQU4sQ0FBYTBCLFVBQWIsQ0FBd0JOLFFBQXhCLEVBQWtDLElBQWxDO0FBQ0QsS0FKRDs7QUFNQTs7O0FBR0FsRCxPQUFHLGdDQUFILEVBQXFDLFlBQVk7QUFDL0MsWUFBTWtELFdBQVcxRCxnQkFBTUssSUFBTixDQUFXYixrQkFBa0JtRSwyQkFBN0IsRUFBMEQsa0NBQTFELEVBQ2RDLE9BRGMsQ0FDTixZQURNLENBQWpCO0FBRUEsWUFBTUMsYUFBYXJFLGtCQUFrQjBFLGdDQUFsQixDQUFtRGIsUUFBbkQsRUFBNkQsV0FBN0QsQ0FBbkI7QUFDQXJELHNCQUFNc0MsTUFBTixDQUFheUIsS0FBYixDQUFtQkYsVUFBbkIsRUFBK0IsWUFBL0I7QUFDQTdELHNCQUFNc0MsTUFBTixDQUFhMEIsVUFBYixDQUF3Qk4sUUFBeEIsRUFBa0NMLFFBQWxDLEVBQTRDLFdBQTVDO0FBQ0QsS0FORDs7QUFRQTs7O0FBR0E3QyxPQUFHLG1DQUFILEVBQXdDLFlBQVk7QUFDbEQsWUFBTWtELFdBQVcxRCxnQkFBTUssSUFBTixDQUFXYixrQkFBa0JtRSwyQkFBN0IsRUFBMEQscUNBQTFELENBQWpCO0FBQ0FuRSx3QkFBa0IyRSxtQ0FBbEIsQ0FBc0QsSUFBdEQ7QUFDQW5FLHNCQUFNc0MsTUFBTixDQUFhMEIsVUFBYixDQUF3Qk4sUUFBeEIsRUFBa0MsSUFBbEM7QUFDRCxLQUpEO0FBTUQsR0FyREQ7QUF1REQsQ0F4T0QiLCJmaWxlIjoiaGlzdG9yeS5jbGllbnQuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IEh0dHBDbGllbnQgZnJvbSAnLi4vaHR0cENsaWVudCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IEhpc3RvcnlDbGllbnQgZnJvbSAnLi9oaXN0b3J5LmNsaWVudCc7XG5pbXBvcnQgRG9tYWluQ2xpZW50IGZyb20gJy4uL2RvbWFpbi5jbGllbnQnO1xuaW1wb3J0IFRyYW5zYWN0aW9uTGlzdGVuZXIgZnJvbSAnLi9zdHJlYW1pbmcvL3RyYW5zYWN0aW9uTGlzdGVuZXInO1xuXG4vKipcbiAqIEB0ZXN0IHtIaXN0b3J5Q2xpZW50fVxuICovXG5kZXNjcmliZSgnSGlzdG9yeUNsaWVudCcsICgpID0+IHtcblxuICBsZXQgY29weUZhY3RvcnlDbGllbnQ7XG4gIGNvbnN0IHRva2VuID0gJ2hlYWRlci5wYXlsb2FkLnNpZ24nO1xuICBsZXQgaHR0cENsaWVudCA9IG5ldyBIdHRwQ2xpZW50KCk7XG4gIGxldCBkb21haW5DbGllbnQ7XG4gIGxldCBzYW5kYm94O1xuICBsZXQgcmVxdWVzdFN0dWI7XG5cbiAgYmVmb3JlKCgpID0+IHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBkb21haW5DbGllbnQgPSBuZXcgRG9tYWluQ2xpZW50KGh0dHBDbGllbnQsIHRva2VuKTtcbiAgICBjb3B5RmFjdG9yeUNsaWVudCA9IG5ldyBIaXN0b3J5Q2xpZW50KGRvbWFpbkNsaWVudCk7XG4gICAgcmVxdWVzdFN0dWIgPSBzYW5kYm94LnN0dWIoZG9tYWluQ2xpZW50LCAncmVxdWVzdENvcHlGYWN0b3J5Jyk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7SGlzdG9yeUNsaWVudCNnZXRQcm92aWRlZFRyYW5zYWN0aW9uc31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0cmlldmUgdHJhbnNhY3Rpb25zIHBlcmZvcm1lZCBvbiBwcm92aWRlZCBzdHJhdGVnaWVzIGZyb20gQVBJJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IFt7XG4gICAgICBpZDogJzY0NjY0NjYxOmNsb3NlJyxcbiAgICAgIHR5cGU6ICdERUFMX1RZUEVfU0VMTCcsXG4gICAgICB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wMlQyMTowMTowMS44MzBaJyksXG4gICAgICBzdWJzY3JpYmVySWQ6ICdlODg2N2JhYS01ZWMyLTQ1YWUtOTkzMC00ZDVjZWExOGQwZDYnLFxuICAgICAgc3ltYm9sOiAnRVVSSlBZJyxcbiAgICAgIHN1YnNjcmliZXJVc2VyOiB7XG4gICAgICAgIGlkOiAnc3Vic2NyaWJlcklkJyxcbiAgICAgICAgbmFtZTogJ1N1YnNjcmliZXInXG4gICAgICB9LFxuICAgICAgZGVtbzogZmFsc2UsXG4gICAgICBwcm92aWRlclVzZXI6IHtcbiAgICAgICAgaWQ6ICdwcm92aWRlcklkJyxcbiAgICAgICAgbmFtZTogJ1Byb3ZpZGVyJ1xuICAgICAgfSxcbiAgICAgIHN0cmF0ZWd5OiB7XG4gICAgICAgIGlkOiAnQUJDRCdcbiAgICAgIH0sXG4gICAgICBpbXByb3ZlbWVudDogMCxcbiAgICAgIHByb3ZpZGVyQ29tbWlzc2lvbjogMCxcbiAgICAgIHBsYXRmb3JtQ29tbWlzc2lvbjogMCxcbiAgICAgIHF1YW50aXR5OiAtMC4wNCxcbiAgICAgIGxvdFByaWNlOiAxMTc1NjYuMDg3NDQ3NzYsXG4gICAgICB0aWNrUHJpY2U6IDEyNC41MjYsXG4gICAgICBhbW91bnQ6IC00NzAyLjY0MzQ5NzkxMDQwMSxcbiAgICAgIGNvbW1pc3Npb246IC0wLjE0LFxuICAgICAgc3dhcDogLTAuMTQsXG4gICAgICBwcm9maXQ6IDAuNDlcbiAgICB9XTtcbiAgICBsZXQgZnJvbSA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IHRpbGwgPSBuZXcgRGF0ZSgpO1xuICAgIHJlcXVlc3RTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBsZXQgdHJhbnNhY3Rpb25zID0gYXdhaXQgY29weUZhY3RvcnlDbGllbnQuZ2V0UHJvdmlkZWRUcmFuc2FjdGlvbnMoZnJvbSwgdGlsbCwgWydBQkNEJ10sXG4gICAgICBbJ2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNiddLCAxMDAsIDIwMCk7XG4gICAgdHJhbnNhY3Rpb25zLnNob3VsZC5lcXVhbChleHBlY3RlZCk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShkb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5LCB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9wcm92aWRlZC10cmFuc2FjdGlvbnMnLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIHFzOiB7XG4gICAgICAgIGZyb20sXG4gICAgICAgIHRpbGwsXG4gICAgICAgIHN0cmF0ZWd5SWQ6IFsnQUJDRCddLFxuICAgICAgICBzdWJzY3JpYmVySWQ6IFsnZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2J10sXG4gICAgICAgIG9mZnNldDogMTAwLFxuICAgICAgICBsaW1pdDogMjAwXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9LCB0cnVlKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtIaXN0b3J5Q2xpZW50I2dldFByb3ZpZGVkVHJhbnNhY3Rpb25zfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBub3QgcmV0cmlldmUgdHJhbnNhY3Rpb25zIG9uIHByb3ZpZGVkIHN0cmF0ZWdpZXMgZnJvbSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudCA9IG5ldyBEb21haW5DbGllbnQoaHR0cENsaWVudCwgJ3Rva2VuJyk7XG4gICAgY29weUZhY3RvcnlDbGllbnQgPSBuZXcgSGlzdG9yeUNsaWVudChkb21haW5DbGllbnQpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb3B5RmFjdG9yeUNsaWVudC5nZXRQcm92aWRlZFRyYW5zYWN0aW9ucyhuZXcgRGF0ZSgpLCBuZXcgRGF0ZSgpKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kQWNjZXNzRXJyb3IgZXhwZWN0ZWQnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3IubmFtZS5zaG91bGQuZXF1YWwoJ01ldGhvZEFjY2Vzc0Vycm9yJyk7XG4gICAgICBlcnJvci5tZXNzYWdlLnNob3VsZC5lcXVhbChcbiAgICAgICAgJ1lvdSBjYW4gbm90IGludm9rZSBnZXRQcm92aWRlZFRyYW5zYWN0aW9ucyBtZXRob2QsIGJlY2F1c2UgeW91IGhhdmUgY29ubmVjdGVkIHdpdGggYWNjb3VudCAnICsgXG4gICAgICAgICdhY2Nlc3MgdG9rZW4uIFBsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7SGlzdG9yeUNsaWVudCNnZXRTdWJzY3JpcHRpb25UcmFuc2FjdGlvbnN9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHJpZXZlIHRyYW5zYWN0aW9ucyBwZXJmb3JtZWQgb24gc3RyYXRlZ2llcyBjdXJyZW50IHVzZXIgaXMgc3Vic2NyaWJlZCB0byBmcm9tIEFQSScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhwZWN0ZWQgPSBbe1xuICAgICAgaWQ6ICc2NDY2NDY2MTpjbG9zZScsXG4gICAgICB0eXBlOiAnREVBTF9UWVBFX1NFTEwnLFxuICAgICAgdGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDJUMjE6MDE6MDEuODMwWicpLFxuICAgICAgc3Vic2NyaWJlcklkOiAnZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2JyxcbiAgICAgIHN5bWJvbDogJ0VVUkpQWScsXG4gICAgICBzdWJzY3JpYmVyVXNlcjoge1xuICAgICAgICBpZDogJ3N1YnNjcmliZXJJZCcsXG4gICAgICAgIG5hbWU6ICdTdWJzY3JpYmVyJ1xuICAgICAgfSxcbiAgICAgIGRlbW86IGZhbHNlLFxuICAgICAgcHJvdmlkZXJVc2VyOiB7XG4gICAgICAgIGlkOiAncHJvdmlkZXJJZCcsXG4gICAgICAgIG5hbWU6ICdQcm92aWRlcidcbiAgICAgIH0sXG4gICAgICBzdHJhdGVneToge1xuICAgICAgICBpZDogJ0FCQ0QnXG4gICAgICB9LFxuICAgICAgaW1wcm92ZW1lbnQ6IDAsXG4gICAgICBwcm92aWRlckNvbW1pc3Npb246IDAsXG4gICAgICBwbGF0Zm9ybUNvbW1pc3Npb246IDAsXG4gICAgICBxdWFudGl0eTogLTAuMDQsXG4gICAgICBsb3RQcmljZTogMTE3NTY2LjA4NzQ0Nzc2LFxuICAgICAgdGlja1ByaWNlOiAxMjQuNTI2LFxuICAgICAgYW1vdW50OiAtNDcwMi42NDM0OTc5MTA0MDEsXG4gICAgICBjb21taXNzaW9uOiAtMC4xNCxcbiAgICAgIHN3YXA6IC0wLjE0LFxuICAgICAgcHJvZml0OiAwLjQ5XG4gICAgfV07XG4gICAgbGV0IGZyb20gPSBuZXcgRGF0ZSgpO1xuICAgIGxldCB0aWxsID0gbmV3IERhdGUoKTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IHRyYW5zYWN0aW9ucyA9IGF3YWl0IGNvcHlGYWN0b3J5Q2xpZW50LmdldFN1YnNjcmlwdGlvblRyYW5zYWN0aW9ucyhmcm9tLCB0aWxsLCBbJ0FCQ0QnXSxcbiAgICAgIFsnZTg4NjdiYWEtNWVjMi00NWFlLTk5MzAtNGQ1Y2VhMThkMGQ2J10sIDEwMCwgMjAwKTtcbiAgICB0cmFuc2FjdGlvbnMuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGRvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3RvcnksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L3N1YnNjcmlwdGlvbi10cmFuc2FjdGlvbnMnLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgICBxczoge1xuICAgICAgICBmcm9tLFxuICAgICAgICB0aWxsLFxuICAgICAgICBzdHJhdGVneUlkOiBbJ0FCQ0QnXSxcbiAgICAgICAgc3Vic2NyaWJlcklkOiBbJ2U4ODY3YmFhLTVlYzItNDVhZS05OTMwLTRkNWNlYTE4ZDBkNiddLFxuICAgICAgICBvZmZzZXQ6IDEwMCxcbiAgICAgICAgbGltaXQ6IDIwMFxuICAgICAgfSxcbiAgICB9LCB0cnVlKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtIaXN0b3J5Q2xpZW50I2dldFN1YnNjcmlwdGlvblRyYW5zYWN0aW9uc31cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IHJldHJpZXZlIHRyYW5zYWN0aW9ucyBvbiBzdHJhdGVnaWVzIHN1YnNjcmliZWQgdG8gZnJvbSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIGRvbWFpbkNsaWVudCA9IG5ldyBEb21haW5DbGllbnQoaHR0cENsaWVudCwgJ3Rva2VuJyk7XG4gICAgY29weUZhY3RvcnlDbGllbnQgPSBuZXcgSGlzdG9yeUNsaWVudChkb21haW5DbGllbnQpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb3B5RmFjdG9yeUNsaWVudC5nZXRTdWJzY3JpcHRpb25UcmFuc2FjdGlvbnMobmV3IERhdGUoKSwgbmV3IERhdGUoKSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZEFjY2Vzc0Vycm9yIGV4cGVjdGVkJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm5hbWUuc2hvdWxkLmVxdWFsKCdNZXRob2RBY2Nlc3NFcnJvcicpO1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgZ2V0U3Vic2NyaXB0aW9uVHJhbnNhY3Rpb25zIG1ldGhvZCwgYmVjYXVzZSB5b3UgaGF2ZSBjb25uZWN0ZWQgd2l0aCBhY2NvdW50ICcgKyBcbiAgICAgICAgJ2FjY2VzcyB0b2tlbi4gUGxlYXNlIHVzZSBBUEkgYWNjZXNzIHRva2VuIGZyb20gaHR0cHM6Ly9hcHAubWV0YWFwaS5jbG91ZC90b2tlbiBwYWdlIHRvIGludm9rZSB0aGlzIG1ldGhvZC4nXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtIaXN0b3J5Q2xpZW50I2FkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcn1cbiAgICogQHRlc3Qge0hpc3RvcnlDbGllbnQjcmVtb3ZlU3RvcG91dExpc3RlbmVyfVxuICAgKi9cbiAgZGVzY3JpYmUoJ3RyYW5zYWN0aW9uTGlzdGVuZXInLCAoKSA9PiB7XG5cbiAgICBsZXQgbGlzdGVuZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcblxuICAgICAgY2xhc3MgTGlzdGVuZXIgZXh0ZW5kcyBUcmFuc2FjdGlvbkxpc3RlbmVyIHtcbiAgICAgICAgYXN5bmMgb25TdG9wb3V0KHN0cmF0ZWd5U3RvcG91dEV2ZW50KSB7fVxuICAgICAgfVxuXG4gICAgICBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0hpc3RvcnlDbGllbnQjYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgYWRkIHN0cmF0ZWd5IGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbFN0dWIgPSBzaW5vbi5zdHViKGNvcHlGYWN0b3J5Q2xpZW50Ll90cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciwgJ2FkZFN0cmF0ZWd5VHJhbnNhY3Rpb25MaXN0ZW5lcicpXG4gICAgICAgIC5yZXR1cm5zKCdsaXN0ZW5lcklkJyk7XG4gICAgICBjb25zdCBsaXN0ZW5lcklkID0gY29weUZhY3RvcnlDbGllbnQuYWRkU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyKGxpc3RlbmVyLCAnQUJDRCcpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKGxpc3RlbmVySWQsICdsaXN0ZW5lcklkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgbGlzdGVuZXIsICdBQkNEJyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7SGlzdG9yeUNsaWVudCNyZW1vdmVTdHJhdGVneVRyYW5zYWN0aW9uTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgc3RyYXRlZ3kgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNpbm9uLnN0dWIoY29weUZhY3RvcnlDbGllbnQuX3RyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLCAncmVtb3ZlU3RyYXRlZ3lUcmFuc2FjdGlvbkxpc3RlbmVyJyk7XG4gICAgICBjb3B5RmFjdG9yeUNsaWVudC5yZW1vdmVTdHJhdGVneVRyYW5zYWN0aW9uTGlzdGVuZXIoJ2lkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgJ2lkJyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVzdCB7SGlzdG9yeUNsaWVudCNhZGRTdWJzY3JpYmVyVHJhbnNhY3Rpb25MaXN0ZW5lcn1cbiAgICAgKi9cbiAgICBpdCgnc2hvdWxkIGFkZCBzdWJzY3JpYmVyIGxpc3RlbmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbFN0dWIgPSBzaW5vbi5zdHViKGNvcHlGYWN0b3J5Q2xpZW50Ll90cmFuc2FjdGlvbkxpc3RlbmVyTWFuYWdlciwgJ2FkZFN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyJylcbiAgICAgICAgLnJldHVybnMoJ2xpc3RlbmVySWQnKTtcbiAgICAgIGNvbnN0IGxpc3RlbmVySWQgPSBjb3B5RmFjdG9yeUNsaWVudC5hZGRTdWJzY3JpYmVyVHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0ZW5lciwgJ2FjY291bnRJZCcpO1xuICAgICAgc2lub24uYXNzZXJ0Lm1hdGNoKGxpc3RlbmVySWQsICdsaXN0ZW5lcklkJyk7XG4gICAgICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChjYWxsU3R1YiwgbGlzdGVuZXIsICdhY2NvdW50SWQnKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEB0ZXN0IHtIaXN0b3J5Q2xpZW50I3JlbW92ZVN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyfVxuICAgICAqL1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIHN1YnNjcmliZXIgbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNpbm9uLnN0dWIoY29weUZhY3RvcnlDbGllbnQuX3RyYW5zYWN0aW9uTGlzdGVuZXJNYW5hZ2VyLCAncmVtb3ZlU3Vic2NyaWJlclRyYW5zYWN0aW9uTGlzdGVuZXInKTtcbiAgICAgIGNvcHlGYWN0b3J5Q2xpZW50LnJlbW92ZVN1YnNjcmliZXJUcmFuc2FjdGlvbkxpc3RlbmVyKCdpZCcpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsICdpZCcpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG59KTtcbiJdfQ==