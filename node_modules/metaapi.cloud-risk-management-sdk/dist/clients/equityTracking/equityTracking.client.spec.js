'use strict';

var _equityTracking = require('./equityTracking.client');

var _equityTracking2 = _interopRequireDefault(_equityTracking);

var _drawdownListener = require('./drawdownListener');

var _drawdownListener2 = _interopRequireDefault(_drawdownListener);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

require('should');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {EquityTrackingClient}
 */
describe('EquityTrackingClient', () => {

  let sandbox;
  let equityTrackingClient;
  let requestApiStub;
  let domainClient = {
    requestApi: () => {}
  };

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    equityTrackingClient = new _equityTracking2.default(domainClient);
    requestApiStub = sandbox.stub(domainClient, 'requestApi');
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {EquityTrackingClient#createDrawdownTracker}
   */
  it('should create drawdown tracker', async () => {
    let expected = { id: 'trackerId' };
    let tracker = { name: 'trackerName' };
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.createDrawdownTracker('accountId', tracker);
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers',
      method: 'POST',
      body: tracker
    });
  });

  /**
   * @test {EquityTrackingClient#getDrawdownTrackers}
   */
  it('should retrieve drawdown trackers', async () => {
    let expected = [{ name: 'trackerName' }];
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.getDrawdownTrackers('accountId');
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers',
      method: 'GET'
    });
  });

  /**
   * @test {EquityTrackingClient#getDrawdownTrackerByName}
   */
  it('should retrieve drawdown tracker by name', async () => {
    let expected = { name: 'trackerName' };
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.getDrawdownTrackerByName('accountId', 'name');
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers/name/name',
      method: 'GET'
    });
  });

  /**
   * @test {EquityTrackingClient#updateDrawdownTracker}
   */
  it('should update drawdown tracker', async () => {
    let update = { name: 'newTrackerName' };
    await equityTrackingClient.updateDrawdownTracker('accountId', 'trackerId', update);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers/trackerId',
      method: 'PUT',
      body: update
    });
  });

  /**
   * @test {EquityTrackingClient#deleteDrawdownTracker}
   */
  it('should delete drawdown tracker', async () => {
    await equityTrackingClient.deleteDrawdownTracker('accountId', 'trackerId');
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers/trackerId',
      method: 'DELETE'
    });
  });

  /**
   * @test {EquityTrackingClient#getDrawdownEvents}
   */
  it('should retrieve drawdown events', async () => {
    let expected = [{
      sequenceNumber: 1,
      accountId: 'accountId',
      trackerId: 'trackerId',
      period: 'day',
      startBrokerTime: '2022-04-08 00:00:00.000',
      endBrokerTime: '2022-04-08 23:59:59.999',
      brokerTime: '2022-04-08 09:36:00.000',
      absoluteDrawdown: 250,
      relativeDrawdown: 0.25
    }];
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.getDrawdownEvents('2022-04-08 09:36:00.000', '2022-04-08 10:36:00.000', 'accountId', 'trackerId', 100);
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/drawdown-events/by-broker-time',
      qs: {
        startBrokerTime: '2022-04-08 09:36:00.000',
        endBrokerTime: '2022-04-08 10:36:00.000',
        accountId: 'accountId',
        trackerId: 'trackerId',
        limit: 100
      },
      method: 'GET'
    });
  });

  /**
   * @test {EquityTrackingClient#getDrawdownStatistics}
   */
  it('should retrieve drawdown statistics', async () => {
    let expected = [{
      period: 'day',
      startBrokerTime: '2022-04-08 00:00:00.000',
      endBrokerTime: '2022-04-08 23:59:59.999',
      initialBalance: 1000,
      maxDrawdownTime: '2022-04-08 09:36:00.000',
      maxAbsoluteDrawdown: 250,
      maxRelativeDrawdown: 0.25,
      thresholdExceeded: true
    }];
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.getDrawdownStatistics('accountId', 'trackerId', '2022-04-08 09:36:00.000', 100);
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/drawdown-trackers/trackerId/statistics',
      qs: { startTime: '2022-04-08 09:36:00.000', limit: 100 },
      method: 'GET'
    });
  });

  /**
   * @test {EquityTrackingClient#getEquityChart}
   */
  it('should retrieve equity chart', async () => {
    let expected = [{
      startBrokerTime: '2022-04-08 00:00:00.000',
      endBrokerTime: '2022-04-08 23:59:59.999',
      averageBalance: 1050,
      minBalance: 100,
      maxBalance: 2000,
      averageEquity: 1075,
      minEquity: 50,
      maxEquity: 2100
    }];
    requestApiStub.resolves(expected);

    let actual = await equityTrackingClient.getEquityChart('accountId', '2022-04-08 09:36:00.000', '2022-04-08 10:36:00.000');
    actual.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(domainClient.requestApi, {
      url: '/users/current/accounts/accountId/equity-chart',
      qs: {
        startTime: '2022-04-08 09:36:00.000',
        endTime: '2022-04-08 10:36:00.000'
      },
      method: 'GET'
    });
  });

  /**
   * @test {EquityTrackingClient#addDrawdownListener}
   * @test {EquityTrackingClient#removeDrawdownListener}
   */
  describe('drawdownListener', () => {

    let listener;

    beforeEach(() => {

      class Listener extends _drawdownListener2.default {
        async onDrawdown(drawdownEvents) {}
      }

      listener = new Listener();
    });

    /**
     * @test {EquityTrackingClient#addDrawdownListener}
     */
    it('should add drawdown listener', async () => {
      const callStub = sandbox.stub(equityTrackingClient._drawdownListenerManager, 'addDrawdownListener');
      equityTrackingClient.addDrawdownListener(listener, 'accountId', 'trackerId', 1);
      _sinon2.default.assert.calledWith(callStub, listener, 'accountId', 'trackerId', 1);
    });

    /**
     * @test {EquityTrackingClient#addDrawdownListener}
     */
    it('should remove drawdown listener', async () => {
      const callStub = sandbox.stub(equityTrackingClient._drawdownListenerManager, 'removeDrawdownListener');
      equityTrackingClient.removeDrawdownListener('id');
      _sinon2.default.assert.calledWith(callStub);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2VxdWl0eVRyYWNraW5nL2VxdWl0eVRyYWNraW5nLmNsaWVudC5zcGVjLmVzNiJdLCJuYW1lcyI6WyJkZXNjcmliZSIsInNhbmRib3giLCJlcXVpdHlUcmFja2luZ0NsaWVudCIsInJlcXVlc3RBcGlTdHViIiwiZG9tYWluQ2xpZW50IiwicmVxdWVzdEFwaSIsImJlZm9yZSIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImJlZm9yZUVhY2giLCJFcXVpdHlUcmFja2luZ0NsaWVudCIsInN0dWIiLCJhZnRlckVhY2giLCJyZXN0b3JlIiwiaXQiLCJleHBlY3RlZCIsImlkIiwidHJhY2tlciIsIm5hbWUiLCJyZXNvbHZlcyIsImFjdHVhbCIsImNyZWF0ZURyYXdkb3duVHJhY2tlciIsInNob3VsZCIsImVxdWFsIiwiYXNzZXJ0IiwiY2FsbGVkT25jZVdpdGhFeGFjdGx5IiwidXJsIiwibWV0aG9kIiwiYm9keSIsImdldERyYXdkb3duVHJhY2tlcnMiLCJnZXREcmF3ZG93blRyYWNrZXJCeU5hbWUiLCJ1cGRhdGUiLCJ1cGRhdGVEcmF3ZG93blRyYWNrZXIiLCJkZWxldGVEcmF3ZG93blRyYWNrZXIiLCJzZXF1ZW5jZU51bWJlciIsImFjY291bnRJZCIsInRyYWNrZXJJZCIsInBlcmlvZCIsInN0YXJ0QnJva2VyVGltZSIsImVuZEJyb2tlclRpbWUiLCJicm9rZXJUaW1lIiwiYWJzb2x1dGVEcmF3ZG93biIsInJlbGF0aXZlRHJhd2Rvd24iLCJnZXREcmF3ZG93bkV2ZW50cyIsInFzIiwibGltaXQiLCJpbml0aWFsQmFsYW5jZSIsIm1heERyYXdkb3duVGltZSIsIm1heEFic29sdXRlRHJhd2Rvd24iLCJtYXhSZWxhdGl2ZURyYXdkb3duIiwidGhyZXNob2xkRXhjZWVkZWQiLCJnZXREcmF3ZG93blN0YXRpc3RpY3MiLCJzdGFydFRpbWUiLCJhdmVyYWdlQmFsYW5jZSIsIm1pbkJhbGFuY2UiLCJtYXhCYWxhbmNlIiwiYXZlcmFnZUVxdWl0eSIsIm1pbkVxdWl0eSIsIm1heEVxdWl0eSIsImdldEVxdWl0eUNoYXJ0IiwiZW5kVGltZSIsImxpc3RlbmVyIiwiTGlzdGVuZXIiLCJEcmF3ZG93bkxpc3RlbmVyIiwib25EcmF3ZG93biIsImRyYXdkb3duRXZlbnRzIiwiY2FsbFN0dWIiLCJfZHJhd2Rvd25MaXN0ZW5lck1hbmFnZXIiLCJhZGREcmF3ZG93bkxpc3RlbmVyIiwiY2FsbGVkV2l0aCIsInJlbW92ZURyYXdkb3duTGlzdGVuZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7OztBQUdBQSxTQUFTLHNCQUFULEVBQWlDLE1BQU07O0FBRXJDLE1BQUlDLE9BQUo7QUFDQSxNQUFJQyxvQkFBSjtBQUNBLE1BQUlDLGNBQUo7QUFDQSxNQUFJQyxlQUFlO0FBQ2pCQyxnQkFBWSxNQUFNLENBQUU7QUFESCxHQUFuQjs7QUFJQUMsU0FBTyxNQUFNO0FBQ1hMLGNBQVVNLGdCQUFNQyxhQUFOLEVBQVY7QUFDRCxHQUZEOztBQUlBQyxhQUFXLE1BQU07QUFDZlAsMkJBQXVCLElBQUlRLHdCQUFKLENBQXlCTixZQUF6QixDQUF2QjtBQUNBRCxxQkFBaUJGLFFBQVFVLElBQVIsQ0FBYVAsWUFBYixFQUEyQixZQUEzQixDQUFqQjtBQUNELEdBSEQ7O0FBS0FRLFlBQVUsTUFBTTtBQUNkWCxZQUFRWSxPQUFSO0FBQ0QsR0FGRDs7QUFJQTs7O0FBR0FDLEtBQUcsZ0NBQUgsRUFBcUMsWUFBWTtBQUMvQyxRQUFJQyxXQUFXLEVBQUNDLElBQUksV0FBTCxFQUFmO0FBQ0EsUUFBSUMsVUFBVSxFQUFDQyxNQUFNLGFBQVAsRUFBZDtBQUNBZixtQkFBZWdCLFFBQWYsQ0FBd0JKLFFBQXhCOztBQUVBLFFBQUlLLFNBQVMsTUFBTWxCLHFCQUFxQm1CLHFCQUFyQixDQUEyQyxXQUEzQyxFQUF3REosT0FBeEQsQ0FBbkI7QUFDQUcsV0FBT0UsTUFBUCxDQUFjQyxLQUFkLENBQW9CUixRQUFwQjtBQUNBUixvQkFBTWlCLE1BQU4sQ0FBYUMscUJBQWIsQ0FBbUNyQixhQUFhQyxVQUFoRCxFQUE0RDtBQUMxRHFCLFdBQUsscURBRHFEO0FBRTFEQyxjQUFRLE1BRmtEO0FBRzFEQyxZQUFNWDtBQUhvRCxLQUE1RDtBQUtELEdBWkQ7O0FBY0E7OztBQUdBSCxLQUFHLG1DQUFILEVBQXdDLFlBQVk7QUFDbEQsUUFBSUMsV0FBVyxDQUFDLEVBQUNHLE1BQU0sYUFBUCxFQUFELENBQWY7QUFDQWYsbUJBQWVnQixRQUFmLENBQXdCSixRQUF4Qjs7QUFFQSxRQUFJSyxTQUFTLE1BQU1sQixxQkFBcUIyQixtQkFBckIsQ0FBeUMsV0FBekMsQ0FBbkI7QUFDQVQsV0FBT0UsTUFBUCxDQUFjQyxLQUFkLENBQW9CUixRQUFwQjtBQUNBUixvQkFBTWlCLE1BQU4sQ0FBYUMscUJBQWIsQ0FBbUNyQixhQUFhQyxVQUFoRCxFQUE0RDtBQUMxRHFCLFdBQUsscURBRHFEO0FBRTFEQyxjQUFRO0FBRmtELEtBQTVEO0FBSUQsR0FWRDs7QUFZQTs7O0FBR0FiLEtBQUcsMENBQUgsRUFBK0MsWUFBWTtBQUN6RCxRQUFJQyxXQUFXLEVBQUNHLE1BQU0sYUFBUCxFQUFmO0FBQ0FmLG1CQUFlZ0IsUUFBZixDQUF3QkosUUFBeEI7O0FBRUEsUUFBSUssU0FBUyxNQUFNbEIscUJBQXFCNEIsd0JBQXJCLENBQThDLFdBQTlDLEVBQTJELE1BQTNELENBQW5CO0FBQ0FWLFdBQU9FLE1BQVAsQ0FBY0MsS0FBZCxDQUFvQlIsUUFBcEI7QUFDQVIsb0JBQU1pQixNQUFOLENBQWFDLHFCQUFiLENBQW1DckIsYUFBYUMsVUFBaEQsRUFBNEQ7QUFDMURxQixXQUFLLCtEQURxRDtBQUUxREMsY0FBUTtBQUZrRCxLQUE1RDtBQUlELEdBVkQ7O0FBWUE7OztBQUdBYixLQUFHLGdDQUFILEVBQXFDLFlBQVk7QUFDL0MsUUFBSWlCLFNBQVMsRUFBQ2IsTUFBTSxnQkFBUCxFQUFiO0FBQ0EsVUFBTWhCLHFCQUFxQjhCLHFCQUFyQixDQUEyQyxXQUEzQyxFQUF3RCxXQUF4RCxFQUFxRUQsTUFBckUsQ0FBTjtBQUNBeEIsb0JBQU1pQixNQUFOLENBQWFDLHFCQUFiLENBQW1DckIsYUFBYUMsVUFBaEQsRUFBNEQ7QUFDMURxQixXQUFLLCtEQURxRDtBQUUxREMsY0FBUSxLQUZrRDtBQUcxREMsWUFBTUc7QUFIb0QsS0FBNUQ7QUFLRCxHQVJEOztBQVVBOzs7QUFHQWpCLEtBQUcsZ0NBQUgsRUFBcUMsWUFBWTtBQUMvQyxVQUFNWixxQkFBcUIrQixxQkFBckIsQ0FBMkMsV0FBM0MsRUFBd0QsV0FBeEQsQ0FBTjtBQUNBMUIsb0JBQU1pQixNQUFOLENBQWFDLHFCQUFiLENBQW1DckIsYUFBYUMsVUFBaEQsRUFBNEQ7QUFDMURxQixXQUFLLCtEQURxRDtBQUUxREMsY0FBUTtBQUZrRCxLQUE1RDtBQUlELEdBTkQ7O0FBUUE7OztBQUdBYixLQUFHLGlDQUFILEVBQXNDLFlBQVk7QUFDaEQsUUFBSUMsV0FBVyxDQUFDO0FBQ2RtQixzQkFBZ0IsQ0FERjtBQUVkQyxpQkFBVyxXQUZHO0FBR2RDLGlCQUFXLFdBSEc7QUFJZEMsY0FBUSxLQUpNO0FBS2RDLHVCQUFpQix5QkFMSDtBQU1kQyxxQkFBZSx5QkFORDtBQU9kQyxrQkFBWSx5QkFQRTtBQVFkQyx3QkFBa0IsR0FSSjtBQVNkQyx3QkFBa0I7QUFUSixLQUFELENBQWY7QUFXQXZDLG1CQUFlZ0IsUUFBZixDQUF3QkosUUFBeEI7O0FBRUEsUUFBSUssU0FBUyxNQUFNbEIscUJBQXFCeUMsaUJBQXJCLENBQXVDLHlCQUF2QyxFQUFrRSx5QkFBbEUsRUFDakIsV0FEaUIsRUFDSixXQURJLEVBQ1MsR0FEVCxDQUFuQjtBQUVBdkIsV0FBT0UsTUFBUCxDQUFjQyxLQUFkLENBQW9CUixRQUFwQjtBQUNBUixvQkFBTWlCLE1BQU4sQ0FBYUMscUJBQWIsQ0FBbUNyQixhQUFhQyxVQUFoRCxFQUE0RDtBQUMxRHFCLFdBQUssK0NBRHFEO0FBRTFEa0IsVUFBSTtBQUNGTix5QkFBaUIseUJBRGY7QUFFRkMsdUJBQWUseUJBRmI7QUFHRkosbUJBQVcsV0FIVDtBQUlGQyxtQkFBVyxXQUpUO0FBS0ZTLGVBQU87QUFMTCxPQUZzRDtBQVMxRGxCLGNBQVE7QUFUa0QsS0FBNUQ7QUFXRCxHQTVCRDs7QUE4QkE7OztBQUdBYixLQUFHLHFDQUFILEVBQTBDLFlBQVk7QUFDcEQsUUFBSUMsV0FBVyxDQUFDO0FBQ2RzQixjQUFRLEtBRE07QUFFZEMsdUJBQWlCLHlCQUZIO0FBR2RDLHFCQUFlLHlCQUhEO0FBSWRPLHNCQUFnQixJQUpGO0FBS2RDLHVCQUFpQix5QkFMSDtBQU1kQywyQkFBcUIsR0FOUDtBQU9kQywyQkFBcUIsSUFQUDtBQVFkQyx5QkFBbUI7QUFSTCxLQUFELENBQWY7QUFVQS9DLG1CQUFlZ0IsUUFBZixDQUF3QkosUUFBeEI7O0FBRUEsUUFBSUssU0FBUyxNQUFNbEIscUJBQXFCaUQscUJBQXJCLENBQTJDLFdBQTNDLEVBQXdELFdBQXhELEVBQXFFLHlCQUFyRSxFQUNqQixHQURpQixDQUFuQjtBQUVBL0IsV0FBT0UsTUFBUCxDQUFjQyxLQUFkLENBQW9CUixRQUFwQjtBQUNBUixvQkFBTWlCLE1BQU4sQ0FBYUMscUJBQWIsQ0FBbUNyQixhQUFhQyxVQUFoRCxFQUE0RDtBQUMxRHFCLFdBQUssMEVBRHFEO0FBRTFEa0IsVUFBSSxFQUFDUSxXQUFXLHlCQUFaLEVBQXVDUCxPQUFPLEdBQTlDLEVBRnNEO0FBRzFEbEIsY0FBUTtBQUhrRCxLQUE1RDtBQUtELEdBckJEOztBQXVCQTs7O0FBR0FiLEtBQUcsOEJBQUgsRUFBbUMsWUFBWTtBQUM3QyxRQUFJQyxXQUFXLENBQUM7QUFDZHVCLHVCQUFpQix5QkFESDtBQUVkQyxxQkFBZSx5QkFGRDtBQUdkYyxzQkFBZ0IsSUFIRjtBQUlkQyxrQkFBWSxHQUpFO0FBS2RDLGtCQUFZLElBTEU7QUFNZEMscUJBQWUsSUFORDtBQU9kQyxpQkFBVyxFQVBHO0FBUWRDLGlCQUFXO0FBUkcsS0FBRCxDQUFmO0FBVUF2RCxtQkFBZWdCLFFBQWYsQ0FBd0JKLFFBQXhCOztBQUVBLFFBQUlLLFNBQVMsTUFBTWxCLHFCQUFxQnlELGNBQXJCLENBQW9DLFdBQXBDLEVBQWlELHlCQUFqRCxFQUNqQix5QkFEaUIsQ0FBbkI7QUFFQXZDLFdBQU9FLE1BQVAsQ0FBY0MsS0FBZCxDQUFvQlIsUUFBcEI7QUFDQVIsb0JBQU1pQixNQUFOLENBQWFDLHFCQUFiLENBQW1DckIsYUFBYUMsVUFBaEQsRUFBNEQ7QUFDMURxQixXQUFLLGdEQURxRDtBQUUxRGtCLFVBQUk7QUFDRlEsbUJBQVcseUJBRFQ7QUFFRlEsaUJBQVM7QUFGUCxPQUZzRDtBQU0xRGpDLGNBQVE7QUFOa0QsS0FBNUQ7QUFRRCxHQXhCRDs7QUEwQkE7Ozs7QUFJQTNCLFdBQVMsa0JBQVQsRUFBNkIsTUFBTTs7QUFFakMsUUFBSTZELFFBQUo7O0FBRUFwRCxlQUFXLE1BQU07O0FBRWYsWUFBTXFELFFBQU4sU0FBdUJDLDBCQUF2QixDQUF3QztBQUN0QyxjQUFNQyxVQUFOLENBQWlCQyxjQUFqQixFQUFpQyxDQUFFO0FBREc7O0FBSXhDSixpQkFBVyxJQUFJQyxRQUFKLEVBQVg7QUFDRCxLQVBEOztBQVNBOzs7QUFHQWhELE9BQUcsOEJBQUgsRUFBbUMsWUFBWTtBQUM3QyxZQUFNb0QsV0FBV2pFLFFBQVFVLElBQVIsQ0FBYVQscUJBQXFCaUUsd0JBQWxDLEVBQTRELHFCQUE1RCxDQUFqQjtBQUNBakUsMkJBQXFCa0UsbUJBQXJCLENBQXlDUCxRQUF6QyxFQUFtRCxXQUFuRCxFQUFnRSxXQUFoRSxFQUE2RSxDQUE3RTtBQUNBdEQsc0JBQU1pQixNQUFOLENBQWE2QyxVQUFiLENBQXdCSCxRQUF4QixFQUFrQ0wsUUFBbEMsRUFBNEMsV0FBNUMsRUFBeUQsV0FBekQsRUFBc0UsQ0FBdEU7QUFDRCxLQUpEOztBQU1BOzs7QUFHQS9DLE9BQUcsaUNBQUgsRUFBc0MsWUFBWTtBQUNoRCxZQUFNb0QsV0FBV2pFLFFBQVFVLElBQVIsQ0FBYVQscUJBQXFCaUUsd0JBQWxDLEVBQTRELHdCQUE1RCxDQUFqQjtBQUNBakUsMkJBQXFCb0Usc0JBQXJCLENBQTRDLElBQTVDO0FBQ0EvRCxzQkFBTWlCLE1BQU4sQ0FBYTZDLFVBQWIsQ0FBd0JILFFBQXhCO0FBQ0QsS0FKRDtBQU1ELEdBL0JEO0FBaUNELENBMU5EIiwiZmlsZSI6ImVxdWl0eVRyYWNraW5nLmNsaWVudC5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgRXF1aXR5VHJhY2tpbmdDbGllbnQgZnJvbSAnLi9lcXVpdHlUcmFja2luZy5jbGllbnQnO1xuaW1wb3J0IERyYXdkb3duTGlzdGVuZXIgZnJvbSAnLi9kcmF3ZG93bkxpc3RlbmVyJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgJ3Nob3VsZCc7XG5cbi8qKlxuICogQHRlc3Qge0VxdWl0eVRyYWNraW5nQ2xpZW50fVxuICovXG5kZXNjcmliZSgnRXF1aXR5VHJhY2tpbmdDbGllbnQnLCAoKSA9PiB7XG5cbiAgbGV0IHNhbmRib3g7XG4gIGxldCBlcXVpdHlUcmFja2luZ0NsaWVudDtcbiAgbGV0IHJlcXVlc3RBcGlTdHViO1xuICBsZXQgZG9tYWluQ2xpZW50ID0ge1xuICAgIHJlcXVlc3RBcGk6ICgpID0+IHt9XG4gIH07XG5cbiAgYmVmb3JlKCgpID0+IHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBlcXVpdHlUcmFja2luZ0NsaWVudCA9IG5ldyBFcXVpdHlUcmFja2luZ0NsaWVudChkb21haW5DbGllbnQpO1xuICAgIHJlcXVlc3RBcGlTdHViID0gc2FuZGJveC5zdHViKGRvbWFpbkNsaWVudCwgJ3JlcXVlc3RBcGknKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtFcXVpdHlUcmFja2luZ0NsaWVudCNjcmVhdGVEcmF3ZG93blRyYWNrZXJ9XG4gICAqL1xuICBpdCgnc2hvdWxkIGNyZWF0ZSBkcmF3ZG93biB0cmFja2VyJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IHtpZDogJ3RyYWNrZXJJZCd9O1xuICAgIGxldCB0cmFja2VyID0ge25hbWU6ICd0cmFja2VyTmFtZSd9O1xuICAgIHJlcXVlc3RBcGlTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBcbiAgICBsZXQgYWN0dWFsID0gYXdhaXQgZXF1aXR5VHJhY2tpbmdDbGllbnQuY3JlYXRlRHJhd2Rvd25UcmFja2VyKCdhY2NvdW50SWQnLCB0cmFja2VyKTtcbiAgICBhY3R1YWwuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGRvbWFpbkNsaWVudC5yZXF1ZXN0QXBpLCB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9hY2NvdW50cy9hY2NvdW50SWQvZHJhd2Rvd24tdHJhY2tlcnMnLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiB0cmFja2VyXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjZ2V0RHJhd2Rvd25UcmFja2Vyc31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0cmlldmUgZHJhd2Rvd24gdHJhY2tlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0gW3tuYW1lOiAndHJhY2tlck5hbWUnfV07XG4gICAgcmVxdWVzdEFwaVN0dWIucmVzb2x2ZXMoZXhwZWN0ZWQpO1xuXG4gICAgbGV0IGFjdHVhbCA9IGF3YWl0IGVxdWl0eVRyYWNraW5nQ2xpZW50LmdldERyYXdkb3duVHJhY2tlcnMoJ2FjY291bnRJZCcpO1xuICAgIGFjdHVhbC5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RBcGksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L2FjY291bnRzL2FjY291bnRJZC9kcmF3ZG93bi10cmFja2VycycsXG4gICAgICBtZXRob2Q6ICdHRVQnXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjZ2V0RHJhd2Rvd25UcmFja2VyQnlOYW1lfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBkcmF3ZG93biB0cmFja2VyIGJ5IG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0ge25hbWU6ICd0cmFja2VyTmFtZSd9O1xuICAgIHJlcXVlc3RBcGlTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcblxuICAgIGxldCBhY3R1YWwgPSBhd2FpdCBlcXVpdHlUcmFja2luZ0NsaWVudC5nZXREcmF3ZG93blRyYWNrZXJCeU5hbWUoJ2FjY291bnRJZCcsICduYW1lJyk7XG4gICAgYWN0dWFsLnNob3VsZC5lcXVhbChleHBlY3RlZCk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShkb21haW5DbGllbnQucmVxdWVzdEFwaSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkL2RyYXdkb3duLXRyYWNrZXJzL25hbWUvbmFtZScsXG4gICAgICBtZXRob2Q6ICdHRVQnXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjdXBkYXRlRHJhd2Rvd25UcmFja2VyfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCB1cGRhdGUgZHJhd2Rvd24gdHJhY2tlcicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgdXBkYXRlID0ge25hbWU6ICduZXdUcmFja2VyTmFtZSd9O1xuICAgIGF3YWl0IGVxdWl0eVRyYWNraW5nQ2xpZW50LnVwZGF0ZURyYXdkb3duVHJhY2tlcignYWNjb3VudElkJywgJ3RyYWNrZXJJZCcsIHVwZGF0ZSk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShkb21haW5DbGllbnQucmVxdWVzdEFwaSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkL2RyYXdkb3duLXRyYWNrZXJzL3RyYWNrZXJJZCcsXG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogdXBkYXRlXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjZGVsZXRlRHJhd2Rvd25UcmFja2VyfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBkZWxldGUgZHJhd2Rvd24gdHJhY2tlcicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBlcXVpdHlUcmFja2luZ0NsaWVudC5kZWxldGVEcmF3ZG93blRyYWNrZXIoJ2FjY291bnRJZCcsICd0cmFja2VySWQnKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGRvbWFpbkNsaWVudC5yZXF1ZXN0QXBpLCB7XG4gICAgICB1cmw6ICcvdXNlcnMvY3VycmVudC9hY2NvdW50cy9hY2NvdW50SWQvZHJhd2Rvd24tdHJhY2tlcnMvdHJhY2tlcklkJyxcbiAgICAgIG1ldGhvZDogJ0RFTEVURSdcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtFcXVpdHlUcmFja2luZ0NsaWVudCNnZXREcmF3ZG93bkV2ZW50c31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0cmlldmUgZHJhd2Rvd24gZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IFt7XG4gICAgICBzZXF1ZW5jZU51bWJlcjogMSxcbiAgICAgIGFjY291bnRJZDogJ2FjY291bnRJZCcsXG4gICAgICB0cmFja2VySWQ6ICd0cmFja2VySWQnLFxuICAgICAgcGVyaW9kOiAnZGF5JyxcbiAgICAgIHN0YXJ0QnJva2VyVGltZTogJzIwMjItMDQtMDggMDA6MDA6MDAuMDAwJyxcbiAgICAgIGVuZEJyb2tlclRpbWU6ICcyMDIyLTA0LTA4IDIzOjU5OjU5Ljk5OScsXG4gICAgICBicm9rZXJUaW1lOiAnMjAyMi0wNC0wOCAwOTozNjowMC4wMDAnLFxuICAgICAgYWJzb2x1dGVEcmF3ZG93bjogMjUwLFxuICAgICAgcmVsYXRpdmVEcmF3ZG93bjogMC4yNVxuICAgIH1dO1xuICAgIHJlcXVlc3RBcGlTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcblxuICAgIGxldCBhY3R1YWwgPSBhd2FpdCBlcXVpdHlUcmFja2luZ0NsaWVudC5nZXREcmF3ZG93bkV2ZW50cygnMjAyMi0wNC0wOCAwOTozNjowMC4wMDAnLCAnMjAyMi0wNC0wOCAxMDozNjowMC4wMDAnLFxuICAgICAgJ2FjY291bnRJZCcsICd0cmFja2VySWQnLCAxMDApO1xuICAgIGFjdHVhbC5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RBcGksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L2RyYXdkb3duLWV2ZW50cy9ieS1icm9rZXItdGltZScsXG4gICAgICBxczoge1xuICAgICAgICBzdGFydEJyb2tlclRpbWU6ICcyMDIyLTA0LTA4IDA5OjM2OjAwLjAwMCcsXG4gICAgICAgIGVuZEJyb2tlclRpbWU6ICcyMDIyLTA0LTA4IDEwOjM2OjAwLjAwMCcsXG4gICAgICAgIGFjY291bnRJZDogJ2FjY291bnRJZCcsXG4gICAgICAgIHRyYWNrZXJJZDogJ3RyYWNrZXJJZCcsXG4gICAgICAgIGxpbWl0OiAxMDBcbiAgICAgIH0sXG4gICAgICBtZXRob2Q6ICdHRVQnXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjZ2V0RHJhd2Rvd25TdGF0aXN0aWNzfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBkcmF3ZG93biBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleHBlY3RlZCA9IFt7XG4gICAgICBwZXJpb2Q6ICdkYXknLFxuICAgICAgc3RhcnRCcm9rZXJUaW1lOiAnMjAyMi0wNC0wOCAwMDowMDowMC4wMDAnLFxuICAgICAgZW5kQnJva2VyVGltZTogJzIwMjItMDQtMDggMjM6NTk6NTkuOTk5JyxcbiAgICAgIGluaXRpYWxCYWxhbmNlOiAxMDAwLFxuICAgICAgbWF4RHJhd2Rvd25UaW1lOiAnMjAyMi0wNC0wOCAwOTozNjowMC4wMDAnLFxuICAgICAgbWF4QWJzb2x1dGVEcmF3ZG93bjogMjUwLFxuICAgICAgbWF4UmVsYXRpdmVEcmF3ZG93bjogMC4yNSxcbiAgICAgIHRocmVzaG9sZEV4Y2VlZGVkOiB0cnVlXG4gICAgfV07XG4gICAgcmVxdWVzdEFwaVN0dWIucmVzb2x2ZXMoZXhwZWN0ZWQpO1xuXG4gICAgbGV0IGFjdHVhbCA9IGF3YWl0IGVxdWl0eVRyYWNraW5nQ2xpZW50LmdldERyYXdkb3duU3RhdGlzdGljcygnYWNjb3VudElkJywgJ3RyYWNrZXJJZCcsICcyMDIyLTA0LTA4IDA5OjM2OjAwLjAwMCcsXG4gICAgICAxMDApO1xuICAgIGFjdHVhbC5zaG91bGQuZXF1YWwoZXhwZWN0ZWQpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoZG9tYWluQ2xpZW50LnJlcXVlc3RBcGksIHtcbiAgICAgIHVybDogJy91c2Vycy9jdXJyZW50L2FjY291bnRzL2FjY291bnRJZC9kcmF3ZG93bi10cmFja2Vycy90cmFja2VySWQvc3RhdGlzdGljcycsXG4gICAgICBxczoge3N0YXJ0VGltZTogJzIwMjItMDQtMDggMDk6MzY6MDAuMDAwJywgbGltaXQ6IDEwMH0sXG4gICAgICBtZXRob2Q6ICdHRVQnXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjZ2V0RXF1aXR5Q2hhcnR9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHJpZXZlIGVxdWl0eSBjaGFydCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhwZWN0ZWQgPSBbe1xuICAgICAgc3RhcnRCcm9rZXJUaW1lOiAnMjAyMi0wNC0wOCAwMDowMDowMC4wMDAnLFxuICAgICAgZW5kQnJva2VyVGltZTogJzIwMjItMDQtMDggMjM6NTk6NTkuOTk5JyxcbiAgICAgIGF2ZXJhZ2VCYWxhbmNlOiAxMDUwLFxuICAgICAgbWluQmFsYW5jZTogMTAwLFxuICAgICAgbWF4QmFsYW5jZTogMjAwMCxcbiAgICAgIGF2ZXJhZ2VFcXVpdHk6IDEwNzUsXG4gICAgICBtaW5FcXVpdHk6IDUwLFxuICAgICAgbWF4RXF1aXR5OiAyMTAwXG4gICAgfV07XG4gICAgcmVxdWVzdEFwaVN0dWIucmVzb2x2ZXMoZXhwZWN0ZWQpO1xuXG4gICAgbGV0IGFjdHVhbCA9IGF3YWl0IGVxdWl0eVRyYWNraW5nQ2xpZW50LmdldEVxdWl0eUNoYXJ0KCdhY2NvdW50SWQnLCAnMjAyMi0wNC0wOCAwOTozNjowMC4wMDAnLFxuICAgICAgJzIwMjItMDQtMDggMTA6MzY6MDAuMDAwJyk7XG4gICAgYWN0dWFsLnNob3VsZC5lcXVhbChleHBlY3RlZCk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShkb21haW5DbGllbnQucmVxdWVzdEFwaSwge1xuICAgICAgdXJsOiAnL3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYWNjb3VudElkL2VxdWl0eS1jaGFydCcsXG4gICAgICBxczoge1xuICAgICAgICBzdGFydFRpbWU6ICcyMDIyLTA0LTA4IDA5OjM2OjAwLjAwMCcsXG4gICAgICAgIGVuZFRpbWU6ICcyMDIyLTA0LTA4IDEwOjM2OjAwLjAwMCdcbiAgICAgIH0sXG4gICAgICBtZXRob2Q6ICdHRVQnXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7RXF1aXR5VHJhY2tpbmdDbGllbnQjYWRkRHJhd2Rvd25MaXN0ZW5lcn1cbiAgICogQHRlc3Qge0VxdWl0eVRyYWNraW5nQ2xpZW50I3JlbW92ZURyYXdkb3duTGlzdGVuZXJ9XG4gICAqL1xuICBkZXNjcmliZSgnZHJhd2Rvd25MaXN0ZW5lcicsICgpID0+IHtcblxuICAgIGxldCBsaXN0ZW5lcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuXG4gICAgICBjbGFzcyBMaXN0ZW5lciBleHRlbmRzIERyYXdkb3duTGlzdGVuZXIge1xuICAgICAgICBhc3luYyBvbkRyYXdkb3duKGRyYXdkb3duRXZlbnRzKSB7fVxuICAgICAgfVxuXG4gICAgICBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0VxdWl0eVRyYWNraW5nQ2xpZW50I2FkZERyYXdkb3duTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCBhZGQgZHJhd2Rvd24gbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNhbmRib3guc3R1YihlcXVpdHlUcmFja2luZ0NsaWVudC5fZHJhd2Rvd25MaXN0ZW5lck1hbmFnZXIsICdhZGREcmF3ZG93bkxpc3RlbmVyJyk7XG4gICAgICBlcXVpdHlUcmFja2luZ0NsaWVudC5hZGREcmF3ZG93bkxpc3RlbmVyKGxpc3RlbmVyLCAnYWNjb3VudElkJywgJ3RyYWNrZXJJZCcsIDEpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIsIGxpc3RlbmVyLCAnYWNjb3VudElkJywgJ3RyYWNrZXJJZCcsIDEpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQHRlc3Qge0VxdWl0eVRyYWNraW5nQ2xpZW50I2FkZERyYXdkb3duTGlzdGVuZXJ9XG4gICAgICovXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgZHJhd2Rvd24gbGlzdGVuZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsU3R1YiA9IHNhbmRib3guc3R1YihlcXVpdHlUcmFja2luZ0NsaWVudC5fZHJhd2Rvd25MaXN0ZW5lck1hbmFnZXIsICdyZW1vdmVEcmF3ZG93bkxpc3RlbmVyJyk7XG4gICAgICBlcXVpdHlUcmFja2luZ0NsaWVudC5yZW1vdmVEcmF3ZG93bkxpc3RlbmVyKCdpZCcpO1xuICAgICAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoY2FsbFN0dWIpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG59KTtcbiJdfQ==